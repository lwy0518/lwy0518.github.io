{"meta":{"title":"lwyçš„åšå®¢","subtitle":"æ¬¢è¿å¤§å®¶ä¸æˆ‘äº¤æµ","description":"èŒ«èŒ«äººæµ·ï¼Œæ€»ä¼šä¸ä½ ç›¸é‡","author":"lwy","url":"https://lwy0518.github.io","root":"/"},"pages":[{"title":"ä¸æˆ‘ç›¸å…³","date":"2021-12-07T02:15:02.000Z","updated":"2021-12-22T03:33:24.416Z","comments":true,"path":"about/index.html","permalink":"https://lwy0518.github.io/about/index.html","excerpt":"","text":"ğŸ åŸºæœ¬ä¿¡æ¯ å§“åï¼šææ–‡è¿œ æ€§åˆ«ï¼šç”· çˆ±å¥½ï¼šæ‰“ä¹’ä¹“çƒã€å¬æ­Œ â€¦ â€¦ âœ”æŠ€èƒ½ java SQL â“ äº†è§£æˆ‘ Githubï¼šhttps://github.com/lwy0518 QQï¼š1024325635 WeChatï¼š15946947900 çŸ¥ä¹ï¼š https://www.zhihu.com/people/nan-cheng-ni-liu-86-1 ğŸ«æ•™è‚²ç»å† 2020.9 - è‡³ä»Š ï¼š åå—å¸ˆèŒƒå¤§å­¦ 2016.9 - 2020.7 ï¼š æ±Ÿè¥¿ç†å·¥å¤§å­¦ 2013.9 - 2016.7 ï¼šä¸´å·ä¸€ä¸­ 2010.9 - 2013.7 ï¼š å¤§å²—ä¸­å­¦ â€¦ â€¦"},{"title":"404","date":"2021-12-06T07:38:28.000Z","updated":"2021-12-06T07:39:37.088Z","comments":true,"path":"404/index.html","permalink":"https://lwy0518.github.io/404/index.html","excerpt":"","text":"title: â€˜404â€™permalink: /404date: 2020-10-16 15:19:35comments: falselayout: false ---"},{"title":"book","date":"2021-12-07T11:10:56.000Z","updated":"2021-12-07T11:10:56.396Z","comments":true,"path":"book/index.html","permalink":"https://lwy0518.github.io/book/index.html","excerpt":"","text":""},{"title":"ç•™è¨€æ¿","date":"2021-12-07T06:33:36.000Z","updated":"2021-12-08T07:21:43.539Z","comments":true,"path":"guestbook/index.html","permalink":"https://lwy0518.github.io/guestbook/index.html","excerpt":"","text":"æ¬¢è¿æ¥åˆ°æˆ‘çš„åšå®¢ï¼ æ¬¢è¿åœ¨è¿™é‡Œç•™è¨€ï¼ä»»ä½•é—®é¢˜éƒ½å¯ä»¥åœ¨è¿™é‡Œç•™è¨€ï¼Œæˆ‘ä¼šåŠæ—¶å›å¤çš„ï¼Œæ·»åŠ QQæˆ–å¾®ä¿¡å¯ä»¥è·å¾—æ›´å¿«çš„å›å¤é€Ÿåº¦ï¼Œåœ¨ä¾§è¾¹æ æ‰«æäºŒç»´ç å³å¯ã€‚"},{"title":"categories","date":"2021-12-06T12:13:37.000Z","updated":"2021-12-06T12:14:34.617Z","comments":true,"path":"categories/index.html","permalink":"https://lwy0518.github.io/categories/index.html","excerpt":"","text":""},{"title":"tags","date":"2021-12-06T12:14:59.000Z","updated":"2021-12-06T12:15:17.173Z","comments":true,"path":"tags/index.html","permalink":"https://lwy0518.github.io/tags/index.html","excerpt":"","text":""},{"title":"Metaverseï¼ˆå…ƒå®‡å®™ï¼‰","date":"2021-12-07T09:22:30.000Z","updated":"2021-12-07T11:32:55.974Z","comments":true,"path":"top/index.html","permalink":"https://lwy0518.github.io/top/index.html","excerpt":"","text":"å…ƒå®‡å®™"},{"title":"tools","date":"2021-12-07T10:51:44.000Z","updated":"2022-01-16T07:56:09.699Z","comments":true,"path":"tools/index.html","permalink":"https://lwy0518.github.io/tools/index.html","excerpt":"","text":"latex åœ¨çº¿è¡¨æ ¼ç”Ÿæˆå™¨ latex åœ¨çº¿å…¬å¼ç”Ÿæˆå™¨ markdown åœ¨çº¿ç¼–è¾‘ æŠ½è±¡è¯­æ³•æ ‘åœ¨çº¿ç”Ÿæˆ é˜¿é‡Œäº‘åŠ é€Ÿ ReadPaper PapersWithCode åœ¨çº¿EVMå­—èŠ‚ç è½¬Wasmå­—èŠ‚ç "},{"title":"navigate","date":"2022-01-18T03:42:45.000Z","updated":"2022-01-18T03:42:45.151Z","comments":true,"path":"navigate/index.html","permalink":"https://lwy0518.github.io/navigate/index.html","excerpt":"","text":""}],"posts":[{"title":"dockeré«˜çº§ç¯‡å­¦ä¹ ç¬”è®°","slug":"dockeré«˜çº§ç¯‡å­¦ä¹ ç¬”è®°","date":"2022-02-13T13:06:53.000Z","updated":"2022-02-13T13:50:15.506Z","comments":true,"path":"2022/02/13/dockeré«˜çº§ç¯‡å­¦ä¹ ç¬”è®°/","link":"","permalink":"https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"ç›®å½•","text":"ç›®å½• Docker é«˜çº§ç¯‡ä¸€ã€Dockerå¤æ‚å®‰è£…1.1 å®‰è£…mysqlä¸»ä»å¤åˆ¶1.1.1 ä¸»ä»å¤åˆ¶åŸç†1é»˜è®¤ä½ å·²ç»äº†è§£ 1.1.2 ä¸»ä»æ­å»ºæ­¥éª¤ 1ã€æ–°å»ºä¸»æœåŠ¡å™¨å®¹å™¨å®ä¾‹3307 123456&gt;docker run -p 3307:3306 --name mysql-master \\ &gt;-v /mydata/mysql-master/log:/var/log/mysql \\ &gt;-v /mydata/mysql-master/data:/var/lib/mysql \\ &gt;-v /mydata/mysql-master/conf:/etc/mysql \\ &gt;-e MYSQL_ROOT_PASSWORD=root \\ &gt;-d mysql:5.7 2ã€è¿›å…¥/mydata/mysql-master/confç›®å½•ä¸‹æ–°å»ºmy.cnf 12345678910111213141516171819202122&gt;[mysqld] &gt;## è®¾ç½®server_idï¼ŒåŒä¸€å±€åŸŸç½‘ä¸­éœ€è¦å”¯ä¸€ &gt;server_id=101 &gt;## æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“åç§° &gt;binlog-ignore-db=mysql &gt;## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ &gt;log-bin=mall-mysql-bin &gt;## è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨å†…å­˜å¤§å°ï¼ˆäº‹åŠ¡ï¼‰ &gt;binlog_cache_size=1M &gt;## è®¾ç½®ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆmixed,statement,rowï¼‰ &gt;binlog_format=mixed &gt;## äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ¸…ç†æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†ã€‚ &gt;expire_logs_days=7 &gt;## è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­ã€‚ &gt;## å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032é”™è¯¯æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ &gt;slave_skip_errors=1062 &gt;## è®¾ç½®utf8&gt;collation_server = utf8_general_ci &gt;## è®¾ç½®serverå­—ç¬¦é›†&gt;character_set_server = utf8 &gt;[client]&gt;default_character_set=utf8 3ã€ä¿®æ”¹å®Œé…ç½®åé‡å¯masterå®ä¾‹ 1&gt;docker restart mysql-master 4ã€è¿›å…¥mysql-masterå®¹å™¨ 123&gt;docker exec -it mysql-master /bin/bash&gt;mysql -uroot -proot 5ã€maserå®¹å™¨å®ä¾‹å†…åˆ›å»ºæ•°æ®åŒæ­¥ç”¨æˆ· 12345&gt;# åˆ›å»ºåŒæ­¥ç”¨æˆ·&gt;CREATE USER &#x27;slave&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;&gt;# åŒæ­¥ç”¨æˆ·æˆæƒ&gt;GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO &#x27;slave&#x27;@&#x27;%&#x27;; 6ã€æ–°å»ºä»æœåŠ¡å®¹å™¨å®ä¾‹3308 123456&gt;docker run -p 3308:3306 --name mysql-slave \\ &gt;-v /mydata/mysql-slave/log:/var/log/mysql \\ &gt;-v /mydata/mysql-slave/data:/var/lib/mysql \\ &gt;-v /mydata/mysql-slave/conf:/etc/mysql \\ &gt;-e MYSQL_ROOT_PASSWORD=root \\ &gt;-d mysql:5.7 7ã€è¿›å…¥/mydata/mysql-slave/confç›®å½•ä¸‹æ–°å»ºmy.cnf 1234567891011121314151617181920212223242526272829&gt;# æ·»åŠ é…ç½®æ–‡ä»¶&gt;[mysqld] &gt;## è®¾ç½®server_idï¼ŒåŒä¸€å±€åŸŸç½‘ä¸­éœ€è¦å”¯ä¸€ &gt;server_id=102 &gt;## æŒ‡å®šä¸éœ€è¦åŒæ­¥çš„æ•°æ®åº“åç§° &gt;binlog-ignore-db=mysql &gt;## å¼€å¯äºŒè¿›åˆ¶æ—¥å¿—åŠŸèƒ½ï¼Œä»¥å¤‡Slaveä½œä¸ºå…¶å®ƒæ•°æ®åº“å®ä¾‹çš„Masteræ—¶ä½¿ç”¨ &gt;log-bin=mall-mysql-slave1-bin &gt;## è®¾ç½®äºŒè¿›åˆ¶æ—¥å¿—ä½¿ç”¨å†…å­˜å¤§å°ï¼ˆäº‹åŠ¡ï¼‰ &gt;binlog_cache_size=1M &gt;## è®¾ç½®ä½¿ç”¨çš„äºŒè¿›åˆ¶æ—¥å¿—æ ¼å¼ï¼ˆmixed,statement,rowï¼‰ &gt;binlog_format=mixed &gt;## äºŒè¿›åˆ¶æ—¥å¿—è¿‡æœŸæ¸…ç†æ—¶é—´ã€‚é»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä¸è‡ªåŠ¨æ¸…ç†ã€‚ &gt;expire_logs_days=7 &gt;## è·³è¿‡ä¸»ä»å¤åˆ¶ä¸­é‡åˆ°çš„æ‰€æœ‰é”™è¯¯æˆ–æŒ‡å®šç±»å‹çš„é”™è¯¯ï¼Œé¿å…slaveç«¯å¤åˆ¶ä¸­æ–­ã€‚ &gt;## å¦‚ï¼š1062é”™è¯¯æ˜¯æŒ‡ä¸€äº›ä¸»é”®é‡å¤ï¼Œ1032é”™è¯¯æ˜¯å› ä¸ºä¸»ä»æ•°æ®åº“æ•°æ®ä¸ä¸€è‡´ &gt;slave_skip_errors=1062 &gt;## relay_logé…ç½®ä¸­ç»§æ—¥å¿— &gt;relay_log=mall-mysql-relay-bin &gt;## log_slave_updatesè¡¨ç¤ºslaveå°†å¤åˆ¶äº‹ä»¶å†™è¿›è‡ªå·±çš„äºŒè¿›åˆ¶æ—¥å¿— &gt;log_slave_updates=1 &gt;## slaveè®¾ç½®ä¸ºåªè¯»ï¼ˆå…·æœ‰superæƒé™çš„ç”¨æˆ·é™¤å¤–ï¼‰ &gt;read_only=1 &gt;## è®¾ç½®utf8&gt;collation_server = utf8_general_ci &gt;## è®¾ç½®serverå­—ç¬¦é›†&gt;character_set_server = utf8 &gt;[client]&gt;default_character_set=utf8 8ã€ä¿®æ”¹å®Œé…ç½®åé‡å¯slaveå®ä¾‹ 1&gt;docker restart mysql-slave 9ã€åœ¨ä¸»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€ 1&gt;show master status; 10ã€è¿›å…¥mysql-slaveå®¹å™¨ 12&gt;docker exec -it mysql-slave /bin/bash&gt;mysql -uroot -proot 11ã€åœ¨ä»æ•°æ®åº“ä¸­é…ç½®ä¸»ä»å¤åˆ¶ 1&gt;change master to master_host=&#x27;å®¿ä¸»æœºip&#x27;, master_user=&#x27;slave&#x27;, master_password=&#x27;123456&#x27;, master_port=3307, master_log_file=&#x27;mall-mysql-bin.000001&#x27;, master_log_pos=617, master_connect_retry=30; 12ã€åœ¨ä»æ•°æ®åº“ä¸­æŸ¥çœ‹ä¸»ä»åŒæ­¥çŠ¶æ€ 1&gt;show slave status\\G; 13ã€åœ¨ä»æ•°æ®åº“ä¸­å¼€å¯ä¸»ä»åŒæ­¥ 1&gt;start slave; 14ã€æŸ¥çœ‹ä»æ•°æ®åº“çŠ¶æ€å‘ç°å·²ç»åŒæ­¥ 15ã€ä¸»ä»å¤åˆ¶æµ‹è¯• 12&gt;1.ä¸»æœºæ–°å»ºæ•°æ®åº“ ---&gt; ä½¿ç”¨æ•°æ®åº“ ---&gt; æ–°å»ºè¡¨ ---&gt;æ’å…¥æ•°æ® ï¼Œ ok&gt;2.ä»æœºä½¿ç”¨åº“ ---&gt; æŸ¥çœ‹è®°å½• ok 1.2 å®‰è£…redisé›†ç¾¤(å¤§å‚é¢è¯•é¢˜ç¬¬4å­£-åˆ†å¸ƒå¼å­˜å‚¨æ¡ˆä¾‹çœŸé¢˜)1.2.1 cluster(é›†ç¾¤)æ¨¡å¼-dockerç‰ˆå“ˆå¸Œæ§½åˆ†åŒºè¿›è¡Œäº¿çº§æ•°æ®å­˜å‚¨ ä¸€ã€é¢è¯•é¢˜ é—®é¢˜ï¼š1~2äº¿æ¡æ•°æ®éœ€è¦ç¼“å­˜ï¼Œè¯·é—®å¦‚ä½•è®¾è®¡è¿™ä¸ªå­˜å‚¨æ¡ˆä¾‹ å›ç­”ï¼šå•æœºå•å°100%ä¸å¯èƒ½ï¼Œè‚¯å®šæ˜¯åˆ†å¸ƒå¼å­˜å‚¨ï¼Œç”¨rediså¦‚ä½•è½åœ°ï¼Ÿ ä¸Šè¿°é—®é¢˜é˜¿é‡ŒP6~P7å·¥ç¨‹æ¡ˆä¾‹å’Œåœºæ™¯è®¾è®¡ç±»å¿…è€ƒé¢˜ç›®ï¼Œä¸€èˆ¬ä¸šç•Œæœ‰3ç§è§£å†³æ–¹æ¡ˆ å“ˆå¸Œå–ä½™åˆ†åŒº 12345678910&gt;2äº¿æ¡è®°å½•å°±æ˜¯2äº¿ä¸ªk,vï¼Œæˆ‘ä»¬å•æœºä¸è¡Œå¿…é¡»è¦åˆ†å¸ƒå¼å¤šæœºï¼Œå‡è®¾æœ‰3å°æœºå™¨æ„æˆä¸€ä¸ªé›†ç¾¤ï¼Œç”¨æˆ·æ¯æ¬¡è¯»å†™æ“ä½œéƒ½æ˜¯æ ¹æ®å…¬å¼ï¼š&gt;hash(key) % Nä¸ªæœºå™¨å°æ•°ï¼Œè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œç”¨æ¥å†³å®šæ•°æ®æ˜ å°„åˆ°å“ªä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚ &gt;ä¼˜ç‚¹ï¼šç®€å•ç²—æš´ï¼Œç›´æ¥æœ‰æ•ˆï¼Œåªéœ€è¦é¢„ä¼°å¥½æ•°æ®è§„åˆ’å¥½èŠ‚ç‚¹ï¼Œä¾‹å¦‚3å°ã€8å°ã€10å°ï¼Œå°±èƒ½ä¿è¯ä¸€æ®µæ—¶é—´çš„æ•°æ®æ”¯æ’‘ã€‚ä½¿ç”¨Hashç®—æ³•è®©å›ºå®šçš„ä¸€éƒ¨åˆ†è¯·æ±‚è½åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ¯å°æœåŠ¡å™¨å›ºå®šå¤„ç†ä¸€éƒ¨åˆ†è¯·æ±‚ï¼ˆå¹¶ç»´æŠ¤è¿™äº›è¯·æ±‚çš„ä¿¡æ¯ï¼‰ï¼Œèµ·åˆ°è´Ÿè½½å‡è¡¡+åˆ†è€Œæ²»ä¹‹çš„ä½œç”¨ã€‚ &gt;ç¼ºç‚¹ï¼š åŸæ¥è§„åˆ’å¥½çš„èŠ‚ç‚¹ï¼Œè¿›è¡Œæ‰©å®¹æˆ–è€…ç¼©å®¹å°±æ¯”è¾ƒéº»çƒ¦äº†é¢ï¼Œä¸ç®¡æ‰©ç¼©ï¼Œæ¯æ¬¡æ•°æ®å˜åŠ¨å¯¼è‡´èŠ‚ç‚¹æœ‰å˜åŠ¨ï¼Œæ˜ å°„å…³ç³»éœ€è¦é‡æ–°è¿›è¡Œè®¡ç®—ï¼Œåœ¨æœåŠ¡å™¨ä¸ªæ•°å›ºå®šä¸å˜æ—¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœéœ€è¦å¼¹æ€§æ‰©å®¹æˆ–æ•…éšœåœæœºçš„æƒ…å†µä¸‹ï¼ŒåŸæ¥çš„å–æ¨¡å…¬å¼å°±ä¼šå‘ç”Ÿå˜åŒ–ï¼šHash(key)/3ä¼šå˜æˆHash(key) /?ã€‚æ­¤æ—¶åœ°å€ç»è¿‡å–ä½™è¿ç®—çš„ç»“æœå°†å‘ç”Ÿå¾ˆå¤§å˜åŒ–ï¼Œæ ¹æ®å…¬å¼è·å–çš„æœåŠ¡å™¨ä¹Ÿä¼šå˜å¾—ä¸å¯æ§ã€‚ &gt;æŸä¸ªredisæœºå™¨å®•æœºäº†ï¼Œç”±äºå°æ•°æ•°é‡å˜åŒ–ï¼Œä¼šå¯¼è‡´hashå–ä½™å…¨éƒ¨æ•°æ®é‡æ–°æ´—ç‰Œã€‚ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åˆ†åŒº 1ã€æ˜¯ä»€ä¹ˆ ä¸€è‡´æ€§Hashç®—æ³•èƒŒæ™¯ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åœ¨1997å¹´ç”±éº»çœç†å·¥å­¦é™¢ä¸­æå‡ºçš„ï¼Œè®¾è®¡ç›®æ ‡æ˜¯ä¸ºäº†è§£å†³ åˆ†å¸ƒå¼ç¼“å­˜æ•°æ® å˜åŠ¨å’Œæ˜ å°„é—®é¢˜ ï¼ŒæŸä¸ªæœºå™¨å®•æœºäº†ï¼Œåˆ†æ¯æ•°é‡æ”¹å˜äº†ï¼Œè‡ªç„¶å–ä½™æ•°ä¸OKäº†ã€‚ 2ã€èƒ½å¹²ä»€ä¹ˆ æå‡ºä¸€è‡´æ€§Hashè§£å†³æ–¹æ¡ˆã€‚ç›®çš„æ˜¯å½“æœåŠ¡å™¨ä¸ªæ•°å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œå°½é‡å‡å°‘å½±å“å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ˜ å°„å…³ç³»ã€‚ 3ã€3å¤§æ­¥éª¤ ã€ç®—æ³•æ„å»ºä¸€è‡´æ€§å“ˆå¸Œç¯ã€‘ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¿…ç„¶æœ‰ä¸ªhashå‡½æ•°å¹¶æŒ‰ç…§ç®—æ³•äº§ç”Ÿhashå€¼ï¼Œè¿™ä¸ªç®—æ³•çš„æ‰€æœ‰å¯èƒ½å“ˆå¸Œå€¼ä¼šæ„æˆä¸€ä¸ªå…¨é‡é›†ï¼Œè¿™ä¸ªé›†åˆå¯ä»¥æˆä¸ºä¸€ä¸ªhashç©ºé—´[0,2^32-1]ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªçº¿æ€§ç©ºé—´ï¼Œä½†æ˜¯åœ¨ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡é€‚å½“çš„é€»è¾‘æ§åˆ¶å°†å®ƒé¦–å°¾ç›¸è¿(0 = 2^32),è¿™æ ·è®©å®ƒé€»è¾‘ä¸Šå½¢æˆäº†ä¸€ä¸ªç¯å½¢ç©ºé—´ã€‚ å®ƒä¹Ÿæ˜¯æŒ‰ç…§ä½¿ç”¨å–æ¨¡çš„æ–¹æ³•ï¼Œå‰é¢ç¬”è®°ä»‹ç»çš„èŠ‚ç‚¹å–æ¨¡æ³•æ˜¯å¯¹èŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰çš„æ•°é‡è¿›è¡Œå–æ¨¡ã€‚è€Œä¸€è‡´æ€§Hashç®—æ³•æ˜¯å¯¹2^32å–æ¨¡ï¼Œç®€å•æ¥è¯´ï¼Œ ä¸€è‡´æ€§Hashç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ ï¼Œå¦‚å‡è®¾æŸå“ˆå¸Œå‡½æ•°Hçš„å€¼ç©ºé—´ä¸º0-2^32-1ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸Œç¯å¦‚ä¸‹å›¾ï¼šæ•´ä¸ªç©ºé—´ æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ ï¼Œåœ†ç¯çš„æ­£ä¸Šæ–¹çš„ç‚¹ä»£è¡¨0ï¼Œ0ç‚¹å³ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨1ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ2ã€3ã€4ã€â€¦â€¦ç›´åˆ°2^32-1ï¼Œä¹Ÿå°±æ˜¯è¯´0ç‚¹å·¦ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨2^32-1ï¼Œ 0å’Œ2^32-1åœ¨é›¶ç‚¹ä¸­æ–¹å‘é‡åˆï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç”±2^32ä¸ªç‚¹ç»„æˆçš„åœ†ç¯ç§°ä¸ºHashç¯ã€‚ ã€æœåŠ¡å™¨IPèŠ‚ç‚¹æ˜ å°„ã€‘ å°†é›†ç¾¤ä¸­å„ä¸ªIPèŠ‚ç‚¹æ˜ å°„åˆ°ç¯ä¸Šçš„æŸä¸€ä¸ªä½ç½®ã€‚ å°†å„ä¸ªæœåŠ¡å™¨ä½¿ç”¨Hashè¿›è¡Œä¸€ä¸ªå“ˆå¸Œï¼Œå…·ä½“å¯ä»¥é€‰æ‹©æœåŠ¡å™¨çš„IPæˆ–ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œï¼Œè¿™æ ·æ¯å°æœºå™¨å°±èƒ½ç¡®å®šå…¶åœ¨å“ˆå¸Œç¯ä¸Šçš„ä½ç½®ã€‚å‡å¦‚4ä¸ªèŠ‚ç‚¹NodeAã€Bã€Cã€Dï¼Œç»è¿‡IPåœ°å€çš„ å“ˆå¸Œå‡½æ•° è®¡ç®—(hash(ip))ï¼Œä½¿ç”¨IPåœ°å€å“ˆå¸Œååœ¨ç¯ç©ºé—´çš„ä½ç½®å¦‚ä¸‹ï¼š ã€keyè½åˆ°æœåŠ¡å™¨çš„è½é”®è§„åˆ™ã€‘ å½“æˆ‘ä»¬éœ€è¦å­˜å‚¨ä¸€ä¸ªkvé”®å€¼å¯¹æ—¶ï¼Œé¦–å…ˆè®¡ç®—keyçš„hashå€¼ï¼Œhash(key)ï¼Œå°†è¿™ä¸ªkeyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼å¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œ ä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ï¼Œå¹¶å°†è¯¥é”®å€¼å¯¹å­˜å‚¨åœ¨è¯¥èŠ‚ç‚¹ä¸Šã€‚å¦‚æˆ‘ä»¬æœ‰Object Aã€Object Bã€Object Cã€Object Då››ä¸ªæ•°æ®å¯¹è±¡ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åï¼Œåœ¨ç¯ç©ºé—´ä¸Šçš„ä½ç½®å¦‚ä¸‹ï¼šæ ¹æ®ä¸€è‡´æ€§Hashç®—æ³•ï¼Œæ•°æ®Aä¼šè¢«å®šä¸ºåˆ°Node Aä¸Šï¼ŒBè¢«å®šä¸ºåˆ°Node Bä¸Šï¼ŒCè¢«å®šä¸ºåˆ°Node Cä¸Šï¼ŒDè¢«å®šä¸ºåˆ°Node Dä¸Šã€‚ 4ã€ä¼˜ç‚¹ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„å®¹é”™æ€§ 1&gt;å‡è®¾Node Cå®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°Node Dã€‚ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§Hashç®—æ³•ä¸­ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™ å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ® ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ã€‚ç®€å•è¯´ï¼Œå°±æ˜¯CæŒ‚äº†ï¼Œå—åˆ°å½±å“çš„åªæ˜¯Bã€Cä¹‹é—´çš„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®ä¼šè½¬ç§»åˆ°Dè¿›è¡Œå­˜å‚¨ã€‚ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„æ‰©å±•æ€§ 12&gt;æ•°æ®é‡å¢åŠ äº†ï¼Œéœ€è¦å¢åŠ ä¸€å°èŠ‚ç‚¹NodeXï¼ŒXçš„ä½ç½®åœ¨Aå’ŒBä¹‹é—´ï¼Œé‚£æ”¶åˆ°å½±å“çš„ä¹Ÿå°±æ˜¯Aåˆ°Xä¹‹é—´çš„æ•°æ®ï¼Œé‡æ–°æŠŠAåˆ°Xçš„æ•°æ®å½•å…¥åˆ°Xä¸Šå³å¯ï¼Œ &gt;ä¸ä¼šå¯¼è‡´hashå–ä½™å…¨éƒ¨æ•°æ®é‡æ–°æ´—ç‰Œã€‚ 5ã€ç¼ºç‚¹ ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„æ•°æ®å€¾æ–œé—®é¢˜ 12&gt;ä¸€è‡´æ€§Hashç®—æ³•åœ¨æœåŠ¡ èŠ‚ç‚¹å¤ªå°‘æ—¶ ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€è€Œé€ æˆ æ•°æ®å€¾æ–œ ï¼ˆè¢«ç¼“å­˜çš„å¯¹è±¡å¤§éƒ¨åˆ†é›†ä¸­ç¼“å­˜åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼‰é—®é¢˜ï¼Œ &gt;ä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼š 6ã€å°æ€»ç»“ 1234567891011&gt;ä¸ºäº†åœ¨èŠ‚ç‚¹æ•°ç›®å‘ç”Ÿæ”¹å˜æ—¶å°½å¯èƒ½å°‘çš„è¿ç§»æ•°æ® &gt;å°†æ‰€æœ‰çš„å­˜å‚¨èŠ‚ç‚¹æ’åˆ—åœ¨æ”¶å°¾ç›¸æ¥çš„Hashç¯ä¸Šï¼Œæ¯ä¸ªkeyåœ¨è®¡ç®—Hashåä¼š é¡ºæ—¶é’ˆ æ‰¾åˆ°ä¸´è¿‘çš„å­˜å‚¨èŠ‚ç‚¹å­˜æ”¾ã€‚ &gt;è€Œå½“æœ‰èŠ‚ç‚¹åŠ å…¥æˆ–é€€å‡ºæ—¶ä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨Hashç¯ä¸Š é¡ºæ—¶é’ˆç›¸é‚»çš„åç»­èŠ‚ç‚¹ ã€‚ &gt;ä¼˜ç‚¹ &gt;åŠ å…¥å’Œåˆ é™¤èŠ‚ç‚¹åªå½±å“å“ˆå¸Œç¯ä¸­é¡ºæ—¶é’ˆæ–¹å‘çš„ç›¸é‚»çš„èŠ‚ç‚¹ï¼Œå¯¹å…¶ä»–èŠ‚ç‚¹æ— å½±å“ã€‚ &gt;ç¼ºç‚¹ &gt;æ•°æ®çš„åˆ†å¸ƒå’ŒèŠ‚ç‚¹çš„ä½ç½®æœ‰å…³ï¼Œå› ä¸ºè¿™äº›èŠ‚ç‚¹ä¸æ˜¯å‡åŒ€çš„åˆ†å¸ƒåœ¨å“ˆå¸Œç¯ä¸Šçš„ï¼Œæ‰€ä»¥æ•°æ®åœ¨è¿›è¡Œå­˜å‚¨æ—¶è¾¾ä¸åˆ°å‡åŒ€åˆ†å¸ƒçš„æ•ˆæœã€‚ å“ˆå¸Œæ§½åˆ†åŒº 1234561. ä¸ºä»€ä¹ˆå‡ºç°ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„æ•°æ®å€¾æ–œé—®é¢˜å“ˆå¸Œæ§½æ˜¯æŒ‡å°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„[0,2^14-1]å½¢æˆçš„hash slotç©ºé—´ã€‚2. èƒ½å¹²ä»€ä¹ˆè§£å†³å‡åŒ€åˆ†é…çš„é—®é¢˜ï¼Œåœ¨æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´æœ‰åŠ å…¥äº†ä¸€å±‚ï¼ŒæŠŠè¿™å±‚ç§°ä¸ºå“ˆå¸Œæ§½(slot)ï¼Œç”¨äºç®¡ç†æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œç°åœ¨å°±ç›¸å½“äºèŠ‚ç‚¹ä¸Šæ”¾çš„æ˜¯æ§½ï¼Œæ§½é‡Œæ”¾çš„æ˜¯æ•°æ®ã€‚ 1234æ§½è§£å†³çš„æ˜¯ç²’åº¦é—®é¢˜ï¼Œç›¸å½“äºæŠŠç²’åº¦å˜å¤§äº†ï¼Œè¿™æ ·ä¾¿äºæ•°æ®ç§»åŠ¨ã€‚ å“ˆå¸Œè§£å†³çš„æ˜¯æ˜ å°„é—®é¢˜ï¼Œä½¿ç”¨keyçš„å“ˆå¸Œå€¼æ¥è®¡ç®—æ‰€åœ¨çš„æ§½ï¼Œä¾¿äºæ•°æ®åˆ†é…ã€‚3. å¤šå°‘ä¸ªhashæ§½ ä¸€ä¸ªé›†ç¾¤åªèƒ½æœ‰16384ä¸ªæ§½ï¼Œç¼–å·0-16383ï¼ˆ0-2^14-1ï¼‰ã€‚è¿™äº›æ§½ä¼šåˆ†é…ç»™é›†ç¾¤ä¸­çš„æ‰€æœ‰ä¸»èŠ‚ç‚¹ï¼Œåˆ†é…ç­–ç•¥æ²¡æœ‰è¦æ±‚ã€‚å¯ä»¥æŒ‡å®šå“ªäº›ç¼–å·çš„æ§½åˆ†é…ç»™å“ªä¸ªä¸»èŠ‚ç‚¹ã€‚é›†ç¾¤ä¼šè®°å½•èŠ‚ç‚¹å’Œæ§½çš„å¯¹åº”å…³ç³»ã€‚è§£å†³äº†èŠ‚ç‚¹å’Œæ§½çš„å…³ç³»åï¼Œæ¥ä¸‹æ¥å°±éœ€è¦å¯¹keyæ±‚å“ˆå¸Œå€¼ï¼Œç„¶åå¯¹16384å–ä½™ï¼Œä½™æ•°æ˜¯å‡ keyå°±è½å…¥å¯¹åº”çš„æ§½é‡Œã€‚slot = CRC16(key) % 16384ã€‚ä»¥æ§½ä¸ºå•ä½ç§»åŠ¨æ•°æ®ï¼Œå› ä¸ºæ§½çš„æ•°ç›®æ˜¯å›ºå®šçš„ï¼Œå¤„ç†èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œè¿™æ ·æ•°æ®ç§»åŠ¨é—®é¢˜å°±è§£å†³äº†ã€‚ 1.2.2 redisé›†ç¾¤3ä¸»3ä»æ‰©ç¼©å®¹é…ç½®æ¡ˆä¾‹ ä¸€ã€å…³é—­é˜²ç«å¢™+å¯åŠ¨dockeråå°æœåŠ¡ 1&gt;systemctl start docker äºŒã€æ–°å»º6ä¸ªdockerå®¹å™¨rediså®ä¾‹ 12345678910111213141516&gt;# åˆ›å»ºå¹¶è¿è¡Œdockerå®¹å™¨å®ä¾‹&gt;docker run &gt;# å®¹å™¨åå­—&gt;--name redis-node-6&gt;# ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ï¼Œé»˜è®¤&gt;--net host&gt;# è·å–å®¿ä¸»æœºrootç”¨æˆ·æƒé™&gt;--privileged=true&gt;# å®¹å™¨å·ï¼Œå®¿ä¸»æœºåœ°å€:dockerå†…éƒ¨åœ°å€&gt;-v /data/redis/share/redis-node-6:/data&gt;# redisé•œåƒå’Œç‰ˆæœ¬å·&gt;redis:6.0.8&gt;# å¼€å¯redisé›†ç¾¤&gt;--cluster-enabled yes &gt;# å¼€å¯æŒä¹…åŒ–&gt;--applendonly yes 1234567891011&gt;docker run -d --name redis-node-1 --net host --privileged=true -v /data/redis/share/redis-node-1:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6381 &gt;docker run -d --name redis-node-2 --net host --privileged=true -v /data/redis/share/redis-node-2:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6382 &gt;docker run -d --name redis-node-3 --net host --privileged=true -v /data/redis/share/redis-node-3:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6383 &gt;docker run -d --name redis-node-4 --net host --privileged=true -v /data/redis/share/redis-node-4:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6384 &gt;docker run -d --name redis-node-5 --net host --privileged=true -v /data/redis/share/redis-node-5:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6385 &gt;docker run -d --name redis-node-6 --net host --privileged=true -v /data/redis/share/redis-node-6:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6386 ä¸‰ã€è¿›å…¥å®¹å™¨redis-node-1å¹¶ä¸º6å°æœºå™¨æ„å»ºé›†ç¾¤å…³ç³» 12&gt;# è¿›å…¥å®¹å™¨&gt;docker exec -it redis-node-1 /bin/bash //æ³¨æ„ï¼Œè¿›å…¥dockerå®¹å™¨åæ‰èƒ½æ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œä¸”æ³¨æ„è‡ªå·±çš„çœŸå®IPåœ°å€ 1&gt;redis-cli --cluster create 192.168.111.147:6381 192.168.111.147:6382 192.168.111.147:6383 192.168.111.147:6384 192.168.111.147:6385 192.168.111.147:6386 --cluster-replicas 1 â€“cluster-replicas 1 è¡¨ç¤ºä¸ºæ¯ä¸ªmasteråˆ›å»ºä¸€ä¸ªslaveèŠ‚ç‚¹ å››ã€è¿æ¥è¿›å…¥6318ä½œä¸ºåˆ‡å…¥ç‚¹ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 123&gt;cluster info&gt;cluster nodes 1.2.3 ä¸»ä»å®¹é”™åˆ‡æ¢è¿ç§»æ¡ˆä¾‹ ä¸€ã€æ•°æ®è¯»å†™å­˜å‚¨ å¯åŠ¨6æœºæ„æˆçš„é›†ç¾¤å¹¶é€šè¿‡execè¿›å…¥ å¯¹6381æ–°å¢ä¸¤ä¸ªkey é˜²æ­¢è·¯ç”±æ—¶æ•ˆåŠ å‚æ•°-cå¹¶æ–°å¢è¿ä¸ªkey æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ 1&gt;redis-cli --cluster check 192.168.111.147:6381 äºŒã€å®¹é”™åˆ‡æ¢è¿ç§» ä¸»6381å’Œä»æœºåˆ‡æ¢ï¼Œå…ˆåœæ­¢ä¸»æœº6381 12&gt;6381ä¸»æœºåœäº†ï¼Œå¯¹åº”çš„çœŸå®ä»æœºä¸Šä½&gt;6381ä½œä¸º1å·ä¸»æœºåˆ†é…çš„ä»æœºä»¥å®é™…æƒ…å†µä¸ºå‡†ï¼Œå…·ä½“æ˜¯å‡ å·æœºå™¨å°±æ˜¯å‡ å· å†æ¬¡æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ 6381å®•æœºäº†ï¼Œ6385ä¸Šä½æˆä¸ºäº†æ–°çš„masterã€‚ å¤‡æ³¨ï¼šæœ¬æ¬¡è„‘å›¾ç¬”è®°6381ä¸ºä¸»ä¸‹é¢æŒ‚ä»6385 ã€‚ æ¯æ¬¡æ¡ˆä¾‹ä¸‹é¢æŒ‚çš„ä»æœºä»¥å®é™…æƒ…å†µä¸ºå‡†ï¼Œå…·ä½“æ˜¯å‡ å·æœºå™¨å°±æ˜¯å‡ å· å…ˆè¿˜åŸä¹‹å‰çš„3ä¸»3ä» 1234567&gt;# å…ˆå¯6381&gt;docker start redis-node-1&gt;# å†åœ6385 &gt;docker stop redis-node-5&gt;# å†èµ·6385&gt;docker start redis-node-5&gt;ä¸»ä»æœºå™¨åˆ†é…æƒ…å†µä¸€å®é™…æƒ…å†µä¸ºå‡† æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ 1redis-cli --cluster check è‡ªå·±IP:6381 1.2.4 ä¸»ä»æ‰©å®¹æ¡ˆä¾‹ ä¸€ã€æ–°å»º6387ã€6388ä¸¤ä¸ªèŠ‚ç‚¹+æ–°å»ºåå¯åŠ¨+æŸ¥çœ‹æ˜¯å¦8èŠ‚ç‚¹ 12345&gt;docker run -d --name redis-node-7 --net host --privileged=true -v /data/redis/share/redis-node-7:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6387 &gt;docker run -d --name redis-node-8 --net host --privileged=true -v /data/redis/share/redis-node-8:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6388 &gt;docker ps äºŒã€è¿›å…¥6387å®¹å™¨å®ä¾‹å†…éƒ¨ 1&gt;docker exec -it redis-node-7 /bin/bash ä¸‰ã€å°†æ–°å¢çš„6387èŠ‚ç‚¹(ç©ºæ§½å·)ä½œä¸ºmasterèŠ‚ç‚¹åŠ å…¥åŸé›†ç¾¤ 1234&gt;å°†æ–°å¢çš„6387ä½œä¸ºmasterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤&gt;redis-cli --cluster add-node è‡ªå·±å®é™…IPåœ°å€: 6387 è‡ªå·±å®é™…IPåœ°å€: 6381 &gt;6387 å°±æ˜¯å°†è¦ä½œä¸ºmasteræ–°å¢èŠ‚ç‚¹ &gt;6381 å°±æ˜¯åŸæ¥é›†ç¾¤èŠ‚ç‚¹é‡Œé¢çš„é¢†è·¯äººï¼Œç›¸å½“äº6387æ‹œæ‹œ6381çš„ç å¤´ä»è€Œæ‰¾åˆ°ç»„ç»‡åŠ å…¥é›†ç¾¤ å››ã€æ£€æŸ¥é›†ç¾¤æƒ…å†µç¬¬1æ¬¡ 123&gt;redis-cli --cluster check çœŸå®ipåœ°å€:6381 &gt;# ä¾‹å¦‚&gt;redis-cli --cluster check 192.168.111.147:6381 äº”ã€é‡æ–°åˆ†æ´¾æ§½å· 123&gt;é‡æ–°åˆ†æ´¾æ§½å·&gt;å‘½ä»¤:redis-cli --cluster reshard IPåœ°å€:ç«¯å£å· &gt;redis-cli --cluster reshard 192.168.111.147:6381 å…­ã€æ£€æŸ¥é›†ç¾¤æƒ…å†µç¬¬2æ¬¡ 1234&gt;redis-cli --cluster check çœŸå®ipåœ°å€:6381 &gt;ä¸ºä»€ä¹ˆ6387æ˜¯3ä¸ªæ–°çš„åŒºé—´ï¼Œä»¥å‰çš„è¿˜æ˜¯è¿ç»­ï¼Ÿ&gt;é‡æ–°åˆ†é…æˆæœ¬å¤ªé«˜ï¼Œæ‰€ä»¥å‰3å®¶å„è‡ªåŒ€å‡ºæ¥ä¸€éƒ¨åˆ†ï¼Œä»6381/6382/6383ä¸‰ä¸ªæ—§èŠ‚ç‚¹åˆ†åˆ«åŒ€å‡º1364ä¸ªå‘ä½ç»™æ–°èŠ‚ç‚¹6387 ä¸ƒã€ä¸ºä¸»èŠ‚ç‚¹6387åˆ†é…ä»èŠ‚ç‚¹6388 123&gt;å‘½ä»¤ï¼šredis-cli --cluster add-node ip:æ–°slaveç«¯å£ ip:æ–°masterç«¯å£ --cluster-slave --cluster-master-id æ–°ä¸»æœºèŠ‚ç‚¹ID&gt;redis-cli --cluster add-node 192.168.111.147:6388 192.168.111.147:6387 --cluster-slave --cluster-master-id e4781f644d4a4e4d4b4d107157b9ba8144631451-------è¿™ä¸ªæ˜¯6387çš„ç¼–å·ï¼ŒæŒ‰ç…§è‡ªå·±å®é™…æƒ…å†µ å…«ã€æ£€æŸ¥é›†ç¾¤æƒ…å†µç¬¬3æ¬¡ 1&gt;redis-cli --cluster check 192.168.111.147:6382 1.2.5 ä¸»ä»ç¼©å®¹æ¡ˆä¾‹ ä¸€ã€ç›®çš„ï¼š6387å’Œ6388ä¸‹çº¿ äºŒã€æ£€æŸ¥é›†ç¾¤æƒ…å†µ1è·å¾—6388çš„èŠ‚ç‚¹ID 1&gt;redis-cli --cluster check 192.168.111.147:6382 ä¸‰ã€å°†6388åˆ é™¤ ä»é›†ç¾¤ä¸­å°†4å·ä»èŠ‚ç‚¹6388åˆ é™¤ 1234567&gt;å‘½ä»¤ï¼šredis-cli --cluster del-node ip:ä»æœºç«¯å£ ä»æœº6388èŠ‚ç‚¹ID&gt;redis-cli --cluster del-node 192.168.111.147:6388 5d149074b7e57b802287d1797a874ed7a1a284a8 &gt;redis-cli --cluster check 192.168.111.147:6382 &gt;æ£€æŸ¥ä¸€ä¸‹å‘ç°ï¼Œ6388è¢«åˆ é™¤äº†ï¼Œåªå‰©ä¸‹7å°æœºå™¨äº†ã€‚ å››ã€å°†6387çš„æ§½å·æ¸…ç©ºï¼Œé‡æ–°åˆ†é…ï¼Œæœ¬ä¾‹å°†æ¸…å‡ºæ¥çš„æ§½å·éƒ½ç»™6381 1&gt;redis-cli --cluster reshard 192.168.111.147:6381 äº”ã€æ£€æŸ¥é›†ç¾¤æƒ…å†µç¬¬äºŒæ¬¡ 123&gt;redis-cli --cluster check 192.168.111.147:6381&gt;4096ä¸ªæ§½ä½éƒ½æŒ‡ç»™6381ï¼Œå®ƒå˜æˆäº†8192ä¸ªæ§½ä½ï¼Œç›¸å½“äºå…¨éƒ¨éƒ½ç»™6381äº†ï¼Œä¸ç„¶è¦è¾“å…¥3æ¬¡ï¼Œä¸€é”…ç«¯ å…­ã€å°†6387åˆ é™¤ 12&gt;# å‘½ä»¤ï¼šredis-cli --cluster del-node ip:ç«¯å£ 6387èŠ‚ç‚¹ID&gt;redis-cli --cluster del-node 192.168.111.147:6387 e4781f644d4a4e4d4b4d107157b9ba8144631451 ä¸ƒã€æ£€æŸ¥é›†ç¾¤æƒ…å†µç¬¬ä¸‰æ¬¡ 1&gt;redis-cli --cluster check 192.168.111.147:6381 äºŒã€DockerFileè§£æ2.1 DockerFileæ˜¯ä»€ä¹ˆDockerFileæ˜¯ç”¨æ¥æ„å»ºDockeré•œåƒçš„æ–‡æœ¬æ–‡ä»¶ï¼Œæ˜¯æœ‰ä¸€æ¡æ¡æ„å»ºé•œåƒæ‰€éœ€çš„æŒ‡ä»¤å’Œå‚æ•°æ„æˆçš„è„šæœ¬ã€‚ å®˜ç½‘ï¼šhttps://docs.docker.com/engine/reference/builder/ æ„å»ºä¸‰æ­¥éª¤ 1231ã€ç¼–å†™DockerFileæ–‡ä»¶2ã€docker buildå‘½ä»¤æ„å»ºé•œåƒ3ã€docker run ä¾é•œåƒè¿è¡Œå®¹å™¨å®ä¾‹ 2.2 DockerFileæ„å»ºè¿‡ç¨‹è§£æDockerFileå†…å®¹åŸºç¡€çŸ¥è¯† 12341. æ¯æ¡ä¿ç•™å­—æŒ‡ä»¤éƒ½å¿…é¡»ä¸ºå¤§å†™å­—æ¯ä¸”åé¢è·Ÿéšè‡³å°‘ä¸€ä¸ªå‚æ•°2. æŒ‡ä»¤æŒ‰ç…§ä»ä¸Šåˆ°ä¸‹ï¼Œé¡ºåºæ‰§è¡Œ3. #è¡¨ç¤ºæ³¨é‡Š4. æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¹¶å¯¹é•œåƒè¿›è¡Œæäº¤ã€‚ Dockeræ‰§è¡ŒDockerFileçš„å¤§è‡´æµç¨‹ 123451. dockerä»æŠ€æœ¯é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨2. æ‰§è¡Œä¸€æ¡æŒ‡ä»¤æ¯”é¥å¯¹å®¹å™¨åšå‡ºä¿®æ”¹3. æ‰§è¡Œç±»ä¼¼docker commit çš„æ“ä½œæäº¤ä¸€ä¸ªæ–°çš„é•œåƒå±‚4. docker åœ¨åŸºäºåˆšæäº¤çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°å®¹å™¨5. æ‰§è¡Œdockerfileä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ç›´åˆ°æ‰€æœ‰æ‰§è¡Œæ‰§è¡Œå®Œæˆã€‚ 2.3 å°æ€»ç»“ ä»åº”ç”¨è½¯ä»¶çš„è§’åº¦æ¥çœ‹ï¼ŒDockerfileã€Dockeré•œåƒä¸Dockerå®¹å™¨åˆ†åˆ«ä»£è¡¨è½¯ä»¶çš„ä¸‰ä¸ªä¸åŒé˜¶æ®µï¼Œ Dockerfileæ˜¯è½¯ä»¶çš„åŸææ–™ Dockeré•œåƒæ˜¯è½¯ä»¶çš„äº¤ä»˜å“ Dockerå®¹å™¨åˆ™å¯ä»¥è®¤ä¸ºæ˜¯è½¯ä»¶é•œåƒçš„è¿è¡Œæ€ï¼Œä¹Ÿå³ä¾ç…§é•œåƒè¿è¡Œçš„å®¹å™¨å®ä¾‹ Dockerfileé¢å‘å¼€å‘ï¼ŒDockeré•œåƒæˆä¸ºäº¤ä»˜æ ‡å‡†ï¼ŒDockerå®¹å™¨åˆ™æ¶‰åŠéƒ¨ç½²ä¸è¿ç»´ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ï¼ŒåˆåŠ›å……å½“Dockerä½“ç³»çš„åŸºçŸ³ã€‚ Dockerfileï¼Œéœ€è¦å®šä¹‰ä¸€ä¸ªDockerfileï¼ŒDockerfileå®šä¹‰äº†è¿›ç¨‹éœ€è¦çš„ä¸€åˆ‡ä¸œè¥¿ã€‚Dockerfileæ¶‰åŠçš„å†…å®¹åŒ…æ‹¬æ‰§è¡Œä»£ç æˆ–è€…æ˜¯æ–‡ä»¶ã€ç¯å¢ƒå˜é‡ã€ä¾èµ–åŒ…ã€è¿è¡Œæ—¶ç¯å¢ƒã€åŠ¨æ€é“¾æ¥åº“ã€æ“ä½œç³»ç»Ÿçš„å‘è¡Œç‰ˆã€æœåŠ¡è¿›ç¨‹å’Œå†…æ ¸è¿›ç¨‹(å½“åº”ç”¨è¿›ç¨‹éœ€è¦å’Œç³»ç»ŸæœåŠ¡å’Œå†…æ ¸è¿›ç¨‹æ‰“äº¤é“ï¼Œè¿™æ—¶éœ€è¦è€ƒè™‘å¦‚ä½•è®¾è®¡namespaceçš„æƒé™æ§åˆ¶)ç­‰ç­‰; Dockeré•œåƒï¼Œåœ¨ç”¨Dockerfileå®šä¹‰ä¸€ä¸ªæ–‡ä»¶ä¹‹åï¼Œdocker buildæ—¶ä¼šäº§ç”Ÿä¸€ä¸ªDockeré•œåƒï¼Œå½“è¿è¡Œ Dockeré•œåƒæ—¶ä¼šçœŸæ­£å¼€å§‹æä¾›æœåŠ¡; Dockerå®¹å™¨ï¼Œå®¹å™¨æ˜¯ç›´æ¥æä¾›æœåŠ¡çš„ã€‚ 2.4 DockerFileå¸¸ç”¨ä¿ç•™å­—æŒ‡ä»¤ å‚è€ƒtomcat8çš„dockerfileå…¥é—¨ https://github.com/docker-library/tomcat From 1åŸºç¡€é•œåƒï¼Œå½“å‰æ–°é•œåƒæ˜¯åŸºäºå“ªä¸ªé•œåƒçš„ï¼ŒæŒ‡å®šä¸€ä¸ªå·²ç»å­˜åœ¨çš„é•œåƒä½œä¸ºæ¨¡æ¿ï¼Œç¬¬ä¸€æ¡å¿…é¡»æ˜¯from MANINTAINER é•œåƒç»´æŠ¤è€…çš„å§“åå’Œé‚®ç®±åœ°å€ Run å®¹å™¨æ„å»ºæ—¶éœ€è¦è¿è¡Œçš„å‘½ä»¤ ä¸¤ç§æ ¼å¼ï¼š shellæ ¼å¼ 123&lt;å‘½ä»¤è¡Œå‘½ä»¤&gt;ç­‰åŒäºï¼Œåœ¨ç»ˆç«¯æ“ä½œçš„shellå‘½ä»¤RUN yum -y install vim execæ ¼å¼ RUNæ˜¯åœ¨docker buildæ—¶è¿è¡Œ EXPOSE å½“å‰å®¹å™¨å¯¹å¤–æš´éœ²å‡ºçš„ç«¯å£ WORKDIR æŒ‡å®šåœ¨åˆ›å»ºå®¹å™¨åã€‚ç»ˆç«¯é»˜è®¤ç™»å½•çš„è¿›æ¥å·¥ä½œç›®å½•ï¼Œä¸€ä¸ªè½è„šç‚¹ã€‚ USER æŒ‡å®šè¯¥é•œåƒä»¥ä»€ä¹ˆæ ·çš„ç”¨æˆ·å»æ‰§è¡Œï¼Œå¦‚æœéƒ½ä¸æŒ‡å®šï¼Œé»˜è®¤æ˜¯root ENV ç”¨æ¥åœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­è®¾ç½®ç¯å¢ƒå˜é‡ 12345ENV MY_PATH /usr/mytest è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥åœ¨åç»­çš„ä»»ä½•RUNæŒ‡ä»¤ä¸­ä½¿ç”¨ï¼Œè¿™å°±å¦‚åŒåœ¨å‘½ä»¤å‰é¢æŒ‡å®šäº†ç¯å¢ƒå˜é‡å‰ç¼€ä¸€æ ·ï¼› ä¹Ÿå¯ä»¥åœ¨å…¶å®ƒæŒ‡ä»¤ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›ç¯å¢ƒå˜é‡ï¼Œ æ¯”å¦‚ï¼šWORKDIR $MY_PATH ADD å°†å®¿ä¸»æœºç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´è¿›é•œåƒä¸”ä¼šè‡ªåŠ¨å¤„ç†URLå’Œè§£å‹tarå‹ç¼©åŒ… COPY ç±»ä¼¼ADDï¼Œæ‹·è´æ–‡ä»¶å’Œç›®å½•åˆ°é•œåƒä¸­ã€‚å°†ä»æ„å»ºä¸Šä¸‹æ–‡ç›®å½•ä¸­&lt;æºè·¯å¾„&gt;çš„æ–‡ä»¶/ç›®å½•å¤åˆ¶åˆ°æ–°çš„ä¸€å±‚é•œåƒå†…çš„&lt;ç›®æ ‡è·¯å¾„&gt;ä½ç½® 1234567COPY src destCOPY[&quot;src&quot;,&quot;dest&quot;]&lt;srcæºè·¯å¾„&gt;ï¼šæºæ–‡ä»¶æˆ–æºç›®å½•&lt;destç›®æ ‡è·¯å¾„&gt;: å®¹å™¨å†…çš„æŒ‡å®šè·¯å¾„ï¼Œè¯¥è·¯å¾„ä¸ç”¨äº‹å…ˆå»ºå¥½ï¼Œè·¯å¾„ä¸å­˜åœ¨çš„è¯ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºã€‚ VOLUME å®¹å™¨æ•°æ®å·ï¼Œç”¨äºæ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–çš„å·¥ä½œ CMD æŒ‡å®šå®¹å™¨å¯åŠ¨åçš„è¦å¹²çš„äº‹æƒ…ã€‚ ã€æ³¨æ„ã€‘ 1Dockerfile ä¸­å¯ä»¥ç”±å¤šä¸ªCMDæŒ‡ä»¤ï¼Œä½†æ˜¯åªæœ‰æœ€åä¸€ä¸ªç”Ÿæ•ˆï¼ŒCMDä¼šè¢«docker run ä¹‹åçš„å‚æ•°æ›¿æ¢ã€‚ å‚è€ƒå®˜ç½‘Tomcatçš„dockerfileæ¼”ç¤ºè®²è§£ å®˜ç½‘æœ€åä¸€è¡Œå‘½ä»¤ 12EXPOSE 8080CMD [&quot;catalina.sh&quot;,&quot;run&quot;] æˆ‘ä»¬æ¼”ç¤ºè‡ªå·±çš„è¦†ç›–æ“ä½œ 1docker run -it -p 8080:8080 å®¹å™¨ID /bin/bash ä»–å’Œå‰é¢RUNå‘½ä»¤çš„åŒºåˆ« 123CMD æ˜¯åœ¨ docker run æ—¶è¿è¡Œã€‚RUN æ˜¯åœ¨docker build æ—¶è¿è¡Œ ENTRYPOINT ä¹Ÿæ˜¯ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦è¿è¡Œçš„å‘½ä»¤ ç±»ä¼¼äºCMDæŒ‡ä»¤ï¼Œä½†æ˜¯ENTRYPOINTä¸ä¼šè¢«docker run åé¢çš„å‘½ä»¤è¦†ç›–ï¼Œè€Œä¸”è¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°é€ç»™ENTRYPOINTæŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºã€‚ å‘½ä»¤æ ¼å¼å’Œæ¡ˆä¾‹è¯´æ˜ 1234å‘½ä»¤æ ¼å¼ï¼šENTRYPOINT[&quot;&lt;executeable&gt;&quot;,&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...] ENTRYPOINT å¯ä»¥å’ŒCMDä¸€èµ·ç”¨ï¼Œä¸€èˆ¬æ˜¯ å˜å‚ æ‰ä¼šä½¿ç”¨ CMD ï¼Œè¿™é‡Œçš„CMDç­‰äºæ˜¯åœ¨ç»™ ENTRYPOINT ä¼ å‚ã€‚å½“åˆ¶å®šäº† ENTRYPOINT åï¼ŒCMDçš„å«ä¹‰å°±å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸å†æ˜¯ç›´æ¥è¿è¡Œå…¶å‘½ä»¤è€Œæ˜¯å°† CMD çš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ ENTRYPOINT æŒ‡å®šï¼Œä»–ä¸¤ä¸ªç»„åˆä¼šå˜æˆ&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;æ¡ˆä¾‹å¦‚ä¸‹ï¼šå‡è®¾å·²é€šè¿‡ Dockerfile æ„å»ºäº† nginx:test é•œåƒ æ˜¯å¦ä¼ å‚ æŒ‰ç…§dockerfileç¼–å†™æ‰§è¡Œ ä¼ å‚è¿è¡Œ Dockerå‘½ä»¤ docker run nginx:test docker run nginx:test -c /etc/nginx/ new.conf è¡ç”Ÿå‡ºçš„å®é™…å‘½ä»¤ nginx -c /etc/nginx/nginx.conf nginx -c /etc/nginx/ new.conf ä¼˜ç‚¹ï¼šåœ¨æ‰§è¡Œdocker run çš„æ—¶å€™å¯ä»¥æŒ‡å®š ENTRYPOINT è¿è¡Œæ‰€éœ€çš„å‚æ•°ã€‚ æ³¨æ„ï¼šå¦‚æœDockerfile ä¸­å¦‚æœå­˜åœ¨å¤šä¸ª ENTRYPOINT æŒ‡ä»¤ï¼Œè¿›æœ€åä¸€ä¸ªç”Ÿæ•ˆã€‚ å°æ€»ç»“ 2.5 æ¡ˆä¾‹2.5.1 è‡ªå®šä¹‰é•œåƒmycentosjava8è¦æ±‚ 12345Centos7é•œåƒå…·å¤‡ vim + ifconfig + jdk8JDKä¸‹è½½é•œåƒåœ°å€å®˜ç½‘ï¼šhttps://www.oracle.com/java/technologies/downloads/#java8 https://mirrors.yangxingzhen.com/jdk/ ç¼–å†™ 1234567891011121314151617181920212223242526272829å‡†å¤‡ç¼–å†™Dockerfileæ–‡ä»¶ ã€æ³¨æ„ã€‘å¤§å†™å­—æ¯D FROM centosMAINTAINER zzyy&lt;zzyybs@126.com&gt; ENV MYPATH /usr/local WORKDIR $MYPATH #å®‰è£…vimç¼–è¾‘å™¨ RUN yum -y install vim #å®‰è£…ifconfigå‘½ä»¤æŸ¥çœ‹ç½‘ç»œIP RUN yum -y install net-tools #å®‰è£…java8åŠlibåº“ RUN yum -y install glibc.i686 RUN mkdir /usr/local/java #ADD æ˜¯ç›¸å¯¹è·¯å¾„jar,æŠŠjdk-8u171-linux-x64.tar.gzæ·»åŠ åˆ°å®¹å™¨ä¸­,å®‰è£…åŒ…å¿…é¡»è¦å’ŒDockerfileæ–‡ä»¶åœ¨åŒä¸€ä½ç½® ADD jdk-8u171-linux-x64.tar.gz /usr/local/java/ #é…ç½®javaç¯å¢ƒå˜é‡ ENV JAVA_HOME /usr/local/java/jdk1.8.0_171 ENV JRE_HOME $JAVA_HOME/jre ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH ENV PATH $JAVA_HOME/bin:$PATH EXPOSE 80 CMD echo $MYPATH CMD echo &quot;success--------------ok&quot; CMD /bin/bash æ„å»º 123456docker build -t æ–°é•œåƒåå­—: TAGä¾‹å¦‚ï¼šdocker build -t centosjava8:1.5 .ã€æ³¨æ„ã€‘ä¸Šé¢TAG åé¢æœ‰ä¸ªç©ºæ ¼ï¼Œæœ‰ä¸ªç‚¹ è¿è¡Œ 123docker run -it æ–°é•œåƒåå­—:TAGdocker run -it centosjava8:1.5 /bin/bash å†ä½“ä¼šä¸‹UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ 123UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒ å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼Œ åŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚ é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• 2.5.2 è™šæ‚¬é•œåƒæ˜¯ä»€ä¹ˆ 123ä»“åº“åï¼Œæ ‡ç­¾éƒ½æ˜¯ &lt;none&gt; çš„é•œåƒï¼Œä¿—ç§°dangling imageDockerfile å†™ä¸€ä¸ª æŸ¥çœ‹ 12docker image ls -f dangling=trueå‘½ä»¤ç»“æœå¦‚ä¸‹å›¾ï¼š åˆ é™¤ 123docker image prune è™šæ‚¬é•œåƒå·²ç»å¸‚åŒºå­˜åœ¨ä»·å€¼ï¼Œå¯ä»¥åˆ é™¤ 2.5.3 å®¶åº­ä½œä¸šè‡ªå®šä¹‰myubuntu123456789101112131415161718192021222324252627# ç¼–å†™å‡†å¤‡ç¼–å†™DockerFileæ–‡ä»¶vim Dockerfile----------------------FROM ubuntuMAINTAINER zzyy&lt;zzyybs@126.com&gt; ENV MYPATH /usr/local WORKDIR $MYPATH RUN apt-get update RUN apt-get install net-tools #RUN apt-get install -y iproute2 #RUN apt-get install -y inetutils-ping EXPOSE 80 CMD echo $MYPATH CMD echo &quot;install inconfig cmd into ubuntu success--------------ok&quot; CMD /bin/bash ------------------------# æ„å»ºdocker build -t æ–°é•œåƒåå­—:TAG#è¿è¡Œdocker run -it æ–°é•œåƒåå­—:TAG ä¸‰ã€Dockerå¾®æœåŠ¡å®æˆ˜3.1 é€šè¿‡IDEAæ–°å»ºä¸€ä¸ªæ™®é€šå¾®æœåŠ¡æ¨¡å—å»ºModule 1docker_boot ä¿®æ”¹POM 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;?xml version =&quot;1.0&quot; encoding =&quot;UTF-8&quot;?&gt; &lt;project xmlns =&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns: xsi =&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi :schemaLocation =&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt; 4.0.0 &lt;/ modelVersion&gt; &lt;parent&gt; &lt;groupId&gt; org.springframework.boot &lt;/ groupId&gt; &lt;artifactId&gt; spring-boot-starter-parent &lt;/ artifactId&gt; &lt;version&gt; 2.5.6 &lt;/ version&gt; &lt;relativePath /&gt; &lt;/ parent&gt; &lt;groupId&gt; com.atguigu.docker &lt;/ groupId&gt; &lt;artifactId&gt; docker_boot &lt;/ artifactId&gt; &lt;version&gt; 0.0.1-SNAPSHOT &lt;/ version&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt; UTF-8 &lt;/ project.build.sourceEncoding&gt; &lt;maven.compiler.source&gt; 1.8 &lt;/ maven.compiler.source&gt; &lt;maven.compiler.target&gt; 1.8 &lt;/ maven.compiler.target&gt; &lt;junit.version&gt; 4.12 &lt;/ junit.version&gt; &lt;log4j.version&gt; 1.2.17 &lt;/ log4j.version&gt; &lt;lombok.version&gt; 1.16.18 &lt;/ lombok.version&gt; &lt;mysql.version&gt; 5.1.47 &lt;/ mysql.version&gt; &lt;druid.version&gt; 1.1.16 &lt;/ druid.version&gt; &lt;mapper.version&gt; 4.1.5 &lt;/ mapper.version&gt; &lt;mybatis.spring.boot.version&gt; 1.3.0 &lt;/ mybatis.spring.boot.version&gt; &lt;/ properties&gt; &lt;dependencies&gt; &lt;!--SpringBoot é€šç”¨ä¾èµ–æ¨¡å— --&gt; &lt;dependency&gt; &lt;groupId&gt; org.springframework.boot &lt;/ groupId&gt; &lt;artifactId&gt; spring-boot-starter-web &lt;/ artifactId&gt; &lt;/ dependency&gt; &lt;dependency&gt; &lt;groupId&gt; org.springframework.boot &lt;/ groupId&gt; &lt;artifactId&gt; spring-boot-starter-actuator &lt;/ artifactId&gt; &lt;/ dependency&gt; &lt;!--test--&gt; &lt;dependency&gt; &lt;groupId&gt; org.springframework.boot &lt;/ groupId&gt; &lt;artifactId&gt; spring-boot-starter-test &lt;/ artifactId&gt; &lt;scope&gt; test &lt;/ scope&gt; &lt;/ dependency&gt; &lt;/ dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt; org.springframework.boot &lt;/ groupId&gt; &lt;artifactId&gt; spring-boot-maven-plugin &lt;/ artifactId&gt; &lt;/ plugin&gt; &lt;plugin&gt; &lt;groupId&gt; org.apache.maven.plugins &lt;/ groupId&gt; &lt;artifactId&gt; maven-resources-plugin &lt;/ artifactId&gt; &lt;version&gt; 3.1.0 &lt;/ version&gt; &lt;/ plugin&gt; &lt;/ plugins&gt; &lt;/ build&gt; &lt;/ project&gt; å†™YML 1server.port=6001 ä¸»å¯åŠ¨ 123456789package com.atguigu.docker;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure. SpringBootApplication ;@SpringBootApplicationpublic class DockerBootApplication &#123; public static void main(String[] args) &#123; SpringApplication. run (DockerBootApplication. class , args); &#125; &#125; ä¸šåŠ¡ç±» 12345678910111213141516171819202122232425262728293031package com.atguigu.docker.controller;import org.springframework.beans.factory.annotation. Value ;import org.springframework.web.bind.annotation. RequestMapping ;import org.springframework.web.bind.annotation.RequestMethod;import org.springframework.web.bind.annotation. RestController ;import java.util.UUID;/ *@auther zzyy *@create 2021-10-25 17:43*/@RestControllerpublic class OrderController&#123; @Value ( &quot;$&#123;server.port&#125;&quot; ) private String port ; @RequestMapping ( &quot;/order/docker&quot; ) public String helloDocker() &#123; return &quot;hello docker&quot; + &quot; \\t &quot; + port + &quot; \\t &quot; + UUID. *randomUUID* ().toString(); &#125; @RequestMapping (value = &quot;/order/index&quot; ,method = RequestMethod. *GET\\* ) public String index() &#123; return &quot; æœåŠ¡ç«¯å£å· : &quot; + &quot; \\t &quot; + port + &quot; \\t &quot; +UUID. *randomUUID* ().toString(); &#125;&#125; 3.2 é€šè¿‡dockerfile å‘å¸ƒå¾®æœåŠ¡éƒ¨ç½²åˆ°dockerå®¹å™¨3.2.1 IDEAå·¥å…·é‡Œé¢æå®šå¾®æœåŠ¡jaråŒ… 3.2.2 ç¼–å†™Dockerfile Dockerfileå†…å®¹ 12345678910111213# åŸºç¡€é•œåƒä½¿ç”¨java FROM java:8 # ä½œè€… MAINTAINER zzyy # VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp VOLUME /tmp # å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸ºzzyy_docker.jar ADD docker_boot-0.0.1-SNAPSHOT.jar /zzyy_docker.jar # è¿è¡ŒjaråŒ… RUN bash -c &#x27;touch /zzyy_docker.jar&#x27; ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/zzyy_docker.jar&quot;] #æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡ EXPOSE 6001 å°†å¾®æœåŠ¡jaråŒ…å’ŒDockerfileæ–‡ä»¶ä¸Šä¼ åˆ°åŒä¸€ä¸ªç›®å½•ä¸‹/mydocker 12docker build -t zzyy_docker:1.6 . æ„å»ºé•œåƒ 12345docker build -t zzyy_docker:1.6 .æ‰“åŒ…æˆé•œåƒæ–‡ä»¶# å‘½ä»¤docker build -t zzyy_docker:1.6 . è¿è¡Œå®¹å™¨ 1234# è¿è¡Œå‘½ä»¤docker run -d -p 6001:6001 zzyy_docker:1.6# æŸ¥çœ‹é•œåƒè¿è¡Œå‘½ä»¤docker images è®¿é—®æµ‹è¯• å››ã€Dockerç½‘ç»œ4.1 Docker ç½‘ç»œæ˜¯ä»€ä¹ˆ4.1.1 dockerä¸å¯åŠ¨ï¼Œé»˜è®¤ç½‘ç»œæƒ…å†µ123ens 33lovirbr0 1234åœ¨CentOS7çš„å®‰è£…è¿‡ç¨‹ä¸­å¦‚æœæœ‰ é€‰æ‹©ç›¸å…³è™šæ‹ŸåŒ–çš„çš„æœåŠ¡å®‰è£…ç³»ç»Ÿå ï¼Œå¯åŠ¨ç½‘å¡æ—¶ä¼šå‘ç°æœ‰ä¸€ä¸ªä»¥ç½‘æ¡¥è¿æ¥çš„ç§ç½‘åœ°å€çš„virbr0ç½‘å¡(virbr0ç½‘å¡ï¼šå®ƒè¿˜æœ‰ä¸€ä¸ªå›ºå®šçš„é»˜è®¤IPåœ°å€192.168.122.1)ï¼Œæ˜¯åšè™šæ‹Ÿæœºç½‘æ¡¥çš„ä½¿ç”¨çš„ï¼Œå…¶ä½œç”¨æ˜¯ä¸ºè¿æ¥å…¶ä¸Šçš„è™šæœºç½‘å¡æä¾› NATè®¿é—®å¤–ç½‘çš„åŠŸèƒ½ã€‚ æˆ‘ä»¬ä¹‹å‰å­¦ä¹ Linuxå®‰è£…ï¼Œå‹¾é€‰å®‰è£…ç³»ç»Ÿçš„æ—¶å€™é™„å¸¦äº†libvirtæœåŠ¡æ‰ä¼šç”Ÿæˆçš„ä¸€ä¸ªä¸œè¥¿ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥ç›´æ¥å°†libvirtdæœåŠ¡å¸è½½ï¼Œ yum remove libvirt-libs.x86_64 4.1.2 dockerå¯åŠ¨åï¼Œç½‘ç»œæƒ…å†µæŸ¥çœ‹dockerç½‘ç»œæ¨¡å¼å‘½ä»¤ 4.2 å¸¸ç”¨åŸºæœ¬å‘½ä»¤4.2.1 All å‘½ä»¤ 4.2.2 æŸ¥çœ‹ç½‘ç»œ1docker network ls 4.2.3 æŸ¥çœ‹ç½‘ç»œæºæ•°æ®1docker network inspect XXXç½‘ç»œåå­— 4.2.4 åˆ é™¤ç½‘ç»œ1docker network rm XXXç½‘ç»œåå­— 4.2.5 æ¡ˆä¾‹ 4.3 èƒ½å¹²å˜›12å®¹å™¨é—´çš„äº’è”å’Œé€šä¿¡ä»¥åŠç«¯å£æ˜ å°„å®¹å™¨IPå˜åŠ¨æ—¶å€™å¯ä»¥é€šè¿‡æœåŠ¡åç›´æ¥ç½‘ç»œé€šä¿¡è€Œä¸å—åˆ°å½±å“ 4.4 ç½‘ç»œæ¨¡å¼4.4.1 æ€»ä½“ä»‹ç»1234567bridgeæ¨¡å¼ï¼šä½¿ç”¨--network bridgeæŒ‡å®šï¼Œé»˜è®¤ä½¿ç”¨docker()hostæ¨¡å¼ï¼šä½¿ç”¨ --network hostæŒ‡å®šnoneæ¨¡å¼ï¼šä½¿ç”¨ --network noneæŒ‡å®šcontaineræ¨¡å¼ï¼šä½¿ç”¨ --network container:Nameæˆ–è€…å®¹å™¨IDæŒ‡å®š 4.4.2 å®¹å™¨å®ä¾‹å†…é»˜è®¤ç½‘ç»œIPç”Ÿäº§è§„åˆ™ 1 å…ˆå¯åŠ¨ä¸¤ä¸ªubuntuå®¹å™¨å®ä¾‹ 2 docker inspect å®¹å™¨ID or å®¹å™¨åå­— 3 å…³é—­u2å®ä¾‹ï¼Œæ–°å»ºu3ï¼ŒæŸ¥çœ‹ipå˜åŒ– 4.4.3 æ¡ˆä¾‹è¯´æ˜bridge 123456Docker æœåŠ¡é»˜è®¤ä¼šåˆ›å»ºä¸€ä¸ª docker0 ç½‘æ¡¥ï¼ˆå…¶ä¸Šæœ‰ä¸€ä¸ª docker0 å†…éƒ¨æ¥å£ï¼‰ï¼Œè¯¥æ¡¥æ¥ç½‘ç»œçš„åç§°ä¸ºdocker0ï¼Œå®ƒåœ¨ å†…æ ¸å±‚ è¿é€šäº†å…¶ä»–çš„ç‰©ç†æˆ–è™šæ‹Ÿç½‘å¡ï¼Œè¿™å°±å°†æ‰€æœ‰å®¹å™¨å’Œæœ¬åœ°ä¸»æœºéƒ½æ”¾åˆ° åŒä¸€ä¸ªç‰©ç†ç½‘ç»œ ã€‚Docker é»˜è®¤æŒ‡å®šäº† docker0 æ¥å£ çš„ IP åœ°å€å’Œå­ç½‘æ©ç ï¼Œ è®©ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¯ä»¥é€šè¿‡ç½‘æ¡¥ç›¸äº’é€šä¿¡ã€‚ # æŸ¥çœ‹ bridge ç½‘ç»œçš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶é€šè¿‡ grep è·å–åç§°é¡¹ docker network inspect bridge | grep name ifconfig æ¡ˆä¾‹ 1234567891 Dockerä½¿ç”¨Linuxæ¡¥æ¥ï¼Œåœ¨å®¿ä¸»æœºè™šæ‹Ÿä¸€ä¸ªDockerå®¹å™¨ç½‘æ¡¥(docker0)ï¼ŒDockerå¯åŠ¨ä¸€ä¸ªå®¹å™¨æ—¶ä¼šæ ¹æ®Dockerç½‘æ¡¥çš„ç½‘æ®µåˆ†é…ç»™å®¹å™¨ä¸€ä¸ªIPåœ°å€ï¼Œç§°ä¸ºContainer-IPï¼ŒåŒæ—¶Dockerç½‘æ¡¥æ˜¯æ¯ä¸ªå®¹å™¨çš„é»˜è®¤ç½‘å…³ã€‚å› ä¸ºåœ¨åŒä¸€å®¿ä¸»æœºå†…çš„å®¹å™¨éƒ½æ¥å…¥åŒä¸€ä¸ªç½‘æ¡¥ï¼Œè¿™æ ·å®¹å™¨ä¹‹é—´å°±èƒ½å¤Ÿé€šè¿‡å®¹å™¨çš„Container-IPç›´æ¥é€šä¿¡ã€‚ 2 docker run çš„æ—¶å€™ï¼Œæ²¡æœ‰æŒ‡å®šnetworkçš„è¯é»˜è®¤ä½¿ç”¨çš„ç½‘æ¡¥æ¨¡å¼å°±æ˜¯bridgeï¼Œä½¿ç”¨çš„å°±æ˜¯docker0 ã€‚åœ¨å®¿ä¸»æœºifconfig,å°±å¯ä»¥çœ‹åˆ°docker0å’Œè‡ªå·±createçš„network(åé¢è®²)eth0ï¼Œeth1ï¼Œeth2â€¦â€¦ä»£è¡¨ç½‘å¡ä¸€ï¼Œç½‘å¡äºŒï¼Œç½‘å¡ä¸‰â€¦â€¦ ï¼Œloä»£è¡¨127.0.0.1ï¼Œå³localhost ï¼Œinet addrç”¨æ¥è¡¨ç¤ºç½‘å¡çš„IPåœ°å€ 3 ç½‘æ¡¥docker0åˆ›å»ºä¸€å¯¹å¯¹ç­‰è™šæ‹Ÿè®¾å¤‡æ¥å£ä¸€ä¸ªå«vethï¼Œå¦ä¸€ä¸ªå«eth0ï¼Œæˆå¯¹åŒ¹é…ã€‚ 3.1 æ•´ä¸ªå®¿ä¸»æœºçš„ç½‘æ¡¥æ¨¡å¼éƒ½æ˜¯docker0ï¼Œç±»ä¼¼ä¸€ä¸ªäº¤æ¢æœºæœ‰ä¸€å †æ¥å£ï¼Œæ¯ä¸ªæ¥å£å«vethï¼Œåœ¨æœ¬åœ°ä¸»æœºå’Œå®¹å™¨å†…åˆ†åˆ«åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæ¥å£ï¼Œå¹¶è®©ä»–ä»¬å½¼æ­¤è”é€šï¼ˆè¿™æ ·ä¸€å¯¹æ¥å£å«veth pairï¼‰ï¼› 3.2 æ¯ä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨ä¹Ÿæœ‰ä¸€å—ç½‘å¡ï¼Œæ¯ä¸ªæ¥å£å«eth0ï¼› 3.3 docker0ä¸Šé¢çš„æ¯ä¸ªvethåŒ¹é…æŸä¸ªå®¹å™¨å®ä¾‹å†…éƒ¨çš„eth0ï¼Œä¸¤ä¸¤é…å¯¹ï¼Œä¸€ä¸€åŒ¹é…ã€‚ é€šè¿‡ä¸Šè¿°ï¼Œå°†å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨éƒ½è¿æ¥åˆ°è¿™ä¸ªå†…éƒ¨ç½‘ç»œä¸Šï¼Œä¸¤ä¸ªå®¹å™¨åœ¨åŒä¸€ä¸ªç½‘ç»œä¸‹,ä¼šä»è¿™ä¸ªç½‘å…³ä¸‹å„è‡ªæ‹¿åˆ°åˆ†é…çš„ipï¼Œæ­¤æ—¶ä¸¤ä¸ªå®¹å™¨çš„ç½‘ç»œæ˜¯äº’é€šçš„ã€‚ ã€ä»£ç ã€‘ 123docker run -d -p 8081:8080 --name tomcat81 billygoo/tomcat8-jdk8docker run -d -p 8082:8080 --name tomcat82 billygoo/tomcat8-jdk8 ä¸¤ä¸¤åŒ¹é…éªŒè¯ Host ä¸€ã€æ˜¯ä»€ä¹ˆ ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„IPåœ°å€ä¸å¤–ç•Œè¿›è¡Œé€šä¿¡ï¼Œä¸å†éœ€è¦é¢å¤–è¿›è¡ŒNATè½¬æ¢ã€‚ äºŒã€æ¡ˆä¾‹ è¯´æ˜ å®¹å™¨å°† ä¸ä¼šè·å¾— ä¸€ä¸ªç‹¬ç«‹çš„Network Namespaceï¼Œ è€Œæ˜¯å’Œå®¿ä¸»æœºå…±ç”¨ä¸€ä¸ªNetwork Namespaceã€‚ å®¹å™¨å°†ä¸ä¼šè™šæ‹Ÿå‡ºè‡ªå·±çš„ç½‘å¡è€Œæ˜¯ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ã€‚ ä»£ç  12345è­¦å‘Šï¼š docker run -d -p 8083:8080 --network host --name tomcat83 billygoo/tomcat8-jdk8æ­£ç¡®ï¼š docker run -d --network host --name tomcat83 billygoo/tomcat8-jdk8 æ— ä¹‹å‰çš„é…å¯¹æ˜¾ç¤ºäº†ï¼Œçœ‹å®¹å™¨å®ä¾‹å†…éƒ¨ æ²¡æœ‰è®¾ç½®-pçš„ç«¯å£æ˜ å°„äº†ï¼Œå¦‚ä½•è®¿é—®å¯åŠ¨çš„tomcat83ï¼Ÿ 1234http://å®¿ä¸»æœºIP:8080/ åœ¨CentOSé‡Œé¢ç”¨é»˜è®¤çš„ç«ç‹æµè§ˆå™¨è®¿é—®å®¹å™¨å†…çš„tomcat83çœ‹åˆ°è®¿é—®æˆåŠŸï¼Œå› ä¸ºæ­¤æ—¶å®¹å™¨çš„IPå€Ÿç”¨ä¸»æœºçš„ï¼Œ æ‰€ä»¥å®¹å™¨å…±äº«å®¿ä¸»æœºç½‘ç»œIPï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å¤–éƒ¨ä¸»æœºä¸å®¹å™¨å¯ä»¥ç›´æ¥é€šä¿¡ã€‚ none ä¸€ã€æ˜¯ä»€ä¹ˆ ç¦ç”¨ç½‘ç»œåŠŸèƒ½ï¼Œåªæœ‰loæ ‡è¯†ï¼ˆå°±æ˜¯127.0.0.1è¡¨ç¤ºæœ¬åœ°å›ç¯ï¼‰ äºŒã€æ¡ˆä¾‹ docker run -d -p8084:8080 â€“network none â€“name tomcat84 billygoo/tomcat8-jdk8 container ä¸€ã€æ˜¯ä»€ä¹ˆ containerâ½¹ç»œæ¨¡å¼ æ–°å»ºçš„å®¹å™¨å’Œå·²ç»å­˜åœ¨çš„ä¸€ä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªç½‘ç»œipé…ç½®è€Œä¸æ˜¯å’Œå®¿ä¸»æœºå…±äº«ã€‚æ–°åˆ›å»ºçš„å®¹å™¨ä¸ä¼šåˆ›å»ºè‡ªå·±çš„ç½‘å¡ï¼Œé…ç½®è‡ªå·±çš„IPï¼Œè€Œæ˜¯å’Œä¸€ä¸ªæŒ‡å®šçš„å®¹å™¨å…±äº«IPã€ç«¯å£èŒƒå›´ç­‰ã€‚åŒæ ·ï¼Œä¸¤ä¸ªå®¹å™¨é™¤äº†ç½‘ç»œæ–¹é¢ï¼Œå…¶ä»–çš„å¦‚æ–‡ä»¶ç³»ç»Ÿã€è¿›ç¨‹åˆ—è¡¨ç­‰è¿˜æ˜¯éš”ç¦»çš„ã€‚ äºŒã€âæ¡ˆä¾‹ 123456789&gt;docker run -d -p 8085:8080 --name tomcat85 billygoo/tomcat8-jdk8&gt;docker run -d -p 8086:8080 --network container:tomcat85 --name tomcat86 billygoo/tomcat8-jdk8&gt;è¿è¡Œç»“æœ&gt;dockerï¼šError response from daemon: conflicting optisons: port ...........&gt;# ç›¸å½“äºtomcat86å’Œtomcat85å…¬ç”¨åŒä¸€ä¸ªipåŒä¸€ä¸ªç«¯å£ï¼Œå¯¼è‡´ç«¯å£å†²çª ä¸‰ã€âœ…æ¡ˆä¾‹2 1234567&gt;Alpineæ“ä½œç³»ç»Ÿæ˜¯ä¸€ä¸ªé¢å‘å®‰å…¨çš„è½»å‹ Linuxå‘è¡Œç‰ˆ&gt;docker run -it --name alpine1 alpine /bin/sh&gt;docker run -it --network container:alpine1 --name alpine2 alpine /bin/sh è¿è¡Œç»“æœï¼ŒéªŒè¯å…±ç”¨æ­æ¡¥ å‡å¦‚æ­¤æ—¶å…³é—­alpine1ï¼Œå†çœ‹çœ‹alpine2 è‡ªå®šä¹‰ç½‘ç»œ ä¸€ã€è¿‡æ—¶çš„link äºŒã€æ˜¯ä»€ä¹ˆ ä¸‰ã€æ¡ˆä¾‹ ã€beforeã€‘ 123456&gt;æ¡ˆä¾‹ï¼š&gt;docker run -d -p 8081:8080 --name tomcat81 billygoo/tomcat8-jdk8&gt;docker run -d -p 8082:8080 --name tomcat82 billygoo/tomcat8-jdk8&gt;ä¸Šè¿°æˆåŠŸå¯åŠ¨å¹¶ç”¨docker execè¿›å…¥å„è‡ªå®¹å™¨å®ä¾‹å†…éƒ¨ 1234&gt;é—®é¢˜ï¼š&gt;1. æŒ‰ç…§IPåœ°å€pingæ˜¯OKçš„&gt;2. æŒ‰ç…§æœåŠ¡åpingç»“æœ???pingï¼š tocmat82ï¼šName or service not known ã€afterã€‘ 1234&gt;æ¡ˆä¾‹&gt;è‡ªå®šä¹‰æ¡¥æ¥ç½‘ç»œ,è‡ªå®šä¹‰ç½‘ç»œé»˜è®¤ä½¿ç”¨çš„æ˜¯æ¡¥æ¥ç½‘ç»œbridge&gt;æ–°å»ºè‡ªå®šä¹‰ç½‘ç»œ æ–°å»ºå®¹å™¨åŠ å…¥ä¸Šä¸€æ­¥æ–°å»ºçš„è‡ªå®šä¹‰ç½‘ç»œ 1234&gt;docker run -d -p 8081:8080 --network zzyy_network --name tomcat81 billygoo/tomcat8-jdk8&gt;docker run -d -p 8082:8080 --network zzyy_network --name tomcat82 billygoo/tomcat8-jdk8 äº’ç›¸pingæµ‹è¯• é—®é¢˜ç»“è®º 123&gt;1ã€è‡ªå®šä¹‰ç½‘ç»œæœ¬èº«å°±ç»´æŠ¤å¥½äº†ä¸»æœºåå’Œipçš„å¯¹åº”å…³ç³»ï¼ˆipå’ŒåŸŸåéƒ½èƒ½é€šï¼‰&gt;2ã€è‡ªå®šä¹‰ç½‘ç»œæœ¬èº«å°±ç»´æŠ¤å¥½äº†ä¸»æœºåå’Œipçš„å¯¹åº”å…³ç³»ï¼ˆipå’ŒåŸŸåéƒ½èƒ½é€šï¼‰&gt;3ã€è‡ªå®šä¹‰ç½‘ç»œæœ¬èº«å°±ç»´æŠ¤å¥½äº†ä¸»æœºåå’Œipçš„å¯¹åº”å…³ç³»ï¼ˆipå’ŒåŸŸåéƒ½èƒ½é€šï¼‰ 4.5 Dockerå¹³å°æ¶æ„å›¾è§£1234567891011ä»å…¶æ¶æ„å’Œè¿è¡Œæµç¨‹æ¥çœ‹ï¼ŒDocker æ˜¯ä¸€ä¸ª C/S æ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œä¼—å¤šæ¨¡å—å„å¸å…¶èŒã€‚ Docker è¿è¡Œçš„åŸºæœ¬æµç¨‹ä¸ºï¼š 1 ç”¨æˆ·æ˜¯ä½¿ç”¨ Docker Client ä¸ Docker Daemon å»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚ 2 Docker Daemon ä½œä¸º Docker æ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾› Docker Server çš„åŠŸèƒ½ä½¿å…¶å¯ä»¥æ¥å— Docker Client çš„è¯·æ±‚ã€‚ 3 Docker Engine æ‰§è¡Œ Docker å†…éƒ¨çš„ä¸€ç³»åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ª Job çš„å½¢å¼çš„å­˜åœ¨ã€‚ 4 Job çš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ—¶ï¼Œåˆ™ä» Docker Registry ä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨ Graph driverå°†ä¸‹è½½é•œåƒä»¥Graphçš„å½¢å¼å­˜å‚¨ã€‚ 5 å½“éœ€è¦ä¸º Docker åˆ›å»ºç½‘ç»œç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘ç»œç®¡ç†é©±åŠ¨ Network driver åˆ›å»ºå¹¶é…ç½® Docker å®¹å™¨ç½‘ç»œç¯å¢ƒã€‚ 6 å½“éœ€è¦é™åˆ¶ Docker å®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡ Execdriver æ¥å®Œæˆã€‚ 7 Libcontaineræ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼ŒNetwork driverä»¥åŠExec driveréƒ½æ˜¯é€šè¿‡Libcontaineræ¥å®ç°å…·ä½“å¯¹å®¹å™¨è¿›è¡Œçš„æ“ä½œã€‚ äº”ã€Docker-composeå®¹å™¨ç¼–æ’5.1 Docker-composeæ˜¯ä»€ä¹ˆ1Docker-Composeæ˜¯Dockerå®˜æ–¹çš„å¼€æºé¡¹ç›®ï¼Œè´Ÿè´£å®ç°å¯¹Dockerå®¹å™¨é›†ç¾¤çš„å¿«é€Ÿç¼–æ’ã€‚ 5.2 èƒ½å¹²ä»€ä¹ˆ123456789 dockerå»ºè®®æˆ‘ä»¬æ¯ä¸€ä¸ªå®¹å™¨ä¸­åªè¿è¡Œä¸€ä¸ªæœåŠ¡,å› ä¸ºdockerå®¹å™¨æœ¬èº«å ç”¨èµ„æºæå°‘,æ‰€ä»¥æœ€å¥½æ˜¯å°†æ¯ä¸ªæœåŠ¡å•ç‹¬çš„åˆ†å‰²å¼€æ¥ä½†æ˜¯è¿™æ ·æˆ‘ä»¬åˆé¢ä¸´äº†ä¸€ä¸ªé—®é¢˜ï¼Ÿ å¦‚æœæˆ‘éœ€è¦åŒæ—¶éƒ¨ç½²å¥½å¤šä¸ªæœåŠ¡,éš¾é“è¦æ¯ä¸ªæœåŠ¡å•ç‹¬å†™Dockerfileç„¶ååœ¨æ„å»ºé•œåƒ,æ„å»ºå®¹å™¨,è¿™æ ·ç´¯éƒ½ç´¯æ­»äº†,æ‰€ä»¥dockerå®˜æ–¹ç»™æˆ‘ä»¬æä¾›äº†docker-composeå¤šæœåŠ¡éƒ¨ç½²çš„å·¥å…· ä¾‹å¦‚è¦å®ç°ä¸€ä¸ªWebå¾®æœåŠ¡é¡¹ç›®ï¼Œé™¤äº†WebæœåŠ¡å®¹å™¨æœ¬èº«ï¼Œå¾€å¾€è¿˜éœ€è¦å†åŠ ä¸Šåç«¯çš„æ•°æ®åº“mysqlæœåŠ¡å®¹å™¨ï¼ŒredisæœåŠ¡å™¨ï¼Œæ³¨å†Œä¸­å¿ƒeurekaï¼Œç”šè‡³è¿˜åŒ…æ‹¬è´Ÿè½½å‡è¡¡å®¹å™¨ç­‰ç­‰ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ Composeå…è®¸ç”¨æˆ·é€šè¿‡ä¸€ä¸ªå•ç‹¬çš„ docker-compose.ymlæ¨¡æ¿æ–‡ä»¶ ï¼ˆYAML æ ¼å¼ï¼‰æ¥å®šä¹‰ ä¸€ç»„ç›¸å…³è”çš„åº”ç”¨å®¹å™¨ä¸ºä¸€ä¸ªé¡¹ç›®ï¼ˆprojectï¼‰ã€‚ å¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶å®šä¹‰ä¸€ä¸ªå¤šå®¹å™¨çš„åº”ç”¨ï¼Œç„¶åä½¿ç”¨ä¸€æ¡æŒ‡ä»¤å®‰è£…è¿™ä¸ªåº”ç”¨çš„æ‰€æœ‰ä¾èµ–ï¼Œå®Œæˆæ„å»ºã€‚Docker-Compose è§£å†³äº†å®¹å™¨ä¸å®¹å™¨ä¹‹é—´å¦‚ä½•ç®¡ç†ç¼–æ’çš„é—®é¢˜ã€‚ 5.3 å»å“ªé‡Œ5.3.1 å®˜ç½‘ï¼šhttps://docs.docker.com/compose/compose-file/compose-file-v3/ 5.3.2 å®˜ç½‘ä¸‹è½½https://docs.docker.com/compose/install/ 5.3.3 å®‰è£…æ­¥éª¤123curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose docker-compose --version 5.3.4 å¸è½½æ­¥éª¤1sudo rm /usr/local/bin/docker-compose 5.4 Compose æ ¸å¿ƒæ¦‚å¿µ5.4.1 ä¸€æ–‡ä»¶1docker-compose.yml 5.4.2 ä¸¤è¦ç´ 12345æœåŠ¡(service):ä¸€ä¸ªä¸ªåº”ç”¨å®¹å™¨å®ä¾‹ï¼Œæ¯”å¦‚è®¢å•å¾®æœåŠ¡ã€åº“å­˜å¾®æœåŠ¡ã€mysqlå®¹å™¨ã€nginxå®¹å™¨æˆ–è€…rediså®¹å™¨ã€‚å·¥ç¨‹(project):ç”±ä¸€ç»„å…³è”çš„åº”ç”¨å®¹å™¨ç»„æˆçš„ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œåœ¨ docker-compose.yml æ–‡ä»¶ä¸­å®šä¹‰ã€‚ 5.5 Compose ä½¿ç”¨çš„ä¸‰ä¸ªæ­¥éª¤12341. ç¼–å†™Dockerfileå®šä¹‰å„ä¸ªå¾®æœåŠ¡åº”ç”¨å¹¶æ„å»ºå‡ºå¯¹åº”çš„é•œåƒæ–‡ä»¶2. ä½¿ç”¨ docker-compose.yml å®šä¹‰ä¸€ä¸ªå®Œæ•´ä¸šåŠ¡å•å…ƒï¼Œå®‰æ’å¥½æ•´ä½“åº”ç”¨ä¸­çš„å„ä¸ªå®¹å™¨æœåŠ¡ã€‚3. æœ€åï¼Œæ‰§è¡Œdocker-compose upå‘½ä»¤ æ¥å¯åŠ¨å¹¶è¿è¡Œæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå®Œæˆä¸€é”®éƒ¨ç½²ä¸Šçº¿ 5.6 Composeå¸¸ç”¨å‘½ä»¤123456789101112131415Compose å¸¸ç”¨å‘½ä»¤ docker-compose -h # æŸ¥çœ‹å¸®åŠ© docker-compose up # å¯åŠ¨æ‰€æœ‰ docker-composeæœåŠ¡ docker-compose up -d # å¯åŠ¨æ‰€æœ‰ docker-composeæœåŠ¡ å¹¶åå°è¿è¡Œ docker-compose down # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚ docker-compose exec ymlé‡Œé¢çš„æœåŠ¡id # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨ docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bash docker-compose ps # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨ docker-compose top # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹ docker-compose logs ymlé‡Œé¢çš„æœåŠ¡id # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿— docker-compose config # æ£€æŸ¥é…ç½® docker-compose config -q # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º docker-compose restart # é‡å¯æœåŠ¡ docker-compose start # å¯åŠ¨æœåŠ¡ docker-compose stop # åœæ­¢æœåŠ¡ 5.5 Componse ç¼–æ’å¾®æœåŠ¡5.5.1 æ”¹é€ å‡çº§å¾®æœåŠ¡å·¥ç¨‹docker_bootä»¥å‰çš„åŸºç¡€ç‰ˆ SQLå»ºè¡¨å»ºåº“ 12345678910CREATE TABLE `t_user` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `username` varchar(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;ç”¨æˆ·å&#x27;, `password` varchar(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;å¯†ç &#x27;, `sex` tinyint(4) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;æ€§åˆ« 0=å¥³ 1=ç”· &#x27;, `deleted` tinyint(4) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤&#x27;, `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;, `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, PRIMARY KEY (`id`) ) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27; æ”¹POM 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179&lt;? xml version =&quot;1.0&quot; encoding =&quot;UTF-8&quot; ?&gt;&lt; project xmlns =&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns: xsi =&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi :schemaLocation =&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot; &gt; &lt; modelVersion &gt; 4.0.0 &lt;/ modelVersion &gt; &lt; parent &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-starter-parent &lt;/ artifactId &gt; &lt; version &gt; 2.5.6 &lt;/ version &gt; &lt;!--&lt;version&gt;2.3.10.RELEASE&lt;/version&gt;--&gt; &lt; relativePath /&gt; &lt;!-- lookup parent from repository --&gt; &lt;/ parent &gt; &lt; groupId &gt; com.atguigu.docker &lt;/ groupId &gt; &lt; artifactId &gt; docker_boot &lt;/ artifactId &gt; &lt; version &gt; 0.0.1-SNAPSHOT &lt;/ version &gt; &lt; properties &gt; &lt; project.build.sourceEncoding &gt; UTF-8 &lt;/ project.build.sourceEncoding &gt; &lt; maven.compiler.source &gt; 1.8 &lt;/ maven.compiler.source &gt; &lt; maven.compiler.target &gt; 1.8 &lt;/ maven.compiler.target &gt; &lt; junit.version &gt; 4.12 &lt;/ junit.version &gt; &lt; log4j.version &gt; 1.2.17 &lt;/ log4j.version &gt; &lt; lombok.version &gt; 1.16.18 &lt;/ lombok.version &gt; &lt; mysql.version &gt; 5.1.47 &lt;/ mysql.version &gt; &lt; druid.version &gt; 1.1.16 &lt;/ druid.version &gt; &lt; mapper.version &gt; 4.1.5 &lt;/ mapper.version &gt; &lt; mybatis.spring.boot.version &gt; 1.3.0 &lt;/ mybatis.spring.boot.version &gt; &lt;/ properties &gt; &lt; dependencies &gt; &lt;!--guava Google å¼€æºçš„ Guava ä¸­è‡ªå¸¦çš„å¸ƒéš†è¿‡æ»¤å™¨ --&gt; &lt; dependency &gt; &lt; groupId &gt; com.google.guava &lt;/ groupId &gt; &lt; artifactId &gt; guava &lt;/ artifactId &gt; &lt; version &gt; 23.0 &lt;/ version &gt; &lt;/ dependency &gt; &lt;!-- redisson --&gt; &lt; dependency &gt; &lt; groupId &gt; org.redisson &lt;/ groupId &gt; &lt; artifactId &gt; redisson &lt;/ artifactId &gt; &lt; version &gt; 3.13.4 &lt;/ version &gt; &lt;/ dependency &gt; &lt;!--SpringBoot é€šç”¨ä¾èµ–æ¨¡å— --&gt; &lt; dependency &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-starter-web &lt;/ artifactId &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-starter-actuator &lt;/ artifactId &gt; &lt;/ dependency &gt; &lt;!--swagger2--&gt; &lt; dependency &gt; &lt; groupId &gt; io.springfox &lt;/ groupId &gt; &lt; artifactId &gt; springfox-swagger2 &lt;/ artifactId &gt; &lt; version &gt; 2.9.2 &lt;/ version &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; io.springfox &lt;/ groupId &gt; &lt; artifactId &gt; springfox-swagger-ui &lt;/ artifactId &gt; &lt; version &gt; 2.9.2 &lt;/ version &gt; &lt;/ dependency &gt; &lt;!--SpringBoot ä¸ Redis æ•´åˆä¾èµ– --&gt; &lt; dependency &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-starter-data-redis &lt;/ artifactId &gt; &lt;/ dependency &gt; &lt;!--springCache--&gt; &lt; dependency &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-starter-cache &lt;/ artifactId &gt; &lt;/ dependency &gt; &lt;!--springCache è¿æ¥æ± ä¾èµ–åŒ… --&gt; &lt; dependency &gt; &lt; groupId &gt; org.apache.commons &lt;/ groupId &gt; &lt; artifactId &gt; commons-pool2 &lt;/ artifactId &gt; &lt;/ dependency &gt; &lt;!-- jedis --&gt; &lt; dependency &gt; &lt; groupId &gt; redis.clients &lt;/ groupId &gt; &lt; artifactId &gt; jedis &lt;/ artifactId &gt; &lt; version &gt; 3.1.0 &lt;/ version &gt; &lt;/ dependency &gt; &lt;!--Mysql æ•°æ®åº“é©±åŠ¨ --&gt; &lt; dependency &gt; &lt; groupId &gt; mysql &lt;/ groupId &gt; &lt; artifactId &gt; mysql-connector-java &lt;/ artifactId &gt; &lt; version &gt; 5.1.47 &lt;/ version &gt; &lt;/ dependency &gt; &lt;!--SpringBoot é›†æˆ druid è¿æ¥æ±  --&gt; &lt; dependency &gt; &lt; groupId &gt; com.alibaba &lt;/ groupId &gt; &lt; artifactId &gt; druid-spring-boot-starter &lt;/ artifactId &gt; &lt; version &gt; 1.1.10 &lt;/ version &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; com.alibaba &lt;/ groupId &gt; &lt; artifactId &gt; druid &lt;/ artifactId &gt; &lt; version &gt; $&#123;druid.version&#125; &lt;/ version &gt; &lt;/ dependency &gt; &lt;!--mybatis å’Œ springboot æ•´åˆ --&gt; &lt; dependency &gt; &lt; groupId &gt; org.mybatis.spring.boot &lt;/ groupId &gt; &lt; artifactId &gt; mybatis-spring-boot-starter &lt;/ artifactId &gt; &lt; version &gt; $&#123;mybatis.spring.boot.version&#125; &lt;/ version &gt; &lt;/ dependency &gt; &lt;!-- æ·»åŠ  springboot å¯¹ amqp çš„æ”¯æŒ --&gt; &lt; dependency &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-starter-amqp &lt;/ artifactId &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; commons-codec &lt;/ groupId &gt; &lt; artifactId &gt; commons-codec &lt;/ artifactId &gt; &lt; version &gt; 1.10 &lt;/ version &gt; &lt;/ dependency &gt; &lt;!-- é€šç”¨åŸºç¡€é…ç½® junit/devtools/test/log4j/lombok/hutool--&gt; &lt;!--hutool--&gt; &lt; dependency &gt; &lt; groupId &gt; cn.hutool &lt;/ groupId &gt; &lt; artifactId &gt; hutool-all &lt;/ artifactId &gt; &lt; version &gt; 5.2.3 &lt;/ version &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; junit &lt;/ groupId &gt; &lt; artifactId &gt; junit &lt;/ artifactId &gt; &lt; version &gt; $&#123;junit.version&#125; &lt;/ version &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-devtools &lt;/ artifactId &gt; &lt; scope &gt; runtime &lt;/ scope &gt; &lt; optional &gt; true &lt;/ optional &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-starter-test &lt;/ artifactId &gt; &lt; scope &gt; test &lt;/ scope &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; log4j &lt;/ groupId &gt; &lt; artifactId &gt; log4j &lt;/ artifactId &gt; &lt; version &gt; $&#123;log4j.version&#125; &lt;/ version &gt; &lt;/ dependency &gt; &lt; dependency &gt; &lt; groupId &gt; org.projectlombok &lt;/ groupId &gt; &lt; artifactId &gt; lombok &lt;/ artifactId &gt; &lt; version &gt; $&#123;lombok.version&#125; &lt;/ version &gt; &lt; optional &gt; true &lt;/ optional &gt; &lt;/ dependency &gt; &lt;!--persistence--&gt; &lt; dependency &gt; &lt; groupId &gt; javax.persistence &lt;/ groupId &gt; &lt; artifactId &gt; persistence-api &lt;/ artifactId &gt; &lt; version &gt; 1.0.2 &lt;/ version &gt; &lt;/ dependency &gt; &lt;!-- é€šç”¨ Mapper--&gt; &lt; dependency &gt; &lt; groupId &gt; tk.mybatis &lt;/ groupId &gt; &lt; artifactId &gt; mapper &lt;/ artifactId &gt; &lt; version &gt; $&#123;mapper.version&#125; &lt;/ version &gt; &lt;/ dependency &gt; &lt;/ dependencies &gt; &lt; build &gt; &lt; plugins &gt; &lt; plugin &gt; &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; &lt; artifactId &gt; spring-boot-maven-plugin &lt;/ artifactId &gt; &lt;/ plugin &gt; &lt; plugin &gt; &lt; groupId &gt; org.apache.maven.plugins &lt;/ groupId &gt; &lt; artifactId &gt; maven-resources-plugin &lt;/ artifactId &gt; &lt; version &gt; 3.1.0 &lt;/ version &gt; &lt;/ plugin &gt; &lt;/ plugins &gt; &lt;/ build &gt; &lt;/ project &gt; å†™YML 1234567891011121314151617181920212223242526272829server.port = 6001========================alibaba.druid* ç›¸å…³é…ç½® *=====================spring.datasource.type = com.alibaba.druid.pool.DruidDataSourcespring.datasource.driver-class-name = com.mysql.jdbc.Driverspring.datasource.url= jdbc:mysql://192.168.111.169 :3306/db2021?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=falsespring.datasource.username = rootspring.datasource.password = 123456spring.datasource.druid.test-while-idle = false========================redis* ç›¸å…³é…ç½® *=====================spring.redis.database = 0spring.redis.host = 192.168.111.169spring.redis.port = 6379spring.redis.password =spring.redis.lettuce.pool.max-active = 8spring.redis.lettuce.pool.max-wait = -1msspring.redis.lettuce.pool.max-idle = 8spring.redis.lettuce.pool.min-idle = 0========================mybatis ç›¸å…³é…ç½® *===================*=mybatis.mapper-locations = classpath:mapper/\\*.xmlmybatis.type-aliases-package = com.atguigu.docker.entities========================swagger=====================spring.swagger2.enabled = true ä¸»å¯åŠ¨ ä¸šåŠ¡ç±» ä¸€ã€configé…ç½®ç±» RedisConfig 123456789101112131415161718192021222324252627282930313233343536373839&gt;package com.atguigu.docker.config;&gt;import lombok.extern.slf4j. Slf4j ;&gt;import org.springframework.context.annotation.Bean ;&gt;import org.springframework.context.annotation.Configuration ;&gt;import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;&gt;import org.springframework.data.redis.core.RedisTemplate;&gt;import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;&gt;import org.springframework.data.redis.serializer.StringRedisSerializer;&gt;import java.io.Serializable;/*** @auther zzyy* @create 2021-10-27 17:19*/ @Configuration@Slf4jpublic class RedisConfig&#123; /*** @param lettuceConnectionFactory * @return * redis åºåˆ—åŒ–çš„å·¥å…·é…ç½®ç±»ï¼Œä¸‹é¢è¿™ä¸ªè¯·ä¸€å®šå¼€å¯é…ç½® * 127.0.0.1:6379&gt; keys * * 1) &quot;ord:102&quot; åºåˆ—åŒ–è¿‡ * 2) &quot;\\xac\\xed\\x00\\x05t\\x00\\aord:102&quot; é‡ç”Ÿï¼Œæ²¡æœ‰åºåˆ—åŒ–è¿‡ */ &gt;@Bean &gt;public RedisTemplate&lt;String,Serializable&gt; redisTemplate(LettuceConnectionFactory lettuceConnectionFactory) &#123; RedisTemplate&lt;String,Serializable&gt; redisTemplate = new RedisTemplate&lt;&gt;();redisTemplate.setConnectionFactory(lettuceConnectionFactory); // è®¾ç½® key åºåˆ—åŒ–æ–¹å¼ string redisTemplate.setKeySerializer( new StringRedisSerializer()); // è®¾ç½® value çš„åºåˆ—åŒ–æ–¹å¼ json redisTemplate.setValueSerializer(new GenericJackson2JsonRedisSerializer());redisTemplate.setHashKeySerializer(new StringRedisSerializer());redisTemplate.setHashValueSerializer( new GenericJackson2JsonRedisSerializer());redisTemplate.afterPropertiesSet();return redisTemplate; &#125;&#125; SwaggerConfig 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.atguigu.docker.config; import org.springframework.beans.factory.annotation. Value ; import org.springframework.context.annotation. Bean ; import org.springframework.context.annotation. Configuration ; import springfox.documentation.builders.ApiInfoBuilder; import springfox.documentation.builders.PathSelectors; import springfox.documentation.builders.RequestHandlerSelectors; import springfox.documentation.service.ApiInfo; import springfox.documentation.spi.DocumentationType; import springfox.documentation.spring.web.plugins.Docket; import springfox.documentation.swagger2.annotations. EnableSwagger2 ; import java.text.SimpleDateFormat; import java.util.Date; /** *@auther zzyy *@create 2021-05-01 16:18 */ @Configuration @EnableSwagger2 public class SwaggerConfig &#123; @Value ( &quot;$&#123;spring.swagger2.enabled&#125;&quot; ) private Boolean enabled ; @Bean public Docket createRestApi() &#123; return new Docket(DocumentationType. *SWAGGER_2\\* ) .apiInfo(apiInfo()) .enable( enabled ) .select() .apis(RequestHandlerSelectors. *basePackage* ( &quot;com.atguigu.docker&quot; )) *//* ä½ è‡ªå·±çš„ *package .paths(PathSelectors. *any* ()) .build(); &#125; public ApiInfo apiInfo() &#123; return new ApiInfoBuilder() .title( &quot; å°šç¡…è°· Java å¤§å‚æŠ€æœ¯ &quot; + &quot; \\t &quot; + new SimpleDateFormat( &quot;yyyy-MM-dd&quot; ).format( new Date())) .description( &quot;docker-compose&quot; ) .version( &quot;1.0&quot; ) .termsOfServiceUrl( &quot;https://www.atguigu.com/&quot; ) .build(); &#125; &#125; æ–°å»ºentity User 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package com.atguigu.docker.entities; import javax.persistence. Column ; import javax.persistence. GeneratedValue ; import javax.persistence. Id ; import javax.persistence. Table ; import java.util.Date; @Table (name = &quot;t_user&quot; ) public class User &#123; @Id @GeneratedValue (generator = &quot;JDBC&quot; ) private Integer id ; private String username ; private String password ; private Byte sex ; private Byte deleted ; @Column (name = &quot;update_time&quot; ) private Date updateTime ; @Column (name = &quot;create_time&quot; ) private Date createTime ; public Integer getId() &#123; return id ; &#125; public void setId(Integer id) &#123; this . id = id; &#125; public String getUsername() &#123; return username ; &#125; public void setUsername(String username) &#123; this . username = username; &#125; public String getPassword() &#123; return password ; &#125; public void setPassword(String password) &#123; this . password = password; &#125; public Byte getSex() &#123; return sex ; &#125; public void setSex(Byte sex) &#123; this . sex = sex; &#125; public Byte getDeleted() &#123; return deleted ; &#125; public void setDeleted(Byte deleted) &#123; this . deleted = deleted; &#125; public Date getUpdateTime() &#123; return updateTime ; &#125; public void setUpdateTime(Date updateTime) &#123; this . updateTime = updateTime; &#125; public Date getCreateTime() &#123; return createTime ; &#125; public void setCreateTime(Date createTime) &#123; this . createTime = createTime; &#125; &#125; UserDTO 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157package com.atguigu.docker.entities;import io.swagger.annotations. ApiModel ;import io.swagger.annotations. ApiModelProperty ;import lombok. AllArgsConstructor ;import lombok. Data ;import lombok. NoArgsConstructor ;import java.io.Serializable;import java.util.Date;@NoArgsConstructor@AllArgsConstructor@Data@ApiModel (value = &quot; ç”¨æˆ·ä¿¡æ¯ &quot; )public class UserDTO implements Serializable&#123; @ApiModelProperty (value = &quot; ç”¨æˆ· ID&quot; ) private Integer id ; @ApiModelProperty (value = &quot; ç”¨æˆ·å &quot; ) private String username ; @ApiModelProperty (value = &quot; å¯†ç  &quot; ) private String password ; @ApiModelProperty (value = &quot; æ€§åˆ« 0= å¥³ 1= ç”· &quot; ) private Byte sex ; @ApiModelProperty (value = &quot; åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤ 0 ä¸åˆ é™¤ï¼Œ 1 åˆ é™¤ &quot; ) private Byte deleted ; @ApiModelProperty (value = &quot; æ›´æ–°æ—¶é—´ &quot; ) private Date updateTime ; @ApiModelProperty (value = &quot; åˆ›å»ºæ—¶é—´ &quot; ) private Date createTime ; /** * @return id */ public Integer getId() &#123; return id ; &#125; /** * @param id */ public void setId(Integer id) &#123; this . id = id; &#125; /** * è·å–ç”¨æˆ·å * * @return username - ç”¨æˆ·å */ public String getUsername() &#123; return username ; &#125; /** * è®¾ç½®ç”¨æˆ·å * * @param username ç”¨æˆ·å */ public void setUsername(String username) &#123; this.username = username; &#125; /** * è·å–å¯†ç  * * @return password - å¯†ç  */ public String getPassword() &#123; return password ; &#125; /** * è®¾ç½®å¯†ç  * * @param password å¯†ç  */ public void setPassword(String password) &#123; this.password=password; &#125; /** *è·å–æ€§åˆ« 0= å¥³ 1= ç”· * * @return sex - æ€§åˆ« 0= å¥³ 1= ç”· */ public Byte getSex() &#123; return sex ; &#125; /** * è®¾ç½®æ€§åˆ« 0= å¥³ 1= ç”· * * @param sex æ€§åˆ« 0= å¥³ 1= ç”· */ public void setSex(Byte sex) &#123; this.sex = sex; &#125; /** * è·å–åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤ 0 ä¸åˆ é™¤ï¼Œ 1 åˆ é™¤ * * @return deleted - åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤ 0 ä¸åˆ é™¤ï¼Œ 1 åˆ é™¤ */ public Byte getDeleted() &#123; return deleted ; &#125; /** * è®¾ç½®åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤ 0 ä¸åˆ é™¤ï¼Œ 1 åˆ é™¤ * * @param deleted åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤ 0 ä¸åˆ é™¤ï¼Œ 1 åˆ é™¤ */ public void setDeleted(Byte deleted) &#123; this.deleted = deleted; &#125; /** * è·å–æ›´æ–°æ—¶é—´ * * @return update_time - æ›´æ–°æ—¶é—´ */ public Date getUpdateTime() &#123; return updateTime ; &#125; /** * è®¾ç½®æ›´æ–°æ—¶é—´ * * @param updateTime æ›´æ–°æ—¶é—´ */ public void setUpdateTime(Date updateTime) &#123; this . updateTime = updateTime; &#125; /** * è·å–åˆ›å»ºæ—¶é—´ * * @return create_time - åˆ›å»ºæ—¶é—´ */ public Date getCreateTime() &#123; return createTime ; &#125; /** * è®¾ç½®åˆ›å»ºæ—¶é—´ * * @param createTime åˆ›å»ºæ—¶é—´ */ public void setCreateTime(Date createTime) &#123; this . createTime = createTime; &#125; @Override public String toString() &#123; \\ return &quot;User&#123;&quot; + &quot;id=&quot; + id + &quot;, username=&#x27;&quot; + username + &#x27; \\&#x27; &#x27; + &quot;, password=&#x27;&quot; + password + &#x27; \\&#x27; &#x27; + &quot;, sex=&quot; + sex + &#x27;&#125;&#x27; ; &#125;&#125; æ–°å»ºmapper 12345678æ–°å»ºæ¥å£UserMappersrc\\main\\resourceè·¯å¾„ä¸‹æ–°å»ºmapperæ–‡ä»¶å¤¹å¹¶æ–°å¢UserMapper.xmlpackage com.atguigu.docker.mapper;import com.atguigu.docker.entities.User;import tk.mybatis.mapper.common.Mapper;public interface UserMapper extends Mapper&lt;User&gt; &#123;&#125; UserMapper.xml 123456789101112131415 &lt;? xml version =&quot;1.0&quot; encoding =&quot;UTF-8&quot; ?&gt; &lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot; &gt; &lt; mapper namespace =&quot;com.atguigu.docker.mapper.UserMapper&quot; &gt; &lt; resultMap id =&quot;BaseResultMap&quot; type =&quot;com.atguigu.docker.entities.User&quot; &gt; &lt;!-- WARNING - @mbg.generated --&gt; &lt; id column =&quot;id&quot; jdbcType =&quot;INTEGER&quot; property =&quot;id&quot; /&gt; &lt; result column =&quot;username&quot; jdbcType =&quot;VARCHAR&quot; property =&quot;username&quot; /&gt; &lt; result column =&quot;password&quot; jdbcType =&quot;VARCHAR&quot; property =&quot;password&quot; /&gt; &lt; result column =&quot;sex&quot; jdbcType =&quot;TINYINT&quot; property =&quot;sex&quot; /&gt; &lt; result column =&quot;deleted&quot; jdbcType =&quot;TINYINT&quot; property =&quot;deleted&quot; /&gt; &lt; result column =&quot;update_time&quot; jdbcType =&quot;TIMESTAMP&quot; property =&quot;updateTime&quot; /&gt; &lt; result column =&quot;create_time&quot; jdbcType =&quot;TIMESTAMP&quot; property =&quot;createTime&quot; /&gt; &lt;/ resultMap &gt; &lt;/ mapper &gt; æ–°å»ºService 1234```**æ–°å»ºController** 1234567891011121314151617181920212223mvn packageå‘½ä»¤å°†å¾®æœåŠ¡å½¢æˆæ–°çš„jaråŒ…å¹¶ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨/mydockerç›®å½•ä¸‹**ç¼–å†™Dockerfile**```shell# åŸºç¡€é•œåƒä½¿ç”¨java FROM java:8 # ä½œè€… MAINTAINER zzyy # VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp VOLUME /tmp # å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸ºzzyy_docker.jar ADD docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar # è¿è¡ŒjaråŒ… RUN bash -c &#x27;touch /zzyy_docker.jar&#x27; ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/zzyy_docker.jar&quot;] #æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡ EXPOSE 6001 æ„å»ºé•œåƒ 1docker build -t zzyy_docker:1.6 . 5.5.2 ä¸ç”¨Compose 1234567891011121314151617181920ä¸€ã€å•ç‹¬çš„mysqlå®¹å™¨å®ä¾‹1. æ–°å»ºmysqlå®¹å™¨å®ä¾‹docker run -p 3306:3306 --name mysql57 --privileged=true -v /zzyyuse/mysql/conf:/etc/mysql/conf.d -v /zzyyuse/mysql/logs:/logs -v /zzyyuse/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.72. è¿›å…¥mysqlå®¹å™¨å®ä¾‹å¹¶æ–°å»ºåº“db2021+æ–°å»ºè¡¨t_userdocker exec -it mysql57 /bin/bash mysql -uroot -p create database db2021; use db2021; CREATE TABLE `t_user` ( `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT, `username` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;ç”¨æˆ·å&#x27;, `password` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;å¯†ç &#x27;, `sex` TINYINT(4) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;æ€§åˆ« 0=å¥³ 1=ç”· &#x27;, `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤&#x27;, `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;, `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, PRIMARY KEY (`id`) ) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27;; å•ç‹¬çš„rediså®¹å™¨å®ä¾‹ 1docker run -p 6379:6379 --name redis608 --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf å¾®æœåŠ¡å·¥ç¨‹ 1docker run -d -p 6001:6001 zzyy_docker:1.6 ä¸Šé¢ä¸‰ä¸ªå®¹å™¨å®ä¾‹ä¾æ¬¡é¡ºåºå¯åŠ¨æˆåŠŸ 1docker ps 5.5.3 swagger æµ‹è¯• 1http://localhost:ä½ çš„å¾®æœåŠ¡ç«¯å£å·/swagger-ui.html#/ 5.5.4 ä¸Šé¢å­˜åœ¨ä»€ä¹ˆé—®é¢˜ï¼Ÿ1234567å…ˆåé¡ºåºè¦æ±‚å›ºå®šï¼Œå…ˆmysql+redisæ‰èƒ½å¾®æœåŠ¡è®¿é—®æˆåŠŸå¤šä¸ªrunå‘½ä»¤......å®¹å™¨é—´çš„å¯åœæˆ–å®•æœºï¼Œæœ‰å¯èƒ½å¯¼è‡´IPåœ°å€å¯¹åº”çš„å®¹å™¨å®ä¾‹å˜åŒ–ï¼Œæ˜ å°„å‡ºé”™ï¼Œè¦ä¹ˆç”Ÿäº§IPå†™æ­»(å¯ä»¥ä½†æ˜¯ä¸æ¨è)ï¼Œè¦ä¹ˆé€šè¿‡æœåŠ¡è°ƒç”¨ 5.5.5 ä½¿ç”¨Compose1231. æœåŠ¡ç¼–æ’ï¼Œä¸€å¥—å¸¦èµ°ï¼Œå®‰æ’2. ç¼–å†™docker-componse.ymlæ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849version: &quot;3&quot; services: microService: image: zzyy_docker:1.6 container_name: ms01 ports: - &quot;6001:6001&quot; volumes: - /app/microService:/data networks: - atguigu_net depends_on: - redis - mysql redis: image: redis:6.0.8 ports: - &quot;6379:6379&quot; volumes: - /app/redis/redis.conf:/etc/redis/redis.conf - /app/redis/data:/data networks: - atguigu_net command: redis-server /etc/redis/redis.conf mysql: image: mysql:5.7 environment: MYSQL_ROOT_PASSWORD: &#x27;123456&#x27; MYSQL_ALLOW_EMPTY_PASSWORD: &#x27;no&#x27; MYSQL_DATABASE: &#x27;db2021&#x27; MYSQL_USER: &#x27;zzyy&#x27; MYSQL_PASSWORD: &#x27;zzyy123&#x27; ports: - &quot;3306:3306&quot; volumes: - /app/mysql/db:/var/lib/mysql - /app/mysql/conf/my.cnf:/etc/my.cnf - /app/mysql/init:/docker-entrypoint-initdb.d networks: - atguigu_net command: --default-authentication-plugin=mysql_native_password #è§£å†³å¤–éƒ¨æ— æ³•è®¿é—® networks: atguigu_net: 123. ç¬¬äºŒæ¬¡ä¿®æ”¹å¾®æœåŠ¡å·¥ç¨‹docker_bootå†™YML é€šè¿‡æœåŠ¡åè®¿é—®ï¼ŒIPæ— å…³ 12345678910111213141516171819202122server.port = 6001# ========================alibaba.druid ç›¸å…³é…ç½® =====================spring.datasource.type = com.alibaba.druid.pool.DruidDataSourcespring.datasource.driver-class-name=com.mysql.jdbc.Driver#spring.datasource.url=jdbc:mysql://192.168.111.169:3306/db2021?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=falsespring.datasource.url = jdbc:mysql://mysql:3306/db2021?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false spring.datasource.username = rootspring.datasource.password = 123456spring.datasource.druid.test-while-idle = false# ========================redis ç›¸å…³é…ç½® =====================spring.redis.database = 0#spring.redis.host=192.168.111.169spring.redis.host = redis spring.redis.port = 6379spring.redis.password =spring.redis.lettuce.pool.max-active = 8spring.redis.lettuce.pool.max-wait = -1msspring.redis.lettuce.pool.max-idle = 8spring.redis.lettuce.pool.min-idle = 0# ========================mybatis ç›¸å…³é…ç½® ===================mybatis.mapper-locations = classpath:mapper/*.xmlmybatis.type-aliases-package = com.atguigu.docker.entities# ========================swagger=====================spring.swagger2.enabled = true 12345678910111213141516171819202122mvn packageå‘½ä»¤å°†å¾®æœåŠ¡å½¢æˆæ–°çš„jaråŒ…å¹¶ä¸Šä¼ åˆ°LinuxæœåŠ¡å™¨/mydockerç›®å½•ä¸‹ç¼–å†™Dockerfile# åŸºç¡€é•œåƒä½¿ç”¨java FROM java:8 # ä½œè€… MAINTAINER zzyy # VOLUME æŒ‡å®šä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸º/tmpï¼Œåœ¨ä¸»æœº/var/lib/dockerç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶å¹¶é“¾æ¥åˆ°å®¹å™¨çš„/tmp VOLUME /tmp # å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ä¸­å¹¶æ›´åä¸ºzzyy_docker.jar ADD docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar # è¿è¡ŒjaråŒ… RUN bash -c &#x27;touch /zzyy_docker.jar&#x27; ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/zzyy_docker.jar&quot;] #æš´éœ²6001ç«¯å£ä½œä¸ºå¾®æœåŠ¡ EXPOSE 6001 æ„å»ºé•œåƒdocker build -t zzyy_docker:1.6 . 14. æ‰§è¡Œ docker-compose up æˆ–è€… æ‰§è¡Œ docker-compose up -d 123456789101112131415165. è¿›å…¥mysqlå®¹å™¨å®ä¾‹å¹¶æ–°å»ºåº“db2021+æ–°å»ºè¡¨t_userdocker exec -it å®¹å™¨å®ä¾‹id /bin/bash mysql -uroot -p create database db2021; use db2021; CREATE TABLE `t_user` ( `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT, `username` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;ç”¨æˆ·å&#x27;, `password` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;å¯†ç &#x27;, `sex` TINYINT(4) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;æ€§åˆ« 0=å¥³ 1=ç”· &#x27;, `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;åˆ é™¤æ ‡å¿—ï¼Œé»˜è®¤0ä¸åˆ é™¤ï¼Œ1åˆ é™¤&#x27;, `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;æ›´æ–°æ—¶é—´&#x27;, `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, PRIMARY KEY (`id`) ) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;ç”¨æˆ·è¡¨&#x27;; 12345678910111213141516176. æµ‹è¯•é€šè¿‡7. Composeå¸¸ç”¨å‘½ä»¤Compose å¸¸ç”¨å‘½ä»¤ docker-compose -h # æŸ¥çœ‹å¸®åŠ© docker-compose up # å¯åŠ¨æ‰€æœ‰ docker-composeæœåŠ¡ docker-compose up -d # å¯åŠ¨æ‰€æœ‰ docker-composeæœåŠ¡ å¹¶åå°è¿è¡Œ docker-compose down # åœæ­¢å¹¶åˆ é™¤å®¹å™¨ã€ç½‘ç»œã€å·ã€é•œåƒã€‚ docker-compose exec ymlé‡Œé¢çš„æœåŠ¡id # è¿›å…¥å®¹å™¨å®ä¾‹å†…éƒ¨ docker-compose exec docker-compose.ymlæ–‡ä»¶ä¸­å†™çš„æœåŠ¡id /bin/bash docker-compose ps # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„è¿è¡Œçš„æ‰€æœ‰å®¹å™¨ docker-compose top # å±•ç¤ºå½“å‰docker-composeç¼–æ’è¿‡çš„å®¹å™¨è¿›ç¨‹ docker-compose logs ymlé‡Œé¢çš„æœåŠ¡id # æŸ¥çœ‹å®¹å™¨è¾“å‡ºæ—¥å¿— dokcer-compose config # æ£€æŸ¥é…ç½® dokcer-compose config -q # æ£€æŸ¥é…ç½®ï¼Œæœ‰é—®é¢˜æ‰æœ‰è¾“å‡º docker-compose restart # é‡å¯æœåŠ¡ docker-compose start # å¯åŠ¨æœåŠ¡ docker-compose stop # åœæ­¢æœåŠ¡ 128. å…³åœdocker -compose stop å…­ã€Dockerè½»é‡çº§å¯è§†åŒ–å·¥å…·Portainer6.1 æ˜¯ä»€ä¹ˆ1Portainer æ˜¯ä¸€æ¬¾è½»é‡çº§çš„åº”ç”¨ï¼Œå®ƒæä¾›äº†å›¾å½¢åŒ–ç•Œé¢ï¼Œç”¨äºæ–¹ä¾¿åœ°ç®¡ç†Dockerç¯å¢ƒï¼ŒåŒ…æ‹¬å•æœºç¯å¢ƒå’Œé›†ç¾¤ç¯å¢ƒã€‚ 6.2 å®‰è£… ä¸€ã€å®˜ç½‘ https://www.portainer.io/ https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux äºŒã€æ­¥éª¤ dockerå‘½ä»¤å®‰è£… 1&gt;docker run -d -p 8000:8000 -p 9000:9000 --name portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer ç¬¬ä¸€æ¬¡ç™»å½•éœ€åˆ›å»ºadminï¼Œè®¿é—®åœ°å€ï¼šxxx.xxx.xxx.xxx:9000 12&gt;ç”¨æˆ·åï¼Œç›´æ¥ç”¨é»˜è®¤admin &gt;å¯†ç è®°å¾—8ä½ï¼Œéšä¾¿ä½ å†™ è®¾ç½®adminç”¨æˆ·å’Œå¯†ç åé¦–æ¬¡ç™»é™† é€‰æ‹©localé€‰é¡¹å¡åæœ¬åœ°dockerè¯¦ç»†ä¿¡æ¯å±•ç¤º ä¸Šä¸€æ­¥çš„å›¾å½¢å±•ç¤ºï¼Œèƒ½æƒ³å¾—èµ·å¯¹åº”å‘½ä»¤å—ï¼Ÿ ç™»é™†å¹¶æ¼”ç¤ºä»‹ç»å¸¸ç”¨æ“ä½œcase ä¸ƒã€Dockerå®¹å™¨ç›‘æ§ä¹‹CAdvisor+InfluxDB+Granfana7.1 åŸç”Ÿå‘½ä»¤123456docker statså‘½ä»¤çš„ç»“æœ é—®é¢˜é€šè¿‡docker statså‘½ä»¤å¯ä»¥å¾ˆæ–¹ä¾¿çš„çœ‹åˆ°å½“å‰å®¿ä¸»æœºä¸Šæ‰€æœ‰å®¹å™¨çš„CPU,å†…å­˜ä»¥åŠç½‘ç»œæµé‡ç­‰æ•°æ®ï¼Œ ä¸€èˆ¬å°å…¬å¸å¤Ÿç”¨äº†ã€‚ã€‚ã€‚ã€‚ ä½†æ˜¯docker statsç»Ÿè®¡ç»“æœåªèƒ½æ˜¯å½“å‰å®¿ä¸»æœºçš„å…¨éƒ¨å®¹å™¨ï¼Œæ•°æ®èµ„æ–™æ˜¯å®æ—¶çš„ï¼Œæ²¡æœ‰åœ°æ–¹å­˜å‚¨ã€æ²¡æœ‰å¥åº·æŒ‡æ ‡è¿‡çº¿é¢„è­¦ç­‰åŠŸèƒ½ 7.2 æ˜¯ä»€ä¹ˆ å®¹å™¨ç›‘æ§3å‰‘å®¢ ä¸€å¥è¯ 1&gt;CAdvisorç›‘æ§æ”¶é›†+InfluxDBå­˜å‚¨æ•°æ®+Granfanaå±•ç¤ºå›¾è¡¨ CAdvisor InfluxDB Granfana 7.3 composeå®¹å™¨ç¼–æ’ï¼Œä¸€å¥—å¸¦èµ° ä¸€ã€æ–°å»ºç›®å½• äºŒã€æ–°å»º3ä»¶å¥—ç»„åˆçš„ docker-compose.yml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&gt;version: &#x27;3.1&#x27; &gt;volumes: &gt;grafana_data: &#123;&#125; &gt;services: &gt;influxdb: &gt;image: tutum/influxdb:0.9 &gt;restart: always &gt;environment: - PRE_CREATE_DB=cadvisor ports: - &quot;8083:8083&quot; - &quot;8086:8086&quot; volumes: - ./data/influxdb:/data &gt;cadvisor: image: google/cadvisor links: - influxdb:influxsrv command: -storage_driver=influxdb -storage_driver_db=cadvisor -storage_driver_host=influxsrv:8086 restart: always ports: - &quot;8080:8080&quot; volumes: - /:/rootfs:ro - /var/run:/var/run:rw - /sys:/sys:ro - /var/lib/docker/:/var/lib/docker:ro &gt;grafana: user: &quot;104&quot; image: grafana/grafana user: &quot;104&quot; restart: always links: - influxdb:influxsrv ports: - &quot;3000:3000&quot; volumes: - grafana_data:/var/lib/grafana environment: - HTTP_USER=admin - HTTP_PASS=admin - INFLUXDB_HOST=influxsrv - INFLUXDB_PORT=8086 - INFLUXDB_NAME=cadvisor - INFLUXDB_USER=root - INFLUXDB_PASS=root ä¸‰ã€å¯åŠ¨docker-composeæ–‡ä»¶ 1&gt;docker-compose up å››ã€æŸ¥çœ‹ä¸‰ä¸ªæœåŠ¡å®¹å™¨æ˜¯å¦å¯åŠ¨ 1&gt;docker ps äº”ã€æµ‹è¯• 1234567&gt;1. æµè§ˆcAdvisoræ”¶é›†æœåŠ¡ï¼Œhttp://ip:8080/&gt;ç¬¬ä¸€æ¬¡è®¿é—®æ…¢ï¼Œè¯·ç¨ç­‰&gt;cadvisorä¹Ÿæœ‰åŸºç¡€çš„å›¾å½¢å±•ç°åŠŸèƒ½ï¼Œè¿™é‡Œä¸»è¦ç”¨å®ƒæ¥ä½œæ•°æ®é‡‡é›†&gt;2. æµè§ˆinfluxdbå­˜å‚¨æœåŠ¡ï¼Œhttp://ip:8083/ 123456789&gt;3. æµè§ˆgrafanaå±•ç°æœåŠ¡ï¼Œhttp://ip:3000ip+3000ç«¯å£çš„æ–¹å¼è®¿é—®,é»˜è®¤å¸æˆ·å¯†ç ï¼ˆadmin/adminï¼‰https://gitee.com/yooome/golang/tree/main/Dockerè¯¦ç»†æ•™ç¨‹é…ç½®æ­¥éª¤[1] é…ç½®æ•°æ®æº[2] é€‰æ‹©influxdbæ•°æ®æº[3] é…ç½®ç»†èŠ‚[4] é…ç½®é¢æ¿panel[5] åˆ°è¿™é‡ŒcAdvisor+InfluxDB+Grafanaå®¹å™¨ç›‘æ§ç³»ç»Ÿå°±éƒ¨ç½²å®Œæˆäº† åŸè§†é¢‘åœ°å€ åŸæ–‡ç« åœ°å€","categories":[{"name":"Docker","slug":"Docker","permalink":"https://lwy0518.github.io/categories/Docker/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://lwy0518.github.io/tags/Docker/"}],"author":"lwy"},{"title":"dockerå­¦ä¹ ç¬”è®°","slug":"dockerå­¦ä¹ ç¬”è®°","date":"2022-02-13T13:01:04.000Z","updated":"2022-02-13T13:50:07.692Z","comments":true,"path":"2022/02/13/dockerå­¦ä¹ ç¬”è®°/","link":"","permalink":"https://lwy0518.github.io/2022/02/13/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"ç›®å½•","text":"ç›®å½• Docker è¯¦ç»†æ•™ç¨‹ä¸€ã€Dockerç®€ä»‹1.1 dockeræ˜¯ä»€ä¹ˆã€é—®é¢˜ã€‘ï¼šé—®ä»€ä¹ˆä¼šæœ‰dockerå‡ºç° Dockerçš„å‡ºç° ä½¿å¾—Dockerå¾—ä»¥æ‰“ç ´è¿‡å»ã€Œç¨‹åºå³åº”ç”¨ã€çš„è§‚å¿µã€‚é€è¿‡é•œåƒ(images)å°†ä½œä¸šç³»ç»Ÿæ ¸å¿ƒé™¤å¤–ï¼Œè¿ä½œåº”ç”¨ç¨‹å¼æ‰€éœ€è¦çš„ç³»ç»Ÿç¯å¢ƒï¼Œç”±ä¸‹è€Œä¸Šæ‰“åŒ…ï¼Œè¾¾åˆ°åº”ç”¨ç¨‹å¼è·¨å¹³å°é—´çš„æ— ç¼æ¥è½¨è¿ä½œã€‚ ã€dockerç†å¿µã€‘ï¼šè§£å†³äº†è¿è¡Œç¯å¢ƒå’Œé…ç½®é—®é¢˜çš„è½¯ä»¶å®¹å™¨ï¼Œæ–¹ä¾¿æŒç»­ç»§æ‰¿å¹¶æœ‰åŠ©äºæ•´ä½“å‘å¸ƒçš„å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ 1.2 å®¹å™¨ä¸è™šæ‹Ÿæœºæ¯”è¾ƒ1.2.1 å®¹å™¨å‘å±•ç®€å²ï¿¼ï¿¼ï¿¼ 1.2.2 ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯è™šæ‹Ÿæœºï¼ˆvirtual machineï¼‰å°±æ˜¯å¸¦ç¯å¢ƒå®‰è£…çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ å®ƒå¯ä»¥åœ¨ä¸€ç§æ“ä½œç³»ç»Ÿé‡Œé¢è¿è¡Œå¦ä¸€ç§æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚åœ¨Windows10ç³»ç»Ÿé‡Œé¢è¿è¡ŒLinuxç³»ç»ŸCentOS7ã€‚åº”ç”¨ç¨‹åºå¯¹æ­¤æ¯«æ— æ„ŸçŸ¥ï¼Œå› ä¸ºè™šæ‹Ÿæœºçœ‹ä¸Šå»è·ŸçœŸå®ç³»ç»Ÿä¸€æ¨¡ä¸€æ ·ï¼Œè€Œå¯¹äºåº•å±‚ç³»ç»Ÿæ¥è¯´ï¼Œè™šæ‹Ÿæœºå°±æ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œä¸éœ€è¦äº†å°±åˆ æ‰ï¼Œå¯¹å…¶ä»–éƒ¨åˆ†æ¯«æ— å½±å“ã€‚è¿™ç±»è™šæ‹Ÿæœºå®Œç¾çš„è¿è¡Œäº†å¦ä¸€å¥—ç³»ç»Ÿï¼Œèƒ½å¤Ÿä½¿åº”ç”¨ç¨‹åºï¼Œæ“ä½œç³»ç»Ÿå’Œç¡¬ä»¶ä¸‰è€…ä¹‹é—´çš„é€»è¾‘ä¸å˜ã€‚ Win10 VMWare Centos7 å„ç§cpuã€å†…å­˜ç½‘ç»œé¢é…ç½®+å„ç§è½¯ä»¶ è™šæ‹Ÿæœºå®ä¾‹ è™šæ‹Ÿæœºçš„ç¼ºç‚¹ï¼š 1 èµ„æºå ç”¨å¤š 2 å†—ä½™æ­¥éª¤å¤š 3 å¯åŠ¨æ…¢ 1.2.3 å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯ç”±äºå‰é¢è™šæ‹Ÿæœºå­˜åœ¨æŸäº›ç¼ºç‚¹ï¼ŒLinuxå‘å±•å‡ºäº†å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼š Linuxå®¹å™¨(Linux Containersï¼Œç¼©å†™ä¸º LXC) Linuxå®¹å™¨æ˜¯ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†éš”ç¦»å¼€çš„ä¸€ç³»åˆ—è¿›ç¨‹ï¼Œä»å¦ä¸€ä¸ªé•œåƒè¿è¡Œï¼Œå¹¶ç”±è¯¥é•œåƒæä¾›æ”¯æŒè¿›ç¨‹æ‰€éœ€çš„å…¨éƒ¨æ–‡ä»¶ã€‚å®¹å™¨æä¾›çš„é•œåƒåŒ…å«äº†åº”ç”¨çš„æ‰€æœ‰ä¾èµ–é¡¹ï¼Œå› è€Œåœ¨ä»å¼€å‘åˆ°æµ‹è¯•å†åˆ°ç”Ÿäº§çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®ƒéƒ½å…·æœ‰å¯ç§»æ¤æ€§å’Œä¸€è‡´æ€§ã€‚ Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ è€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚æœ‰äº†å®¹å™¨ï¼Œå°±å¯ä»¥å°†è½¯ä»¶è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰èµ„æºæ‰“åŒ…åˆ°ä¸€ä¸ªéš”ç¦»çš„å®¹å™¨ä¸­ã€‚ å®¹å™¨ä¸è™šæ‹Ÿæœºä¸åŒï¼Œä¸éœ€è¦æ†ç»‘ä¸€æ•´å¥—æ“ä½œç³»ç»Ÿ ï¼Œåªéœ€è¦è½¯ä»¶å·¥ä½œæ‰€éœ€çš„åº“èµ„æºå’Œè®¾ç½®ã€‚ç³»ç»Ÿå› æ­¤è€Œå˜å¾—é«˜æ•ˆè½»é‡å¹¶ä¿è¯éƒ¨ç½²åœ¨ä»»ä½•ç¯å¢ƒä¸­çš„è½¯ä»¶éƒ½èƒ½å§‹ç»ˆå¦‚ä¸€åœ°è¿è¡Œã€‚ 1.2.4 å¯¹æ¯” æ¯”è¾ƒäº† Docker å’Œä¼ ç»Ÿè™šæ‹ŸåŒ–æ–¹å¼çš„ä¸åŒä¹‹å¤„ï¼š ä¼ ç»Ÿè™šæ‹ŸæœºæŠ€æœ¯æ˜¯è™šæ‹Ÿå‡ºä¸€å¥—ç¡¬ä»¶åï¼Œåœ¨å…¶ä¸Šè¿è¡Œä¸€ä¸ªå®Œæ•´æ“ä½œç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸Šå†è¿è¡Œæ‰€éœ€åº”ç”¨è¿›ç¨‹ï¼› å®¹å™¨å†…çš„åº”ç”¨è¿›ç¨‹ç›´æ¥è¿è¡Œäºå®¿ä¸»çš„å†…æ ¸ï¼Œå®¹å™¨å†…æ²¡æœ‰è‡ªå·±çš„å†…æ ¸ ä¸”ä¹Ÿæ²¡æœ‰è¿›è¡Œç¡¬ä»¶è™šæ‹Ÿ ã€‚å› æ­¤å®¹å™¨è¦æ¯”ä¼ ç»Ÿè™šæ‹Ÿæœºæ›´ä¸ºè½»ä¾¿ã€‚ æ¯ä¸ªå®¹å™¨ä¹‹é—´äº’ç›¸éš”ç¦»ï¼Œæ¯ä¸ªå®¹å™¨æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿ ï¼Œå®¹å™¨ä¹‹é—´è¿›ç¨‹ä¸ä¼šç›¸äº’å½±å“ï¼Œèƒ½åŒºåˆ†è®¡ç®—èµ„æºã€‚ 1.3 èƒ½å¹²ä»€ä¹ˆ1.3.1 æŠ€æœ¯èŒçº§å˜åŒ–coder -&gt; programmer -&gt; software engineer -&gt; DevOps engineer 1.3.2 å¼€å‘/è¿ç»´ï¼ˆDevops)æ–°ä¸€ä»£å¼€å‘å·¥ç¨‹å¸ˆ ä¸€æ¬¡æ„å»ºã€éšå¤„è¿è¡Œ æ›´å¿«é€Ÿçš„åº”ç”¨äº¤ä»˜å’Œéƒ¨ç½² æ›´ä¾¿æ·çš„å‡çº§å’Œæ‰©ç¼©å®¹ æ›´ç®€å•çš„ç³»ç»Ÿè¿ç»´ æ›´é«˜æ•ˆçš„è®¡ç®—èµ„æºåˆ©ç”¨ 1.3.3 Dockeråº”ç”¨åœºæ™¯ Docker å€Ÿé‰´äº†æ ‡ç –é›†è£…ç®±çš„æ¦‚å¿µã€‚æ ‡å‡†é›†è£…ç®±å°†è´§ç‰©è¿å¾€ä¸–ç•Œå„åœ°ï¼ŒDockerå°†è¿™ä¸ªæ¨¡å‹è¿ç”¨åˆ°è‡ªå·±çš„è®¾è®¡ä¸­ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯ï¼šé›†è£…ç®±è¿è¾“è´§ç‰©ï¼Œè€ŒDockerè¿è¾“è½¯ä»¶ã€‚ 1.4 é‚£äº›ä¼ä¸šåœ¨ä½¿ç”¨ æ–°æµª ç¾å›¢ è˜‘è‡è¡— 1.5 ä¸‹è½½åœ°å€å®˜ç½‘ï¼šhttp://www.docker.com Docker Hub å®˜ç½‘ï¼šhttps://hub.docker.com äºŒã€Dockerå®‰è£…2.1 å‰æè¯´æ˜2.1.1 CentOS Docker å®‰è£… 2.1.2 å‰ææ¡ä»¶ç›®å‰ï¼ŒCentOSä»…å‘è¡Œç‰ˆæœ¬ä¸­çš„å†…æ ¸æ”¯æŒDockerã€‚Dockerè¿è¡Œåœ¨CentOS 7ï¼ˆ64-bitï¼‰ä¸Šï¼Œè¦æ±‚ç³»ç»Ÿä¸º64ä½ï¼ŒLinuxç³»ç»Ÿå†…æ ¸ç‰ˆæœ¬ä¸º3.8ä»¥ä¸Šï¼Œè¿™é‡Œé€‰ç”¨Centos7.x 2.1.3 æŸ¥çœ‹è‡ªå·±çš„å†…æ ¸uname å‘½ä»¤ç”¨äºæ‰“å°å½“å‰ç³»ç»Ÿç›¸å…³ä¿¡æ¯ï¼ˆå†…æ ¸ç‰ˆæœ¬å·ï¼Œç¡¬ä»¶æ¶æ„ï¼Œä¸»æœºåç§°å’Œæ“ä½œç³»ç»Ÿç±»å‹ç­‰ï¼‰ã€‚ 2.2 Dockerçš„åŸºæœ¬ç»„æˆ2.2.1 é•œåƒï¼ˆimageï¼‰Docker é•œåƒï¼ˆImageï¼‰å°±æ˜¯ä¸€ä¸ª åªè¯» çš„æ¨¡æ¿ã€‚é•œåƒå¯ä»¥ç”¨æ¥åˆ›å»º Docker å®¹å™¨ï¼Œ ä¸€ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¾ˆå¤šå®¹å™¨ ã€‚ å®ƒä¹Ÿç›¸å½“äºæ˜¯ä¸€ä¸ªrootæ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ centos:7 å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— centos:7 æœ€å°ç³»ç»Ÿçš„ root æ–‡ä»¶ç³»ç»Ÿã€‚ ç›¸å½“äºå®¹å™¨çš„â€œæºä»£ç â€ï¼Œ dockeré•œåƒæ–‡ä»¶ç±»ä¼¼äºJavaçš„ç±»æ¨¡æ¿ï¼Œè€Œdockerå®¹å™¨å®ä¾‹ç±»ä¼¼äºjavaä¸­newå‡ºæ¥çš„å®ä¾‹å¯¹è±¡ã€‚ 2.2.2 å®¹å™¨ï¼ˆcontainerï¼‰ ä»é¢å‘å¯¹è±¡è§’åº¦ Docker åˆ©ç”¨å®¹å™¨ï¼ˆContainerï¼‰ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªæˆ–ä¸€ç»„åº”ç”¨ï¼Œåº”ç”¨ç¨‹åºæˆ–æœåŠ¡è¿è¡Œåœ¨å®¹å™¨é‡Œé¢ï¼Œå®¹å™¨å°±ç±»ä¼¼äºä¸€ä¸ªè™šæ‹ŸåŒ–çš„è¿è¡Œç¯å¢ƒï¼Œ å®¹å™¨æ˜¯ç”¨é•œåƒåˆ›å»ºçš„è¿è¡Œå®ä¾‹ ã€‚å°±åƒæ˜¯Javaä¸­çš„ç±»å’Œå®ä¾‹å¯¹è±¡ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨ä¸ºé•œåƒæä¾›äº†ä¸€ä¸ªæ ‡å‡†çš„å’Œéš”ç¦»çš„è¿è¡Œç¯å¢ƒ ï¼Œå®ƒå¯ä»¥è¢«å¯åŠ¨ã€å¼€å§‹ã€åœæ­¢ã€åˆ é™¤ã€‚æ¯ä¸ªå®¹å™¨éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ã€ä¿è¯å®‰å…¨çš„å¹³å° ä»é•œåƒå®¹å™¨è§’åº¦ å¯ä»¥æŠŠå®¹å™¨çœ‹åšæ˜¯ä¸€ä¸ªç®€æ˜“ç‰ˆçš„ *Linux* ç¯å¢ƒ ï¼ˆåŒ…æ‹¬rootç”¨æˆ·æƒé™ã€è¿›ç¨‹ç©ºé—´ã€ç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰ï¼‰å’Œè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚ 2.2.3 ä»“åº“ï¼ˆrepositoryï¼‰ä»“åº“ï¼ˆRepositoryï¼‰æ˜¯ é›†ä¸­å­˜æ”¾é•œåƒ æ–‡ä»¶çš„åœºæ‰€ã€‚ ç±»ä¼¼äº Mavenä»“åº“ï¼Œå­˜æ”¾å„ç§jaråŒ…çš„åœ°æ–¹ï¼› githubä»“åº“ï¼Œå­˜æ”¾å„ç§gité¡¹ç›®çš„åœ°æ–¹ï¼› Dockerå…¬å¸æä¾›çš„å®˜æ–¹registryè¢«ç§°ä¸ºDocker Hubï¼Œå­˜æ”¾å„ç§é•œåƒæ¨¡æ¿çš„åœ°æ–¹ã€‚ ä»“åº“åˆ†ä¸ºå…¬å¼€ä»“åº“ï¼ˆPublicï¼‰å’Œç§æœ‰ä»“åº“ï¼ˆPrivateï¼‰ä¸¤ç§å½¢å¼ã€‚ æœ€å¤§çš„å…¬å¼€ä»“åº“æ˜¯ Docker Hub(https://hub.docker.com/) ï¼Œ å­˜æ”¾äº†æ•°é‡åºå¤§çš„é•œåƒä¾›ç”¨æˆ·ä¸‹è½½ã€‚å›½å†…çš„å…¬å¼€ä»“åº“åŒ…æ‹¬é˜¿é‡Œäº‘ ã€ç½‘æ˜“äº‘ç­‰ 2.2.4 å°æ€»ç»“ éœ€è¦æ­£ç¡®çš„ç†è§£ä»“åº“/é•œåƒ/å®¹å™¨è¿™å‡ ä¸ªæ¦‚å¿µ: Docker æœ¬èº«æ˜¯ä¸€ä¸ªå®¹å™¨è¿è¡Œè½½ä½“æˆ–ç§°ä¹‹ä¸ºç®¡ç†å¼•æ“ã€‚æˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½å½¢æˆä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯imageé•œåƒæ–‡ä»¶ã€‚åªæœ‰é€šè¿‡è¿™ä¸ªé•œåƒæ–‡ä»¶æ‰èƒ½ç”ŸæˆDockerå®¹å™¨å®ä¾‹(ç±»ä¼¼Javaä¸­newå‡ºæ¥ä¸€ä¸ªå¯¹è±¡)ã€‚ imageæ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯å®¹å™¨çš„æ¨¡æ¿ã€‚Docker æ ¹æ® image æ–‡ä»¶ç”Ÿæˆå®¹å™¨çš„å®ä¾‹ã€‚åŒä¸€ä¸ª image æ–‡ä»¶ï¼Œå¯ä»¥ç”Ÿæˆå¤šä¸ªåŒæ—¶è¿è¡Œçš„å®¹å™¨å®ä¾‹ã€‚ é•œåƒæ–‡ä»¶ image æ–‡ä»¶ç”Ÿæˆçš„å®¹å™¨å®ä¾‹ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç§°ä¸ºé•œåƒæ–‡ä»¶ã€‚ å®¹å™¨å®ä¾‹ ä¸€ä¸ªå®¹å™¨è¿è¡Œä¸€ç§æœåŠ¡ï¼Œå½“æˆ‘ä»¬éœ€è¦çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡dockerå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªå¯¹åº”çš„è¿è¡Œå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å®¹å™¨ ã€‚ ä»“åº“ å°±æ˜¯æ”¾ä¸€å †é•œåƒçš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé•œåƒå‘å¸ƒåˆ°ä»“åº“ä¸­ï¼Œéœ€è¦çš„æ—¶å€™å†ä»ä»“åº“ä¸­æ‹‰ä¸‹æ¥å°±å¯ä»¥äº†ã€‚ 2.3 Dockerå¹³å°æ¶æ„å›¾è§£ï¼ˆå…¥é—¨ç‰ˆï¼‰ 2.3.1 Dockerå·¥ä½œåŸç†Dockeræ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨ä¸»æœºä¸Šï¼Œ ç„¶åé€šè¿‡Socketè¿æ¥ä»å®¢æˆ·ç«¯è®¿é—®ï¼Œå®ˆæŠ¤è¿›ç¨‹ä»å®¢æˆ·ç«¯æ¥å—å‘½ä»¤å¹¶ç®¡ç†è¿è¡Œåœ¨ä¸»æœºä¸Šçš„å®¹å™¨ ã€‚ å®¹å™¨ï¼Œæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ç¯å¢ƒï¼Œå°±æ˜¯æˆ‘ä»¬å‰é¢è¯´åˆ°çš„é›†è£…ç®±ã€‚å¯ä»¥å¯¹æ¯”mysqlæ¼”ç¤ºå¯¹æ¯”è®²è§£ 2.3.2 æ•´ä½“æ¶æ„åŠåº•å±‚é€šä¿¡åŸç†ç®€è¿°Dockeræ˜¯ä¸€ä¸ªC/Sæ¨¡å¼çš„æ¶æ„ï¼Œåç«¯æ˜¯ä¸€ä¸ªæ¾è€¦åˆæ¶æ„ï¼Œä¼—å¤šæ¨¡å—å„å¸å…¶èŒ 2.3.3 Dockerè¿è¡Œçš„åŸºæœ¬æµç¨‹ä¸ºï¼š ç”¨æˆ·æ˜¯ä½¿ç”¨Docker Client ä¸Docker Daemon å»ºç«‹é€šä¿¡ï¼Œå¹¶å‘é€è¯·æ±‚ç»™åè€…ã€‚ Docker Daemon ä½œä¸ºDockeræ¶æ„ä¸­çš„ä¸»ä½“éƒ¨åˆ†ï¼Œé¦–å…ˆæä¾›Docker Server çš„åŠŸèƒ½æ—¶æœŸå¯ä»¥æ¥å— Docker Clientçš„è¯·æ±‚ã€‚ Docker Engine æ‰§è¡ŒDockerå†…éƒ¨çš„ä¸€äº›åˆ—å·¥ä½œï¼Œæ¯ä¸€é¡¹å·¥ä½œéƒ½æ˜¯ä»¥ä¸€ä¸ªJobçš„å½¢å¼çš„å­˜åœ¨ã€‚ Jobçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦å®¹å™¨é•œåƒæ˜¯ï¼Œåˆ™ä»Docker Registerä¸­ä¸‹è½½é•œåƒï¼Œå¹¶é€šè¿‡é•œåƒç®¡ç†é©±åŠ¨Graph driver å°†ä¸‹è½½é•œåƒä»¥Graphçš„å½¢å¼å­˜å‚¨ã€‚ å½“éœ€è¦ä¸ºDockeråˆ›å»ºç½‘ç»œç¯å¢ƒæ—¶ï¼Œé€šè¿‡ç½‘ç»œé©±åŠ¨Network driveråˆ›å»ºå¹¶é…ç½®Dockerå®¹å™¨ç½‘ç»œç¯å¢ƒã€‚ å½“éœ€è¦é™åˆ¶Dockerå®¹å™¨è¿è¡Œèµ„æºæˆ–æ‰§è¡Œç”¨æˆ·æŒ‡ä»¤ç­‰æ“ä½œæ—¶ï¼Œåˆ™é€šè¿‡Exec driveræ¥å®Œæˆã€‚ Libcontaineræ˜¯ä¸€é¡¹ç‹¬ç«‹çš„å®¹å™¨ç®¡ç†åŒ…ï¼ŒNetwork driverä»¥åŠExec driveréƒ½æ˜¯é€šè¿‡Libcontaineræ¥å®ç°å…·ä½“å®¹å™¨è¿›è¡Œçš„æ“ä½œã€‚ 2.4ã€å®‰è£…æ­¥éª¤2.4.1 CentOS7å®‰è£…Docker ç¡®å®šä½ æ˜¯CentOS7ä»¥ä¸Šç‰ˆæœ¬ 12# æŸ¥çœ‹CentOSç‰ˆæœ¬å‘½ä»¤cat /etc/redhat-release å¸è½½æ—§ç‰ˆæœ¬ 123456789# å¸è½½æ—§ç‰ˆæœ¬dockerå‘½ä»¤$ sudo yum remove docker \\ docker-client \\ docker-client-latest \\ docker-common \\ docker-latest \\ docker-latest-logrotate \\ docker-logrotate \\ docker-engine yumå®‰è£…gccç›¸å…³å‘½ä»¤ 123# yumå®‰è£…gccç›¸å…³å‘½ä»¤yum -y install gccyum -y install gcc-c++ å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ… ä½¿ç”¨å­˜å‚¨åº“å®‰è£… 12345åœ¨æ–°ä¸»æœºä¸Šé¦–æ¬¡å®‰è£…Docker Engineä¹‹å‰ï¼Œæ‚¨éœ€è¦è®¾ç½®Dockerå­˜å‚¨åº“ã€‚ä¹‹åï¼Œæ‚¨å¯ä»¥ä»å­˜å‚¨åº“å®‰è£…å’Œæ›´æ–°Dockerè®¾ç½®å­˜å‚¨åº“å®‰è£… yum-utils åŒ…ï¼ˆæä¾›yum-config-manager å®ç”¨ç¨‹åºï¼‰å¹¶è®¾ç½®ç¨³å®šçš„å­˜å‚¨åº“# å®˜ç½‘è¦æ±‚yum install -y yum-utils è®¾ç½®stableé•œåƒä»“åº“ 12# æ¨èä½¿ç”¨ ä½¿ç”¨é˜¿é‡Œçš„ docker é•œåƒä»“åº“ï¼Œå›½å¤–çš„é•œåƒä»“åº“æ˜¯æ¯”è¾ƒæ…¢çš„yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼• 12# æ›´æ–°yumè½¯ä»¶åŒ…ç´¢å¼•yum makecache fast å®‰è£…DOCKER CE å¼•æ“ 12# å‘½ä»¤yum -y install docker-ce docker-ce-cli containerd.io å¯åŠ¨docker 12# å¯åŠ¨å‘½ä»¤systemctl start docker æµ‹è¯• 1234# æµ‹è¯•docker version docker run hello-world å¸è½½ 12345# å¸è½½å‘½ä»¤systemctl stop docker yum remove docker-ce docker-ce-cli containerd.iorm -rf /var/lib/dockerrm -rf /var/lib/containerd 2.5ã€é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ2.5.1 æ˜¯ä»€ä¹ˆ åœ°å€ï¼šhttps://promotion.aliyun.com/ntms/act/kubernetes.html æ³¨å†Œä¸€ä¸ªå±äºè‡ªå·±çš„é˜¿é‡Œäº‘è´¦æˆ· è·å¾—åŠ é€Ÿå™¨åœ°å€è¿æ¥ï¼š ç™»é™†é˜¿é‡Œäº‘å¼€å‘è€…å¹³å° ç‚¹å‡»æ§åˆ¶å° é€‰æ‹©å®¹å™¨é•œåƒæœåŠ¡ è·å–åŠ é€Ÿå™¨åœ°å€ ç²˜è´´è„šæœ¬ç›´æ¥æ‰§è¡Œ 123456mkdir -p /etc/docker tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;&#123; &quot;registry-mirrors&quot;: [&quot;https://aa25jngu.mirror.aliyuncs.com&quot;] &#125; EOF 123# æˆ–è€…åˆ†å¼€æ­¥éª¤æ‰§è¡Œmkdir -p /etc/dockervim /etc/docker/daemon.json é‡å¯æœåŠ¡å™¨ 123# é‡å¯æœåŠ¡å™¨systemctl daemon-reloadsystemctl restart docker 2.5.2 æ°¸è¿œçš„HelloWorldå¯åŠ¨Dockeråå°å®¹å™¨ï¼ˆæµ‹è¯•è¿è¡Œ hello-worldï¼‰ 12# å‘½ä»¤docker run hello-world 2.5.3 åº•å±‚åŸç†ä¸ºä»€ä¹ˆDockerä¼šæ¯”VMè™šæ‹Ÿæœºå¿«: 1234(1)dockeræœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚ ç”±äºdockerä¸éœ€è¦Hypervisor(è™šæ‹Ÿæœº)å®ç°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–,è¿è¡Œåœ¨dockerå®¹å™¨ä¸Šçš„ç¨‹åºç›´æ¥ä½¿ç”¨çš„éƒ½æ˜¯å®é™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æºã€‚å› æ­¤åœ¨CPUã€å†…å­˜åˆ©ç”¨ç‡ä¸Šdockerå°†ä¼šåœ¨æ•ˆç‡ä¸Šæœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚ (2)dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸,è€Œä¸éœ€è¦åŠ è½½æ“ä½œç³»ç»ŸOSå†…æ ¸ å½“æ–°å»ºä¸€ä¸ªå®¹å™¨æ—¶,dockerä¸éœ€è¦å’Œè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ã€‚è¿›è€Œé¿å…å¼•å¯»ã€åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸è¿”å›ç­‰æ¯”è¾ƒè´¹æ—¶è´¹èµ„æºçš„è¿‡ç¨‹,å½“æ–°å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ—¶,è™šæ‹Ÿæœºè½¯ä»¶éœ€è¦åŠ è½½OS,è¿”å›æ–°å»ºè¿‡ç¨‹æ˜¯åˆ†é’Ÿçº§åˆ«çš„ã€‚è€Œdockerç”±äºç›´æ¥åˆ©ç”¨å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿ,åˆ™çœç•¥äº†è¿”å›è¿‡ç¨‹,å› æ­¤æ–°å»ºä¸€ä¸ªdockerå®¹å™¨åªéœ€è¦å‡ ç§’é’Ÿã€‚ ä¸‰ã€Dockerå¸¸ç”¨å‘½ä»¤3.1 å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤12345678910111213141516# å¯åŠ¨å‘½ä»¤systemctl start docker# åœæ­¢å‘½ä»¤systemctl stop docker# é‡å¯å‘½ä»¤systemctl restart docker# æŸ¥çœ‹dockerçŠ¶æ€systemctl status docker# å¼€æœºå¯åŠ¨systemctl enable docker# æŸ¥çœ‹ docker æ¦‚è¦ä¿¡æ¯docker info# æŸ¥çœ‹docker æ€»ä½“å¸®åŠ©æ–‡æ¡£docker --help# æŸ¥çœ‹dockerå‘½ä»¤å¸®åŠ©æ–‡æ¡£ï¼šdocker å…·ä½“å‘½ä»¤ --help 3.2 é•œåƒå‘½ä»¤3.2.1 docker images12# åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šçš„é•œåƒdocker images å„ä¸ªé€‰é¡¹è¯´æ˜: REPOSITORYï¼šè¡¨ç¤ºé•œåƒçš„ä»“åº“æº TAGï¼šé•œåƒçš„æ ‡ç­¾ç‰ˆæœ¬å· IMAGE IDï¼šé•œåƒID CREATEDï¼šé•œåƒåˆ›å»ºæ—¶é—´ SIZEï¼šé•œåƒå¤§å° åŒä¸€ä»“åº“æºå¯ä»¥æœ‰å¤šä¸ª TAGç‰ˆæœ¬ï¼Œä»£è¡¨è¿™ä¸ªä»“åº“æºçš„ä¸åŒä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨ REPOSITORY:TAG æ¥å®šä¹‰ä¸åŒçš„é•œåƒã€‚ å¦‚æœä½ ä¸æŒ‡å®šä¸€ä¸ªé•œåƒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œä¾‹å¦‚ä½ åªä½¿ç”¨ ubuntuï¼Œdocker å°†é»˜è®¤ä½¿ç”¨ ubuntu:latest é•œåƒ 3.2.2 OPTIONS è¯´æ˜-a : åˆ—å‡ºæœ¬åœ°æ‰€æœ‰çš„é•œåƒï¼ˆå«å†å²æ˜ åƒå±‚ï¼‰ -qï¼šåªæ˜¾ç¤ºé•œåƒID 3.2.3 docker search æŸä¸ªXXXé•œåƒåå­—1234567# ç½‘ç«™https://hub.docker.com# å‘½ä»¤docker search [OPTIONS]é•œåƒåå­—# OPTIONSè¯´æ˜# --limit ï¼šåªåˆ—å‡ºNä¸ªé•œåƒï¼Œé»˜è®¤25ä¸ªdocker search --limit 5 redis æ¡ˆä¾‹ï¼š 3.2.4 docker pull æŸä¸ªXXXé•œåƒåå­—12345678# ä¸‹è½½é•œåƒ docker pull é•œåƒåå­—[:TAG] docker pull é•œåƒåå­— # æ²¡æœ‰TAGå°±æ˜¯æœ€æ–°ç‰ˆæœ¬ ç­‰ä»·äº docker pull é•œåƒåå­—ï¼šlatest docker pull ubuntu 3.2.5 docker system df æŸ¥çœ‹é•œåƒ/å®¹å™¨/æ•°æ®å·æ‰€å ç”¨çš„ç©ºé—´ 3.2.6 docker rmi åˆ é™¤é•œåƒ12345678# åˆ é™¤å•ä¸ªdocker rmi -f é•œåƒID# åˆ é™¤å¤šä¸ªdocker rmi -f é•œåƒå1:TAG é•œåƒå2:TAG# åˆ é™¤å…¨éƒ¨docker rmi -f $(docker images -qa) 3.2.7 è°ˆè°ˆdockerè™šæ‚¬é•œåƒæ˜¯ä»€ä¹ˆï¼Ÿ123ä»“åº“åç§°ï¼Œæ ‡ç­¾éƒ½æ˜¯&lt;none&gt;çš„é•œåƒï¼Œä¿—ç§°è™šæ‚¬é•œåƒdangling imageé•¿ä»€ä¹ˆæ ·å­åç»­Dockerfileç« èŠ‚åœ¨ä»‹ç» 3.3 å®¹å™¨å‘½ä»¤ æœ‰é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œè¿™æ˜¯æ ¹æœ¬å‰æï¼ˆä¸‹è½½ä¸€ä¸ªCentOSæˆ–è€…ubuntué•œåƒæ¼”ç¤ºï¼‰ 1.è¯´æ˜ 2.docker pull centos3.docker pull ubuntu4.æœ¬æ¬¡æ¼”ç¤ºç”¨ubuntuæ¼”ç¤º 3.3.1 æ–°å»º+å¯åŠ¨å®¹å™¨ æ–°å»º+å¯åŠ¨å®¹å™¨ å‘½ä»¤docker run [OPTIONS] IMAGE [COMMAND] [ARGâ€¦] OPTIONSè¯´æ˜OPTIONSè¯´æ˜ï¼ˆå¸¸ç”¨ï¼‰ï¼šæœ‰äº›æ˜¯ä¸€ä¸ªå‡å·ï¼Œæœ‰äº›æ˜¯ä¸¤ä¸ªå‡å· â€“name=â€å®¹å™¨æ–°åå­—â€ ä¸ºå®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼›-d: åå°è¿è¡Œå®¹å™¨å¹¶è¿”å›å®¹å™¨IDï¼Œä¹Ÿå³å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨(åå°è¿è¡Œ)ï¼› -iï¼šä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œé€šå¸¸ä¸ -t åŒæ—¶ä½¿ç”¨ï¼›-tï¼šä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸ -i åŒæ—¶ä½¿ç”¨ï¼›ä¹Ÿå³ å¯åŠ¨äº¤äº’å¼å®¹å™¨(å‰å°æœ‰ä¼ªç»ˆç«¯ï¼Œç­‰å¾…äº¤äº’) ï¼› -P: éšæœº ç«¯å£æ˜ å°„ï¼Œå¤§å†™P-p: æŒ‡å®š ç«¯å£æ˜ å°„ï¼Œå°å†™p å¯åŠ¨äº¤äº’å¼å®¹å™¨ï¼ˆå‰å°å‘½ä»¤è¡Œï¼‰ ä½¿ç”¨é•œåƒcentos:latestä»¥ äº¤äº’æ¨¡å¼ å¯åŠ¨ä¸€ä¸ªå®¹å™¨,åœ¨å®¹å™¨å†…æ‰§è¡Œ/bin/bashå‘½ä»¤ã€‚ docker run -it centos /bin/bash å‚æ•°è¯´æ˜ï¼š -i: äº¤äº’å¼æ“ä½œã€‚ -t: ç»ˆç«¯ã€‚ centos : centos é•œåƒã€‚ /bin/bashï¼šæ”¾åœ¨é•œåƒååçš„æ˜¯å‘½ä»¤ï¼Œè¿™é‡Œæˆ‘ä»¬å¸Œæœ›æœ‰ä¸ªäº¤äº’å¼ Shellï¼Œå› æ­¤ç”¨çš„æ˜¯ /bin/bashã€‚ è¦é€€å‡ºç»ˆç«¯ï¼Œç›´æ¥è¾“å…¥ exit: 3.3.2 åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨1234567# åˆ—å‡ºå½“å‰æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨docker ps [OPTIONS]# OPTIONSè¯´æ˜-a : åˆ—å‡ºå½“å‰æ‰€æœ‰ æ­£åœ¨è¿è¡Œ çš„å®¹å™¨ + å†å²ä¸Šè¿è¡Œè¿‡ çš„ -l :æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨ã€‚ -nï¼šæ˜¾ç¤ºæœ€è¿‘nä¸ªåˆ›å»ºçš„å®¹å™¨ã€‚ -q :é™é»˜æ¨¡å¼ï¼Œåªæ˜¾ç¤ºå®¹å™¨ç¼–å·ã€‚ 3.3.3 é€€å‡ºå®¹å™¨12345# ä¸¤ç§é€€å‡ºæ–¹å¼# 1ã€runè¿›å»å®¹å™¨ï¼Œexité€€å‡ºï¼Œå®¹å™¨åœæ­¢exit # 2ã€runè¿›å»å®¹å™¨ï¼Œctrl+p+qé€€å‡ºï¼Œå®¹å™¨ä¸åœæ­¢ctrl+p+q 3.3.4 å¯åŠ¨å·²åœæ­¢è¿è¡Œçš„å®¹å™¨1234567891011121314# å¯åŠ¨å·²åœæ­¢è¿è¡Œçš„å®¹å™¨docker start å®¹å™¨IDæˆ–è€…å®¹å™¨å# é‡å¯å®¹å™¨docker restart å®¹å™¨IDæˆ–è€…å®¹å™¨å# åœæ­¢å®¹å™¨docker stop å®¹å™¨IDæˆ–è€…å®¹å™¨å# å¼ºåˆ¶åœæ­¢å®¹å™¨docker kill å®¹å™¨IDæˆ–å®¹å™¨å# åˆ é™¤å·²åœæ­¢çš„å®¹å™¨docker rm å®¹å™¨ID# ä¸€æ¬¡æ€§åˆ é™¤å¤šä¸ªå®¹å™¨å®ä¾‹docker rm -rf $(docker ps -a -q)docker ps -a -q | xargs docker rm 3.3.5 é‡è¦å¯åŠ¨å®ˆæŠ¤å¼å®¹å™¨ï¼ˆåå°æœåŠ¡å™¨ï¼‰ï¼š 12345678910111213141516171819æœ‰é•œåƒæ‰èƒ½åˆ›å»ºå®¹å™¨ï¼Œè¿™æ˜¯æ ¹æœ¬å‰æï¼ˆä¸‹è½½ä¸€ä¸ªRedis6.0.8é•œåƒæ¼”ç¤ºï¼‰åœ¨å¤§éƒ¨åˆ†çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›dockerçš„æœåŠ¡æ˜¯åœ¨åå°è¿è¡Œçš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ -d æŒ‡å®šå®¹å™¨çš„åå°è¿è¡Œæ¨¡å¼ã€‚docker run -d å®¹å™¨å# ä½¿ç”¨é•œåƒcentos:latestä»¥åå°æ¨¡å¼å¯åŠ¨ä¸€ä¸ªå®¹å™¨ docker run -d centos é—®é¢˜ï¼šç„¶ådocker ps -a è¿›è¡ŒæŸ¥çœ‹, ä¼šå‘ç°å®¹å™¨å·²ç»é€€å‡º å¾ˆé‡è¦çš„è¦è¯´æ˜çš„ä¸€ç‚¹: Dockerå®¹å™¨åå°è¿è¡Œ,å°±å¿…é¡»æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹. å®¹å™¨è¿è¡Œçš„å‘½ä»¤å¦‚æœä¸æ˜¯é‚£äº› ä¸€ç›´æŒ‚èµ·çš„å‘½ä»¤ ï¼ˆæ¯”å¦‚è¿è¡Œtopï¼Œtailï¼‰ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨é€€å‡ºçš„ã€‚ è¿™ä¸ªæ˜¯dockerçš„æœºåˆ¶é—®é¢˜,æ¯”å¦‚ä½ çš„webå®¹å™¨,æˆ‘ä»¬ä»¥nginxä¸ºä¾‹ï¼Œæ­£å¸¸æƒ…å†µä¸‹, æˆ‘ä»¬é…ç½®å¯åŠ¨æœåŠ¡åªéœ€è¦å¯åŠ¨å“åº”çš„serviceå³å¯ã€‚ä¾‹å¦‚service nginx start ä½†æ˜¯,è¿™æ ·åš,nginxä¸ºåå°è¿›ç¨‹æ¨¡å¼è¿è¡Œ,å°±å¯¼è‡´dockerå‰å°æ²¡æœ‰è¿è¡Œçš„åº”ç”¨, è¿™æ ·çš„å®¹å™¨åå°å¯åŠ¨å,ä¼šç«‹å³è‡ªæ€å› ä¸ºä»–è§‰å¾—ä»–æ²¡äº‹å¯åšäº†. æ‰€ä»¥ï¼Œæœ€ä½³çš„è§£å†³æ–¹æ¡ˆæ˜¯, å°†ä½ è¦è¿è¡Œçš„ç¨‹åºä»¥å‰å°è¿›ç¨‹çš„å½¢å¼è¿è¡Œï¼Œ å¸¸è§å°±æ˜¯å‘½ä»¤è¡Œæ¨¡å¼ï¼Œè¡¨ç¤ºæˆ‘è¿˜æœ‰äº¤äº’æ“ä½œï¼Œåˆ«ä¸­æ–­ï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~ rediså‰åå°å¯åŠ¨æ¼”ç¤ºcase 1234# å‰å°äº¤äº’å¼å¯åŠ¨docker run -it redis:6.0.8# åå°äº¤äº’å¼å¯åŠ¨docker run -d redis:6.0.8 æŸ¥çœ‹å®¹å™¨æ—¥å¿— 12# æŸ¥çœ‹å®¹å™¨æ—¥å¿—docker logs å®¹å™¨ID æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹ 12# æŸ¥çœ‹å®¹å™¨å†…è¿è¡Œçš„è¿›ç¨‹docker top å®¹å™¨ID æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚ 12# æŸ¥çœ‹å®¹å™¨å†…éƒ¨ç»†èŠ‚docker inspect å®¹å™¨ID è¿›å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶ä»¥å‘½ä»¤è¡Œäº¤äº’ 1docker exec -it å®¹å™¨ID bashShell é‡æ–°è¿›å…¥docker attach å®¹å™¨ID æ¡ˆä¾‹æ¼”ç¤ºï¼Œç”¨centosæˆ–è€…unbuntuéƒ½å¯ä»¥ä¸Šè¿°ä¸¤ä¸ªåŒºåˆ«ï¼š attach ç›´æ¥è¿›å…¥å®¹å™¨å¯åŠ¨å‘½ä»¤çš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹ç”¨exité€€å‡ºï¼Œä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚ 2. exec æ˜¯åœ¨å®¹å™¨ä¸­æ‰“å¼€æ–°çš„ç»ˆç«¯ï¼Œå¹¶ä¸”å¯ä»¥å¯åŠ¨æ–°çš„è¿›ç¨‹ç”¨exité€€å‡ºï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚ æ¨èå¤§å®¶ä½¿ç”¨docker exec å‘½ä»¤ï¼Œå› ä¸ºé€€å‡ºå®¹å™¨ç»ˆç«¯ï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚ ä½¿ç”¨ä¹‹å‰çš„rediså®¹å™¨å®ä¾‹è¿›å…¥è¯•è¯• 12345docker exec -it å®¹å™¨ID /bin/bashdocker exec -it å®¹å™¨ID redis-cliä¸€èˆ¬ç”¨-dåå°å¯åŠ¨çš„ç¨‹åºï¼Œåœ¨ç”¨execè¿›å…¥å¯¹åº”å®¹å™¨å®ä¾‹ ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š å®¹å™¨ -&gt; ä¸»æœº docker cp å®¹å™¨ID:å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„ å…¬å¼ï¼š docker cp å®¹å™¨ ID: å®¹å™¨å†…è·¯å¾„ ç›®çš„ä¸»æœºè·¯å¾„ å¯¼å…¥å’Œå¯¼å‡ºå®¹å™¨ Export å¯¼å‡ºå®¹å™¨çš„å†…å®¹ç•™ä½œä¸ºä¸€ä¸ªtarå½’æ¡£æ–‡ä»¶[å¯¹åº”importå‘½ä»¤] import ä»tar åŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿåœ¨å¯¼å…¥ä¸ºé•œåƒ[å¯¹åº”export] ã€æ¡ˆä¾‹ã€‘ï¼š docker export å®¹å™¨ID &gt; æ–‡ä»¶.tar cat æ–‡ä»¶å.tar | docker import -é•œåƒç”¨æˆ·/é•œåƒå:é•œåƒç‰ˆæœ¬å· 3.4 å°æ€»ç»“ 12345678910111213141516171819202122232425262728293031323334353637attach Attach to a running container # å½“å‰ shell ä¸‹ attach è¿æ¥æŒ‡å®šè¿è¡Œé•œåƒ build Build an image from a Dockerfile # é€šè¿‡ Dockerfile å®šåˆ¶é•œåƒ commit Create a new image from a container changes # æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ cp Copy files/folders from the containers filesystem to the host path #ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–è€…ç›®å½•åˆ°å®¿ä¸»æœºä¸­ create Create a new container # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒ runï¼Œä½†ä¸å¯åŠ¨å®¹å™¨ diff Inspect changes on a container&#x27;s filesystem # æŸ¥çœ‹ docker å®¹å™¨å˜åŒ– events Get real time events from the server # ä» docker æœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶ exec Run a command in an existing container # åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸Šè¿è¡Œå‘½ä»¤ export Stream the contents of a container as a tar archive # å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ª tar å½’æ¡£æ–‡ä»¶[å¯¹åº” import ] history Show the history of an image # å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å² images List images # åˆ—å‡ºç³»ç»Ÿå½“å‰é•œåƒ import Create a new filesystem image from the contents of a tarball # ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿæ˜ åƒ[å¯¹åº”export] info Display system-wide information # æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯ inspect Return low-level information on a container # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯ kill Kill a running container # kill æŒ‡å®š docker å®¹å™¨ load Load an image from a tar archive # ä»ä¸€ä¸ª tar åŒ…ä¸­åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº” save] login Register or Login to the docker registry server # æ³¨å†Œæˆ–è€…ç™»é™†ä¸€ä¸ª docker æºæœåŠ¡å™¨ logout Log out from a Docker registry server # ä»å½“å‰ Docker registry é€€å‡º logs Fetch the logs of a container # è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯ port Lookup the public-facing port which is NAT-ed to PRIVATE_PORT # æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”çš„å®¹å™¨å†…éƒ¨æºç«¯å£ pause Pause all processes within a container # æš‚åœå®¹å™¨ ps List containers # åˆ—å‡ºå®¹å™¨åˆ—è¡¨ pull Pull an image or a repository from the docker registry server # ä»dockeré•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒ push Push an image or a repository to the docker registry server # æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³dockeræºæœåŠ¡å™¨ restart Restart a running container # é‡å¯è¿è¡Œçš„å®¹å™¨ rm Remove one or more containers # ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ rmi Remove one or more images # ç§»é™¤ä¸€ä¸ªæˆ–å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ– -f å¼ºåˆ¶åˆ é™¤] run Run a command in a new container # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤ save Save an image to a tar archive # ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ª tar åŒ…[å¯¹åº” load] search Search for an image on the Docker Hub # åœ¨ docker hub ä¸­æœç´¢é•œåƒ start Start a stopped containers # å¯åŠ¨å®¹å™¨ stop Stop a running containers # åœæ­¢å®¹å™¨ tag Tag an image into a repository # ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾ top Lookup the running processes of a container # æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯ unpause Unpause a paused container # å–æ¶ˆæš‚åœå®¹å™¨ version Show the docker version information # æŸ¥çœ‹ docker ç‰ˆæœ¬å· wait Block until a container stops, then print its exit code # æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼ å››ã€Dockeré•œåƒ4.1 æ˜¯ä»€ä¹ˆ1234567891011ã€é•œåƒã€‘ æ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶åŒ…ï¼Œå®ƒåŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬æŠŠåº”ç”¨ç¨‹åºå’Œé…ç½®ä¾èµ–æ‰“åŒ…å¥½å½¢æˆä¸€ä¸ªå¯äº¤ä»˜çš„è¿è¡Œç¯å¢ƒ(åŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶éœ€è¦çš„åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ç­‰)ï¼Œè¿™ä¸ªæ‰“åŒ…å¥½çš„è¿è¡Œç¯å¢ƒå°±æ˜¯imageé•œåƒæ–‡ä»¶ã€‚ åªæœ‰é€šè¿‡è¿™ä¸ªé•œåƒæ–‡ä»¶æ‰èƒ½ç”ŸæˆDockerå®¹å™¨å®ä¾‹(ç±»ä¼¼Javaä¸­newå‡ºæ¥ä¸€ä¸ªå¯¹è±¡)ã€‚ã€åˆ†å±‚é•œåƒã€‘ä»¥æˆ‘ä»¬çš„pullä¸ºä¾‹ï¼Œåœ¨ä¸‹è½½çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°dockerçš„é•œåƒå¥½åƒæ˜¯åœ¨ä¸€å±‚ä¸€å±‚çš„åœ¨ä¸‹è½½ ã€‚ã€UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ã€‘UnionFSï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFSï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ”¯æŒ å¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼Œ åŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹(unite several directories into a single virtual filesystem)ã€‚Union æ–‡ä»¶ç³»ç»Ÿæ˜¯ Docker é•œåƒçš„åŸºç¡€ã€‚ é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒã€‚ ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½• Dockeré•œåƒåŠ è½½åŸç† Dockeré•œåƒåŠ è½½åŸç†ï¼š dockerçš„é•œåƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»ŸUnionFSã€‚ bootfs(boot file system)ä¸»è¦åŒ…å«bootloaderå’Œkernel, bootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½kernel, Linuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿï¼Œ åœ¨Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯å¼•å¯¼æ–‡ä»¶ç³»ç»Ÿbootfsã€‚ è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„Linux/Unixç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…å«bootåŠ è½½å™¨å’Œå†…æ ¸ã€‚å½“bootåŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”±bootfsè½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½bootfsã€‚ rootfs (root file system) ï¼Œåœ¨bootfsä¹‹ä¸Š ã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹ Linux ç³»ç»Ÿä¸­çš„ /dev, /proc, /bin, /etc ç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚Ubuntuï¼ŒCentosç­‰ç­‰ã€‚ å¹³æ—¶æˆ‘ä»¬å®‰è£…è¿›è™šæ‹Ÿæœºçš„CentOSéƒ½æ˜¯å¥½å‡ ä¸ªGï¼Œä¸ºä»€ä¹ˆdockerè¿™é‡Œæ‰200Mï¼Ÿï¼Ÿ å¯¹äºä¸€ä¸ªç²¾ç®€çš„OSï¼Œrootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…æ‹¬æœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨Hostçš„kernelï¼Œè‡ªå·±åªéœ€è¦æä¾› rootfs å°±è¡Œäº†ã€‚ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„linuxå‘è¡Œç‰ˆ, bootfsåŸºæœ¬æ˜¯ä¸€è‡´çš„, rootfsä¼šæœ‰å·®åˆ«, å› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…¬ç”¨bootfsã€‚ ä¸ºä»€ä¹ˆDockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚ç»“æ„å‘¢ é•œåƒåˆ†å±‚æœ€å¤§çš„ä¸€ä¸ªå¥½å¤„å°±æ˜¯å…±äº«èµ„æºï¼Œæ–¹ä¾¿å¤åˆ¶è¿ç§»ï¼Œå°±æ˜¯ä¸ºäº†å¤ç”¨ã€‚ æ¯”å¦‚è¯´æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„ base é•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆ Docker Host åªéœ€åœ¨ç£ç›˜ä¸Šä¿å­˜ä¸€ä»½ base é•œåƒï¼›åŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€åŠ è½½ä¸€ä»½ base é•œåƒï¼Œå°±å¯ä»¥ä¸ºæ‰€æœ‰å®¹å™¨æœåŠ¡äº†ã€‚è€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚ 4.2 é‡ç‚¹ç†è§£ Dockeré•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ï¼Œå®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚è¢«åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ã€‚è¿™ä¸€å±‚é€šå¸¸è¢«ç§°ä½œâ€å®¹å™¨å±‚â€ï¼Œâ€å®¹å™¨å±‚â€ä¹‹ä¸‹çš„éƒ½å«â€é•œåƒå±‚â€ã€‚ æ‰€æœ‰å¯¹å®¹å™¨çš„æ”¹åŠ¨ - æ— è®ºæ·»åŠ ã€åˆ é™¤ã€è¿˜æ˜¯ä¿®æ”¹æ–‡ä»¶éƒ½åªä¼šå‘ç”Ÿåœ¨å®¹å™¨å±‚ä¸­ã€‚åªæœ‰å®¹å™¨å±‚æ˜¯å¯å†™çš„ï¼Œå®¹å™¨å±‚ä¸‹é¢çš„æ‰€æœ‰é•œåƒå±‚éƒ½æ˜¯åªè¯»çš„ã€‚ 4.3 Dockeré•œåƒcommitæ“ä½œæ¡ˆä¾‹ docker commit æäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºä¸€ä¸ªæ–°çš„é•œåƒ docker commit -m=â€æäº¤çš„æè¿°ä¿¡æ¯â€ -a=â€ä½œè€…â€ å®¹å™¨ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå:[æ ‡ç­¾å] ã€æ¡ˆä¾‹æ¼”ç¤ºã€‘ubuntuå®‰è£…vim ä»Hubä¸Šä¸‹ubuntué•œåƒåˆ°ç¬¨åœ°å¹¶æˆåŠŸè¿è¡Œ åŸå§‹é»˜è®¤Ubuntué•œåƒæ˜¯ä¸å¸¦ç€vimå‘½ä»¤çš„ å¤–ç½‘è¿é€šæƒ…å†µä¸‹ï¼Œå®‰è£…vim 1234# å…ˆæ›´æ–°æˆ‘ä»¬çš„åŒ…ç®¡ç†å·¥å…·apt-get update# ç„¶åå®‰è£…æˆ‘ä»¬éœ€è¦çš„vimapt-get install vim dockerå®¹å™¨å†…æ‰§è¡Œä¸Šè¿°ä¸¤æ¡å‘½ä»¤ï¼š apt-get update apt-get -y install vim å®‰è£…å®Œæˆåï¼Œcommitæˆ‘ä»¬è‡ªå·±çš„æ–°é•œåƒ å¯åŠ¨æˆ‘ä»¬çš„æ–°é•œåƒå¹¶å’ŒåŸæ¥çš„å¯¹æ¯” å®˜ç½‘æ˜¯é»˜è®¤ä¸‹è½½çš„Ubuntuæ²¡æœ‰vimå‘½ä»¤ æˆ‘ä»¬è‡ªå·±commitæ„å»ºçš„é•œåƒï¼Œæ–°å¢åŠ äº†vimåŠŸèƒ½ï¼Œå¯ä»¥æˆåŠŸä½¿ç”¨ã€‚ æ€»ç»“ 12 Dockerä¸­çš„é•œåƒåˆ†å±‚ï¼Œ æ”¯æŒé€šè¿‡æ‰©å±•ç°æœ‰é•œåƒï¼Œåˆ›å»ºæ–°çš„é•œåƒ ã€‚ç±»ä¼¼Javaç»§æ‰¿äºä¸€ä¸ªBaseåŸºç¡€ç±»ï¼Œè‡ªå·±å†æŒ‰éœ€æ‰©å±•ã€‚ æ–°é•œåƒæ˜¯ä» base é•œåƒä¸€å±‚ä¸€å±‚å åŠ ç”Ÿæˆçš„ã€‚æ¯å®‰è£…ä¸€ä¸ªè½¯ä»¶ï¼Œå°±åœ¨ç°æœ‰é•œåƒçš„åŸºç¡€ä¸Šå¢åŠ ä¸€å±‚ äº”ã€æœ¬åœ°é•œåƒå‘å¸ƒåˆ°é˜¿é‡Œäº‘5.1 æœ¬åœ°é•œåƒå‘å¸ƒåˆ°é˜¿é‡Œäº‘æµç¨‹ 5.2 é•œåƒç”Ÿæˆçš„æ–¹æ³• ä¸Šä¸€è®²å·²ç»ä»‹ç»è¿‡ åŸºäºå½“å‰å®¹å™¨åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œæ–°åŠŸèƒ½å¢å¼º docker commit [OPTIONS]å®¹å™¨ID [REPOSOTORY[:TAG]] OPTIONSè¯´æ˜ï¼š -a :æäº¤çš„é•œåƒä½œè€…ï¼› -m :æäº¤æ—¶çš„è¯´æ˜æ–‡å­—ï¼› æœ¬æ¬¡æ¡ˆä¾‹centos+ubuntuä¸¤ä¸ªï¼Œå½“å ‚è®²è§£ä¸€ä¸ªï¼Œå®¶åº­ä½œä¸šä¸€ä¸ªï¼Œè¯·å¤§å®¶åŠ¡å¿…åŠ¨æ‰‹ï¼Œäº²è‡ªå®æ“ã€‚ 5.3 å°†æœ¬åœ°é•œåƒæ¨é€åˆ°é˜¿é‡Œäº‘ æœ¬åœ°é•œåƒç´ æåŸå‹ é˜¿é‡Œäº‘å¼€å‘è€…å¹³å° åœ°å€ï¼šhttps://promotion.aliyun.com/ntms/act/kubernetes.html å°†é•œåƒæ¨é€åˆ°é˜¿é‡Œäº‘ å°†é•œåƒæ¨é€åˆ°é˜¿é‡Œäº‘registry ï¼Œç®¡ç†ç•Œé¢è„šæœ¬ è„šæœ¬å®ä¾‹ 1234567docker login --username=zzyybuy registry.cn-hangzhou.aliyuncs.com docker tag cea1bb40441c registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1 docker push registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1 ä¸Šé¢å‘½ä»¤æ˜¯é˜³å“¥è‡ªå·±æœ¬åœ°çš„ï¼Œä½ è‡ªå·±é…Œæƒ…å¤„ç†ï¼Œä¸è¦ç²˜è´´æˆ‘çš„ã€‚ 5.4 å°†é˜¿é‡Œäº‘ä¸Šçš„é•œåƒä¸‹è½½åˆ°æœ¬åœ° 1docker pull registry.cn-hangzhou.aliyuncs.com/atguiguwh/myubuntu:1.1 å…­ã€æœ¬åœ°é•œåƒå‘å¸ƒåˆ°ç§æœ‰åº“6.1 æœ¬åœ°é•œåƒå‘å¸ƒåˆ°ç§æœ‰åº“æµç¨‹ ä¸‹è½½é•œåƒDocker Registry docker pull registry è¿è¡Œç§æœ‰åº“Registryï¼Œç›¸å½“äºæœ¬åœ°æœ‰ä¸ªç§æœ‰åº“Docker hub docker run -d -p 5000:5000 -v /zzyyuse/myregistry/:/tmp/registry â€“privileged=true registry é»˜è®¤æƒ…å†µï¼Œä»“åº“è¢«åˆ›å»ºåœ¨å®¹å™¨çš„/var/lib/registryç›®å½•ä¸‹ï¼Œå»ºè®®è‡ªè¡Œç”¨å®¹å™¨å·æ˜ å°„ï¼Œæ–¹ä¾¿äºå®¿ä¸»æœºè”è°ƒ æ¡ˆä¾‹æ¼”ç¤ºåˆ›å»ºä¸€ä¸ªæ–°é•œåƒï¼Œubuntuå®‰è£…ifconfigå‘½ä»¤ ä»Hubä¸Šä¸‹è½½ubuntué•œåƒåˆ°æœ¬åœ°å¹¶æˆåŠŸè¿è¡Œ åŸå§‹Ubuntué•œåƒæ˜¯ä¸å¸¦ç€ifconfigå‘½ä»¤çš„ ä»Hubä¸Šä¸‹è½½ubuntué•œåƒåˆ°æœ¬åœ°å¹¶æˆåŠŸè¿è¡Œ åŸå§‹Ubuntué•œåƒæ˜¯ä¸å¸¦ç€ifconfigå‘½ä»¤çš„ å¤–ç½‘è¿é€šæƒ…å†µä¸‹ï¼Œå®‰è£…ifconfigå‘½ä»¤é€šè¿‡æµ‹è¯• dockerå®¹å™¨å†… æ‰§è¡Œä¸Šè¿°ä¸¤æ¡å‘½ä»¤ï¼š apt-get update apt-get install net-tools å®‰è£…å®Œæˆåï¼Œcommitæˆ‘ä»¬è‡ªå·±çš„æ–°é•œåƒ å…¬å¼ï¼š docker commit -m=â€ æäº¤çš„æè¿°ä¿¡æ¯ â€œ -a=â€ ä½œè€… â€œ å®¹å™¨ ID è¦åˆ›å»ºçš„ç›®æ ‡é•œåƒå :[ æ ‡ç­¾å ] å‘½ä»¤ï¼š åœ¨å®¹å™¨å¤–æ‰§è¡Œï¼Œè®°å¾— docker commit -m=â€ ifconfig cmd add â€œ -a=â€ zzyy â€œ a69d7c825c4f zzyyubuntu:1.2 å¯åŠ¨æˆ‘ä»¬çš„æ–°é•œåƒå¹¶å’ŒåŸæ¥çš„å¯¹æ¯” 1.å®˜ç½‘æ˜¯é»˜è®¤ä¸‹è½½çš„Ubuntuæ²¡æœ‰ifconfigå‘½ä»¤ 2.æˆ‘ä»¬è‡ªå·±commitæ„å»ºçš„æ–°é•œåƒï¼Œæ–°å¢åŠ äº†ifconfigåŠŸèƒ½ï¼Œå¯ä»¥æˆåŠŸä½¿ç”¨ã€‚ curléªŒè¯ç§æœåº“ä¸Šæœ‰ä»€ä¹ˆé•œåƒ curl -XGET http://192.168.111.162:5000/v2/_catalog å¯ä»¥çœ‹åˆ°ï¼Œç›®å‰ç§æœåº“æ²¡æœ‰ä»»ä½•é•œåƒä¸Šä¼ è¿‡ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ å°†æ–°é•œåƒzzyyubuntu:1.2ä¿®æ”¹ç¬¦åˆç§æœè§„èŒƒçš„Tag 12345æŒ‰ç…§å…¬å¼ï¼š docker tag é•œåƒ:Tag Host:Port/Repository:Tag è‡ªå·±hostä¸»æœºIPåœ°å€ï¼Œå¡«å†™åŒå­¦ä½ ä»¬è‡ªå·±çš„ï¼Œä¸è¦ç²˜è´´é”™è¯¯ï¼ŒO(âˆ©_âˆ©)O ä½¿ç”¨å‘½ä»¤ docker tag å°†zzyyubuntu:1.2 è¿™ä¸ªé•œåƒä¿®æ”¹ä¸º192.168.111.162:5000/zzyyubuntu:1.2 docker tag zzyyubuntu:1.2 192.168.111.162:5000/zzyyubuntu:1.2 ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ä¹‹æ”¯æŒhttp 1234åˆ«æ— è„‘ç…§ç€å¤åˆ¶ï¼Œregistry-mirrors é…ç½®çš„æ˜¯å›½å†…é˜¿é‡Œæä¾›çš„é•œåƒåŠ é€Ÿåœ°å€ï¼Œä¸ç”¨åŠ é€Ÿçš„è¯è®¿é—®å®˜ç½‘çš„ä¼šå¾ˆæ…¢ã€‚2ä¸ªé…ç½®ä¸­é—´æœ‰ä¸ªé€—å· &#x27;,&#x27;åˆ«æ¼äº† ï¼Œè¿™ä¸ªé…ç½®æ˜¯jsonæ ¼å¼çš„ã€‚ 2ä¸ªé…ç½®ä¸­é—´æœ‰ä¸ªé€—å· &#x27;,&#x27;åˆ«æ¼äº† ï¼Œè¿™ä¸ªé…ç½®æ˜¯jsonæ ¼å¼çš„ã€‚ 2ä¸ªé…ç½®ä¸­é—´æœ‰ä¸ªé€—å· &#x27;,&#x27;åˆ«æ¼äº† ï¼Œè¿™ä¸ªé…ç½®æ˜¯jsonæ ¼å¼çš„ã€‚ vimå‘½ä»¤æ–°å¢å¦‚ä¸‹çº¢è‰²å†…å®¹ï¼švim /etc/docker/daemon.json 1234&#123; &quot;registry-mirrors&quot;: [&quot;https://aa25jngu.mirror.aliyuncs.com&quot;] , &quot;insecure-registries&quot;: [&quot;192.168.111.162:5000&quot;] &#125; ä¸Šè¿°ç†ç”±ï¼šdockeré»˜è®¤ä¸å…è®¸httpæ–¹å¼æ¨é€é•œåƒï¼Œé€šè¿‡é…ç½®é€‰é¡¹æ¥å–æ¶ˆè¿™ä¸ªé™åˆ¶ã€‚====&gt; ä¿®æ”¹å®Œåå¦‚æœä¸ç”Ÿæ•ˆï¼Œå»ºè®®é‡å¯docker pushæ¨é€åˆ°ç§æœåº“ 1docker push 192.168.111.162:5000/zzyyubuntu:1.2 curléªŒè¯ç§æœåº“ä¸Šæœ‰ä»€ä¹ˆé•œåƒ2 curl -XGET http://192.168.111.162:5000/v2/_catalog pullåˆ°æœ¬åœ°å¹¶è¿è¡Œ 1docker pull 192.168.111.162:5000/zzyyubuntu:1.2 docker run -it é•œåƒID /bin/bash ä¸ƒã€Dockerå®¹å™¨æ•°æ®å·7.1 å‘ï¼šå®¹å™¨å·è®°å¾—åŠ å…¥123456789--privileged=true# åŸå›  DockeræŒ‚è½½ä¸»æœºç›®å½•è®¿é—® å¦‚æœå‡ºç°cannot open directory .: Permission denied è§£å†³åŠæ³•ï¼šåœ¨æŒ‚è½½ç›®å½•åå¤šåŠ ä¸€ä¸ª--privileged=trueå‚æ•°å³å¯ å¦‚æœæ˜¯CentOS7å®‰å…¨æ¨¡å—ä¼šæ¯”ä¹‹å‰ç³»ç»Ÿç‰ˆæœ¬åŠ å¼ºï¼Œä¸å®‰å…¨çš„ä¼šå…ˆç¦æ­¢ï¼Œæ‰€ä»¥ç›®å½•æŒ‚è½½çš„æƒ…å†µè¢«é»˜è®¤ä¸ºä¸å®‰å…¨çš„è¡Œä¸ºï¼Œ åœ¨SELinuxé‡Œé¢æŒ‚è½½ç›®å½•è¢«ç¦æ­¢æ‰äº†é¢ï¼Œå¦‚æœè¦å¼€å¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨--privileged=trueå‘½ä»¤ï¼Œæ‰©å¤§å®¹å™¨çš„æƒé™è§£å†³æŒ‚è½½ç›®å½•æ²¡æœ‰æƒé™çš„é—®é¢˜ï¼Œä¹Ÿå³ ä½¿ç”¨è¯¥å‚æ•°ï¼Œcontainerå†…çš„rootæ‹¥æœ‰çœŸæ­£çš„rootæƒé™ï¼Œå¦åˆ™ï¼Œcontainerå†…çš„rootåªæ˜¯å¤–éƒ¨çš„ä¸€ä¸ªæ™®é€šç”¨æˆ·æƒé™ã€‚ 7.2 å›é¡¾ä¸‹ä¸Šä¸€å°†çš„çŸ¥è¯†ç‚¹ï¼Œå‚æ•°Vè¿˜è®°å¾—è“è‰²æ¡†æ¡†ä¸­çš„å†…å®¹å˜› 7.3 æ˜¯ä»€ä¹ˆ1234ä¸€å¥è¯ï¼šæœ‰ç‚¹ç±»ä¼¼æˆ‘ä»¬Redisé‡Œé¢çš„rdbå’Œaofæ–‡ä»¶å°†dockerå®¹å™¨å†…çš„æ•°æ®ä¿å­˜è¿›å®¿ä¸»æœºçš„ç£ç›˜ä¸­è¿è¡Œä¸€ä¸ªå¸¦æœ‰å®¹å™¨å·å­˜å‚¨åŠŸèƒ½çš„å®¹å™¨å®ä¾‹docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½• é•œåƒå 7.4 èƒ½å¹²ä»€ä¹ˆ12345678910å°†è¿ç”¨ä¸è¿è¡Œçš„ç¯å¢ƒæ‰“åŒ…é•œåƒï¼Œrunåå½¢æˆå®¹å™¨å®ä¾‹è¿è¡Œ ï¼Œä½†æ˜¯æˆ‘ä»¬å¯¹æ•°æ®çš„è¦æ±‚å¸Œæœ›æ˜¯ æŒä¹…åŒ–çš„ Dockerå®¹å™¨äº§ç”Ÿçš„æ•°æ®ï¼Œå¦‚æœä¸å¤‡ä»½ï¼Œé‚£ä¹ˆå½“å®¹å™¨å®ä¾‹åˆ é™¤åï¼Œå®¹å™¨å†…çš„æ•°æ®è‡ªç„¶ä¹Ÿå°±æ²¡æœ‰äº†ã€‚ ä¸ºäº†èƒ½ä¿å­˜æ•°æ®åœ¨dockerä¸­æˆ‘ä»¬ä½¿ç”¨å·ã€‚ ç‰¹ç‚¹ï¼š 1ï¼šæ•°æ®å·å¯åœ¨å®¹å™¨ä¹‹é—´å…±äº«æˆ–é‡ç”¨æ•°æ® 2ï¼šå·ä¸­çš„æ›´æ”¹å¯ä»¥ç›´æ¥å®æ—¶ç”Ÿæ•ˆï¼Œçˆ½ 3ï¼šæ•°æ®å·ä¸­çš„æ›´æ”¹ä¸ä¼šåŒ…å«åœ¨é•œåƒçš„æ›´æ–°ä¸­ 4ï¼šæ•°æ®å·çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨å®ƒä¸ºæ­¢ 7.5 æ•°æ®å·æ¡ˆä¾‹ 7.5.1 å®¿ä¸»vså®¹å™¨ä¹‹é—´æ˜ å°„æ·»åŠ å®¹å™¨å·ç›´æ¥å‘½ä»¤æ·»åŠ  123&gt;å…¬å¼ï¼šdocker run -it -v /å®¿ä¸»æœºç›®å½•:/å®¹å™¨å†…ç›®å½•&gt;ubuntu /bin/bash&gt;docker run -it --name myu3 --privileged=true -v /tmp/myHostData:/tmp/myDockerData ubuntu /bin/bash æŸ¥çœ‹æ•°æ®å·æ˜¯å¦æŒ‚æˆåŠŸ 1&gt;docker inspect å®¹å™¨ID å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´æ•°æ®å…±äº« 123&gt;1. dockerä¿®æ”¹ï¼Œä¸»æœºåŒæ­¥è·å¾— &gt;2. ä¸»æœºä¿®æ”¹ï¼ŒdockeråŒæ­¥è·å¾— &gt;3. dockerå®¹å™¨stopï¼Œä¸»æœºä¿®æ”¹ï¼Œdockerå®¹å™¨é‡å¯çœ‹æ•°æ®æ˜¯å¦åŒæ­¥ã€‚ 7.5.2 è¯»å†™è§„åˆ™æ˜ å°„æ·»åŠ è¯´æ˜è¯»å†™(é»˜è®¤) 12docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:rw é•œåƒåé»˜è®¤åŒä¸Šæ¡ˆä¾‹ï¼Œé»˜è®¤å°±æ˜¯rw é»˜è®¤åŒä¸Šæ¡ˆä¾‹ï¼Œé»˜è®¤å°±æ˜¯rw åªè¯» å®¹å™¨å®ä¾‹å†…éƒ¨è¢«é™åˆ¶ï¼Œåªèƒ½è¯»å–ä¸èƒ½å†™ 123/å®¹å™¨ç›®å½•:ro é•œåƒå å°±èƒ½å®ŒæˆåŠŸèƒ½ï¼Œæ­¤æ—¶å®¹å™¨è‡ªå·±åªèƒ½è¯»å–ä¸èƒ½å†™ ro = read only æ­¤æ—¶å¦‚æœå®¿ä¸»æœºå†™å…¥å†…å®¹ï¼Œå¯ä»¥åŒæ­¥ç»™å®¹å™¨å†…ï¼Œå®¹å™¨å¯ä»¥è¯»å–åˆ°ã€‚ 1docker run -it --privileged=true -v /å®¿ä¸»æœºç»å¯¹è·¯å¾„ç›®å½•:/å®¹å™¨å†…ç›®å½•:ro é•œåƒå 7.5.3 å·çš„é›†æˆå’Œå…±äº«å®¹å™¨1å®Œæˆå’Œå®¿ä¸»æœºçš„æ˜ å°„ 1&gt;docker run -it --privileged=true -v /mydocker/u:/tmp --name u1 ubuntu å®¹å™¨2é›†æˆå®¹å™¨1çš„å·è§„åˆ™ 1&gt;docker run -it --privileged=true --volumes-from çˆ¶ç±» --name u2 ubuntu å…«ã€Dockerå¸¸è§„å®‰è£…ç®€ä»‹8.1 æ€»ä½“æ­¥éª¤12345671. æœç´¢é•œåƒ2. æ‹‰å»é•œåƒ3. æŸ¥çœ‹é•œåƒ4. æŸ¥çœ‹é•œåƒ5. å¯åŠ¨é•œåƒ æœåŠ¡ç«¯å£æ˜ å°„6. åœæ­¢å®¹å™¨ 8.2 å®‰è£…tomcat 1ã€docker hub ä¸Šé¢æŸ¥æ‰¾tomcaté•œåƒ 12# å‘½ä»¤docker search tomcat 2ã€ä»docker hub ä¸Šæ‹‰å»tomcaté•œåƒåˆ°æœ¬åœ° 12# å‘½ä»¤docker pull tomcat 3ã€docker images æŸ¥çœ‹æ˜¯å¦æœ‰æ‹‰å»åˆ°tomcat 12# å‘½ä»¤docker images tomcat 4ã€ä½¿ç”¨tomcaté•œåƒåˆ›å»ºå®¹å™¨å®ä¾‹ï¼ˆä¹Ÿå«è¿è¡Œé•œåƒï¼‰ 12345678910111213# å‘½ä»¤docker run -it -p 8080:8080 tomcat-p å°å†™ï¼Œä¸»æœºç«¯å£:dockerå®¹å™¨ç«¯å£-P å¤§å†™ï¼Œéšæœºåˆ†é…ç«¯å£i:äº¤äº’t:ç»ˆç«¯d:åå° 5ã€è®¿é—®tomcaté¦–é¡µ 1234567å¯èƒ½å‡ºç°404 çš„æƒ…å†µè§£å†³1ã€å¯èƒ½æ²¡æœ‰æ˜ å°„ç«¯å£æˆ–è€…æ²¡æœ‰å…³é—­é˜²ç«å¢™2ã€æŠŠwebapps.dist ç›®å½•æ¢æˆwebapps å…ˆæˆåŠŸå¯åŠ¨tomcat æŸ¥çœ‹webappsæ–‡ä»¶å¤¹æŸ¥çœ‹ä¸ºç©º 6ã€å…ä¿®æ”¹ç‰ˆè¯´æ˜ docker pull billygoo/tomcat8-jdk8 Docker run -d -p 8080:8080 â€“name mytomcat8 billygoo/tomcat8-djk8 8.3 å®‰è£…mysql 1ã€docker hubä¸Šé¢æŸ¥æ‰¾mysqlé•œåƒ 12# å‘½ä»¤docker search mysql 2ã€ä»docker hubä¸Šï¼ˆé˜¿é‡Œäº‘åŠ é€Ÿå™¨ï¼‰æ‹‰å»mysqlé•œåƒåˆ°æœ¬åœ°æ ‡ç­¾ä¸º5.7 12# å‘½ä»¤docker pull mysql:5.7 3ã€ä½¿ç”¨mysql5.7 é•œåƒåˆ›å»ºå®¹å™¨ï¼ˆä¹Ÿå«è¿è¡Œé•œåƒï¼‰ 12345678910# 1ã€å‘½ä»¤å‡ºå¤„ï¼Œå“ªé‡Œæ¥çš„åœ°å€ï¼šhttps://hub.docker.com/_/mysql# 2ã€ç®€å•ç‰ˆdocker run -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7 docker psdocker exec -it å®¹å™¨ID /bin/bashmysql -uroot -p 1# 4ã€ å»ºåº“å»ºè¡¨æ’å…¥æ•°æ® 1234567891011å¤–éƒ¨Win10ä¹Ÿæ¥è¿æ¥è¿è¡Œåœ¨dokcerä¸Šçš„mysqlå®¹å™¨å®ä¾‹æœåŠ¡ã€é—®é¢˜ã€‘æ’å…¥ä¸­æ–‡æ•°æ®è¯•è¯•ï¼Œä¸ºä»€ä¹ˆæŠ¥é”™ï¼Ÿ docker ä¸Šé»˜è®¤å­—ç¬¦é›†ç¼–ç éšæ‚£dockeré‡Œé¢çš„mysqlå®¹å™¨å®ä¾‹æŸ¥çœ‹ï¼Œå†…å®¹å¦‚ä¸‹ï¼š SHOW VARIABLES LIKE &#x27;character%&#x27; åˆ é™¤å®¹å™¨åï¼Œé‡Œé¢çš„mysqlæ•°æ®å¦‚ä½•åŠå®¹å™¨å®ä¾‹ä¸€åˆ é™¤ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆï¼Ÿåˆ å®¹å™¨åˆ°è·‘è·¯ã€‚ã€‚ã€‚ã€‚ã€‚ï¼Ÿ ã€å®æˆ˜ç‰ˆã€‘ 123456789101112131415161718192021222324#1ã€æ–°å»ºmysqlå®¹å™¨å®ä¾‹docker run -d -p 3306:3306 --privileged=true -v /zzyyuse/mysql/log:/var/log/mysql -v /zzyyuse/mysql/data:/var/lib/mysql -v /zzyyuse/mysql/conf:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=123456 --name mysql mysql:5.7 #2ã€æ–°å»ºmy.cnf é€šè¿‡å®¹å™¨å·åŒæ­¥ç»™MySQLå®¹å™¨å®ä¾‹[client]default_character_set=utf8 [mysqld] collation_server = utf8_general_ci character_set_server = utf8 #3ã€é‡æ–°å¯åŠ¨mysqlå®¹å™¨å®ä¾‹åœ¨é‡æ–°è¿›å…¥å¹¶æŸ¥çœ‹å­—ç¬¦ç¼–ç docker restart mysqldocker exec -it mysql_bashshow variables like &#x27;character%&#x27;;#4ã€å†æ–°å»ºåº“æ–°å»ºè¡¨å†æ’å…¥ä¸­æ–‡æµ‹è¯•å®Œå…¨æ­£å¸¸#5ã€ç»“è®ºä¹‹å‰çš„DB æ— æ•ˆ ä¿®æ”¹å­—ç¬¦é›†æ“ä½œ+é‡å¯mysqlå®¹å™¨å®ä¾‹ ä¹‹åçš„DB æœ‰æ•ˆï¼Œéœ€è¦æ–°å»º ç»“è®ºï¼š dockerå®‰è£…å®ŒMySQLå¹¶runå‡ºå®¹å™¨åï¼Œå»ºè®®è¯·å…ˆä¿®æ”¹å®Œå­—ç¬¦é›†ç¼–ç åå†æ–°å»ºmysqlåº“-è¡¨-æ’æ•°æ® #6ã€å‡å¦‚å°†å½“å‰å®¹å™¨å®ä¾‹åˆ é™¤ï¼Œå†é‡æ–°æ¥ä¸€æ¬¡ï¼Œä¹‹å‰å»ºçš„db01å®ä¾‹è¿˜æœ‰å—ï¼Ÿtrytry 8.4 å®‰è£…redis 1ã€ä»docker hubä¸Šï¼ˆé˜¿é‡Œäº‘åŠ é€Ÿå™¨ï¼‰æ‹‰å»redisé•œåƒåˆ°æœ¬åœ°æ ‡ç­¾6.0.8 1234&gt;# æ‹‰å»é•œåƒ&gt;docker pull redis:6.0.8&gt;# æŸ¥çœ‹é•œåƒ&gt;docker images 2ã€å…¥é—¨å‘½ä»¤ 12345&gt;# å¯åŠ¨å‘½ä»¤&gt;docker run -d -p 6379:6379 redis:6.0.8&gt;# docker ps&gt;# åå°å¯åŠ¨&gt;docker exec -it CONTAINER ID /bin/bash 3ã€å‘½ä»¤æé†’ï¼šå®¹å™¨å·è®°å¾—åŠ å…¥ â€“privileged=true 12&gt;DockeræŒ‚è½½ä¸»æœºç›®å½•Dockerè®¿é—®å‡ºç°cannot open directory .: Permission denied &gt;è§£å†³åŠæ³•ï¼šåœ¨æŒ‚è½½ç›®å½•åå¤šåŠ ä¸€ä¸ª--privileged=trueå‚æ•°å³å¯ 4ã€åœ¨CentOSå®¿ä¸»æœºä¸‹æ–°å»ºç›®å½•/app/redis 12&gt;# æ–°å»ºç›®å½•&gt;mkdir -p /app/redis 5ã€å°†ä¸€ä¸ªredis.confæ–‡ä»¶æ¨¡æ¿æ‹·è´è¿› /app/redisç›®å½•ä¸‹ 12345&gt;mkdir -p /app/redis&gt;cp /myredis/redis.conf /app/redis/&gt;cp /app/redis 6ã€/app/redis ç›®å½•ä¸‹ä¿®æ”¹redis.conf 12345678910111213&gt;# ä¿®æ”¹redis.confæ–‡ä»¶ &gt;/app/redisç›®å½•ä¸‹ä¿®æ”¹redis.confæ–‡ä»¶ &gt;å¼€å¯rediséªŒè¯ å¯é€‰ &gt;requirepass 123 &gt;å…è®¸rediså¤–åœ°è¿æ¥ å¿…é¡» &gt;æ³¨é‡Šæ‰ # bind 127.0.0.1 &gt;# æ³¨é‡Šdaemonize no&gt;daemonize no &gt;å°†daemonize yesæ³¨é‡Šèµ·æ¥æˆ–è€… daemonize noè®¾ç½®ï¼Œå› ä¸ºè¯¥é…ç½®å’Œdocker runä¸­-då‚æ•°å†²çªï¼Œä¼šå¯¼è‡´å®¹å™¨ä¸€ç›´å¯åŠ¨å¤±è´¥&gt;# å¼€å¯redisæ•°æ®æŒä¹…åŒ–&gt;appendonly yes å¯é€‰ 7ã€ä½¿ç”¨redis6.0.8 é•œåƒåˆ›å»ºå®¹å™¨(ä¹Ÿå«è¿è¡Œé•œåƒ) 1&gt;docker run -p 6379:6379 --name myr3 --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf 8ã€æµ‹è¯•redis-cliè¿æ¥ä¸Š docker exec -it è¿è¡Œç€RediisæœåŠ¡çš„å®¹å™¨ID redis-cli 9ã€è¯·è¯æ˜dockerå¯åŠ¨ä½¿ç”¨äº†æˆ‘ä»¬è‡ªå·±æŒ‡å®šçš„é…ç½®æ–‡ä»¶ ã€ä¿®æ”¹å‰ã€‘ ã€ä¿®æ”¹åã€‘ 10ã€æµ‹è¯•redis-cliè¿æ¥ä¸Šæ¥ç¬¬2æ¬¡ åŸè§†é¢‘åœ°å€ åŸæ–‡ç« åœ°å€","categories":[],"tags":[],"author":"lwy"},{"title":"rediså­¦ä¹ ç¬”è®°","slug":"rediså­¦ä¹ ç¬”è®°","date":"2022-02-13T06:51:52.000Z","updated":"2022-02-13T13:49:59.606Z","comments":true,"path":"2022/02/13/rediså­¦ä¹ ç¬”è®°/","link":"","permalink":"https://lwy0518.github.io/2022/02/13/redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/","excerpt":"ç›®å½•","text":"ç›®å½• Rediså­¦ä¹ ç¬”è®°ä¸€ ã€Redisç®€ä»‹1.1 ä»€ä¹ˆæ˜¯RedisRedis æ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œéµå®ˆBSDåè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½(NOSQL)çš„key-valueæ•°æ®åº“ï¼ŒRedisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ï¼ŒKey-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚ 123BSDæ˜¯&quot;Berkeley Software Distribution&quot;çš„ç¼©å†™ï¼Œæ„æ€æ˜¯â€œä¼¯å…‹åˆ©è½¯ä»¶å‘å‹ç‰ˆæœ¬â€ã€‚BSDå¼€æºåè®®æ˜¯ä¸€ä¸ªç»™äºˆä½¿ç”¨è€…å¾ˆå¤§è‡ªç”±çš„åè®®ã€‚å¯ä»¥è‡ªç”±çš„ä½¿ç”¨ï¼Œä¿®æ”¹æºä»£ç ï¼Œä¹Ÿå¯ä»¥å°†ä¿®æ”¹åçš„ä»£ç ä½œä¸ºå¼€æºæˆ–è€…ä¸“æœ‰è½¯ä»¶åœ¨å‘å¸ƒã€‚BSDä»£ç é¼“åŠ±ä»£ç å…±äº«ï¼Œä½†éœ€è¦å°Šé‡ä»£ç ä½œè€…çš„è‘—ä½œæƒã€‚BSDç”±äºå…è®¸ä½¿ç”¨è€…ä¿®æ”¹å’Œé‡æ–°å‘å¸ƒä»£ç ï¼Œä¹Ÿå…è®¸ä½¿ç”¨æˆ–åœ¨BSDä»£ç ä¸Šå¼€å‘å•†ä¸šè½¯ä»¶å‘å¸ƒå’Œé”€å”®ï¼Œä¸€æ¬¡æ˜¯å¯¹å•†ä¸šé›†æˆå¾ˆå‹å¥½çš„åè®®ã€‚ 1.2 NoSQL1NoSQL,æ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ï¼ŒNoSQLå³Not-only SQL,å®ƒå¯ä»¥ä½œä¸ºå…³ç³»å‹æ•°æ®åº“çš„è‰¯å¥½è¡¥å……ã€‚éšç€äº’è”ç½‘web2.0ç½‘ç«™çš„å…´èµ·ï¼Œéå…³ç³»å‹çš„æ•°æ®åº“ç°åœ¨æˆä¸ºäº†ä¸€ä¸ªåŠå…¶çƒ­é—¨çš„æ–°é¢†åŸŸï¼Œéå…³ç³»å‹æ•°æ®åº“äº§å“çš„å‘å±•éå¸¸è¿…é€Ÿã€‚ ä¼ ç»Ÿæ•°æ®åº“æš´éœ²å¾ˆå¤šéš¾ä»¥å…‹æœçš„é—®é¢˜ï¼Œå¦‚ä¸‹é—®é¢˜ï¼š 123451ã€High performance - å¯¹æ•°æ®åº“é«˜å¹¶å‘è¯»å†™çš„éœ€æ±‚ã€‚2ã€Huge Storage - å¯¹æµ·é‡æ•°æ®çš„é«˜æ•ˆå­˜å‚¨å’Œè®¿é—®çš„éœ€æ±‚ã€‚3ã€High Scalability &amp;&amp; High Availability - å¯¹æ•°æ®åº“çš„é«˜å¯æ‰©å±•æ€§å’Œé«˜è¯¾ç”¨æ€§çš„éœ€æ±‚ã€‚ 1.3 NoSQLçš„ç±»åˆ«é”®å€¼ï¼ˆKey-Valueï¼‰å­˜å‚¨æ•°æ®åº“ 12345678 è¿™ä¸€ç±»æ•°æ®åº“ä¸»è¦ä¼šä½¿ç”¨åˆ°ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œè¿™ä¸ªè¡¨ä¸­æœ‰ä¸€ä¸ªç‰¹å®šçš„é”®å’Œä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ç‰¹å®šçš„æ•°æ®ã€‚key/valueæ¨¡å‹å¯¹äºITç³»ç»Ÿæ¶æ°´çš„ä¼˜åŠ¿åœ¨äºç®€å•ï¼Œå·²éƒ¨ç½²ã€‚ä½†æ˜¯å¦‚æœDBAåªå¯¹éƒ¨åˆ†å€¼è¿›è¡ŒæŸ¥è¯¢æˆ–è€…æ›´æ–°çš„æ—¶å€™ï¼Œkey/valueæ˜¾ç¤ºçš„æ•ˆç‡ä½ä¸‹ã€‚ç›¸å…³äº§å“ ï¼š Redisï¼ŒTokyo Cabinetå…¸å‹åº”ç”¨ ï¼š å†…å­˜ç¼“å­˜ï¼Œä¸»è¦ç”¨äºå¤„ç†å¤§é‡æ•°æ®çš„é«˜è®¿é—®è´Ÿè½½ã€‚æ•°æ®æ¨¡å‹ ï¼š ä¸€ç³»åˆ—é”®å€¼å¯¹ä¼˜åŠ¿ ï¼š å¿«é€ŸæŸ¥è¯¢åŠ£åŠ¿ ï¼š å­˜å‚¨çš„æ•°æ®ç¼ºå°‘ç»“æ„åŒ– åˆ—å­˜å‚¨æ•°æ®åº“ 123456è¿™éƒ¨åˆ†æ•°æ®åº“é€šå¸¸æ˜¯ç”¨æ¥å¯¹åˆ†å¸ƒå¼å­˜å‚¨çš„æµ·é‡æ•°æ®ã€‚é”®ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯ä»–ä»¬çš„ç‰¹ç‚¹æ˜¯æŒ‡å‘äº†å¤šä¸ªåˆ—ã€‚è¿™äº›åˆ—æ˜¯ç”±åˆ—å®¶æ—æ¥å®‰æ’çš„ã€‚ç›¸å…³äº§å“ : HBase ã€Riakå…¸å‹åº”ç”¨ ï¼š åˆ†å¸ƒå¼çš„æ–‡ä»¶ç³»ç»Ÿæ•°æ®æ¨¡å‹ ï¼š ä»¥åˆ—ç°‡å¼å­˜å‚¨ï¼Œå°†åŒä¸€åˆ—æ•°æ®å­˜åœ¨ä¸€èµ·ä¼˜åŠ¿ ï¼š æŸ¥æ‰¾é€Ÿåº¦å¿«ï¼Œå¯æ‰©å±•æ€§å¼ºï¼Œæ›´å®¹æ˜“è¿›è¡Œåˆ†å¸ƒå¼æ‰©å±•åŠ£åŠ¿ ï¼š åŠŸèƒ½ç›¸å¯¹äºå±€é™ æ–‡æ¡£å‹æ•°æ®åº“ 123456æ–‡æ¡£å‹æ•°æ®åº“ï¼šè¯¥ç±»å‹çš„æ•°æ®åº“æ¨¡å‹æ˜¯ç‰ˆæœ¬åŒ–çš„æ–‡æ¡£ï¼ŒåŠç»“æ„åŒ–çš„æ–‡æ¡£ä¸€ç‰¹å®šçš„æ ¼å¼å­˜å‚¨ï¼Œæ¯”å¦‚JSONã€‚æ–‡æ¡£æ•°æ®åº“å¯ä»¥çœ‹åšé”®å€¼æ•°æ®åº“çš„å‡çº§ç‰ˆï¼Œå…è®¸ä¹‹é—´åµŒå¥—é”®å€¼ã€‚è€Œä¸”æ–‡æ¡£å‹æ•°æ®åº“æ¯”é”®å€¼æ•°æ®åº“çš„æŸ¥è¯¢æ•ˆç‡æ›´é«˜ã€‚ç›¸å…³äº§å“ï¼šMOngoDBå…¸å‹åº”ç”¨ ï¼š webåº”ç”¨æ•°æ®æ¨¡å‹ ï¼š ä¸€ç³»åˆ—é”®å€¼å¯¹ä¼˜åŠ¿ ï¼š æ•°æ®ç»“æ„è¦æ±‚ä¸ä¸¥æ ¼åŠ£åŠ¿ ï¼š æŸ¥è¯¢æ€§èƒ½ä¸é«˜ï¼Œè€Œä¸”ç¼ºä¹ç»Ÿä¸€çš„æŸ¥è¯¢è¯­è¨€ 1.4 æ€»ç»“ï¼šNoSQL æ•°æ®åº“åœ¨ä¸€ä¸‹çš„è¿™å‡ ç§æƒ…å†µä¸‹æ¯”è¾ƒé€‚ç”¨ ï¼š 1ã€æ•°æ®æ¨¡å‹æ¯”è¾ƒç®€å•ï¼› 2ã€éœ€è¦çµæ´»æ›´å‰çš„ITç³»ç»Ÿï¼› 3ã€å¯¹æ•°æ®åº“æ€§èƒ½è¦æ±‚è¾ƒé«˜ï¼› 4ã€ä¸éœ€è¦é«˜åº¦çš„æ•°æ®ä¸€è‡´æ€§ï¼› 5ã€å¯¹äºç»™å®škeyï¼Œæ¯”è¾ƒå®¹æ˜“æ˜ å°„å¤æ‚çš„ç¯å¢ƒï¼› 1.5 Redis æè¿°Redisæ˜¯å®Œå…¨å¼€æºå…è´¹çš„ï¼Œéµå®ˆBSDåè®®ï¼Œæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½(NoSQL)çš„ï¼ˆkey-valueï¼‰æ•°æ®åº“ï¼ŒRedisæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒç½‘ç»œï¼Œå¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ï¼ŒKey-Valueæ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„APIã€‚ 1.6 Redisçš„ç‰¹ç‚¹ æ€§èƒ½æé«˜ - Redisè¯»å†™çš„ç†Ÿè¯»110000æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚ ä¸°å¯Œçš„æ•°æ®ç±»å‹ - Redisæ”¯æŒçš„ç±»å‹Stringï¼Œ Hash ã€List ã€Set åŠ Ordered Setæ•°æ®ç±»å‹æ“ä½œã€‚ åŸå­æ€§ - Redisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œæ„æ€å°±æ˜¯è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚å•ä¸ªæ“ä½œæ—¶åŸå­æ€§çš„ã€‚å¤šä¸ªæ“ä½œä¹Ÿæ”¯æŒäº‹åŠ¡ï¼Œå³åŸå­æ€§ï¼Œé€šè¿‡MULTIå’ŒEXECæŒ‡ä»¤åŒ…èµ·æ¥ã€‚ ä¸°å¯Œçš„ç‰¹æ€§ - Redisè¿˜æ”¯æŒpublis/subscribeï¼Œé€šçŸ¥ï¼Œkeyè¿‡æœŸç­‰ç­‰ç‰¹æ€§ã€‚ é«˜é€Ÿè¯»å†™ ï¼Œredisä½¿ç”¨è‡ªå·±å®ç°çš„åˆ†ç¦»å™¨ï¼Œä»£ç é‡å¾ˆçŸ­ï¼Œæ²¡æœ‰ä½¿ç”¨lock(MySQL),å› æ­¤æ•ˆç‡éå¸¸é«˜ã€‚ Redisæ˜¯ä¸€ä¸ªç®€å•çš„ï¼Œé«˜æ•ˆçš„ï¼Œåˆ†å¸ƒå¼çš„ï¼ŒåŸºäºå†…å­˜çš„ç¼“å­˜å·¥å…·ã€‚ æ¶è®¾å¥½æœåŠ¡å™¨åï¼Œé€šè¿‡ç½‘ç»œè¿æ¥(ç±»ä¼¼æ•°æ®åº“)ï¼Œæä¾›Key-Valueç¼“å­˜æœåŠ¡ã€‚ ç®€å•ï¼Œæ˜¯Redisçªå‡ºçš„ç‰¹è‰²ã€‚ ç®€å•å¯ä»¥ä¿è¯æ ¸å¿ƒåŠŸèƒ½çš„ç¨³å®šå’Œä¼˜å¼‚ã€‚ 1.7 Redisçš„åº”ç”¨åœºæ™¯å¯ä»¥ä½œä¸ºæ•°æ®åº“ï¼Œç¼“å­˜ï¼Œçƒ­ç‚¹æ•°æ®(ç»å¸¸åˆ«æŸ¥è¯¢ï¼Œä½†æ˜¯ä¸ç»å¸¸è¢«ä¿®æ”¹æˆ–è€…åˆ é™¤çš„æ•°æ®)å’Œæ¶ˆæ¯ä¸­é—´ä»¶ç­‰å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚ Rediså¸¸ç”¨çš„åœºæ™¯ç¤ºä¾‹å¦‚ä¸‹ï¼š 123456789101112131415161ã€ç¼“å­˜ ç¼“å­˜ç°åœ¨å‡ ä¹æ˜¯æ‰€æœ‰å¤§ä¸­å‹ç½‘ç«™éƒ½åœ¨ç”¨çš„å¿…æ€æŠ€ï¼Œåˆç†åˆ©ç”¨ç¼“å­˜æå‡ç½‘ç«™çš„è®¿é—®é€Ÿåº¦ï¼Œè¿˜èƒ½å¤§å¤§é™ä½æ•°æ®åº“çš„è®¿é—®å‹åŠ›ã€‚Redisæä¾›äº†é”®è¿‡æœŸåŠŸèƒ½ï¼Œä¹Ÿæä¾›äº†çµæ´»çš„é”®æ·˜æ±°ç­–ç•¥ï¼Œæ‰€ä»¥ï¼Œç°åœ¨Redisç”¨åœ¨ç¼“å­˜çš„åœºåˆéå¸¸å¤šã€‚2ã€æ’è¡Œæ¦œ Redisæä¾›çš„æœ‰åºé›†åˆæ•°æ®ç±»ç»“æ„èƒ½å¤Ÿå®ç°è‘›æ´ªå¤æ‚çš„æ’è¡Œæ¦œåº”ç”¨ã€‚3ã€è®¡æ•°å™¨ ä»€ä¹ˆæ˜¯è®¡æ•°å™¨ï¼Œï¼Œè§†é¢‘ç½‘ç«™çš„æ’­æ”¾é‡ç­‰ç­‰ï¼Œæ¯æ¬¡æµè§ˆ+1ï¼Œå¹¶å‘é‡é«˜æ—¶å¦‚æœæ¯æ¬¡éƒ½è¯·æ±‚æ•°æ®åº“æ“ä½œæ— ç–‘æ˜¯ä¸­æŒ‘æˆ˜å’Œå‹åŠ›ã€‚Redisæä¾›çš„incrå‘½ä»¤æ¥å®ç°è®¡æ•°å™¨åŠŸèƒ½ï¼Œå†…å­˜æ“ä½œï¼Œæ€§èƒ½éå¸¸å¥½ï¼Œéå¸¸æ˜¯ç”¨äºè¿™äº›æŠ€æœ¯åœºæ™¯ã€‚4ã€åˆ†å¸ƒå¼ä¼šè¯ é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œåœ¨åº”ç”¨ä¸å¤šçš„æƒ…å†µä¸‹ä¸€èˆ¬ä½¿ç”¨å®¹æ—¥è‡ªå¸¦çš„sessionå¤åˆ¶åŠŸèƒ½å°±èƒ½å¤Ÿæ»¡è¶³ï¼Œå½“åº”ç”¨ç›¸å¯¹å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬éƒ½ä¼šæ­å»ºRedisç­‰å†…å­˜æ•°æ®åº“ä¸ºä¸­å¿ƒçš„sessionæœåŠ¡ï¼Œsessionä¸åœ¨ç”±å®¹å™¨ç®¡ç†ï¼Œè€Œæ˜¯æœ‰sessionæœåŠ¡åŠå†…å­˜æ•°æ®ç®¡ç†ã€‚5ã€åˆ†å¸ƒå¼é” åœ¨å¾ˆå¤šäº’è”ç½‘å…¬å¸ä¸­éƒ½æ˜¯ç”¨æ¥åˆ†å¸ƒå¼æŠ€æœ¯ï¼Œåˆ†å¸ƒå¼æŠ€æœ¯å¸¦æ¥çš„æŠ€æœ¯æŒ‘æˆ˜æ˜¯å¯¹åŒä¸€ä¸ªèµ„æºçš„å¹¶å‘è®¿é—®ï¼Œå¦‚å…¨å±€IDï¼Œå‡åº“å­˜ï¼Œç§’æ€ç­‰åœºæ™¯ï¼Œå¹¶å‘é‡ä¸å‘çš„åœºæ™¯å¯ä»¥ä½¿ç”¨æ•°æ®åº“çš„æ‚²è§‚é”ï¼Œä¹è§‚é”æ¥å®ç°ï¼Œä½†æ˜¯åœ¨å¹¶å‘é«˜çš„åœºåˆä¸­ï¼Œåˆ©ç”¨æ•°æ®åº“é”æ¥æ§åˆ¶èµ„æºçš„å¹¶å‘è®¿é—®æ˜¯ä¸å¤ªç†æƒ³çš„ï¼Œå¤§å¤§å½±å“äº†æ•°æ®åº“çš„æ€§èƒ½ã€‚å¯ä»¥åˆ©ç”¨Redisçš„setnxåŠŸèƒ½æ¥ç¼–å†™åˆ†å¸ƒå¼çš„é”ï¼Œå¦‚æœè®¾ç½®è¿”å›1ï¼Œè¯´æ˜è·å–æ‰€æˆåŠŸï¼Œå¦åˆ™è·å–é”å¤±è´¥ï¼Œå®é™…åº”ç”¨ä¸­è¯è€ƒè™‘çš„ç»†èŠ‚è¦æ›´å¤šã€‚6ã€ç¤¾äº¤ç½‘ç»œ ç‚¹èµã€è¸©ã€å…³æ³¨/è¢«å…³æ³¨ï¼Œå…±åŒå¥½å‹ç­‰æ˜¯ç¤¾äº¤ç½‘ç«™çš„åŸºæœ¬åŠŸèƒ½ï¼Œç¤¾äº¤ç½‘ç«™çš„è®¿é—®é‡é€šå¸¸è€è¯´æ¯”è¾ƒå¤§ï¼Œè€Œä¸”ä¼ ç»Ÿçš„å…³ç³»æ•°æ®åº“ä¸é€‚åˆè¿™ç§ç±»å‹çš„æ•°æ®ï¼ŒRedisæä¾›çš„å“ˆå¸Œï¼Œé›†åˆç­‰æ•°æ®ç»“æ„èƒ½å¾ˆæ–¹ä¾¿çš„å®ç°è¿™äº›åŠŸèƒ½ã€‚7ã€æœ€æ–°åˆ—è¡¨ Redisåˆ—è¡¨ç»“æ„ï¼ŒLPUSHå¯ä»¥åœ¨åˆ—è¡¨å¤´éƒ¨æ’å…¥ä¸€ä¸ªå†…å®¹IDä½œä¸ºå…³é”®å­—ï¼ŒLTRIMå¯ä»¥ç”¨æ¥é™åˆ¶åˆ—è¡¨çš„æ•°é‡ï¼Œè¿™æ ·åˆ—è¡¨æ°¸è¿œä¸ºNä¸ªIDã€‚æ— éœ€æŸ¥è¯¢æœ€æ–°çš„åˆ—è¡¨ï¼Œç›´æ¥æ ¹æ®ID å»åˆ°å¯¹åº”çš„å†…å®¹ä¹Ÿå³å¯ã€‚8ã€æ¶ˆæ¯ç³»ç»Ÿ æ¶ˆæ¯å¯¹é˜Ÿåˆ—æ˜¯ç½‘ç«™æ¯”ç”¨ä¸­é—´ä»¶ï¼Œå¦‚ActiveMQï¼ŒRabbitMQï¼ŒKafakaç­‰æµè¡Œçš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œä¸»è¦ç”¨äºä¸šåŠ¡è§£è€¦ï¼Œæµé‡å‰Šå³°åŠå¼‚æ­¥å¤„ç†è¯•è¯•æ€§ä½çš„ä¸šåŠ¡ã€‚Redisæä¾›äº†å‘å¸ƒ/è®¢é˜…åŠé˜»å¡é˜Ÿåˆ—åŠŸèƒ½ï¼Œèƒ½å®ç°ä¸€ä¸ªç®€å•çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿã€‚å¦å¤–ï¼Œè¿™ä¸ªä¸èƒ½å–ä¸“ä¸šçš„æ¶ˆæ¯ä¸­é—´ä»¶ç›¸æ¯”ã€‚ 1.8 Redisæ€»ç»“ä¼˜åŠ¿ æ€§èƒ½æé«˜ - Redisè¯»å†™çš„ç†Ÿè¯»110000æ¬¡/sï¼Œå†™çš„é€Ÿåº¦æ˜¯81000æ¬¡/sã€‚ ä¸°å¯Œçš„æ•°æ®ç±»å‹ - Redisæ”¯æŒçš„ç±»å‹Stringï¼Œ Hash ã€List ã€Set åŠ Ordered Setæ•°æ®ç±»å‹æ“ä½œã€‚ åŸå­æ€§ - Redisçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼Œæ„æ€å°±æ˜¯è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚å•ä¸ªæ“ä½œæ—¶åŸå­æ€§çš„ã€‚å¤šä¸ªæ“ä½œä¹Ÿæ”¯æŒäº‹åŠ¡ï¼Œå³åŸå­æ€§ï¼Œé€šè¿‡MULTIå’ŒEXECæŒ‡ä»¤åŒ…èµ·æ¥ã€‚ ä¸°å¯Œçš„ç‰¹æ€§ - Redisè¿˜æ”¯æŒpublis/subscribeï¼Œé€šçŸ¥ï¼Œkeyè¿‡æœŸç­‰ç­‰ç‰¹æ€§ã€‚ é«˜é€Ÿè¯»å†™ ï¼Œredisä½¿ç”¨è‡ªå·±å®ç°çš„åˆ†ç¦»å™¨ï¼Œä»£ç é‡å¾ˆçŸ­ï¼Œæ²¡æœ‰ä½¿ç”¨lock(MySQL),å› æ­¤æ•ˆç‡éå¸¸é«˜ã€‚ ç¼ºç‚¹ æŒä¹…åŒ–ã€‚ Redisç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°å†…å­˜ä¸­ï¼Œè¦å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸Šï¼ŒRediså¯ä»¥ä½¿ç”¨ä¸¤ç§æ–¹å¼å®ç°æŒä¹…åŒ–è¿‡ç¨‹ã€‚å®šæ—¶å¿«ç…§(snapshot)ï¼šæ¯ä¸ªä¸€ç«¯æ—¶é—´å°†æ•´ä¸ªæ•°æ®åº“å†™åˆ°ç£ç›˜ä¸Šï¼Œæ¯æ¬¡å‡æ˜¯å†™å…¨éƒ¨æ•°æ®ï¼Œä»£ä»·éå¸¸é«˜ã€‚ç¬¬äºŒç§æ–¹å¼åŸºäºè¯­å¥è¿½åŠ ï¼ˆaofï¼‰ï¼šåªè¿½è¸ªå˜åŒ–çš„æ•°æ®ï¼Œä½†æ˜¯è¿½åŠ çš„logå¯èƒ½è¿‡å¤§ï¼ŒåŒæ—¶æ‰€æœ‰çš„æ“ä½œå‡é‡æ–°æ‰§è¡Œä¸€éï¼Œå›å¤é€Ÿåº¦æ…¢ã€‚ è€—å†…å­˜ ã€å ç”¨å†…å­˜è¿‡é«˜ã€‚ äºŒã€Rediså®‰è£…2.1 Rediså®˜ç½‘å®˜æ–¹ç½‘ç«™ ï¼š https://redis.io/ å®˜æ–¹ä¸‹è½½ ï¼š https://redis.io/download å¯ä»¥æ ¹æ®éœ€è¦ä¸‹è½½ä¸åŒç‰ˆæœ¬ 2.2 Redis å®‰è£…Redisæ˜¯Cè¯­è¨€å¼€å‘ï¼Œå®‰è£…Rediséœ€è¦å…ˆå°†å®˜ç½‘ä¸‹è½½çš„æºç è¿›è¡Œç¼–è¯‘ã€‚ç¼–è¯‘ä¾èµ–gccç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰gccç¯å¢ƒï¼Œéœ€è¦å®‰è£…gcc 2.3 å®‰è£…gccgccçš„å®‰è£…å¾ˆç®€å•ï¼Œé¦–å…ˆè¦ç¡®ä¿rootç™»å½•ï¼Œå…¶æ¬¡å°±æ˜¯Linuxè¦èƒ½è¿å¤–ç½‘ 1yum -y install gcc automake autoconf libtool make æ³¨æ„ï¼š è¿è¡Œyumæ˜¯å‡ºç°/var/run/yum.pidå·²è¢«é”å®šï¼ŒPIDä¸ºxxxxçš„å¦å¤–ä¸€ä¸ªç¨‹åºæ­£åœ¨è¿è¡Œçš„é—®é¢˜è§£å†³ã€‚ 1rm -f /var/run/yum.pid 2.4 å®‰è£…Redisä¸‹è½½redisäºŒè¿›åˆ¶å®‰è£…åŒ… 1wget http://download.redis.io/release/redis-6.0.5.tar.gz è§£å‹/appsç›®å½•ä¸‹ 12345tar zxvf redis-6.0.5.tar.gz -C /apps#Linux ä¸­å‰ªåˆ‡å‘½ä»¤mv redis-6.0.5.tar.gz å®‰è£…åŒ…#Linuxä¸­å¤åˆ¶å‘½ä»¤: cp Files pathcp redis-6.0.5.tar.gz /root/apps è¿›å…¥redisä¸­ä½¿ç”¨makeå‘½ä»¤è¿›è¡Œç¼–è¯‘ 1[root@centos redis-5.0.8]# make MALLOC=libc 12345678910 LINK redis-cli CC redis-benchmark.o LINK redis-benchmark INSTALL redis-check-rdb INSTALL redis-check-aofHint: It&#x27;s a good idea to run &#x27;make test&#x27; ;)make[1]: ç¦»å¼€ç›®å½•â€œ/root/apps/redis-5.0.8/srcâ€[root@centos redis-5.0.8]# ll å®‰è£…æˆåŠŸå¦‚ä¸Š 2.5 å®‰è£…åˆ°æŒ‡å®šçš„ä½ç½®1make PREFIX=/root/apps/redis install ï¼ˆå®‰è£…ç¼–è¯‘åçš„æ–‡ä»¶ï¼‰å®‰è£…åˆ°æŒ‡å®šç›®å½•ï¼› æ³¨æ„ï¼šPREFIXå¿…é¡»ä¸ºå¤§å†™ï¼ŒåŒæ—¶ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºredisç›®å½•ï¼Œå¹¶å°†ç»“æœå®‰è£…æ­¤ç›®å½•ï¼› ä¸‰ ã€Rediså¯åŠ¨3.1 å¯åŠ¨RedisæœåŠ¡ç«¯ï¼Œè¿›å…¥åˆ°Redisçš„å®‰è£…ç›®å½•1cd /usr/local/redis 3.2 æ‰§è¡Œå‘½ä»¤1./bin/redis-server 3.3 Redisçš„å®¢æˆ·ç«¯è¿›è¡Œå¯åŠ¨1./bin/redis-cli 3.4 å¯åŠ¨Rediså®¢æˆ·ç«¯å‘½ä»¤è¯­æ³•ï¼š1redis-cli -h IPåœ°å€ -p ç«¯å£ //é»˜è®¤IPæœ¬æœº ç«¯å£å·6379 3.5 æ£€æµ‹æ˜¯å¦æœåŠ¡ç«¯å¯åŠ¨å¯åŠ¨rediså®¢æˆ·ç«¯ï¼Œæ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥å‘½ä»¤redis-cliã€‚è¯¥å‘½ä»¤è¿æ¥æœ¬åœ°çš„redisæœåŠ¡ã€‚ 1234127.0.0.1:6379&gt; 127.0.0.1:6379&gt; pingPONG127.0.0.1:6379&gt; åœ¨ä»¥ä¸Šå®ä¾‹ä¸­æˆ‘ä»¬è¿æ¥åˆ°æœ¬åœ°çš„redisæœåŠ¡å¹¶æ‰§è¡ŒPING å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ç”¨äºæ£€æµ‹redisæœåŠ¡æ˜¯å¦å¯åŠ¨ 3.6 æ£€æŸ¥redisçš„è¿›ç¨‹123456#æ‰§è¡Œ ps -ef | grep -i redis æ¥æŸ¥çœ‹è¿›ç¨‹ps -ef | grep -i redisroot 10050 5728 0 23:03 pts/0 00:00:03 ./bin/redis-server *:6379root 10077 10056 0 23:10 pts/1 00:00:00 ./bin/redis-cliroot 10100 10081 0 23:22 pts/2 00:00:00 grep --color=auto -i redis[root@centos ~]# å››ã€Redisé…ç½®è¯¦ç»†Redisé»˜è®¤å®šä¹‰äº†å¾ˆå¤šé»˜è®¤é…ç½®ã€‚ä½†åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸€èˆ¬æˆ‘ä»¬éƒ½ä¼šé€šè¿‡æ‰‹åŠ¨é…ç½®å®Œæˆã€‚å›åˆ°å®‰è£…ç›®å½•ä¸‹æ‰¾åˆ°è§£å‹æ–‡ä»¶ä¸­çš„redis.confã€‚ Redisçš„é…ç½®æ–‡ä»¶ä½äºRediså®‰è£…ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åç§°ä¸ºredis.conf 4.1 é…ç½®Rediså‘½ä»¤ï¼šè§£å‹ç›®å½•ä¸‹çš„redis.confé…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å®‰è£…æ–‡ä»¶çš„ç›®å½•ä¸‹ 123456#æŠŠç¼–è¯‘çš„redis.confæ–‡ä»¶æ”¾ ï¼Œå®‰è£…çš„redisæ–‡ä»¶ç›®å½•ä¸‹[root@centos redis-5.0.8]# pwd/root/apps/redis-5.0.8[root@centos redis-5.0.8]# cp redis.conf /root/apps/redis[root@centos redis-5.0.8]# cd ..[root@centos apps]# ll 4.2 Redis.conf12345678910111213141516171819202122232425261ã€Redisé»˜è®¤ä¸æ˜¯ä»¥å®ˆæŠ¤è¿›ç¨‹çš„æ–¹å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡è¯¥é…ç½®é¡¹ä¿®æ”¹ï¼Œä½¿ç”¨yeså¯ç”¨å®ˆæŠ¤è¿›ç¨‹ daemonize no2ã€å½“Redisä»¥å®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œæ—¶ï¼ŒRedisé»˜è®¤ä¼šæŠŠpidå†™å…¥/var/run/redis.pidæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡pidfileæŒ‡å®š pidfile /var/run/redis.pid3ã€æŒ‡å®šRedisç›‘å¬ç«¯å£ï¼Œé»˜è®¤ç«¯å£ä¸º6379ï¼›â€™ port 63794ã€ç»‘å®šçš„ä¸»æœºåœ°å€ bind 127.0.0.15ã€å½“å®¢æˆ·ç«¯é™åˆ¶å¤šé•¿æ—¶é—´åå…³é—­è¿æ¥ï¼Œå¦‚æœæŒ‡å®šä¸º0ï¼Œè¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ timeout 3006ã€æŒ‡å®šæ—¥å¿—è®°å½•å‡ å€ï¼ŒRedisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugï¼Œverboseï¼Œnoticeï¼Œwarningï¼Œé»˜è®¤ä¸ºverbose loglevel verbos7ã€æ—¥å¿—è®°å½•æ–¹å¼ï¼Œé»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºï¼Œå¦‚æœé…ç½®Redisä¸ºå®ˆæŠ¤è¿›ç¨‹æ–¹å¼è¿è¡Œï¼Œè€Œè¿™é‡Œåˆé…ç½®æ—¥å¿—è®°å½•æ–¹å¼æ ‡å‡†è¾“å‡ºï¼Œåˆ™æ—¥å¿—å°†ä¼šå‘é€ç»™/dev/null logfile stdout8ã€è®¾ç½®æ•°æ®åº“çš„æ•°é‡ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT&lt;dbid&gt;å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id databases 169ã€æŒ‡å®šåœ¨å¤šé•¿æ—¶é—´å†…ï¼Œæœ‰å¤šå°‘æ¬¡æ›´æ–°æ“ä½œï¼Œå°±å°†æ•°æ®åŒæ­¥åˆ°æ•°æ®æ–‡ä»¶ï¼Œå¯ä»¥å¤šä¸ªæ¡ä»¶é…åˆ save&lt;seconds&gt;&lt;changes&gt; Redisé»˜è®¤é…ç½®æ–‡ä»¶ä¸­æä¾›äº†ä¸‰ä¸ªæ¡ä»¶ save 900 1 save 300 10 save 60 10000 åˆ†åˆ«è¡¨ç¤º900ç§’(15åˆ†é’Ÿ)å†…æœ‰1ä¸ªæ›´æ”¹ï¼Œ300ç§’(5åˆ†é’Ÿ)å†…æœ‰10ä¸ªæ›´æ”¹ä»¥åŠ60ç§’å†…æœ‰10000ä¸ªæ›´æ”¹ã€‚10ã€æŒ‡å®šå­˜å‚¨è‡³æœ¬åœ°æ•°æ®åº“æ—¶æ˜¯å¦å‹ç¼©æ•°æ®ï¼Œé»˜è®¤ä¸ºyesï¼ŒRedisé‡‡ç”¨LZF(å‹ç¼©ç®—æ³•)å‹ç¼©ï¼Œå¦‚æœä¸ºäº†èŠ‚çœCPUæ—¶é—´ï¼Œå¯ä»¥å…³é—­è¯¥é€‰é¡¹ï¼Œä½†ä¼šå¯¼è‡´æ•°æ®åº“æ–‡ä»¶å˜çš„å·¨å¤§ rdbcompression yes ä¸­é—´10ä¸ª 123456789101112131415161718192021222311ã€æŒ‡å®šæœ¬åœ°æ•°æ®åº“æ–‡ä»¶åï¼Œé»˜è®¤ä¸ºdump.rdb dbfilename dump.rdb12ã€æŒ‡å®šæœ¬åœ°æ•°æ®åº“å­˜æ”¾ç›®å½• dir ./13ã€è®¾ç½®å½“æœ¬æœºä¸ºslavæœåŠ¡æ—¶ï¼Œè®¾ç½®masteræœåŠ¡çš„IPåœ°å€åŠç«¯å£ï¼Œåœ¨Rediså¯åŠ¨æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨ä»masterè¿›è¡Œæ•°æ®åŒæ­¥slaveof&lt;masterip&gt; &lt;masterport&gt;14ã€å½“masteræœåŠ¡è®¾ç½®äº†å¯†ç ä¿æŠ¤æ—¶ï¼ŒslavæœåŠ¡è¿æ¥masterçš„å¯†ç  masterauth&lt;master-password&gt;15ã€è®¾ç½®Redisè¿æ¥å¯†ç ï¼Œå¦‚æœé…ç½®äº†è¿æ¥å¯†ç ï¼Œå®¢æˆ·ç«¯åœ¨è¿æ¥Redisæ˜¯éœ€è¦é€šè¿‡AUTH &lt;password&gt;å‘½ä»¤æä¾›å¯†ç ï¼Œé»˜è®¤å…³é—­ requirepass foobared16ã€è®¾ç½®åŒä¸€æ—¶é—´æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°ï¼Œé»˜è®¤æ˜¯æ— é™åˆ¶ï¼ŒRediså¯ä»¥åŒæ—¶æ‰“å¼€çš„å®¢æˆ·ç«¯è¿æ¥æ•°ä¸ºRedisè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼Œå¦‚æœè®¾ç½®maxclients 0ï¼Œè¡¨ç¤ºä¸ä½œé™åˆ¶ã€‚å½“å®¢æˆ·ç«¯è¿æ¥æ•°åˆ°è¾¾é™åˆ¶æ˜¯ï¼ŒRedisä¼šå…³é—­æ–°çš„è¿æ¥å¹¶å‘å®¢æˆ·ç«¯è¿”å›max number of clients reachedé”™è¯¯ä¿¡æ¯ maxclients 12817ã€æŒ‡å®šRedisæœ€å¤§å†…å­˜é™åˆ¶ï¼ŒRedisåœ¨å¯åŠ¨æ—¶ä¼šæŠŠæ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè¾¾åˆ°æœ€å¤§å†…å­˜åï¼ŒRedisä¼šå…ˆå°è¯•æ¸…é™¤å·²åˆ°æœŸæˆ–å³å°†åˆ°æœŸçš„Keyï¼Œæ¡£æ¬¡æ–¹æ³•å¤„ç†åï¼Œä»ç„¶è¾¾æœ€å¤§å†…å­˜è®¾ç½®ï¼Œå°†æ— æ³•å†è¿›è¡Œå†™å…¥æ“ä½œï¼Œä½†ä»ç„¶å¯ä»¥é™å¿ƒè¯»å–æ“ä½œã€‚Rdisæ–°çš„vmæœºåˆ¶ï¼Œä¼šæŠŠkeyå­˜æ”¾å†…å­˜ï¼ŒValueä¼šå­˜æ”¾åœ¨swapåŒº maxmemory &lt;bytes&gt;18ã€æŒ‡å®šæ˜¯å¦æ¯æ¬¡æ›´æ–°æ“ä½œåè¿›è¡Œæ—¥å¿—è®°å½•ï¼ŒRedisåœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯å¼‚æ­¥çš„æŠŠæ•°æ®å†™å…¥ç£ç›˜ï¼Œå¦‚æœä¸å¼€å¯ï¼Œå¯èƒ½ä¼šåœ¨æ–­ç”µæ—¶å¯¼è‡´ä¸€ç«¯æ—¶é—´å†…çš„æ•°æ®ä¸¢å¤±ã€‚å› ä¸º redis æœ¬çœåŒæ­¥æ•°æ®æ–‡ä»¶æ˜¯æŒ‰ä¸Šé¢saveæ¡ä»¶æ¥åŒæ­¥çš„ï¼Œæ‰€æœ‰çš„æ•°æ®ä¼šåœ¨ä¸€ç«¯æ—¶é—´å†…åªå­˜åœ¨äºå†…å­˜ä¸­ã€‚é»˜è®¤ä¸ºno appendonly no19ã€æŒ‡å®šæ›´æ–°æ—¥å¿—æ–‡ä»¶åï¼Œé»˜è®¤ä¸ºappendonly.aof appendfulename appendonly.aof20ã€æŒ‡å®šæ›´æ–°æ—¥å¿—æ¡ä»¶ï¼Œå…±æœ‰3ä¸ªå¯é€‰å€¼ï¼š no: è¡¨ç¤ºç­‰æ“ä½œç³»ç»Ÿè¿›è¡Œæ•°æ®ç¼“å­˜åŒæ­¥åˆ°ç£ç›˜(å¿«) always: è¡¨ç¤ºæ¯æ¬¡æ›´æ–°æ“ä½œåæ´»åŠ¨è°ƒç”¨fsync()å°†æ•°æ®å†™åˆ°ç£ç›˜(æ…¢ï¼Œå®‰å…¨) everysec: è¡¨ç¤ºæ¯ç§’åŒæ­¥ä¸€ä¸ª(æŠ˜ä¸­ï¼Œé»˜è®¤å€¼) appendfsync everysec 1234567maxmemory-policy noeviction # å†…å­˜è¾¾åˆ°ä¸Šé™ä¹‹åçš„å¤„ç†ç­–ç•¥1ã€volatile-lru ï¼š åªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyè¿›è¡ŒLRUï¼ˆé»˜è®¤å€¼ï¼‰2ã€allkeys-lru ï¼š äº§å‡ºlruç®—æ³•çš„key3ã€volatile-random ï¼š éšæœºåˆ é™¤å³å°†è¿‡æœŸkey4ã€allkey -random : éšæœºåˆ é™¤5ã€volatile-ttl : åˆ é™¤å³å°†è¿‡æœŸçš„6ã€noeviction ï¼š æ°¸ä¸è¿‡æœŸï¼Œè¿”å›é”™è¯¯ ç»“å°¾10ä¸ª 12345678910111213141516171819202121ã€æŒ‡å®šæ˜¯å¦å¯ç”¨è™šæ‹Ÿå†…å­˜æœºåˆ¶ï¼Œé»˜è®¤ä¸ºnoï¼Œç®€å•çš„ä»‹ç»ä¸€ä¸‹ï¼Œvmæœºåˆ¶å°†æ•°æ®åˆ†é¡µå­˜æ”¾ï¼Œæœ‰Rediså°†è®¿é—®é‡è¾ƒå°‘çš„é¡µå³å†·æ•°æ®swapåˆ°ç£ç›˜ä¸Šï¼Œè®¿é—®å¤šçš„é¡µé¢ç”±ç£ç›˜è‡ªåŠ¨æ¢å‡ºåˆ°å†…å­˜ä¸­(åœ¨åé¢çš„æ–‡ç« ä¼šä»”ç»†åˆ†æRedisçš„vmæœºåˆ¶) vm-enabled no22ã€è™šæ‹Ÿå†…å­˜æ–‡ä»¶è·¯å¾„ï¼Œé»˜è®¤å€¼ä¸º/tmp/redis.swapï¼Œä¸å¯å¤šä¸ªRediså®ä¾‹å…±äº« vm-swap-file /tmp/redis.swap23ã€å°†æ‰€æœ‰å¤§äºvm-max-memoryçš„æ•°æ®å­˜å…¥è™šæ‹Ÿå†…å­˜ï¼Œæ— è®ºvm-max-memoryè®¾ç½®å¤šå°ï¼Œæ‰€æœ‰ç´¢å¼•æ•°æ®éƒ½æ˜¯å†…å­˜å­˜å‚¨çš„(Redisçš„ç´¢å¼•æ•°æ® å°±æ˜¯keys)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“vm-max-memoryè®¾ç½®ä¸º0çš„æ—¶å€™ï¼Œå…¶å®æ˜¯æ‰€æœ‰valueéƒ½å­˜åœ¨äºç£ç›˜ã€‚é»˜è®¤å€¼ä¸º0 vm-page-size 3224ã€Redis swapæ–‡ä»¶åˆ†æˆäº†å¾ˆå¤šçš„pageï¼Œä¸€ä¸ªå¯¹è±¡å¯ä»¥ä¿å­˜å’±å‡ å¤šä¸ªpageä¸Šé¢ï¼Œä½†ä¸€ä¸ªpageä¸Šä¸èƒ½è¢«å¤šä¸ªå¯¹è±¡å…±äº«ï¼Œvm-page-sizeæ˜¯è¦æ ¹æ®å­˜å‚¨çš„ æ•°æ®å¤§å°æ¥è®¾å®šçš„ï¼Œä½œè€…å»ºè®®å¦‚æœæ‘ç²—å¾ˆå¤šå°å¯¹è±¡ï¼Œpageå¤§å°æœ€å¥½è®¾ç½®ä¸º32æˆ–è€…64bytesï¼›å¦‚æœå­˜å‚¨å¾ˆå¤§å¤§å¯¹è±¡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨æ›´å¤§çš„pageï¼Œå¦‚æœä¸ç¡®å®šï¼Œå°±æ˜¯ç”¨é»˜è®¤å€¼ vm-page-size 3225ã€è®¾ç½®swapæ–‡ä»¶ä¸­çš„pageæ•°é‡ï¼Œç”±äºé¡µè¡¨(ä¸€ç§è¡¨ç¤ºé¡µé¢ç©ºé—²æˆ–æ˜¯æ¬§è¯ºä¸ªçš„bitmap)æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œåœ¨ç£ç›˜ä¸Šæ¯8ä¸ªpageså°†æ¶ˆè€—1byteçš„å†…å­˜ vm-pages 13421772826ã€è®¾ç½®è®¿é—®swapæ–‡ä»¶çš„çº¿ç¨‹æ•°ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡æœºå™¨çš„æ ¸æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆæ‰€æœ‰å¯¹swapæ–‡ä»¶çš„æ“ä½œéƒ½æ˜¯ä¸²è¡Œçš„ï¼Œå¯èƒ½ä¼šé€ æˆæ¯”è¾ƒé•¿æ—¶é—´çš„å»¶è¿Ÿã€‚é»˜è®¤å€¼ä¸º 4 vm-max-threads 427ã€è®¾ç½®åœ¨å‘å®¢æˆ·ç«¯åº”ç­”æ—¶ï¼Œæ˜¯å¦æŠŠè¾ƒå°çš„åŒ…å«å¹¶æœªä¸€ä¸ªåŒ…å‘é€ï¼Œé»˜è®¤ä¸ºå¼€å¯ glueoutputbuf yes28ã€æŒ‡å®šåœ¨è¶…è¿‡ä¸€å®šçš„æ•°é‡æˆ–è€…æœ€å¤§çš„å…ƒç´ è¶…è¿‡æŸä¸€ä¸´ç•Œå€¼æ—¶ï¼Œé‡‡ç”¨ä¸€ç§ç‰¹æ®Šçš„å“ˆå¸Œç®—æ³• hash-max-zipmap-entries 64 hash-max-zipmap-value 51229ã€æŒ‡å®šæ˜¯å¦æ¿€æ´»é‡ç½®å“ˆå¸Œã€‚é»˜è®¤ä¸ºå¼€å¯(åé¢åœ¨ä»‹ç»Redisçš„å“ˆå¸Œç®—æ³•æ—¶å…·ä½“ä»‹ç») activerehasing yes30ã€æŒ‡å®šåŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥åœ¨åŒä¸€ä¸»æœºä¸Šå¤šä¸ªrediså®ä¾‹ä¹‹é—´ä½¿ç”¨åŒä¸€ä»½é…ç½®æ–‡ä»¶ï¼Œè€ŒåŒæ—¶å„ä¸ªå®ä¾‹åˆæ‹¥æœ‰è‡ªå·±çš„ç‰¹å®šé…ç½®æ–‡ä»¶ include /path/to/local.conf 4.2ã€å†…å­˜ä¸­çš„ç»´æŠ¤ç­–ç•¥redisä½œä¸ºä¼˜ç§€çš„ä¸­é—´ç¼“å­˜ä»¶ï¼Œæ—¶å¸¸ä¼šå­˜å‚¨å¤§é‡çš„æ•°æ®ï¼Œå³ä½¿é‡‡å–äº†é›†ç¾¤éƒ¨ç½²æ¥åŠ¨æ€æ‰©å®¹ï¼Œä¹Ÿåº”è¯¥å³ä½¿çš„æ•´ç†å†…å­˜ï¼Œç»´æŒç³»ç»Ÿæ€§èƒ½ã€‚ 4.2.1 åœ¨redisä¸­æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆ ä¸ºæ•°æ®è®¾ç½®è¶…æ—¶æ—¶é—´ 1234567//è®¾ç½®è¿‡æœŸæ—¶é—´expire key time(ä»¥ç§’ä¸ºå•ä½)--è¿™æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼setex(String key, int seconds, String value) --å­—ç¬¦ä¸²ç‹¬æœ‰çš„æ–¹å¼1ã€é™¤äº†å­—ç¬¦ä¸²è‡ªå·±ç‹¬æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ–¹æ³•å¤–ï¼Œå…¶ä»–æ–¹æ³•éƒ½éœ€è¦ä¾é expireæ–¹æ³•æ¥è®¾ç½®æ—¶é—´2ã€å¦‚æœæ²¡æœ‰è®¾ç½®æ—¶é—´ï¼Œé‚£ç¼“å­˜å°±æ˜¯æ°¸ä¸è¿‡æœŸ3ã€å¦‚æœè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œä¹‹ååˆæƒ³è®©ç¼“å­˜æ°¸ä¸è¿‡æœŸæ²¡ä½¿ç”¨persist key é‡‡ç”¨LRUç®—æ³•åŠ¨æ€å°†ä¸ç”¨çš„æ•°æ®åˆ é™¤ 123å†…å­˜ç®¡ç†çš„ä¸€ç§é¡µé¢ç½®æ¢ç®—æ³•ï¼Œå¯¹äºåœ¨å†…å­˜ä¸­ä½†åˆä¸ç”¨çš„æ•°æ®å—(å†…å­˜å—)å«åšLRUï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®å“ªäº›æ•°æ®å±äºLRUè€Œå°†å…¶ç§»é™¤å†…å­˜è€Œè…¾å‡ºç©ºé—´æ¥åŠ è½½å¦å¤–çš„æ•°æ®ã€‚ 1.volatile-lruï¼šè®¾å®šè¶…æ—¶æ—¶é—´çš„æ•°æ®ä¸­ï¼Œåˆ é™¤æœ€ä¸å¸¸ä½¿ç”¨çš„æ•°æ® 2.allkeys-lruï¼šæŸ¥è¯¢æ‰€æœ‰çš„keyåªèƒ½æ€ªæœ€è¿‘æœ€ä¸å¸¸ä½¿ç”¨çš„æ•°æ®è¿›è¡Œåˆ é™¤ï¼Œè¿™æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„ç­–ç•¥ã€‚ 3.volatile-randomï¼šåœ¨å·²ç»è®¾å®šäº†è¶…æ—¶çš„æ•°æ®ä¸­éšæœºåˆ é™¤ã€‚ 4.allkeys-randomï¼šæŸ¥è¯¢æ‰€æœ‰çš„keyï¼Œä¹‹åéšæœºåˆ é™¤ã€‚ 5.volatile-ttlï¼šæŸ¥è¯¢å…¨éƒ¨è®¾å®šè¶…æ—¶æ—¶é—´çš„æ•°æ®ï¼Œä¹‹åæ’åºï¼Œå°†é©¬ä¸Šè¦è¿‡æœŸçš„æ•°æ®è¿›è¡Œåˆ é™¤æ“ä½œã€‚ 6.noevictionï¼šå¦‚æœè®¾ç½®ä¸ºè¯¥å±æ€§ï¼Œåˆ™ä¸ä¼šè¿›è¡Œåˆ é™¤æ“ä½œï¼Œå¦‚æœå†…å­˜æº¢å‡ºåˆ™æŠ¥é”™è¿”å›ã€‚ 7.volatile-lfuï¼šä»æ‰€æœ‰é…ç½®äº†è¿‡å»æ—¶é—´çš„é”®ä¸­é©±é€ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„é”® 8.allkeys-lfuï¼šä»æ‰€æœ‰é”®ä¸­é©±é€ä½¿ç”¨é¢‘ç‡æœ€å°‘çš„é”® 4.2.2 è‡ªå®šä¹‰é…ç½®redisè¿›å…¥å¯¹åº”çš„å®‰è£…ç›®å½•ï¼š 1/root/apps/redis ä¿®æ”¹redis.confé…ç½®æ–‡ä»¶ vim redis.confï¼ˆè¿›å…¥å‘½ä»¤æ¨¡å¼ é€šè¿‡/å†…å®¹ æŸ¥æ‰¾ç›¸åº”å­—ç¬¦ä¸²ï¼‰ 123daemonize no ä¿®æ”¹ä¸º daemonize yes å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨bind 127.0.0.1 æ³¨é‡Šæ‰ å…è®¸é™¤æœ¬æœº å¤–çš„æœºå™¨è®¿é—®redisæœåŠ¡requirepass è®¾ç½®å¯†ç  è®¾å®šæ•°æ®åº“å¯†ç  (ä¿è¯æœåŠ¡å®‰å…¨/æœ‰äº›æƒ…å†µä¸‹ä¸è®¾å®šå¯†ç æ˜¯æ— æ³•è¿›è¡Œè¿œç¨‹è¿æ¥è®¿é—®çš„) Redisé‡‡ç”¨çš„æ˜¯å•è¿›ç¨‹å¤šçº¿ç¨‹çš„æ¨¡å¼ã€‚å½“redis.confä¸­é€‰é¡¹daemonizeè®¾ç½®æˆä¸ºyesæ—¶ï¼Œä»£è¡¨å¼€å¯å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ã€‚åœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œredisä¼šåœ¨åå°è¿è¡Œï¼Œå¹¶å°†è¿›ç¨‹pidå·å†™å…¥å€¼redis.confé€‰é¡¹pidfileè®¾ç½®çš„æ–‡ä»¶ä¸­ï¼Œæ­¤æ—¶rediså°†ä¸€ç›´è¿è¡Œï¼Œé™¤éæ‰‹åŠ¨killè¯¥è¿›ç¨‹ã€‚ä½†å½“daemonizeé€‰é¡¹è®¾ç½®ä¸ºnoæ—¶ï¼Œå½“å‰ç•Œé¢å°†è¿›å…¥redisçš„å‘½ä»¤è¡Œç•Œé¢ï¼Œexitå¼ºåˆ¶é€€å‡ºæˆ–è€…å…³é—­è¿æ¥å·¥å…·ï¼ˆputty,xshellç­‰ï¼‰éƒ½ä¼šå‘†æ»redisè¿›ç¨‹é€€å‡ºã€‚ æœåŠ¡ç«¯å¼€å‘çš„å¤§éƒ¨åˆ†åº”ç”¨éƒ½æ˜¯é‡‡ç”¨åå°è¿è¡Œçš„æ¨¡å¼ requirepassè®¾ç½®å¯†ç ã€‚å› ä¸ºredisé€Ÿåº¦ç›¸å½“å¿«ï¼Œæ‰€ä»¥ä¸€å°æ¯”è¾ƒå¥½çš„æœåŠ¡å™¨ä¸‹ï¼Œä¸€ä¸ªå¤–éƒ¨ç”¨æˆ·åœ¨ä¸€ç§’å†…å¯ä»¥è¿›è¡Œ15wå¯†ç å°è¯•ï¼Œè¿™æ„å‘³ä½ éœ€è¦è®¾å®šéå¸¸å¼ºå¤§çš„å¯†ç æ¥é˜²æ­¢æš´åŠ›ç ´è§£ã€‚ å¯ä»¥é€šè¿‡redisçš„é…ç½®æ–‡ä»¶è®¾ç½®å¯†ç å‚æ•°ï¼Œè¿™æ ·å®¢æˆ·ç«¯è¿æ¥å¤§redisæœåŠ¡å°±éœ€è¦å¯†ç éªŒè¯ï¼Œè¿™æ ·å¯ä»¥è®©ä½ çš„redisæœåŠ¡æ›´åŠ å®‰å…¨ã€‚ äº” ã€Rediså¯åŠ¨5.1 Redisä»¥å®ˆæŠ¤è¿›ç¨‹æœåŠ¡ç«¯è¿›è¡Œå¯åŠ¨123456// ä½¿ç”¨è¯¥å‘½ä»¤è¿›è¡Œå¯åŠ¨ï¼šã€./bin/redis-server ./redis.conf ã€‘[root@centos redis]# ./bin/redis-server ./redis.conf 11450:C 05 Jul 2020 12:23:34.257 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo11450:C 05 Jul 2020 12:23:34.257 # Redis version=5.0.8, bits=64, commit=00000000, modified=0, pid=11450, just started11450:C 05 Jul 2020 12:23:34.257 # Configuration loaded[root@centos redis]# 5.2 Rediså®¢æˆ·ç«¯è¿›è¡Œå¯åŠ¨ï¼š12345//Redis å®¢æˆ·ç«¯å¯åŠ¨å‘½ä»¤ï¼š./redis-cli[root@centos bin]# ./redis-cli 127.0.0.1:6379&gt; keys *1) &quot;name&quot;127.0.0.1:6379&gt; å…­ã€Rediså…³é—­6.1ã€ç¬¬ä¸€ç§å…³é—­æ–¹å¼ï¼š(æ–­ç”µã€éæ­£å¸¸å…³é—­ï¼Œå®¹æ˜“æ•°æ®ä¸¢å¤±) æŸ¥è¯¢ä¸åˆ°redisè¿›ç¨‹id 1PID ps -ef | grep -i redis kill æŸ¥è¯¢çš„idè¿›è¡Œå¼ºåˆ¶å…³é—­ 1kill -9 PID 6.2ã€ç¬¬äºŒç§å…³é—­æ–¹å¼(æ­£å¸¸å…³é—­ï¼Œæ•°æ®ä¿å­˜) å…³é—­redisæœåŠ¡ï¼Œé€šè¿‡å®¢æˆ·ç«¯è¿›è¡Œshutdown å¦‚æœredisè®¾ç½®äº†å¯†ç ï¼Œéœ€è¦å…ˆåœ¨å®¢æˆ·ç«¯é€šè¿‡å¯†ç ç™»å½•ï¼Œåœ¨è¿›è¡Œshutdownå³å¯å…³é—­æœåŠ¡ç«¯ 12345// åœ¨å®¢æˆ·ç«¯ä½¿ç”¨ã€shutdownã€‘å‘½ä»¤å…³é—­RedisæœåŠ¡ç«¯127.0.0.1:6379&gt; SHUTDOWNnot connected&gt; yCould not connect to Redis at 127.0.0.1:6379: Connection refusednot connected&gt; shutdown ä¸ƒã€è¿œç¨‹è¿æ¥7.1 Redisè¿œç¨‹è¿æ¥æ¯”è¾ƒæµè¡Œçš„è½¯ä»¶ï¼šRedisDesktoManageré»˜è®¤ä¸å…è®¸è¿œç¨‹è¿æ¥ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ä¿¡æ¯æ‰å¯ä»¥è¿›è¡Œä¿®æ”¹ï¼Œ 12bind 127.0.0.1 æ³¨é‡Šæ‰ å…è®¸é™¤æœ¬æœºä»¥å¤–çš„æœºå™¨è®¿é—®RedisæœåŠ¡requirepass è®¾ç½®å¯†ç  è®¾å®šæ•°æ®åº“å¯†ç (æœ‰äº›æƒ…å†µç³»ä¸è®¾å®šå¯†ç æ˜¯æ— æ³•è¿›è¡Œè¿œç¨‹è¿æ¥è®¿é—®çš„) 7.2 Redisä½¿ç”¨å¯†ç ç™»å½•123456// Rediså®¢æˆ·ç«¯ä½¿ç”¨å¯†ç è¿›è¡Œç™»å½• ã€./bin/redis-cli -a redisã€‘[root@centos redis]# ./bin/redis-cli -a redisWarning: Using a password with &#x27;-a&#x27; or &#x27;-u&#x27; option on the command line interface may not be safe.127.0.0.1:6379&gt; keys *1) &quot;name&quot;127.0.0.1:6379&gt; Centos é˜²ç«å¢™ç«¯å£å¼€æ”¾8080ç«¯å£ï¼ˆå¦‚ä¸‹å‘½ä»¤åªé’ˆå¯¹Centos7ä»¥ä¸Šï¼‰ æŸ¥çœ‹å·²ç»å¼€æ”¾çš„ç«¯å£ï¼š 1firewall-cmd --list-ports å¼€å¯ç«¯å£ï¼š 1firewall-cmd --zone=public --add-port-6379/tcp --permanent é‡å¯é˜²ç«å¢™ï¼š 1234firewall-cmd --reload #é‡å¯Firewall systemctl stop firewalld.service #åœæ­¢firewall systemctl disable firewalld.service #ç¦æ­¢firewall å¼€æœºå¯åŠ¨ å…« ã€Dockerå®‰è£…Redis8.1 æœç´¢redis1docker search redis 8.2 ä¸‹è½½é•œåƒ1docker pull redisï¼š4.0.1 8.3 åˆ›å»ºå¹¶è¿è¡Œå®¹å™¨1docker run -d --name redis6379 -p 6379:6379 redis:4.0.1 --requirepass &quot;redis&quot; 8.4 æµ‹è¯•è¿›å…¥Redisè¿›å…¥å®¢æˆ·ç«¯ä½¿ç”¨redisé•œåƒæ‰§è¡Œredis-cliå‘½ä»¤è¿æ¥åˆ°åˆšå¯åŠ¨çš„å®¹å™¨ ä¹ã€Rediså¸¸ç”¨å‘½ä»¤Redis å‘½ä»¤ç”¨äºåœ¨redisæœåŠ¡ä¸Šæ‰§è¡Œæ“ä½œã€‚è¦åœ¨redisæœåŠ¡ä¸Šæ‰§è¡Œå‘½ä»¤éœ€è¦ä¸€ä¸ªrediså®¢æˆ·ç«¯ã€‚ Redis å®¢æˆ·ç«¯åœ¨æˆ‘ä»¬ä¹‹å‰ä¸‹è½½çš„Redisçš„å®‰è£…åŒ…ä¸­ã€‚ **Redisæ”¯æŒçš„ç‰©ç§æ•°æ®ç±»å‹ ï¼šstring(å­—ç¬¦ä¸²)ï¼Œhash(å“ˆå¸Œ)ï¼Œlist(åˆ—è¡¨)ï¼Œset(é›†åˆ)åŠzsetï¼ˆsorted set : æœ‰åºé›†åˆï¼‰ç­‰ 9.1 å¸¸ç”¨å‘½ä»¤keyç®¡ç†1234567891011121314151617181ã€ keys * :è¿”å›æ»¡è¶³çš„æ‰€æœ‰é”®ï¼Œå¯ä»¥æ¨¡ç³ŠåŒ¹é…ï¼Œæ¯”å¦‚ keys abc* ï¼šè¡¨ç¤ºä»¥ abc å¼€å¤´çš„ key2ã€ exists key ï¼š æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„key ï¼Œå­˜åœ¨è¿”å›1.ä¸å­˜åœ¨è¿”å›03ã€ expire key second ï¼šè®¾ç½®æŸä¸ªkeyçš„è¿‡æœŸæ—¶é—´ æ—¶é—´ä¸ºå¦™4ã€ del key : åˆ é™¤æŸä¸ªkey5ã€ ttl key ï¼šæŸ¥çœ‹å‰©ä½™æ—¶é—´ï¼Œå½“keyä¸å­˜åœ¨æ˜¯ï¼Œè¿”å›-2ï¼›å­˜åœ¨ä½†æ²¡æœ‰è®¾ç½®å‰©ä½™ç”Ÿå­˜æ—¶é—´æ—¶ï¼Œè¿”å› -1ï¼Œå¦ åˆ™ï¼Œä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ã€‚6ã€ persist key ï¼šå–æ¶ˆè¿‡å»æ—¶é—´7ã€ PEXPIRE key millisseconds ä¿®æ”¹key çš„è¿‡æœŸæ—¶é—´ä¸ºæ¯«ç§’8ã€ select ï¼š é€‰æ‹©æ•°æ®åº“ æ•°æ®åº“ä¸º0-15ï¼ˆé»˜è®¤ä¸€å…±16ä¸ªæ•°æ®åº“ï¼‰9ã€ è®¾è®¡æˆå¤šä¸ªæ•°æ®åº“å®é™…ä¸Šæ˜¯ä¸ºäº†æ•°æ®åº“å®‰å…¨å’Œå¤‡ä»½10ã€ move key dbindex ï¼š å°†å½“å‰æ•°æ®ä¸­çš„keyè½¬ç§»åˆ°å…¶ä»–æ•°æ®åº“11ã€ randomkey ï¼š éšæœºè¿”å›ä¸€ä¸ªkey12ã€ rename key key2 : ç§å‘½åkey13ã€ echo ï¼š æ‰“å°å‘½ä»¤14ã€ dbsize : æŸ¥çœ‹æ•°æ®åº“çš„keyæ•°é‡15ã€ info : æŸ¥çœ‹æ•°æ®åº“ä¿¡æ¯16ã€ config get * å®æ—¶å­˜å‚¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œè¿”å›ç›¸å…³çš„é…ç½®17ã€ flushdb ï¼š æ¸…é™¤å½“å‰æ•°æ®åº“18ã€ flushall ï¼š æ¸…ç©ºæ‰€æœ‰æ•°æ®åº“ 9.2 DEL key1è¯¥å‘½ä»¤ç”¨äºåœ¨keyå­˜åœ¨æ—¶åˆ é™¤keyã€‚ 9.3 EXISTS key1æ£€æŸ¥ç»™å®škeyæ˜¯å¦å­˜åœ¨ã€‚ 9.4 EXPIRE key seconds1ä¸ºç»™å®škeyè®¾ç½®è¿‡æœŸæ—¶é—´(ä»¥ç§’è®¡) 9.5 PEXPIRE key milliseconds1è®¾ç½®keyçš„è¿‡æœŸæ—¶é—´ä»¥æ¯«ç§’è®¡ 9.6 TTL key1ä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å›ç»™å®škeyçš„å‰©ä½™ç”Ÿå­˜æ—¶é—´(TTL, time to live) 9.7 PTTL key1ä»¥ç§’ä¸ºå•ä½ï¼Œè¿”å› key çš„å‰©ä½™ç”Ÿå­˜æ—¶é—´ 9.8 KEYS pattern12345æŸ¥æ‰¾æ‰€æœ‰æœåŠ¡ç»™å®šæ¨¡å¼(pattern)çš„keyã€‚keys é€šé…ç¬¦ è·å–æ‰€æœ‰ä¸patternåŒ¹é…çš„keyï¼Œè¿”å›æ‰€æœ‰ä¸è¯¥åŒ¹é… é€šé…ç¬¦ ï¼š * ä»£è¡¨æ‰€æœ‰ ? è¡¨ç¤ºä»£è¡¨ä¸€ä¸ªå­—ç¬¦ 9.9 RENAME key newkey1ä¿®æ”¹keyçš„åç§° 9.10 MOVE key db1å°†å½“å‰æ•°æ®åº“çš„ key ç§»åŠ¨åˆ°ç»™å®šçš„æ•°æ®åº“dbå½“ä¸­ 9.11 TYPE key1è¿”å› key æ‰€å­˜å‚¨çš„å€¼çš„ç±»å‹ 9.12 åº”ç”¨åœºæ™¯EXPIPER key seconds 12341ã€é™æ—¶çš„ä¼˜æƒ æ´»åŠ¨ä¿¡æ¯2ã€ç½‘ç«™æ•°æ®ç¼“å­˜(å¯¹äºä¸€äº›éœ€è¦å®šæ—¶æ›´æ–°çš„æ•°æ®ï¼Œä¾‹å¦‚:ç§¯åˆ†æ’è¡Œæ¦œ)3ã€æ‰‹æœºéªŒè¯ç 4ã€é™åˆ¶ç½‘ç«™è®¿å®¢è®¿é—®é¢‘ç‡(ä¾‹å¦‚ï¼š1åˆ†é’Ÿæœ€å¤šè®¿é—®10æ¬¡) 9.13 keyçš„å‘½åå»ºè®®rediså•ä¸ªkeyå…è®¸å­˜å…¥512Må¤§å° 1ã€key ä¸è¦å¤ªé•¿ï¼Œå°½é‡ä¸è¦è¶…è¿‡1024å­—èŠ‚ï¼Œè¿™ä¸ä»…æ¶ˆè€—å†…å­˜ï¼Œè€Œä¸”ä¼šé™ä½æŸ¥æ‰¾çš„æ•ˆç‡ 2ã€key ä¹Ÿä¸è¦å¤ªçŸ­ï¼Œå¤ªçŸ­çš„è¯ï¼Œkeyçš„å¯è¯»æ€§ä¼šé™ä½ 3ã€åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œkeyæœ€å¥½ä½¿ç”¨æè®®çš„å‘½åæ¨¡å¼ï¼Œä¾‹å¦‚user:12:password 4ã€keyåç§°åŒºåˆ†å¤§å°å†™ å ã€Redisæ•°æ®ç±»å‹10.1 String ç±»å‹Stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªé”®æœ€å¤§èƒ½å­˜å‚¨512MBã€‚ String æ•°æ®ç»“æ„æœ€è´±ä½†çš„key-valueç±»å‹ï¼Œvalueå…¶ä¸ä»…æ˜¯stringï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°å­—ï¼Œæ˜¯åŒ…å«å¾ˆå¤šç§ç±»å‹çš„ç‰¹æ®Šç±»å‹ï¼Œ Stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„æ€æ˜¯redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚ æ¯”å¦‚åºåˆ—åŒ–çš„å¯¹è±¡è¿›è¡Œå­˜å‚¨ï¼Œæ¯”å¦‚ä¸€å¼ å›¾ç‰‡è¿›è¡ŒäºŒè¿›åˆ¶å­˜å‚¨ï¼Œæ¯”å¦‚ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œæ•°å€¼ç­‰ç­‰ã€‚ Stringå‘½ä»¤123456789101112131415161718192021222324252627282930313233343536373839404142431ã€å¤åˆ¶è¯­æ³•ï¼š SET KEY_NAME VALUE : (è¯´æ˜ï¼šå¤šæ¬¡è®¾ç½®nameä¼šè¦†ç›–)(Redis SET å‘½ä»¤ç”¨äºè®¾ç½®ç»™å®š key çš„å€¼ã€‚å¦‚æœ key å·²ç»å­˜å‚¨å€¼ï¼ŒSET å°±è¦å†™æ—§å€¼ï¼Œä¸”æ— è§†ç±»å‹)ã€‚2ã€å‘½ä»¤ï¼š SETNX key1 valueï¼š(not exist) å¦‚æœkey1ä¸å­˜åœ¨ï¼Œåˆ™è®¾ç½® å¹¶è¿”å›1ã€‚å¦‚æœkey1å­˜åœ¨ï¼Œåˆ™ä¸è®¾ç½®å¹¶è¿”å›0;(è§£å†³åˆ†å¸ƒå¼é” æ–¹æ¡ˆä¹‹ä¸€ï¼Œåªæœ‰åœ¨key ä¸å­˜åœ¨æ—¶è®¾ç½® key çš„å€¼ã€‚setnx (SET if not exits)å‘½ä»¤åœ¨æŒ‡å®šçš„keyä¸å­˜åœ¨æ—¶ï¼Œä¸ºkeyè®¾ç½®æŒ‡å®šçš„å€¼)ã€‚ SETEX key1 10 lx :(expired)è®¾ç½®key1çš„å€¼ä¸ºlx,è¿‡æœŸæ—¶é—´ä¸º10ç§’ï¼Œ10ç§’åkey1æ¸…é™¤ï¼ˆkeyä¹Ÿæ¸…é™¤ï¼‰SETEX key1 10 lx :(expired) è®¾ç½®key1çš„å€¼ä¸ºlxï¼Œè¿‡æœŸæ—¶é—´ä¸º10ç§’ï¼Œ10ç§’åkey1æ¸…é™¤(key ä¹Ÿæ¸…é™¤)SETRANG STRING range value : æ›¿æ¢å­—ç¬¦ä¸²3ã€å–å€¼è¯­æ³•ï¼š GET KEY_NAME : Redis GET å‘½ä»¤ç”¨äºè·å–æŒ‡å®š key çš„å€¼ã€‚å¦‚æœ key ä¸å­˜åœ¨ï¼Œè¿”å› nilã€‚å¦‚æœkeyå­˜å‚¨çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ GETRANGE key start end : ç”¨äºè·å–å­˜å‚¨åœ¨æŒ‡å®škeyä¸­å­—ç¬¦ä¸²çš„å­å­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²çš„æˆªå–èŒƒå›´ç”± start å’Œ end ä¸¤ä¸ªåç§»é‡æ¥å†³å®š(åŒ…æ‹¬ start å’Œ end åœ¨å†…) GETBIT key offset ï¼šå¯¹ key æ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²å€¼ï¼Œè·å–æŒ‡å®šåç§»é‡ä¸Šçš„ä¸º(bit)ï¼›GETTESTè¯­æ³• ï¼š GETSET KEY_NAME VALUE : GETSET å‘½ä»¤ç”¨äºè®¾ç½®æŒ‡å®š key çš„å€¼ï¼Œå¹¶è¿”å›keyçš„æ—§å€¼ã€‚å½“keyä¸å­˜åœ¨æ˜¯ï¼Œè¿”å› nil STRLEN key :è¿”å› key æ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²å€¼çš„é•¿åº¦4ã€åˆ é™¤è¯­æ³•ï¼šDEL KEY_NAME : åˆ é™¤æŒ‡å®šçš„keyï¼Œå¦‚æœå­˜åœ¨ï¼Œè¿”å›æ•°å­—ç±»å‹ã€‚5ã€æ‰¹é‡å†™ï¼šMSET K1 V1 K2 V2 ... (ä¸€æ¬¡æ€§å†™å…¥å¤šä¸ªå€¼)6ã€æ‰¹é‡è¯»ï¼šMGET K1 K2 K37ã€GETSET NAME VALUE : ä¸€æ¬¡æ€§è®¾ç½®å’Œè¯»å–(è¿”å›æ—§å€¼ï¼Œå†™ä¸Šæ–°å€¼)8ã€è‡ªå¢/è‡ªå‡ï¼š INCR KEY_Name : Incr å‘½ä»¤å°†keyä¸­å­˜å‚¨çš„æ•°ç»„å€¼å¢1ã€‚å¦‚æœ key ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆkeyçš„å€¼ä¼šå…ˆè¢«åˆå§‹åŒ–ä¸º0ï¼Œç„¶ååœ¨æ‰§è¡ŒINCRæ“ä½œ è‡ªå¢: INCRBY KEY_Name : å¢é‡å€¼Incrby å‘½ä»¤å°†keyä¸­å­˜å‚¨çš„æ•°å­—åŠ ä¸ŠæŒ‡å®šçš„å¢é‡å€¼ è‡ªå‡: DECR KEY_Name æˆ– DECYBY KEY_NAME å‡å€¼ï¼šDECR å‘½ä»¤å°†keyä¸­å­˜å‚¨çš„æ•°å­—å‡å°‘1ï¼š(æ³¨æ„è¿™äº›keyå¯¹åº”çš„å¿…é¡»æ˜¯æ•°å­—ç±»å‹å­—ç¬¦ä¸²ï¼Œå¦åˆ™ä¼šå‡ºé”™ã€‚)å­—ç¬¦ä¸²æ‹¼æ¥ï¼šAPPEND KEY_NAME VALUE:Append å‘½ä»¤ç”¨äºä¸ºæŒ‡å®šçš„keyè¿½åŠ è‡³æœ«å°¾ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œä¸ºå…¶èµ‹å€¼å­—ç¬¦ä¸²é•¿åº¦ ï¼šSTRLEN key ########################## setex (set with expire) #è®¾ç½®è¿‡æœŸæ—¶é—´ setnx (set if not exist) #ä¸å­˜åœ¨è®¾ç½® åœ¨åˆ†å¸ƒå¼é”ä¸­ä¼šå¸¸å¸¸ä½¿ç”¨ï¼ 10.2 åº”ç”¨åœºæ™¯ 1ã€Stringé€šå¸¸ç”¨äºä¿å­˜å•ä¸ªå­—ç¬¦ä¸²æˆ–JSONå­—ç¬¦ä¸²æ•°æ® 2ã€å› Stringæ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ï¼Œæ‰€ä»¥ä½ å®Œå…¨å¯ä»¥æŠŠä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶çš„å†…å®¹ä½œä¸ºå­—ç¬¦ä¸²æ¥å­˜å‚¨ 3ã€è®¡æ•°å™¨(å¸¸è§„key-valueç¼“å­˜åº”ç”¨ã€‚å¸¸è§„è®¡æ•°ï¼šå¾®åšæ•°ï¼Œç²‰ä¸æ•°) 12INCR ç­‰æŒ‡ä»¤æœ¬èº«å°±å…·æœ‰åŸå­æ“ä½œçš„ç‰¹å®šï¼Œæ‰€ä»¥æˆ‘ä»¬å®Œå…¨å¯ä»¥åˆ©ç”¨redisçš„INCRï¼ŒINCRBY,DECR,DECRBYç­‰æŒ‡ä»¤æ¥å®ç°åŸå­è®¡æ•°çš„æ•ˆæœã€‚å‡å¦‚ï¼Œåœ¨æŸç§åœºæ™¯ä¸‹æœ‰3ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¯»å–äº†mynumçš„å€¼(å€¼ä¸º2)ï¼Œç„¶åå¯¹å…¶åŒæ—¶è¿›è¡Œäº†åŠ 1çš„æ“ä½œï¼Œé‚£ä¹ˆï¼Œæœ€åmynumçš„å€¼ä¸€å®šæ˜¯5ã€‚ä¸å°‘ç½‘ç«™éƒ½åˆ©ç”¨redisçš„è¿™ä¸ªç‰¹æ€§æ¥å®ç°ä¸šåŠ¡ä¸Šçš„ç»Ÿè®¡è®¡æ•°éœ€æ±‚ã€‚ 10.3 Hashç±»å‹Hashç±»å‹æ˜¯Stringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œæˆ–è€…è¯´æ˜¯ä¸€ä¸ªStringé›†åˆã€‚hashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ï¼Œç›¸æ¯”è¾ƒè€Œè¨€ï¼Œå°†ä¸€ä¸ªå¯¹è±¡ç±»å‹å­˜å‚¨åœ¨Hashç±»å‹è¦å­˜å‚¨åœ¨Stringç±»å‹é‡Œå ç”¨æ›´å°‘çš„å†…å­˜ç©ºé—´ï¼Œå¹¶å¯¹æ•´ä¸ªå¯¹è±¡çš„å­˜å–ã€‚å¯ä»¥çœ‹æˆå…·æœ‰KEYå’ŒVALUEçš„MAPå®¹å™¨ï¼Œè¯¥ç±»å‹éå¸¸é€‚åˆäºå­˜å‚¨å€¼å¯¹è±¡çš„ä¿¡æ¯ã€‚ å¦‚ï¼šunameï¼Œupassï¼Œageç­‰ã€‚è¯¥ç±»å‹çš„æ•°æ®ä»…å ç”¨å¾ˆå°‘çš„ç£ç›˜ç©ºé—´(ç›¸æ¯”äºJSON). Redis ä¸­æ¯ä¸€ä¸ªhash å¯ä»¥å­˜å‚¨ 2çš„32æ¬¡æ–¹ -1 é”®å€¼å¯¹(40 å¤šäº¿) 10.4 Hashå‘½ä»¤å¸¸ç”¨å‘½ä»¤ 1234567891011121314151617181920212223ä¸€ã€èµ‹å€¼è¯­æ³•ï¼š 1ã€ HSET KEY FIELD VALUE ï¼š ä¸ºæŒ‡å®šçš„KEY,è®¾å®šFILD/VALUE 2ã€ HMSET KEY FIELD VALUE [FIELD1ï¼ŒVALUE]... : åŒæ—¶å°†å¤šä¸ª field-value(åŸŸ-å€¼)å¯¹è®¾ç½®åˆ°å“ˆå¸Œè¡¨keyä¸­ã€‚äºŒã€å–å€¼è¯­æ³•ï¼š HGET KEY FIELD :è·å–å­˜å‚¨åœ¨HASHä¸­çš„å€¼ï¼Œæ ¹æ®FIELDå¾—åˆ°VALUE HMGET KEY FIELD [FIELD1] :è·å–keyæ‰€æœ‰ç»™å®šå­—æ®µçš„å€¼ HGETALL KEY :è¿”å›HASHè¡¨ä¸­æ‰€æœ‰çš„å­—æ®µå’Œå€¼ HKEYS KEY : è·å–æ‰€æœ‰å“ˆå¸Œè¡¨ä¸­çš„å­—æ®µ HLEN KEY : è·å–å“ˆå¸Œè¡¨ä¸­å­—æ®µçš„æ•°é‡ä¸‰ã€åˆ é™¤è¯­æ³•ï¼š HDEL KEY FIELD[FIELD2] :åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªHASHè¡¨å­—æ®µ å››ã€å…¶å®ƒè¯­æ³•ï¼š HSETNX KEY FIELD VALUE : åªæœ‰åœ¨å­—æ®µfield ä¸å­˜åœ¨æ—¶ï¼Œè®¾ç½®å“ˆå¸Œè¡¨å­—æ®µçš„å€¼ HINCRBY KEY FIELD INCREMENT :ä¸ºå“ˆå¸Œkeyä¸­çš„æŒ‡å®šå­—æ®µçš„æ•´æ•°å€¼åŠ ä¸Šå¢é‡ incrementã€‚ HINCRBYFLOAT KEY FIELD INCREMENT :ä¸ºå“ˆå¸Œè¡¨key ä¸­çš„æŒ‡å®šå­—æ®µçš„æµ®ç‚¹æ•°å€¼åŠ ä¸Šå¢é‡ increment HEXISTS KEY FIELD : æŸ¥çœ‹å“ˆå¸Œè¡¨ä¸­keyä¸­ï¼ŒæŒ‡å®šçš„å­—æ®µæ˜¯å¦å­˜åœ¨ 10.5 åº”ç”¨åœºæ™¯Hashçš„åº”ç”¨åœºæ™¯ ï¼š(å­˜å‚¨ä¸€ä¸ªç”¨æˆ·ä¿¡æ¯å¯¹è±¡æ•°æ®) å¸¸ç”¨äºå­˜å‚¨ä¸€ä¸ªå¯¹è±¡ ä¸ºä»€ä¹ˆä¸ç”¨stringå­˜å‚¨ä¸€ä¸ªå¯¹è±¡ hashå€¼æœ€æ¥è¿‘å…³ç³»æ•°æ®åº“ç»“æ„çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å°†æ•°æ®åº“ä¸€æ¡è®°å½•æˆ–ç¨‹åºä¸­ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆhashmapå­˜æ”¾åœ¨redisä¸­ã€‚ ç”¨æˆ·IDä¸ºæŸ¥æ‰¾çš„keyï¼Œå­˜å‚¨çš„valueç”¨æˆ·å¯¹è±¡åŒ…å«å§“åï¼Œå¹´é¾„ï¼Œç”Ÿæ—¥ç­‰ä¿¡æ¯ï¼Œå¦‚æœç”¨æ™®é€šçš„key/valueç»“æ„æ¥å­˜å‚¨ï¼Œä¸»è¦æœ‰ä¸€ä¸‹2ä¸­æ‘ç²—æ–¹å¼ï¼š ç¬¬ä¸€ç§æ–¹å¼å°†ç”¨æˆ·IDä½œä¸ºæŸ¥æ‰¾keyï¼ŒæŠŠå…¶ä»–ä¿¡æ¯å°è£…æˆä¸ºä¸€ä¸ªå¯¹è±¡ä»¥åºåˆ—åŒ–çš„æ–¹å¼å­˜å‚¨ï¼Œè¿™ç§æ–¹å¼çš„å´ä½†æ˜¯ï¼Œå¢åŠ äº†åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¼€é”€ï¼Œå¹¶ä¸”åœ¨éœ€è¦ä¿®æ”¹å…¶ä¸­ä¸€é¡¹ä¿¡æ¯æ—¶ï¼Œéœ€è¦æŠŠæ•´ä¸ªå¯¹è±¡å–å›ï¼Œå¹¶ä¸”ä¿®æ”¹æ“ä½œéœ€è¦å¯¹å¹¶å‘è¿›è¡Œä¿æŠ¤ï¼Œå¼•å…¥CASç­‰å¤æ‚é—®é¢˜ã€‚ ç¬¬äºŒç§æ–¹æ³•æ˜¯è¿™ä¸ªç”¨æˆ·ä¿¡æ¯å¯¹è±¡æœ‰å¤šå°‘æˆå‘˜å°±å­˜æˆå¤šå°‘ä¸ªkey-valueå¯¹å„¿ï¼Œç”¨ç”¨æˆ·ID+å¯¹åº”å±æ€§çš„åç§°ä½œä¸ºå”¯ä¸€æ ‡è¯†æ¥å–çš„å¯¹åº”å±æ€§çš„å€¼ï¼Œè™½ç„¶çœå»äº†åºåˆ—åŒ–å¼€é”€å’Œå¹¶å‘é—®é¢˜ï¼Œä½†æ˜¯ç”¨æˆ·IDé‡å¤å­˜å‚¨ï¼Œå¦‚æœå­˜åœ¨å¤§é‡è¿™æ ·çš„æ•°æ®ï¼Œå†…å­˜æµªè´¹è¿˜æ˜¯éå¸¸å¯è§‚çš„ã€‚ 10.6 æ€»ç»“ï¼šRedisæä¾›çš„Hashå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼ŒRedisçš„Hashå®é™…å†…éƒ¨å­˜å‚¨çš„Valueä¸ºä¸€ä¸ªHashMapï¼Œ 10.6 Listç±»å‹ç®€ä»‹ï¼š 11ã€ List ç±»å‹æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„é›†åˆï¼Œå…¶ä¸»è¦åŠŸèƒ½æœ‰pushã€popã€è·å–å…ƒç´ ç­‰ã€‚æ›´è¯¦ç»†çš„è¯´ï¼ŒListç±»å‹æ˜¯ä¸€ä¸ªåŒç«¯é“¾è¡¨çš„èŠ‚åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›¸å…³çš„æ“ä½œè¿›è¡Œé›†åˆçš„å¤´éƒ¨æˆ–è€…å°¾éƒ¨æ·»åŠ å’Œåˆ é™¤å…ƒç´ ï¼ŒListçš„è®¾è®¡æ˜¯éå¸¸ç®€å•ç²¾å·§ï¼Œå³å¯ä»¥æœ€ä¸ºæ ˆï¼Œæœ‰å¯ä»¥æœ€ä¸ºé˜Ÿåˆ—ï¼Œæ»¡è¶³ç»å¤§å¤šæ•°çš„éœ€æ±‚ã€‚ å¸¸ç”¨å‘½ä»¤ 123451ã€èµ‹å€¼è¯­æ³•ï¼š LPUSH KEY VALUE1 [VALUE2] :å°†ä¸€ä¸ªæˆ–å¤šä¸ªå€¼æ’å…¥åˆ°åˆ—è¡¨å¤´éƒ¨ï¼ˆä»å·¦ä¾§æ·»åŠ ï¼‰ RPUSH KEY VALUE1 [VALUE2] ï¼šåœ¨åˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ï¼ˆä»æœ‰ä¾§æ·»åŠ ï¼‰ LPUSHX KEY VAKUE :å°†ä¸€ä¸ªå€¼æ’å…¥åˆ°å·²å­˜åœ¨çš„åˆ—è¡¨å¤´éƒ¨ã€‚å¦‚æœåˆ—è¡¨ä¸åœ¨ï¼Œæ“ä½œæ— æ•ˆ RPUSHX KEY VALUE :ä¸€ä¸ªå€¼æ’å…¥å·²ç»åœ¨çš„åˆ—è¡¨å°¾éƒ¨ï¼ˆæœ€å³è¾¹ï¼‰ã€‚å¦‚æœåˆ—è¡¨ä¸åœ¨ï¼Œæ“ä½œæ— æ•ˆ 12342ã€å–å€¼è¯­æ³•ï¼š LLEN KEY :è·å–åˆ—è¡¨é•¿åº¦ LINDEX KEY INDEX :é€šè¿‡ç´¢å¼•è·å–åˆ—è¡¨ä¸­çš„å…ƒç´  LRANGE KEY START STOP :è·å–åˆ—è¡¨æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´  æè¿°ï¼šè¿”å›åˆ—è¡¨ä¸­æŒ‡å®šåŒºé—´çš„å…ƒç´ ï¼ŒåŒºé—´ä»¥åç§»é‡STARTå’ŒENDæŒ‡å®šã€‚ å…¶ä¸­0è¡¨ç¤ºåˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œ1è¡¨ç¤ºåˆ—è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚ã€‚ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨è´Ÿæ•°ä¸‹æ ‡ï¼Œä»¥-1è¡¨ç¤ºåˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œ-2è¡¨ç¤ºåˆ—è¡¨çš„å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¸€æ¬¡ç±»æ¨ã€‚ã€‚ã€‚ startï¼šé¡µå¤§å°ï¼ˆé¡µæ•°-1ï¼‰ stopï¼šï¼ˆé¡µå¤§å°é¡µæ•°ï¼‰-1 123453ã€åˆ é™¤è¯­æ³•ï¼š LPOP KEY :ç§»é™¤å¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆä»å·¦ä¾§åˆ é™¤ï¼‰ RPOP KEY :ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œè¿”å›å€¼ä¸ºç§»é™¤çš„å…ƒç´ ï¼ˆä»å³ä¾§åˆ é™¤ï¼‰ BLPOP key1 [key2]timeout :ç§»é™¤å¹¶è·å–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨çŸ¥é“ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºå…ƒç´ ä¸ºæ­¢ã€‚ 1234ã€ä¿®æ”¹è¯­æ³•ï¼š LSET KEY INDEX VALUE :é€šè¿‡ç´¢å¼•è®¾ç½®åˆ—è¡¨å…ƒç´ çš„å€¼ LINSERT KEY BEFORE|AFTER WORIL VALUE :åœ¨åˆ—è¡¨çš„å…ƒç´ å‰æˆ–è€…å æ’å…¥å…ƒç´  æè¿°ï¼šå°†å€¼ value æ’å…¥åˆ°åˆ—è¡¨keyå½“ä¸­ï¼Œä½äºå€¼worldä¹‹å‰æˆ–ä¹‹åã€‚ é«˜çº§å‘½ä»¤ 123456é«˜çº§è¯­æ³•ï¼š RPOPLPUSH source destiation : ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å› ç¤ºä¾‹æè¿°ï¼š RPOPLPUSH a1 a2 : a1çš„æœ€åå…ƒç´ ç§»åˆ°a2çš„å·¦ä¾§ RPOPLPUSH a1 a1 : å¾ªç¯åˆ—è¡¨ï¼Œå°†æœ€åå…ƒç´ ç§»åˆ°æœ€å·¦ä¾§ BRPOPLPUSH source destination timeout :ä»åˆ—è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå€¼ï¼Œå°†å¼¹å‡ºçš„å…ƒç´ æ’å…¥åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒï¼›å¦‚æœåˆ—è¡¨æ²¡æœ‰å…ƒç´ ä¼šé˜»å¡åˆ—è¡¨çŸ¥é“ç­‰å¾…è¶…æ—¶æˆ–å‘ç°å¯å¼¹å‡ºçš„å…ƒç´ ä¸ºæ­¢ã€‚ Listä»£ç æ¡ˆä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334package com.tyx.service.impl;import com.tyx.po.User;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.stereotype.Service;import org.springframework.util.CollectionUtils;import java.io.Serializable;import java.util.Collections;import java.util.List;import java.util.concurrent.TimeUnit;/** * @author papi * @data 2020/7/15 */@Service@Slf4jpublic class UserServiceImpl &#123; @Autowired private RedisTemplate&lt;String, Object&gt; redisTemplate; /** * Redisæœ‰ä»€ä¹ˆå‘½ä»¤ï¼ŒJedisæœ‰ä»€ä¹ˆæ–¹æ³• * Lettuce-----ã€‹RedisTemplateè¿›ä¸€æ­¥çš„å°è£… *RedisTemplate æ–¹æ³•å’Œå‘½ä»¤æ˜¯è‚¯å®šä¸ä¸€æ ·çš„ * Redis å’Œ Stringç±»å‹ * éœ€æ±‚è¾“å…¥ä¸€ä¸ªkey * å…ˆåˆ¤æ–­è¯¥keyæ˜¯å¦å­˜åœ¨å¦‚æœä¸å­˜åœ¨åˆ™åœ¨mysqlä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œå†™å…¥åˆ°redisä¸­ã€‚å¹¶è¿”å›å€¼ã€‚ */ public String getRedisValueByKey(String key)&#123; if (redisTemplate.hasKey(key)) &#123; //è¡¨ç¤ºå­˜åœ¨å€¼ï¼Œè¿›è¡Œè·å– log.info(&quot;-------&gt; redisä¸­æŸ¥è¯¢çš„æ•°æ®&quot;); Object o = redisTemplate.opsForValue().get(key); return (String) o; &#125;else &#123; //ä¸å­˜åœ¨å»mysqlä¸­æŸ¥å¹¶ä¸”èµ‹å€¼ç»™reids String val = &quot;redisä¸­ä¸å­˜åœ¨çš„key&quot;; log.info(&quot;------&gt;mysqlä¸­æŸ¥è¯¢å‡ºæ¥çš„ï¼š&quot;+val); redisTemplate.opsForValue().set(key,val); log.info(&quot;------&gt;mysqlä¸­æŸ¥å‡ºçš„æ•°æ®å­˜å…¥redisä¸­&quot;); return val; &#125; &#125; /** * æµ‹è¯•Stringç±»å‹ * éœ€æ±‚ï¼šç”¨æˆ·è¾“å…¥ä¸€ä¸ªredisæ•°æ®ã€‚è¯¥keyçš„æœ‰æ•ˆæœŸä¸º28å°æ—¶ */ public void expireStr(String key, String val)&#123; redisTemplate.opsForValue().set(key,val); redisTemplate.expire(key,2,TimeUnit.HOURS); &#125; /** * æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·å¯¹è±¡ä¿¡æ¯ * å…ˆåˆ¤æ–­redisä¸­æ˜¯å¦å­˜åœ¨è¯¥key * å¦‚æœä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“ä¸­mysqlä¸­çš„å€¼ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°redisä¸­ã€‚ * å¦‚æœå­˜åœ¨ï¼Œç›´æ¥å°†ç»“æœåœ¨redisæŸ¥è¯¢ï¼Œå¹¶è¿”å›ã€‚ */ public User getHashKey(String id)&#123; if (redisTemplate.opsForHash().hasKey(&quot;user&quot;,id))&#123; log.info(&quot;-----&gt;æŸ¥è¯¢redisæ•°æ®åº“&quot;); return (User) redisTemplate.opsForHash().get(&quot;user&quot;,id); &#125;else &#123; log.info(&quot;-----&gt;æŸ¥è¯¢mysqlæ•°æ®åº“&quot;); User user = new User(); user.setId(id); user.setAge(18); user.setName(&quot;é€Ÿé€Ÿ&quot;); /* @param h ç”¨æˆ·çš„å®ä½“ @param hk ç”¨æˆ·ä¸»é”®id @param hv æ•´ä¸ªå¯¹è±¡ */ redisTemplate.opsForHash().put(&quot;user&quot;,id,user); return user; &#125; &#125; /** * å°†listæ”¾å…¥ç¼“å­˜ä¸­ * @param key å€¼ * @param list é”® * @return true æˆåŠŸ false å¤±è´¥ */ public boolean lpushAll(String key, List&lt;Object&gt; list)&#123; try &#123; redisTemplate.opsForList().leftPush(key, list); return true; &#125;catch (Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * å°†listæ”¾å…¥ç¼“å­˜ä¸­ * @param key å€¼ * @param list é”® * @param time æ—¶é—´ï¼ˆç§’ï¼‰ * @return true æˆåŠŸ false å¤±è´¥ */ public boolean lpushAll(String key, List&lt;Object&gt; list, long time)&#123; try &#123; redisTemplate.opsForList().leftPushAll(key, list); if (time &gt;0)&#123; redisTemplate.expire(key,time,TimeUnit.SECONDS); &#125; return true; &#125;catch (Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * åœ¨å˜é‡å·¦è¾¹æ·»åŠ å…ƒç´ ã€‚ * @param key * @param obj * @return */ public boolean lpush(String key, Object obj)&#123; try &#123; redisTemplate.opsForList().leftPush(key,obj); return true; &#125;catch (Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * åœ¨å˜é‡å·¦è¾¹æ·»åŠ å…ƒç´ ã€‚ * @param key é”® * @param prvot ä¸­é—´å‚æ•° * @param object è¦æ”¾çš„å€¼ * @return ã€‚ */ public boolean lpush(String key, Object prvot,Object object)&#123; try &#123; redisTemplate.opsForList().leftPush(key,prvot,object); return true; &#125;catch (Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * åœ¨å˜é‡å·¦è¾¹æ·»åŠ å…ƒç´ ã€‚ * @param key é”® * @param prvot ä¸­é—´å‚æ•° * @param object è¦æ”¾çš„å€¼ * @return ã€‚ */ public boolean rpush(String key, Object prvot,Object object)&#123; try &#123; redisTemplate.opsForList().rightPush(key,prvot,object); return true; &#125;catch (Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * åœ¨å˜é‡å·¦è¾¹æ·»åŠ å…ƒç´ ã€‚ * @param key é”® * @param object è¦æ”¾çš„å€¼ * @return ã€‚ */ public boolean rpush(String key, Object object)&#123; try &#123; redisTemplate.opsForList().rightPush(key,object); return true; &#125;catch (Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * åœ¨å˜é‡å·¦è¾¹æ·»åŠ å…ƒç´ ã€‚ * @param key é”® * @param object è¦æ”¾çš„å€¼ * @return ã€‚ */ public boolean lpushIfPresent(String key, Object object)&#123; try &#123; redisTemplate.opsForList().leftPushIfPresent(key,object); return true; &#125;catch (Exception e)&#123; e.printStackTrace(); return false; &#125; &#125; /** * ç§»é™¤é›†åˆä¸­çš„å·¦è¾¹ç¬¬ä¸€ä¸ªé›†åˆ * @param key é”® * @return è¿”å›å³è¾¹ç¬¬ä¸€ä¸ªå€¼ */ public Object lpop(String key) &#123; return redisTemplate.opsForList().leftPop(key); &#125; /** * ç§»é™¤é›†åˆä¸­çš„å³è¾¹çš„å…ƒç´ ï¼Œä¸€èˆ¬ç”¨åœ¨é˜Ÿåˆ—å–å€¼ * @param key é”® * @return è¿”å›å³è¾¹çš„å…ƒç´  */ public Object rpop(String key) &#123; return redisTemplate.opsForList().leftPop(key); &#125; /** * è·å–æŒ‡å®šåŒºé—´çš„å€¼ * @param key é”® * @param start å¼€å§‹ä½ç½® * @param end ç»“æŸä½ç½® * @return è¿”å›å€¼ */ public List&lt;Object&gt; lrange(String key, long start, long end) &#123; return redisTemplate.opsForList().range(key,start,end); &#125; /** * è¿”å›å½“å‰ä½ç½®ä¸Šçš„å€¼ã€‚ * @param key é”® * @param index å½“å‰ä½ç½® * @return */ public Object lindex(String key, long index) &#123; return redisTemplate.opsForList().index(key,index); &#125; /** * * @param key é”® * @param count ç»Ÿè®¡ * @param object ç§»é™¤çš„å¯¹è±¡ * @return */ public long remove(String key,long count, Object object)&#123; return redisTemplate.opsForList().remove(key,count,object); &#125; /** * è·å–é›†åˆé•¿åº¦ * @param key é”® * @return é•¿åº¦ */ public long llen(String key)&#123; return redisTemplate.opsForList().size(key); &#125; /** * åœ¨é›†åˆçš„æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ï¼Œå¦‚æœæŒ‡å®šçš„ä½ç½®å·²æœ‰å…ƒç´ ï¼Œåˆ™è¦†ç›–ï¼Œæ²¡æœ‰åˆ™æ–°å¢ï¼Œè¶…è¿‡é›†åˆçš„ä¸‹æ ‡+nåˆ™ä¼šæŠ¥é”™ï¼› * @param key é”® * @param index ä½ç½® * @param value å€¼ */ public void set(String key,Long index, Object value) &#123; &#125; /** * æˆªå–é›†åˆå…ƒç´ ï¼Œä¿ç•™æˆéƒ½å†…åœ°æ•°æ® * @param key é”® * @param start å¼€å§‹ä½ç½® * @param end ç»“æŸä½ç½® */ public void trim(String key,Long start, Long end) &#123; redisTemplate.opsForList().trim(key,start,end); &#125; /** *å‡ºå»é›†åˆå³è¾¹çš„å€¼ï¼ŒåŒæ—¶é›†åˆçš„å·¦è¾¹æ·»åŠ ä¸€ä¸ªå€¼ * @param key é”® * @param str å…¥æ ˆçš„å€¼ * @return è¿”å›å¯¹è±¡ */ public Object rightPopAndleftPush(String key,String str) &#123; return redisTemplate.opsForList().rightPopAndLeftPush(key,str); &#125; /** *å‡ºå»é›†åˆå³è¾¹çš„å€¼ï¼ŒåŒæ—¶é›†åˆçš„å·¦è¾¹æ·»åŠ ä¸€ä¸ªå€¼,å¦‚æœè¶…è¿‡ç­‰å¾…çš„æ—¶é—´ä»ç„¶æ²¡æœ‰å…ƒç´ åˆ™é€€å‡º * @param key é”® * @param str å·¦è¾¹æ–°å¢çš„å€¼ * @param time è¶…æ—¶æ—¶é—´ * @return è¿”å›ç§»é™¤å³è¾¹çš„å€¼ */ public Object rightPopAndleftPush(String key,String str,long time) &#123; return redisTemplate.opsForList().rightPopAndLeftPush(key,str,time,TimeUnit.MINUTES); &#125; /** * åˆ é™¤. * @param keys */ public void del(String ... keys)&#123; if (keys!=null || keys.length &gt; 0)&#123; if (keys.length == 1) &#123; redisTemplate.delete(keys[0]); &#125;else &#123; redisTemplate.delete(CollectionUtils.arrayToList(keys)); &#125; &#125; &#125; /** * è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚ * @param key é”®ã€‚ * @param seconds è¿‡æœŸæ—¶é—´ã€‚ */ public void expire(String key,long seconds)&#123; redisTemplate.expire(key,seconds,TimeUnit.SECONDS); &#125;&#125; 10.7 List çš„åº”ç”¨åœºæ™¯é¡¹ç›®åº”ç”¨äºï¼š1ã€å¯¹æ•°æ®é‡å¤§çš„é›†åˆæ•°æ®åˆ é™¤ï¼›2ã€ä»»åŠ¡é˜Ÿåˆ— 1ã€å¯¹æ•°æ®é‡å¤§çš„é›†åˆæ•°æ®åˆ å‡ åˆ—è¡¨æ•°æ®æ˜¾ç¤ºï¼Œå…³æ³¨åˆ—è¡¨ï¼Œç²‰ä¸åˆ—è¡¨ï¼Œç•™è¨€è¯„è®ºç­‰.....åˆ†é¡µï¼Œçƒ­ç‚¹æ–°é—»ç­‰ åˆ©ç”¨LRANGè¿˜å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®ç°åˆ†é¡µçš„åŠŸèƒ½ï¼Œåœ¨åšå®¢ç³»ç»Ÿä¸­ï¼Œæ¯ç‰‡åšæ–‡çš„è¯„è®ºä¹Ÿå¯ä»¥å­˜å…¥ä¸€ä¸ªå•ç‹¬çš„listä¸­ã€‚ 2ã€ä»»åŠ¡é˜Ÿåˆ— (list é€šå¸¸ç”¨æ¥å®ç°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œè€Œä¸”å¯ä»¥å´è¡¨å…ˆåé¡ºåºï¼Œä¸å¿…åƒMySQLé‚£æ ·è¿˜éœ€è¦é€šè¿‡ORDER BYæ¥è¿›è¡Œæ’åº) 12345ä»»åŠ¡é˜Ÿåˆ—ä»‹ç»(ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å¼ï¼š) åœ¨å¤„ç†webå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤è¯·æ±‚æ˜¯ï¼ŒæŸäº›æ“ä½œçš„æ‰§è¡Œæ—¶é—´å¯èƒ½ä¼šæ¯”æˆ‘ä»¬é¢„æœŸçš„æ›´é•¿ä¸€äº›ï¼Œé€šè¿‡å°†å¾…æ‰§è¡Œä»»åŠ¡çš„ç›¸å…³ä¿¡æ¯æ”¾å…¥é˜Ÿåˆ—é‡Œé¢ï¼Œå¹¶åœ¨ä¹‹åé˜Ÿåˆ—è¿›è¡Œå¤„ç†ï¼Œç”¨æˆ·å¯ä»¥æ¨è¿Ÿæ‰§è¡Œé‚£äº›éœ€è¦ä¸€æ®µæ—¶é—´æ‰èƒ½å®Œæˆçš„æ“ä½œï¼Œè¿™ç§å°†å·¥ä½œäº¤ä¸ªä»»åŠ¡å¤„ç†å™¨æ¥æ‰§è¡Œçš„åšæ³•è¢«ç§°ä¸ºä»»åŠ¡é˜Ÿåˆ—ï¼ˆtask queueï¼‰ã€‚ RPOPLPUSH source destination ç§»é™¤åˆ—è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¯¥å…ƒç´ æ·»åŠ åˆ°å¦ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å› 3ã€Liståº”ç”¨åœºæ™¯æ¡ˆä¾‹1 12 10.8 Setç±»å‹ç®€ä»‹ Redisçš„Setæ˜¯Stringç±»å‹çš„æ— éœ€é›†åˆã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™å°±æ„å‘³ç€é›†åˆä¸­ä¸èƒ½å‡ºç°é‡å¤çš„æ•°æ®ã€‚Redisä¸­é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ï¼Œsetæ˜¯é€šè¿‡hashtableå®ç°çš„ é›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°ä¸º2^32 -1,ç±»ä¼¼äºJAVAä¸­çš„Hashtableé›†åˆã€‚ å‘½ä»¤ 1234567891011121314151617181920211ã€å¤åˆ¶è¯­æ³•ï¼š SADD KEY member1 [member2]:å‘é›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ 2ã€å–å€¼è¯­æ³•ï¼š SCARD KEY :è·å–é›†åˆçš„æˆå‘˜æ•° SMEMBERS KEY ï¼šè¿”å›é›†åˆä¸­çš„æ‰€æœ‰æˆå‘˜ SISMEMBER KEY MEMBER :åˆ¤æ–­memberå…ƒç´ æ˜¯å¦æ˜¯é›†åˆkeyçš„æˆå‘˜(å¼€å‘ä¸­ï¼šéªŒè¯æ˜¯å¦å­˜åœ¨åˆ¤æ–­) SRANDMEMBER KEY [COUNT] :è¿”å›é›†åˆä¸­ä¸€ä¸ªæˆ–å¯¹ä¸ªéšæœºæ•° 3ã€åˆ é™¤è¯­æ³•ï¼š SREM key member1 [member2] : ç§»é™¤é›†åˆä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ SPOP key [count] : ç§»é™¤å¹¶è¿”å›é›†åˆä¸­çš„ä¸€ä¸ªéšæœºå…ƒç´  SMOVE source destination member :å°†member å…ƒç´ ä»Sourceé›†åˆç§»åŠ¨åˆ°destinationé›†åˆä¸­4ã€å·®é›†è¯­è¨€ï¼š SDIFF key1 [key2] :è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„å·®é›† SDIFFSTORE destination key1 [key2] :è¿”å›ç»™å®šæ‰€æœ‰é›†åˆçš„èŒ¶å‡ å¹¶å­˜å‚¨åœ¨destinationä¸­5ã€äº¤é›†è¯­è¨€ï¼š SUNION key1 [key2] : è¿”å›æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›† SUNIONSTORE destination key1 [key2] :æ‰€æœ‰ç»™å®šé›†åˆçš„å¹¶é›†å­˜å‚¨åœ¨ destinatiioné›†åˆä¸­ 10.9 ZSetç±»å‹æœ‰åºé›†åˆ(sorted set) ç®€ä»‹ 1ã€Redisæœ‰åºé›†åˆå’Œé›†åˆä¸€æ ·ä¹Ÿæ˜¯stringç±»å‹å…ƒç´ çš„é›†åˆï¼Œä¸”ä¸å…è®¸é‡å¤çš„æˆå‘˜ã€‚ 2ã€ä¸åŒçš„æ˜¯æ¯ä¸ªå…ƒç´ éƒ½ä¼šå…³è”ä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•°ã€‚redisæ­£æ˜¯é€šè¿‡åˆ†æ•°æ¥ä¸ºé›†åˆä¸­çš„æˆå‘˜è¿›è¡Œä»å°åˆ°å¤§çš„æ’åºã€‚ 3ã€æœ‰åºé›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†åˆ†æ•°ï¼ˆscoreï¼‰å´å¯ä»¥é‡å¤ã€‚ 4ã€é›†åˆæ˜¯é€šè¿‡å“ˆå¸Œè¡¨å®ç°çš„ã€‚é›†åˆä¸­æœ€å¤§çš„æˆå‘˜æ•°ä¸º2^32 -1ã€‚Redisçš„ZSetæ˜¯æœ‰åºï¼Œä¸”ä¸é‡å¤ã€‚ ï¼ˆå¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å°†redisä¸­çš„æœ‰åºç»“åˆå«åšzsetsï¼Œè¿™æ˜¯å› ä¸ºåœ¨redisä¸­ï¼Œæœ‰åºé›†åˆç›¸å…³çš„æ“ä½œæŒ‡ä»¤éƒ½æ˜¯ä»¥zå¼€å¤´çš„ï¼‰ å‘½ä»¤ 1234567891011121314151617181920212223242526272829301ã€å¤åˆ¶è¯­æ³•ï¼š ZADD KEY score1 member1 ã€score2 member2ã€‘ ï¼šå‘æœ‰åºé›†åˆæ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œæˆ–è€…æ›´æ–°å·²ç»å­˜åœ¨æˆå‘˜çš„åˆ†æ•°2ã€å–å€¼è¯­æ³•ï¼š ZCARD key ï¼šè·å–æœ‰åºç»“åˆçš„æˆå‘˜æ•° ZCOUNT key min max :è®¡ç®—åœ¨æœ‰åºç»“åˆä¸­æŒ‡å®šåŒºé—´åˆ†æ•°çš„æˆå‘˜æ•° 127.0.0.1:6379&gt; ZADD kim 1 tian (integer) 0 127.0.0.1:6379&gt; zadd kim 2 yuan 3 xing (integer) 2 127.0.0.1:6379&gt; zcount kim 1 2 (integer) 2 127.0.0.1:6379&gt; ZRANK key member :è¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šæˆå‘˜çš„æ‰€æœ‰ ZRANGE KEY START STOP [WITHSCORES]:é€šè¿‡ç´¢å¼•åŒºé—´è¿”å›æœ‰åºé›†åˆæˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜(ä½åˆ°é«˜) ZRANGEBYSCORE KEY MIN MAX [WITHSCORES] [LIMIT] :é€šè¿‡åˆ†æ•°è¿”å›æœ‰åºé›†åˆæŒ‡å®šåŒºé—´å†…çš„æˆå‘˜ ZREVRANGE KEY START STOP [WITHSCORES] :è¿”å›æœ‰åºé›†ä¸­æ˜¯å®šåŒºé—´å†…çš„æˆå‘˜ï¼Œé€šè¿‡ç´¢å¼•ï¼Œåˆ†æ•°ä»é«˜åˆ°åº• ZREVERANGEBYSCORE KEY MAX MIN [WITHSCORES] :è¿”å›æœ‰åºé›†ä¸­æŒ‡å®šåˆ†æ•°åŒºé—´çš„æˆå‘˜ï¼Œåˆ†æ•°ä»é«˜åˆ°ä½æ’åºåˆ é™¤è¯­æ³•ï¼š DEL KEY : ç§»é™¤é›†åˆ ZREM key member [member...] ç§»é™¤æœ‰åºé›†åˆä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ ZREMRANGEBYSCORE KEY MIN MAX :ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„åˆ†æ•°åŒºé—´çš„æ‰€æœ‰æˆå‘˜ã€‚ ZREMRANGEBYSCORE KEY MIN MAX :ç§»é™¤æœ‰åºé›†åˆä¸­ç»™å®šçš„åˆ†æ•°åŒºé—´çš„æ‰€æœ‰æˆå‘˜ã€‚ ZINCRBY KEY INCREMENT MEMBER :å¢åŠ memberå…ƒç´ çš„åˆ†æ•°incrementï¼Œè¿”å›å€¼æ˜¯æ›´æ”¹åçš„åˆ†æ•° 10.10 HyperLogLogå¸¸ç”¨å‘½ä»¤ 1234PFADD key element [element ...] : æ·»åŠ æŒ‡å®šå…ƒç´ åˆ°HyperLoglogä¸­PFCOUNT KEY [key ...] :è¿”å›ç»™å®š HyperLogLogçš„åŸºæ•°ä¼°ç®—å€¼PFMERGE destkey sourcekey [sourcekey ...] :å°†è¿‡ä¸ªHyperLogLog åˆå¹¶ä¸ºä¸€ä¸ªHyperLoglog åº”ç”¨åœºæ™¯ åŸºæ•°ä¸å¤§ï¼Œæ•°æ®é‡ä¸å¤§å°±ç”¨ä¸ä¸Šï¼Œä¼šæœ‰ç‚¹å¤§æå°ç”¨æµªè´¹ç©ºé—´ æœ‰å±€é™æ€§ï¼Œå°±æ˜¯æŒ‡èƒ½ç»Ÿè®¡åŸºæ•°æ•°é‡ï¼Œè€Œæ²¡åŠæ³•å»çŸ¥é“å…·ä½“çš„å†…å®¹æ˜¯ä»€ä¹ˆ 123456ç»Ÿè®¡æ³¨å†Œ IP æ•°ç»Ÿè®¡æ¯æ—¥è®¿é—® IP æ•°ç»Ÿè®¡é¡µé¢å®æ—¶ UV æ•°ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°ç»Ÿè®¡ç”¨æˆ·æ¯å¤©æœç´¢ä¸åŒè¯æ¡çš„ä¸ªæ•°ç»Ÿè®¡çœŸå®æ–‡ç« é˜…è¯»æ•° 10.11 geospatial åœ°ç†ä½ç½®GEORANDIUSBYMEMBER æ‰¾å‡ºæŒ‡å®šå…ƒç´ å‘¨å›´çš„å…¶ä»–å…ƒç´  åä¸€ã€SpringBootæ•´åˆJedis11.1 ç®€ä»‹ æˆ‘ä»¬åœ¨ä½¿ç”¨springbootæ­å»ºå¾®æœåŠ¡çš„æ—¶å€™ï¼Œåœ¨å¾ˆå¤šæ—¶å€™è¿˜æ˜¯éœ€è¦redisçš„é«˜é€Ÿç¼“å­˜æ¥ç¼“å­˜ä¸€äº›æ•°æ®ï¼Œå­˜å‚¨ä¸€äº›é«˜å“ç‡è®¿é—®çš„æ•°æ®ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨redisçš„è¯ç”±æ¯”è¾ƒéº»çƒ¦ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨jedisæ¥å®ç°redisç¼“å­˜è¾¾åˆ°é«˜æ•ˆç¼“å­˜çš„ç›®çš„ã€‚ 11.2 å¼•å…¥Jedisä¾èµ–1234567&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt;&lt;/dependency&gt; å› ä¸ºSpringBootå†…é»˜è®¤å¼•ç”¨äº†jedisç‰ˆæœ¬ã€‚ æ‰€ä»¥æˆ‘ä»¬ç›´æ¥å¼•å…¥jedisä¾èµ–æ— éœ€é…ç½®jedisçš„ç‰ˆæœ¬å·äº†ã€‚ 11.3 application.ymlä¾‹å¦‚ åœ¨application.ymlä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯ï¼š åäºŒã€SpringBoot2.xä¸­redisä½¿ç”¨ï¼ˆlettuceï¼‰12javaä»£ç æ“ä½œRedisï¼Œéœ€è¦ä½¿ç”¨Jedisï¼Œä¹Ÿå°±æ˜¯redisæ”¯æŒjavaçš„ç¬¬ä¸‰æ–¹ç±»åº“æ³¨æ„ï¼šJedis2.7ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰æ”¯æŒé›†ç¾¤æ“ä½œ 12.1 mavené…ç½®æ–°å»ºSpringBoot2.0.3çš„WEBå·¥ç¨‹ï¼Œåœ¨MAVENçš„pom.xmlæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹ä¾èµ– 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.1.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.tyx&lt;/groupId&gt; &lt;artifactId&gt;lettuce-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;lettuce-demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- é»˜è®¤æ˜¯lettuceå®¢æˆ·ç«¯ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- redisä¾èµ–common-pool è¿™ä¸ªä¾èµ–ä¸€å®šè¦æ·»åŠ  --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;version&gt;2.8.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; 12.2 è§†é¢‘ä¸­çš„ä»£ç POMæ–‡ä»¶ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;parent&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt; &lt;version&gt;2.3.1.RELEASE&lt;/version&gt; &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt; &lt;/parent&gt; &lt;groupId&gt;com.tyx&lt;/groupId&gt; &lt;artifactId&gt;lettuce-demo&lt;/artifactId&gt; &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt; &lt;name&gt;lettuce-demo&lt;/name&gt; &lt;description&gt;Demo project for Spring Boot&lt;/description&gt; &lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- é»˜è®¤æ˜¯lettuceå®¢æˆ·ç«¯ --&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!-- redisä¾èµ–common-pool è¿™ä¸ªä¾èµ–ä¸€å®šè¦æ·»åŠ  --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt; &lt;version&gt;2.8.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.projectlombok&lt;/groupId&gt; &lt;artifactId&gt;lombok&lt;/artifactId&gt; &lt;optional&gt;true&lt;/optional&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;exclusions&gt; &lt;exclusion&gt; &lt;groupId&gt;org.junit.vintage&lt;/groupId&gt; &lt;artifactId&gt;junit-vintage-engine&lt;/artifactId&gt; &lt;/exclusion&gt; &lt;/exclusions&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; RedisConfig 12345678910111213141516171819202122232425262728package com.tyx.config;import org.springframework.cache.annotation.CachingConfigurerSupport;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;import org.springframework.data.redis.serializer.StringRedisSerializer;import org.springframework.stereotype.Component;import java.io.Serializable;/** * @author papi * @data 2020/7/15 */@Configurationpublic class RedisConfig &#123; @Bean public RedisTemplate&lt;String, Object&gt; redisTemplate(LettuceConnectionFactory factory)&#123; RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;(); redisTemplate.setKeySerializer(new StringRedisSerializer()); redisTemplate.setValueSerializer(new GenericJackson2JsonRedisSerializer()); redisTemplate.setConnectionFactory(factory); return redisTemplate; &#125;&#125; User 12345678910111213141516171819202122package com.tyx.po;import lombok.Data;import java.io.Serializable;/** * @author papi * @data 2020/7/15 *//** * Javaå¸¸ç”¨ç¼–ç è§„èŒƒ * Javaè§„èŒƒ */@Datapublic class User implements Serializable &#123; private String name; private int age; private String id;&#125; UserServiceImpl 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879package com.tyx.service.impl;import com.tyx.po.User;import lombok.extern.slf4j.Slf4j;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.RedisTemplate;import org.springframework.stereotype.Service;import java.io.Serializable;import java.util.concurrent.TimeUnit;/** * @author papi * @data 2020/7/15 */@Service@Slf4jpublic class UserServiceImpl &#123; @Autowired private RedisTemplate&lt;String, Object&gt; redisTemplate; /** * Redisæœ‰ä»€ä¹ˆå‘½ä»¤ï¼ŒJedisæœ‰ä»€ä¹ˆæ–¹æ³• * Lettuce-----ã€‹RedisTemplateè¿›ä¸€æ­¥çš„å°è£… *RedisTemplate æ–¹æ³•å’Œå‘½ä»¤æ˜¯è‚¯å®šä¸ä¸€æ ·çš„ * Redis å’Œ Stringç±»å‹ * éœ€æ±‚è¾“å…¥ä¸€ä¸ªkey * å…ˆåˆ¤æ–­è¯¥keyæ˜¯å¦å­˜åœ¨å¦‚æœä¸å­˜åœ¨åˆ™åœ¨mysqlä¸­è¿›è¡ŒæŸ¥è¯¢ï¼Œå†™å…¥åˆ°redisä¸­ã€‚å¹¶è¿”å›å€¼ã€‚ */ public String getRedisValueByKey(String key)&#123; if (redisTemplate.hasKey(key)) &#123; //è¡¨ç¤ºå­˜åœ¨å€¼ï¼Œè¿›è¡Œè·å– log.info(&quot;-------&gt; redisä¸­æŸ¥è¯¢çš„æ•°æ®&quot;); Object o = redisTemplate.opsForValue().get(key); return (String) o; &#125;else &#123; //ä¸å­˜åœ¨å»mysqlä¸­æŸ¥å¹¶ä¸”èµ‹å€¼ç»™reids String val = &quot;redisä¸­ä¸å­˜åœ¨çš„key&quot;; log.info(&quot;------&gt;mysqlä¸­æŸ¥è¯¢å‡ºæ¥çš„ï¼š&quot;+val); redisTemplate.opsForValue().set(key,val); log.info(&quot;------&gt;mysqlä¸­æŸ¥å‡ºçš„æ•°æ®å­˜å…¥redisä¸­&quot;); return val; &#125; &#125; /** * æµ‹è¯•Stringç±»å‹ * éœ€æ±‚ï¼šç”¨æˆ·è¾“å…¥ä¸€ä¸ªredisæ•°æ®ã€‚è¯¥keyçš„æœ‰æ•ˆæœŸä¸º28å°æ—¶ */ public void expireStr(String key, String val)&#123; redisTemplate.opsForValue().set(key,val); redisTemplate.expire(key,2,TimeUnit.HOURS); &#125; /** * æ ¹æ®IDæŸ¥è¯¢ç”¨æˆ·å¯¹è±¡ä¿¡æ¯ * å…ˆåˆ¤æ–­redisä¸­æ˜¯å¦å­˜åœ¨è¯¥key * å¦‚æœä¸å­˜åœ¨ï¼ŒæŸ¥è¯¢æ•°æ®åº“ä¸­mysqlä¸­çš„å€¼ï¼Œå¹¶å°†ç»“æœæ·»åŠ åˆ°redisä¸­ã€‚ * å¦‚æœå­˜åœ¨ï¼Œç›´æ¥å°†ç»“æœåœ¨redisæŸ¥è¯¢ï¼Œå¹¶è¿”å›ã€‚ */ public User getHashKey(String id)&#123; if (redisTemplate.opsForHash().hasKey(&quot;user&quot;,id))&#123; log.info(&quot;-----&gt;æŸ¥è¯¢redisæ•°æ®åº“&quot;); return (User) redisTemplate.opsForHash().get(&quot;user&quot;,id); &#125;else &#123; log.info(&quot;-----&gt;æŸ¥è¯¢mysqlæ•°æ®åº“&quot;); User user = new User(); user.setId(id); user.setAge(18); user.setName(&quot;é€Ÿé€Ÿ&quot;); /* @param h ç”¨æˆ·çš„å®ä½“ @param hk ç”¨æˆ·ä¸»é”®id @param hv æ•´ä¸ªå¯¹è±¡ */ redisTemplate.opsForHash().put(&quot;user&quot;,id,user); return user; &#125; &#125;&#125; æµ‹è¯•ç±» 1234567891011121314151617181920212223242526272829package com.tyx;import com.tyx.po.User;import com.tyx.service.impl.UserServiceImpl;import lombok.AllArgsConstructor;import org.junit.jupiter.api.Test;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.boot.test.context.SpringBootTest;@SpringBootTestclass LettuceDemoApplicationTests &#123; @Autowired private UserServiceImpl userService; @Test void contextLoads() &#123; &#125; @Test void T1 ()&#123; String tyx = userService.getRedisValueByKey(&quot;tyx&quot;); System.out.println(&quot;è¿”å›redisä¸­çš„å€¼ä¸ºï¼š&quot; + tyx); &#125; @Test void T2()&#123; User hashKey = userService.getHashKey(&quot;1003&quot;); System.out.println(hashKey); &#125;&#125; 12.3 æŸ¥çœ‹Rediså®¢æˆ·ç«¯ä¿¡æ¯åŸå› ï¼šæŠŠä»»ä½•æ•°æ®ä¿å­˜åˆ°redisä¸­æ—¶ï¼Œéƒ½éœ€è¦è¿›è¡Œåºåˆ—åŒ–ï¼Œé»˜è®¤ä½¿ç”¨JdkSerializationRedisSerializerè¿›è¡Œæ•°æ®åºåˆ—åŒ–ã€‚æ‰€æœ‰çš„keyå’Œvalueè¿˜æœ‰hashkeyå’Œhashvalueçš„åŸå§‹å­—ç¬¦å‰ï¼Œéƒ½åŠ äº†ä¸€ä¸²å­—ç¬¦ã€‚ åä¸‰ã€Redisçš„å‘å¸ƒè®¢é˜…13.1 rediså‘å¸ƒè®¢é˜…ç®€ä»‹Redis å‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…ï¼ˆpubï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆsub)æ¥å—æ¶ˆæ¯ã€‚ Rediså®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ 123Redis å‘å¸ƒè®¢é˜…(pub/sub)æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€…ï¼ˆpubï¼‰å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€…ï¼ˆsub)æ¥å—æ¶ˆæ¯ã€‚Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚ä¸‹å›¾å±•ç¤ºäº†é¢‘é“channel1ï¼Œä»¥åŠè®¢é˜…è¿™ä¸ªé¢‘é“çš„ä¸‰ä¸ªå®¢æˆ·ç«¯---client2ï¼Œclient5å’Œclient1ä¹‹é—´çš„å…³ç³»ã€‚ 12345//è®¢é˜…ç«¯SUBSCRIBE redischannelReading messages ...(press ctrl-c quit)//å‘é€ç«¯PUBLIC redischannel &quot;redis channel&quot; åå››ã€Rediså¤šæ•°æ®åº“14.1 Redisä¸‹ï¼Œæ•°æ®åº“æ˜¯ç”±ä¸€ä¸ªæ•´æ•°ç´¢å¼•æ ‡è¯†ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ•°æ®åº“åç§°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ°æ•°æ®åº“0ã€‚redisé…ç½®é—®é˜¿é‡‘ä¸­ä¸‹é¢çš„å‚æ•°æ¥æ§åˆ¶æ•°æ®åº“æ€»æ•°ï¼š database 16 //ï¼ˆä»0å¼€å§‹ 1,2,3â€¦15ï¼‰ select æ•°æ®åº“ //æ•°æ®åº“çš„åˆ‡æ¢ ç§»åŠ¨æ•°æ®(å°†å½“å‰keyç§»åŠ¨å¦ä¸€åº“) 1move key åç§° æ•°æ®åº“ 14.2 æ•°æ®åº“æ¸…ç©ºï¼š12flushdb ï¼šæ¸…é™¤å½“å‰æ•°æ®åº“çš„æ‰€æœ‰keyflushall :æ¸…é™¤æ•´ä¸ªredisçš„æ•°æ®åº“æ‰€æœ‰key åäº”ã€Redisäº‹åŠ¡Redisäº‹åŠ¡å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šä¸ªå‘½ä»¤ï¼Œï¼ˆæŒ‰é¡ºåºåœ°ä¸²è¡ŒåŒ–æ‰§è¡Œï¼Œæ‰§è¡Œä¸­ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’å…¥ï¼Œä¸è®¸åŠ å¡ï¼‰ ç®€ä»‹ Redisäº‹åŠ¡å¯ä»¥ä¸€æ¬¡æŒ‡å®šå¤šä¸ªå‘½ä»¤ï¼ˆå…è®¸åœ¨ä¸€ä¸ªå•ç‹¬çš„æ­¥éª¤ä¸­æ‰§è¡Œä¸€ç»„å‘½ä»¤ï¼‰ï¼Œå¹¶ä¸”å¸¦æœ‰ä¸€ä¸‹ä¸¤ä¸ªä¸­è¦çš„ä¿è¯ï¼š 123æ‰¹é‡æ“ä½œåœ¨å‘é€EXECå‘½ä»¤å‰è¢«æ”¾å…¥é˜Ÿåˆ—ç¼“å­˜ã€‚æ”¶åˆ°EXECå‘½ä»¤åè¿›å…¥äº‹åŠ¡æ‰§è¡Œï¼Œäº‹åŠ¡ä¸­ä»»æ„å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶ä½™å‘½ä»¤ä¾ç„¶è¢«æ‰§è¡Œã€‚åœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–å®¢æˆ·ç«¯æäº¤çš„å‘½ä»¤è¯·æ±‚ä¸ä¼šæ’å…¥åˆ°äº‹åŠ¡æ‰§è¡Œå‘½ä»¤åˆ—ä¸­ã€‚ Redisä¼šå°†ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤åºåˆ—åŒ–ï¼Œç„¶åæŒ‰é¡ºåºæ‰§è¡Œ æ‰§è¡Œä¸­ä¸ä¼šè¢«å…¶å®ƒå‘½ä»¤æ’å…¥ï¼Œä¸è®¸å‡ºç°åŠ èµ›è¡Œä¸º å¸¸ç”¨å‘½ä»¤ 1234567891011DISCARD : å–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—å†…çš„æ‰€æœ‰å‘½ä»¤ã€‚MULTI : æ ‡è®°ä¸€ä¸ªäº‹åŠ¡å—çš„å¼€å§‹ã€‚EXEC : æ‰§è¡Œæ‰€æœ‰äº‹åŠ¡å—å†…çš„å‘½ä»¤ã€‚UNWATCH: å–æ¶ˆwatchå‘½ä»¤å¯¹æ‰€æœ‰keyçš„ç›‘è§†ã€‚WATCH KEY [KEY ...] :ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª)keyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›)keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚ ä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹åˆ°æ‰§è¡Œä¼šç»å†ä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š 1ã€å¼€å§‹äº‹åŠ¡ã€‚ 2ã€å‘½ä»¤å…¥é˜Ÿã€‚ 3ã€æ‰§è¡Œäº‹åŠ¡ã€‚ 15.1ç¤ºä¾‹ 1 MULTI EXECè½¬è´¦åŠŸèƒ½ï¼ŒAå‘Bè½¬è´¦50å…ƒ ä¸€ä¸ªäº‹åŠ¡çš„ä¾‹å­ï¼Œå®ƒå…ˆä»¥MULTIå¼€å§‹ä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åå°†å¤šä¸ªå‘½ä»¤å…¥é˜Ÿåˆ°äº‹åŠ¡ä¸­ï¼Œæœ€åç”±EXECå‘½ä»¤è§¦å‘äº‹åŠ¡ è¾“å…¥Multiå‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¸€æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œ çŸ¥é“è¾“å…¥Exceåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¸€æ¬¡æ‰§è¡Œã€‚ 15.2 ç¤ºä¾‹ DISCARDæ”¾å¼ƒé˜Ÿåˆ—è¿è¡Œ è¾“å…¥MULTIå‘½ä»¤ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œã€‚ ç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚ å‘½ä»¤é˜Ÿåˆ—çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨å‘½ä»¤DISCARDæ¥æ”¾å¼ƒé˜Ÿåˆ—è¿è¡Œã€‚ 15.3 ç¤ºä¾‹3äº‹åŠ¡çš„é”™è¯¯å¤„ç†äº‹åŠ¡çš„é”™è¯¯å¤„ç†ï¼š å¦‚æœæ‰§è¡Œçš„æŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚ 15.4 ç¤ºä¾‹4 äº‹åŠ¡çš„é”™è¯¯å¤„ç†äº‹åŠ¡çš„é”™è¯¯å¤„ç†ï¼š é˜Ÿåˆ—ä¸­çš„æŸä¸ªå‘½ä»¤å‡ºç°äº† æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ˜¯æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚ ç”±äºä¹‹å‰çš„é”™è¯¯ï¼Œäº‹åŠ¡æ‰§è¡Œå¤±è´¥ 15.5 ç¤ºä¾‹5 äº‹åŠ¡çš„watch12WATCH key [key ...]:ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª)keyï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œå‰è¿™ä¸ª(æˆ–è¿™äº›)keyè¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚ éœ€æ±‚ï¼šæŸä¸€è´¦æˆ·åœ¨ä¸€äº‹åŠ¡å†…è¿›è¡Œæ“ä½œï¼Œåœ¨æäº¤äº‹åŠ¡å‰ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹å¯¹è¯¥è´¦æˆ·è¿›è¡Œæ“ä½œã€‚ 15.6 åº”ç”¨åœºæ™¯ä¸€ç»„å‘½ä»¤å¿…é¡»åŒæ—¶éƒ½æ‰§è¡Œï¼Œæˆ–è€…éƒ½ä¸æ‰§è¡Œã€‚ æˆ‘ä»¬æƒ³è¦ä¿è¯ä¸€ç»„å‘½ä»¤åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¹‹ä¸­ä¸è¢«å…¶ä»–å‘½ä»¤æ’å…¥ã€‚ æ¡ˆä¾‹ï¼š ç§’æ€ 15.7 Redisäº‹åŠ¡çš„æ€»ç»“Redisäº‹åŠ¡æœ¬è´¨ï¼šä¸€ç»„å‘½ä»¤çš„é›†åˆï¼ä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šè¢«åºåˆ—åŒ–ï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼ä¸€æ¬¡æ€§ï¼Œé¡ºåºæ€§ï¼Œæ’ä»–æ€§ï¼æ‰§è¡Œä¸€äº›åˆ—çš„å‘½ä»¤ï¼ Redisäº‹åŠ¡æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µï¼ æ‰€æœ‰çš„å‘½ä»¤åœ¨äº‹åŠ¡ä¸­ï¼Œå¹¶æ²¡æœ‰ç›´æ¥è¢«æ‰§è¡Œï¼åªæœ‰å‘èµ·æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ‰ä¼šæ‰§è¡Œï¼Exec Rediså•æ¡å‘½ä»¤ä¿å­˜åŸå­æ€§ï¼Œä½†æ˜¯äº‹åŠ¡ä¸ä¿è¯åŸå­æ€§ï¼ Redis äº‹åŠ¡å…¶å®æ˜¯æ”¯æŒåŸå­æ€§çš„ï¼å³ä½¿ Redis ä¸æ”¯æŒäº‹åŠ¡å›æ»šæœºåˆ¶ï¼Œä½†æ˜¯å®ƒä¼šæ£€æŸ¥æ¯ä¸€ä¸ªäº‹åŠ¡ä¸­çš„å‘½ä»¤æ˜¯å¦é”™è¯¯ã€‚ åå…­ã€RedisæŒä¹…åŒ–16.1 ä»€ä¹ˆæ˜¯Redis æŒä¹…åŒ–ï¼ŸæŒä¹…åŒ–å°±æ˜¯æŠŠå†…å­˜çš„æ•°æ®å†™åˆ°ç£ç›˜ä¸­å»ï¼Œé˜²æ­¢åºœæœåŠ¡å®•æœºå†…å­˜æ•°æ®ä¸¢å¤±ã€‚ Redisæä¾›äº†ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ï¼šRDB(é»˜è®¤)å’ŒAOF ç®€ä»‹ æ•°æ®å­˜æ”¾äºï¼š å†…å­˜ï¼šé«˜æ•ˆï¼Œæ–­ç”µï¼ˆå…³æœºï¼‰å†…å­˜æ•°æ®ä¼šä¸¢å¤± ç¡¬ç›˜ï¼šè¯»å†™é€Ÿåº¦æ…¢äºå†…å­˜ï¼Œæ–­ç”µæ•°æ®ä¸ä¼šä¸¢å¤± RedisæŒä¹…åŒ–å­˜å‚¨æ”¯æŒä¸¤ç§æ–¹å¼ï¼šRDBå’ŒAOFã€‚RDBä¸€å®šæ—¶é—´å–å­˜å‚¨æ–‡ä»¶ï¼ŒAOFé»˜è®¤æ¯ç§’å»å­˜å‚¨å†å²å‘½ä»¤ï¼Œ Redisæ˜¯æ”¯æŒæŒä¹…åŒ–çš„å†…å­˜æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯è¯´rediséœ€è¦ç»å¸¸å°†å†…å­˜ä¸­çš„æ•°æ®åŒæ­¥åˆ°ç¡¬ç›˜æ¥ä¿è¯æŒä¹…åŒ–ã€‚ 16.2 RDBRDBæ˜¯Redis DataBaseç¼©å†™ Redisæ˜¯å†…å­˜æ•°æ®åº“ï¼Œå¦‚æœä¸å°†å†…å­˜ä¸­çš„æ•°æ®åº“çŠ¶æ€ä¿å­˜åˆ°ç£ç›˜ä¸­ï¼Œé‚£ä¹ˆä¸€æ—¦æœåŠ¡å™¨è¿›ç¨‹é€€å‡ºï¼ŒæœåŠ¡å™¨ä¸­çš„æ•°æ®åº“çš„çŠ¶æ€ä¹Ÿä¼šæ¶ˆå¤±ã€‚é€ æˆæ•°æ®çš„ä¸¢å¤±ï¼Œæ‰€ä»¥redisæä¾›äº†æŒä¹…åŒ–çš„åŠŸèƒ½ã€‚ åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œä¹Ÿå°±æ˜¯æ‰€è¯´çš„snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ˜¯å°†å¡UNå…³ç…§æ–‡ä»¶çˆ±ä½ ç›´æ¥è¯»åˆ°å†…å­˜é‡Œã€‚ Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆfockï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œåœ¨ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ã€‚è¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ã€‚å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡çš„æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ­»éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOF æ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚ åŠŸèƒ½æ ¸å¿ƒå‡½æ•°rdbSaveï¼ˆç”ŸæˆRDBæ–‡ä»¶ï¼‰å’ŒrdbLoadï¼ˆä»æ–‡ä»¶åŠ è½½å†…å­˜ï¼‰ä¸¤ä¸ªå‡½æ•° rdbSaveï¼šç”ŸæˆRDBæ–‡ä»¶ rdbLoadï¼šä»æ–‡ä»¶å¤¹æ‚å†…å­˜ RDB : æ˜¯redisé»˜è®¤çš„æŒä¹…åŒ–æœºåˆ¶ å¿«ç…§æ˜¯é»˜è®¤çš„æŒä¹…åŒ–æ–¹å¼ã€‚è¿™ç§æ–¹å¼å°±æ˜¯å°†å†…å­˜ä¸­æ•°æ®ä»¥å¿«ç…§çš„æ–¹å¼å†™å…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œé»˜è®¤çš„æ–‡ä»¶åä¸ºdump.rdbã€‚ ä¼˜ç‚¹ï¼š å¿«ç…§ä¿å­˜æ•°æ®æå¿«ï¼Œè¿˜åŸæ•°æ®æå¿« é€‚ç”¨äºç¾éš¾å¤‡ä»½ ç¼ºç‚¹ï¼š å°å†…å­˜æœºå™¨ä¸é€‚åˆä½¿ç”¨ï¼ŒRDBæœºåˆ¶ç¬¦åˆè¦æ±‚å°±ä¼šç…§å¿«ç…§ å¿«ç…§æ¡ä»¶ï¼š 12345671ã€æœåŠ¡å™¨æ­£å¸¸å…³é—­ï¼š./bin/redis-cli shutdown2ã€keyæ»¡è¶³ä¸€å®šæ¡ä»¶ï¼Œä¼šè¿›è¡Œå¿«ç…§ vim redis.config æœç´¢save /savesave 900 1 //æ¯ç§’900ç§’ï¼ˆ15åˆ†é’Ÿï¼‰è‡³å°‘1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œäº§ç”Ÿå¿«ç…§save 300 10 //æ¯300ç§’ ï¼ˆ5åˆ†é’Ÿï¼‰è‡³å°‘10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œäº§ç”Ÿå¿«ç…§save 60 10000 //æ¯60ç§’ï¼ˆ1åˆ†é’Ÿï¼‰è‡³å°‘10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼Œäº§ç”Ÿå¿«ç…§ 16.3 AOFç”±äºå¿«ç…§æ–¹å¼æ˜¯åœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡çš„ï¼Œæ‰€ä»¥å¦‚æœredisæ„å¤–downæ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€ä¸ªå¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚å¦‚æœåº”ç”¨è¦æ±‚ä¸èƒ½ä¸¢å¤±ä»»ä½•ä¿®æ”¹çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨aofæŒä¹…åŒ–æ–¹å¼ã€‚ Append-only fileï¼šaofæ¯”rdbæœ‰æ›´å¥½çš„æŒä¹…åŒ–æ€§ï¼Œæ˜¯ç”±äºåœ¨ä½¿ç”¨aofæŒä¹…åŒ–æ–¹å¼æ˜¯ï¼Œredisä¼šå°†æ¯ä¸€ä¸ªæ”¶åˆ°çš„å‘½ä»¤éƒ½é€šè¿‡writeå‡½æ•°è¿½åŠ åˆ°æ–‡ä»¶ä¸­ï¼ˆé»˜è®¤æ˜¯appendonly.aof)ã€‚å½“redisé‡å¯æ˜¯ä¼šé€šè¿‡é‡æ–°æ‰§è¡Œæ–‡ä»¶ä¸­ä¿å­˜çš„å†™å‘½ä»¤æ¥åœ¨å†…å­˜å†²é‡å»ºæ•´ä¸ªæ•°æ®åº“çš„å†…å®¹ã€‚ æ¯å½“æ‰§è¡ŒæœåŠ¡å™¨ï¼ˆå®šæ—¶ï¼‰ä»»åŠ¡æˆ–è€…å‡½æ•°æ—¶flushAppendOnlyFileå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªå·¥ä½œaofå†™å…¥ä¿å­˜ï¼š WRITEï¼šæ ¹æ®æ¡ä»¶ï¼Œå°†aof_bufä¸­çš„ç¼“å­˜å†™å…¥åˆ°AOFæ–‡ä»¶ã€‚ SAVEï¼šæ ¹æ®æ¡ä»¶ï¼Œè°ƒç”¨fsyncæˆ–fdatasyncå‡½æ•°ï¼Œå°†AOFæ–‡ä»¶ä¿å­˜åˆ°ç£ç›˜ä¸­ã€‚ æœ‰ä¸‰ç§æ–¹å¼å¦‚ä¸‹ï¼ˆé»˜è®¤æ˜¯ï¼šæ¯ç§’fsyncä¸€æ¬¡ï¼‰ appendonly yes //å¯ç”¨aofæŒä¹…åŒ–æ–¹å¼ # appendfsync always //æ”¶åˆ°å†™å‘½ä»¤å°±ç«‹å³å†™å…¥ç£ç›˜ï¼Œæœ€æ…¢ï¼Œä½†æ˜¯ä¿è¯å®Œå…¨çš„æŒä¹…åŒ– appendfysnceverysec //æ¯ç§’é’Ÿå†™å…¥ç£ç›˜ä¸€æ¬¡ï¼Œåœ¨æ€§èƒ½å’ŒæŒä¹…åŒ–æ–¹é¢åšäº†å¾ˆå¥½çš„æŠ˜ä¸­ # appendfysnc no //å®Œå…¨ä¾èµ–osï¼Œæ€§èƒ½å­”ï¼ŒæŒä¹…åŒ–æ²¡ä¿è¯ äº§ç”Ÿçš„é—®é¢˜ï¼š aofçš„æ–¹å¼ä¹ŸåŒæ—¶å¸¦æ¥äº†å¦ä¸€ä¸ªé—®é¢˜ã€‚æŒä¹…åŒ–æ–‡ä»¶ä¼šå˜çš„è¶Šæ¥è¶Šå¤§ã€‚ä¾‹å¦‚æˆ‘ä»¬è°ƒç”¨incr testå‘½ä»¤ 100æ¬¡ï¼Œé—®ä»·ä¸­å¿…é¡»ä¿å­˜å…¨éƒ¨çš„1000æ¡å‘½ä»¤ï¼Œå…¶å®æœ‰99æ¡éƒ½æ˜¯å¤šä½™çš„ã€‚ åä¸ƒã€Redisç¼“å­˜ä¸æ•°æ®åº“ä¸€è‡´æ€§17.1 å®æ—¶åŒæ­¥å¯¹å¼ºä¸€ç›´è¦æ±‚æ¯”è¾ƒé«˜çš„ï¼Œåº”é‡‡ç”¨å®æ—¶åŒæ­¥æ–¹æ¡ˆï¼Œå³æŸ¥è¯¢ç¼“å­˜æŸ¥è¯¢ä¸åˆ°åœ¨ä»DBæŸ¥è¯¢ï¼Œä¿å­˜åˆ°ç¼“å­˜ï¼›æ›´æ–°ç¼“å­˜æ—¶ï¼Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œåœ¨å°†ç¼“å­˜çš„è®¾ç½®è¿‡æœŸï¼ˆå»ºè®®ä¸è¦å»æ›´æ–°ç¼“å­˜å†…å®¹ï¼Œç›´æ¥è®¾ç½®ç¼“å­˜è¿‡æœŸï¼‰ã€‚ @Cacheableï¼šæŸ¥è¯¢æ—¶ä½¿ç”¨ï¼Œæ³¨æ„Longç±»å‹éœ€è¦è½¬æ¢ä¸ºStringç±»å‹ï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ @CachePutï¼šè·Ÿæ–°æ˜¯ä½¿ç”¨ï¼Œä½¿ç”¨æ­¤æ³¨è§£ï¼Œä¸€å®šä¼šä»DBä¸ŠæŸ¥è¯¢æ•°æ® @CacheEvictï¼šåˆ é™¤æ—¶ä½¿ç”¨ï¼› @Caching ï¼šç»„åˆç”¨æ³• 17.2 å¼‚æ­¥é˜Ÿåˆ—å¯¹äºå¹¶å‘ç¨‹åº¦é«˜çš„ï¼Œå¯é‡‡ç”¨å¼‚æ­¥é˜Ÿåˆ—çš„æ–¹å¼åŒæ­¥ï¼Œå¯é‡‡ç”¨kafkaç­‰æ¶ˆæ¯ä¸­é—´ä»¶å¤„ç†æ¶ˆæ¯ç”Ÿäº§å’Œæ¶ˆè´¹ã€‚ 17.3 ä½¿ç”¨é˜¿é‡Œçš„åŒæ­¥å·¥å…·canal17.4 é‡‡ç”¨UDFè‡ªå®šä¹‰å‡½æ•°çš„æ–¹å¼é¢å¯¹mysqlçš„APIè¿›è¡Œç¼–ç¨‹ï¼Œåˆ©ç”¨è§¦å‘å™¨è¿›è¡Œç¼“å­˜åŒæ­¥ï¼Œä½†UDFä¸»è¦æ˜¯C/C++è¯­è¨€å®ç°ï¼Œå­¦ä¹ æˆæœ¬é«˜ã€‚ åå…«ã€æ€»ç»“18.1 ç¼“å­˜ç©¿é€ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ—¶ä¸å‘½ä¸­æ—¶éœ€è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼ŒæŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æ•°æ®åº“å»æŸ¥è¯¢ï¼Œé€ æˆç¼“å­˜ç©¿é€ã€‚ è§£å†³åŠæ³•ï¼šæŒä¹…å±‚æŸ¥è¯¢ä¸åˆ°å°±ç¼“å­˜ç©ºç»“æœï¼ŒæŸ¥è¯¢æ—¶å…ˆåˆ¤æ–­ç¼“å­˜ä¸­æ˜¯å¦exists(key)ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ç©ºï¼Œæ²¡æœ‰åˆ™æŸ¥è¯¢åè¿”å›ï¼Œ æ³¨æ„insertæ—¶éœ€è¦æ¸…é™¤æŸ¥è¯¢çš„keyï¼Œå¦åˆ™å³ä¾¿DBä¸­æœ‰å€¼ä¹ŸæŸ¥è¯¢ä¸åˆ°ï¼ˆå½“ç„¶å¯ä»¥è®¾ç½®ç©ºç¼“å­˜çš„è¿‡å»æ—¶é—´ï¼‰ æ¦‚å¿µ ç¼“å­˜ç©¿é€çš„æ¦‚å¿µå¾ˆç®€å•ï¼Œç”¨æˆ·æƒ³è¦æŸ¥è¯¢ä¸€ä¸ªæ•°æ®æ²¡æ³•å®‰rediså†…å­˜æ•°æ®åº“æ²¡æœ‰ï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼Œäºæ˜¯å‘æŒä¹…å±‚æ•°æ®é‡æŸ¥è¯¢ã€‚å‘ç°ä¹Ÿæ²¡æœ‰ï¼Œäºæ˜¯æœ¬æ¬¡æŸ¥è¯¢å¤±è´¥ã€‚å½“ç”¨æˆ·å¾ˆå¤šçš„æ—¶å€™ï¼Œç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­ï¼Œäºæ˜¯éƒ½å»è¯·æ±‚æŒä¹…å±‚æ•°æ®åº“ï¼Œè¿™ä¼šç»™æŒä¹…å±‚æ•°æ®åº“é€ æˆå¾ˆå¤§çš„å‹åŠ›ï¼Œè¿™æ—¶å€™å°±ç›¸å½“äºå‡ºç°äº†ç¼“å­˜ç©¿é€ã€‚ è§£å†³æ–¹æ¡ˆ 18.1.1 å¸ƒéš†è¿‡æ»¤å™¨å¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯¹æ‰€æœ‰å¯èƒ½æŸ¥è¯¢çš„å‚æ•°ä»¥hashå½¢å¼å­˜å‚¨ï¼Œåœ¨æ§åˆ¶å±‚å…ˆè¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆåˆ™ä¸¢å¼ƒï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ï¼› ä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š 1ã€å¦‚æœç©ºå€¼èƒ½å¤Ÿè¢«ç¼“å­˜èµ·æ¥ï¼Œè¿™å°±æ„å‘³ç€ç¼“å­˜éœ€è¦æ›´è¿‡çš„ç©ºé—´æ‘ç²—æ›´è¿‡çš„é”®ï¼Œå› ä¸ºè¿™å½“ä¸­å¯èƒ½å›æœ‰å¾ˆå¤šçš„ç©ºå€¼çš„é”®ï¼› 2ã€å³ä½¿å¯¹ç©ºå€¼è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚çš„æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´çª—å£çš„ä¸ä¸€è‡´ï¼Œè¿™å¯¹äºéœ€è¦ä¿æŒä¸€è‡´æ€§çš„ä¸šåŠ¡ä¼šæœ‰å½±å“ï¼› 18.1.2 ç¼“å­˜å‡»ç©¿ æ¦‚å¿µ è¿™é‡Œéœ€è¦ä¸»è¦çš„æ˜¯ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«ï¼Œç¼“å­˜å‡»ç©¿ï¼Œæ˜¯æŒ‡ä¸€ä¸ªkeyéå¸¸çƒ­ç‚¹ï¼Œåœ¨ä¸åœçš„æ‰›ç€å¤§å¹¶å‘ï¼Œå¤§å¹¶å‘é›†ä¸­å¯¹è¿™ä¸€ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œå½“è¿™ä¸ªkeyåœ¨å¤±æ•ˆçš„ç¬é—´ï¼ŒæŒç»­çš„å¤§å¹¶å‘å°±ç©¿ç ´ç¼“å­˜ï¼Œç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå°±è¡Œåœ¨ä¸€ä¸ªå±å¹•ä¸Šå‡¿å¼€ä¸€ä¸ªæ´ å½“æŸä¸ªkeyåœ¨è¿‡æœŸçš„ç¬é—´ï¼Œæœ‰å¤§é‡çš„è¯·æ±‚å¹¶å‘è®¿é—®ï¼Œè¿™ç±»æ•°æ®ä¸€èˆ¬æ˜¯çƒ­ç‚¹æ•°æ®ï¼Œç”±äºç¼“å­˜è¿‡æœŸï¼Œä¼šåŒæ—¶è®¿é—®æ•°æ®åº“æ¥æŸ¥è¯¢æœ€æ–°æ•°æ®ï¼Œå¹¶ä¸”å›å†™ç¼“å­˜ï¼Œä¼šå¯¼è‡´æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ã€‚ è§£å†³æ–¹æ¡ˆ è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ ä»ç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œæ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€æœ‰ä¸ä¼šå‡ºç°çƒ­ç‚¹keyè¿‡æœŸåäº§ç”Ÿçš„é—®é¢˜ã€‚ åŠ é”äº’æ–¥ åˆ†å¸ƒå¼é”ï¼šä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œä¿è¯å¯¹äºæ¯ä¸ªkeyåŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æŸ¥è¯¢åç›¾æœåŠ¡ï¼Œå…¶ä»–çº¿ç¨‹æ²¡æœ‰è·å¾—åˆ†å¸ƒå¼é”çš„æƒé™ï¼Œå› æ­¤åªéœ€è¦ç­‰å¾…å³å¯ï¼Œè¿™ç§æ–¹å¼å°†é«˜å¹¶å‘çš„å‹åŠ›è½¬ç§»åˆ°äº†åˆ†å¸ƒå¼é”ï¼Œå› æ­¤å¯¹åˆ†å¸ƒå¼é”çš„è€ƒéªŒå¾ˆå¤§ã€‚ 18.2 é›ªå´©é›ªå´©ï¼šç¼“å­˜å¤§é‡å¤±æ•ˆçš„æ—¶å€™ï¼Œå¼•å‘å¤§é‡æŸ¥è¯¢æ•°æ®åº“ã€‚ è§£å†³åŠæ³•ï¼š ç”¨é”/åˆ†å¸ƒå¼é”æˆ–è€…é˜Ÿåˆ—ä¸²è¡Œè®¿é—® ç¼“å­˜å¤±æ•ˆæ—¶é—´å‡åŒ€åˆ†å¸ƒ 123å¦‚æœç¼“å­˜é›†ä¸­åœ¨ä¸€ç«¯æ—¶é—´å†…å¤±æ•ˆï¼Œå‘ç”Ÿå¤§é‡çš„ç¼“å­˜ç©¿é€ï¼Œæ‰€æœ‰çš„æŸ¥è¯¢éƒ½è½åœ¨æ•°æ®åº“ä¸Šï¼Œé€ æˆäº†ç¼“å­˜é›ªå´©ã€‚è¿™ä¸ªæ²¡æœ‰å®Œç¾è§£å†³åŠæ³•ï¼Œä½†æ˜¯å¯ä»¥åˆ†æç”¨æˆ·çš„è¡Œä¸ºï¼Œå°½é‡è®©å¤±æ•ˆæ—¶é—´ç‚¹å‡åŒ€åˆ†å¸ƒã€‚å¤§æ‰€å±ç³»ç»Ÿè®¾è®¡è€…è€ƒè™‘ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯ç¼“å­˜çš„å•çº¿ç¨‹å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ åŠ é”æ’é˜Ÿã€‚é™æµâ€”é™æµç®—æ³• åœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡åŠ é”æˆ–è€…é˜Ÿåˆ—æ¥æ§åˆ¶è¯»æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ã€‚æ¯”å¦‚å¯¹æŸä¸ªkeyåªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚ ç®€å•åœ°æ¥è¯´ï¼Œå°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbï¼Œè€Œæ˜¯å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚Redisde SETNXæˆ–è€…Memcacheçš„ADDï¼‰å»setä¸€ä¸ªmutex keyï¼Œå½“æ“ä½œè¿”å›æˆåŠŸæ˜¯ï¼Œåœ¨è¿›è¡Œkoad db çš„æ“ä½œåº”è®¾ç¼“å­˜ï¼›å¦åˆ™ï¼Œå°±é‡è¯•æ•´ä¸ªgetç¼“å­˜çš„æ–¹æ³•ã€‚ SETNX ,æ˜¯ã€SET IF NOT EXISTS]çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸å­˜åœ¨çš„æ—¶å€™æ‰è®¾ç½®ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°é”çš„æ•ˆæœã€‚ æ•°æ®é¢„çƒ­ å¯ä»¥é€šè¿‡ç¼“å­˜reloadæœºåˆ¶ï¼Œé¢„é€‰å»æ›´æ–°ç¼“å­˜ï¼Œå†å³å°†å‘ç”Ÿå¤§å¹¶å‘è®¿é—®å‰æ‰‹åŠ¨è§¦å‘åŠ è½½ç¼“å­˜ä¸åŒçš„keyï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚ 18.3 çƒ­ç‚¹keyçƒ­ç‚¹keyï¼šæŸä¸ªkeyè®¿é—®éå¸¸é¢‘ç¹ã€‚å½“keyå¤±æ•ˆçš„æ—¶å€™æœ‰å¤§é‡çº¿ç¨‹æ¥æ„å»ºç¼“å­˜ï¼Œå¯¼è‡´è´Ÿè½½å¢åŠ ï¼Œç³»ç»Ÿå´©æºƒã€‚ è§£å†³åŠæ³•ï¼š ä½¿ç”¨é”ï¼Œå•æœºç”¨synchronized ï¼Œ lockç­‰ï¼Œåˆ†å¸ƒå¼ä½¿ç”¨åˆ†å¸ƒå¼é” ç¼“å­˜è¿‡æœŸæ—¶é—´ä¸è®¾ç½®ï¼Œè€Œæ˜¯è®¾ç½®åœ¨keyå¯¹åº”çš„valueé‡Œã€‚å¦‚æœæ£€æµ‹åˆ°å­˜çš„æ—¶é—´è¶…è¿‡è¿‡æœŸæ—¶é—´åˆ™ å¼‚æ­¥è·Ÿæ–°ç¼“å­˜ã€‚ åœ¨valueè®¾ç½®ä¸€ä¸ªæ¯”è¿‡å»æ—¶é—´t0å°çš„è¿‡æœŸæ—¶é—´å€¼t1,å½“t1è¿‡æœŸçš„æ—¶å€™ï¼Œå»¶é•¿t1å¹¶åšæ›´æ–°ç¼“å­˜æ“ä½œã€‚ è®¾ç½®æ ‡ç­¾ç¼“å­˜ï¼Œæ ‡ç­¾ç¼“å­˜è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ ‡ç­¾ç¼“å­˜è¿‡æœŸåï¼Œéœ€å¼‚æ­¥åœ°è·Ÿæ–°å®é™…ç¼“å­˜ã€‚ æ¡ˆä¾‹ 1å‡è®¾å¹¶å‘æœ‰10000ä¸ªè¯·æ±‚ï¼Œæƒ³è¾¾åˆ°å¯¹ä¸ªè¯·æ±‚ä»æ•°æ®åº“ä¸­è·å–ï¼Œå…¶ä»–9999ä¸ªè¯·æ±‚å†²redisä¸­è·å–è¿™ç§æ•ˆæœ åŒé‡æ£€æµ‹é”æµ‹å‹ï¼š åä¹ã€å¯èƒ½çš„é—®é¢˜ä¸€èˆ¬æ¥è¯´ï¼Œè¦å°†redisè¿ç”¨äºå·¥ç¨‹é¡¹ç›®ä¸­ï¼Œåªæ˜¯ç”¨ä¸€å°Redisæ˜¯ä¸‡ä¸‡ä¸èƒ½çš„ï¼ŒåŸå› å¦‚ä¸‹ï¼š 1ã€ä»ç»“æ„ä¸Šï¼Œå•ä¸ªRedisæœåŠ¡å™¨ä¼šå‘ç”Ÿå•ç‚¹æ•…éšœï¼Œå¹¶ä¸”ä¸€å°æœåŠ¡å™¨éœ€è¦å¤„ç†æ‰€æœ‰çš„è¯·æ±‚è´Ÿè½½ï¼Œå‹åŠ›è¾ƒå¤§ï¼›ï¼ˆå®¹é”™æ€§ï¼‰ 2ã€ä»å®¹é‡ä¸Šï¼Œå•ä¸ªredisæœåŠ¡å™¨å†…å­˜å®¹é‡æœ‰é™ï¼Œå°±ç®—ä¸€å°redisæœåŠ¡å™¨å†…å­˜å®¹é‡ä¸º256Gï¼Œä¹Ÿä¸èƒ½å°†æ‰€æœ‰å†…å®¹ç”¨ä½œRediså­˜å‚¨å†…å­˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå•å°Redisæœ€å¤§ä½¿ç”¨å†…å­˜ä¸åº”è¯¥è¶…è¿‡20Gã€‚ é—®é¢˜ï¼š å†…å­˜å®¹é‡æœ‰é™ å¤„ç†èƒ½åŠ›æœ‰é™ æ— æ³•é«˜å¯ç”¨ã€‚ äºŒåã€ä¸»ä»å¤åˆ¶ç®€ä»‹ ç”µå­å•†åŠ¡ç½‘ç«™ä¸Šçš„å•†å“ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€æ¬¡ä¸Šä¼ ï¼Œæ— æ•°æ¬¡çš„æµè§ˆçš„ï¼Œè¯´ä¸“ä¸šç‚¹çš„ä¹Ÿå°±æ˜¯â€œå¤šè¯»å°‘äº›â€ã€‚ 20.1ä¸»ä»å¤åˆ¶ï¼šä¸€ä¸ªRedisæœåŠ¡å¯ä»¥æœ‰å¤šä¸ªè¯¥æœåŠ¡çš„å¤åˆ¶å“ï¼Œè¿™ä¸ªRedisæœåŠ¡æˆä¸ºMasterï¼Œå…¶ä»–çš„å¤åˆ¶æˆä¸ºSlaves å¦‚å›¾ä¸­æ‰€ç¤ºï¼šæˆ‘ä»¬å°†ä¸€å°RedisæœåŠ¡å™¨ä½œä¸ºä¸»åº“ï¼ˆmasterï¼‰ï¼Œå…¶ä»–çš„ä¸‰å°ä½œä¸ºï¼ˆsalveï¼‰ï¼Œä¸»åº“è´Ÿè´£å†™æ•°æ®ï¼Œæ¯æ¬¡æœ‰æ•°æ®è·Ÿæ–°éƒ½æ›´æ–°çš„æ•°æ®åŒæ­¥åˆ°å®ƒçš„æ‰€æœ‰çš„ä»åº“ï¼Œè€Œä»åº“åªè´Ÿè´£è¯»æ•°æ®ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±æœ‰äº†ä¸¤ä¸ªå¥½å¤„ï¼š 1ã€è¯»å†™åˆ†ç¦»ï¼šä¸ä»…å¯ä»¥æé«˜æœåŠ¡å™¨çš„è´Ÿè½½èƒ½åŠ›ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®è¯»è¯·æ±‚çš„è§„æ¨¡è‡ªç”±å¢åŠ æˆ–è€…å‡å°‘ä»åº“çš„æ•°æ®ã€‚ 2ã€æ•°æ®è¢«å¤åˆ¶æˆäº†å¥½å‡ ä»½ï¼Œå°±ç®—ä¸€å°æœºå™¨å‡ºç°æ•…éšœï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒæœºå™¨çš„æ•°æ®å¿«é€Ÿçš„æ¢å¤ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼šRedisä¸»ä»å¤åˆ¶æ¨¡å¼ä¸­ï¼Œä¸€å°ä¸»åº“å¯ä»¥ç”¨ç”¨å¤šä¸ªä»åº“ï¼Œä¸€ä¸ªä»åº“åªèƒ½å±äºä¸€ä¸ªä¸»åº“ã€‚ 20.2 Redisä¸»ä»å¤åˆ¶é…ç½®åœ¨Redisä¸­ï¼Œè¦å®ç°ä¸»ä»å¤åˆ¶æ¶æ„éå¸¸çš„ç®€å•ï¼Œåªéœ€è¦åœ¨ä»æ•°æ®åº“çš„é…ç½®æ–‡ä»¶ä¸­åŠ ä¸Šå¦‚ä¸‹å‘½ä»¤å³å¯ï¼š 1ã€ä¸»æ•°æ®åº“ä¸éœ€è¦ä»»åŠ¡é…ç½®ï¼Œåˆ›å»ºçˆ±å“ªä¸€ä¸ªä»æ•°æ®åº“ï¼š redis.configï¼ˆé…ç½®æ–‡ä»¶ä¿¡æ¯ï¼‰ 12-- port 6380 : ä»æœåŠ¡çš„ç«¯å£å·--slaveof 127.0.0.1 6379 ï¼šæŒ‡å®šä¸»æœåŠ¡å™¨ 2ã€å¯åŠ¨ä»æ•°æ®åº“ï¼š 1./bin/redis-server ./redis.conf --port 6380 --slaveof 127.0.0.1 6379 3ã€ç™»å½•åˆ°ä»æœåŠ¡å®¢æˆ·ç«¯ 1./bin/redis-cli -p 6380 -a redis 4ã€å“¨å…µæ¨¡å¼ ç®€ä»‹ 1Redis-Sentinel(å“¨å…µæ¨¡å¼)æ˜¯é«˜å¯ç”¨è§£å†³æ–¹æ¡ˆï¼Œå½“redisåœ¨åšmaster-slaveçš„é«˜å¯ç”¨æ–¹æ¡ˆæ—¶ï¼Œå‡å¦‚masterå®•æœºäº†ï¼Œredisæœ¬èº«ï¼ˆä»¥åŠå…¶å¾ˆå¤šå®¢æˆ·ç«¯ï¼‰éƒ½æ²¡æœ‰å®ç°è‡ªåŠ¨è¿›è¡Œä¸»å¤‡åˆ‡æ¢ï¼Œè€Œredis-sentinelæœ¬èº«æ˜¯ç‹¬ç«‹è¿è¡Œçš„è¿›ç¨‹ï¼Œå¯ä»¥éƒ¨ç½²åœ¨å…¶ä»–çš„ä¸redisé›†ç¾¤å¯é€šè®¯çš„æœºå™¨ä¸­ç›‘æ§redisé›†ç¾¤ã€‚ 12æœ‰äº†ä¸»ä»å¤åˆ¶çš„å®ç°ä¹‹åï¼Œæˆ‘ä»¬å¦‚æœæƒ³ä»æœåŠ¡å™¨è¿›è¡Œç›‘æ§ï¼Œé‚£ä¹ˆåœ¨redis2.6ä»¥åæä¾›äº†æœ‰ä¸ªâ€œå“¨å…µâ€æœºåˆ¶ï¼Œå¹¶åœ¨2.8ç‰ˆæœ¬ä»¥ååŠŸèƒ½ç¨³å®šèµ·æ¥ã€‚å“¨å…µï¼šæ•…åå¸ä»ªï¼Œå°±æ˜¯ç›‘æ§Redisç³»ç»Ÿçš„è¿è¡ŒçŠ¶å†µã€‚ å“¨å…µæ¨¡å¼çš„ç‰¹ç‚¹ 12341ã€ä¸æ—¶åœ°ç›‘æ§redisæ˜¯å¦æŒ‰ç…§é¢„æœŸè‰¯å¥½åœ°è¿è¡Œï¼›2ã€å¦‚æœå‘ç°æŸä¸ªredis èŠ‚ç‚¹è¿è¡Œå‡ºç°çŠ¶å†µï¼Œèƒ½å¤Ÿé€šçŸ¥å¦å¤–ä¸€ä¸ªè¿›ç¨‹ï¼ˆä¾‹å¦‚å®ƒçš„å®¢æˆ·ç«¯ï¼‰ï¼›3ã€èƒ½å¤Ÿè¿›è¡Œè‡ªåŠ¨åˆ‡æ¢ã€‚å½“ä¸€ä¸ªmasterèŠ‚ç‚¹ä¸å¯ç”¨æ—¶ï¼Œèƒ½å¤Ÿé€‰ä¸¾å‡ºmasterçš„å¤šä¸ªslave(å¦‚æœæœ‰è¶…è¿‡ä¸€ä¸ªslaveçš„è¯)ä¸­çš„ä¸€ä¸ªæ¥ä½œä¸ºæ–°çš„masterï¼Œå…¶ä»–çš„slaveèŠ‚ç‚¹ä¼šå°†å®ƒæ‰€è¿½éšçš„masteråœ°å€æ”¹ä¸ºè¢«æå‡ä¸ºmasterçš„salveçš„æ–°åœ°å€ã€‚4ã€å“¨å…µä¸ºå®¢æˆ·ç«¯æä¾›æœåŠ¡å‘ç°ï¼Œå®¢æˆ·ç«¯è¿æ¥å“¨å…µï¼Œå“¨å…µæä¾›å½“å‰masterçš„åœ°å€ç„¶åæä¾›æœåŠ¡ï¼Œå¦‚æœå‡ºç°åˆ‡æ¢ï¼Œä¹Ÿå°±æ˜¯masteræŒ‚äº†ï¼Œå“¨å…µä¼šæä¾›å®¢æˆ·ç«¯ä¸€ä¸ªæ–°åœ°å€ã€‚ 20.3 åŸºæœ¬æ¦‚è¿°é«˜å¯ç”¨ â€œé«˜å¯ç”¨æ€§ï¼ˆHigh Availabilityï¼‰â€é€šå¸¸ç”¨æ¥æè¿°ä¸€ä¸ªç³»ç»Ÿç»è¿‡ä¸“é—¨çš„è®¾è®¡ï¼Œä»è€Œå‡å°‘åœå·¥æ—¶é—´ï¼Œè€Œä¿è¯å™¨æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚ï¼ˆä¸€ç›´éƒ½èƒ½ç”¨ï¼‰ é«˜å¯ç”¨ï¼š6ä¸ª99.9999% å…¨å¹´åœæœºä¸è¶…è¿‡32ç§’ã€‚ é«˜å¹¶å‘ é«˜å¹¶å‘ ï¼ˆHigh Concurrentcyï¼‰æ˜¯äº’è”ç½‘åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­å¿…é¡»è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ï¼Œå®ƒé€šå¸¸æ˜¯æŒ‡ï¼Œé€šè¿‡è®¾è®¡åœ¨ä¿è¯ç³»ç»Ÿèƒ½å¤ŸåŒæ—¶å¹¶è¡Œå¤„ç†çš„å¾ˆå¤šè¯·æ±‚ã€‚ é«˜å¹¶å‘ç›¸å…³å•†ç”¨çš„ä¸€äº›æŒ‡æ ‡æœ‰å¦‚ä¸‹ï¼š å“åº”æ—¶é—´ï¼ˆResponse Timeï¼‰ ååé‡ï¼ˆThroughputï¼‰ æ¯ç§’æŸ¥è¯¢ç‡QPSï¼ˆQuery Pre Secondï¼‰ï¼Œå¹¶å‘ç”¨æˆ·æ•°ç­‰ã€‚ å“åº”æ—¶é—´ï¼šç³»ç»Ÿå¯¹è¯·æ±‚åšå‡ºå“åº”çš„æ—¶é—´ï¼Œä¾‹å¦‚ç³»ç»Ÿå¤„ç†ä¸€ä¸ªHTTPè¯·æ±‚éœ€è¦200msï¼Œè¿™ä¸ª200mså°±æ˜¯ç³»ç»Ÿçš„å“åº”æ—¶é—´ã€‚ ååé‡ï¼šå•ä½æ—¶é—´å†…å¤„ç†çš„è¯·æ±‚æ•°é‡ã€‚ QPS ï¼šæ¯ç§’å“åº”è¯·æ±‚æ•°ã€‚åœ¨äº’è”ç½‘é¢†åŸŸï¼Œè¿™ä¸ªæŒ‡æ ‡å’Œååé‡åŒºåˆ†çš„æ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾ã€‚ å¹¶å‘ç”¨æˆ·ï¼šåŒæ—¶æ‰¿è½½æ­£å¸¸ä½¿ç”¨ç³»ç»ŸåŠŸèƒ½çš„ç”¨æˆ·æ•°é‡ã€‚ä¾‹å¦‚ä¸€ä¸ªå³ä½¿é€šè®¯ç³»ç»Ÿï¼ŒåŒæ—¶åœ¨çº¿é‡ä¸€å®šç¨‹åº¦ä¸Šä»£è¡¨ 20.4 ä¸»ä»å¤åˆ¶çš„ä¸»è¦ä½œç”¨åŒ…æ‹¬1ã€æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™çš„æ–¹å¼ã€‚ 2ã€æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç° é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼›ä¸–ç•Œä¸Šæ˜¯ä»¥ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚ 3ã€è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±èŠ‚ç‚¹æä¾›å†™çš„æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›æä¾›è¯»æœåŠ¡ï¼ˆå³å†™redisæ•°æ®æ—¶åº”ç”¨åŠè¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯»redisæ•°æ®æ—¶åº”è¯¥ç”¨ä»èŠ‚ç‚¹ï¼‰ï¼Œäººä¸¹æœåŠ¡å™¨çš„è´Ÿè½½ï¼›å°¤å…¶åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜redisæœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚ 4ã€é«˜å¯ç”¨çš„åŸºçŸ³ï¼šé™¤äº†ä¸Šè¿°ä½œç”¨ä»¥å¤–ï¼Œä¸»ä»å¤åˆ¶è¿˜æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ï¼Œå› æ­¤è¯´ä¸»ä»å¤åˆ¶æ˜¯redisé«˜å¯ç”¨çš„åŸºç¡€ã€‚ 20.5 ä¸»ä»å¤åˆ¶çš„åŸç†Slave å¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncå‘½ä»¤ Masteræ¥æ”¶åˆ°åï¼Œå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥å—åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œmasterå°†ä¼ é€çš„æ•°æ®æ–‡ä»¶åˆ°slaveï¼Œå¹¶å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥å—åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½å†…å­˜ä¸­ã€‚ å¢é‡æ–‡ä»¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†çš„ä¿®æ”¹å‘½ä»¤ä¸€æ¬¡ä¼ ç»™slaveï¼Œå®ŒæˆåŒæ­¥ ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥masterï¼Œä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶ï¼‰å°†åˆ«è‡ªåŠ¨æ‰§è¡Œã€‚ äºŒåä¸€ã€Redis Clusteré›†ç¾¤ç®€ä»‹ 21.1 é›†ç¾¤æ¨¡å¼æ˜¯å®é™…ä½¿ç”¨æœ€å¤šçš„æ¨¡å¼ã€‚Redis Clusteræ˜¯ç¤¾åŒºç‰ˆæ¨å‡ºçš„Redisåˆ†å¸ƒå¼é›†ç¾¤è§£å†³æ–¹æ¡ˆï¼Œä¸»è¦è§£å†³Redisåˆ†å¸ƒå¼æ–¹é¢çš„éœ€æ±‚ï¼Œæ¯”å¦‚ï¼Œå½“é‡åˆ°å•æœºå†…å­˜ï¼Œå¹¶å‘å’Œæµé‡ç­‰ç“¶é¢ˆçš„æ—¶å€™ï¼ŒRedis Clusterèƒ½èµ·åˆ°å¾ˆå¥½çš„çš„è´Ÿè½½å‡è¡¡çš„ç›®çš„ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨redis-clusterï¼Ÿ 123ä¸ºäº†åœ¨å¤§æµé‡è®¿é—®ä¸‹æä¾›ç¨³å®šçš„ä¸šåŠ¡ï¼Œé›†ç¾¤åŒ–æ—¶å­˜å‚¨çš„å¿…ç„¶å½¢æ€æœªæ¥çš„å‘å±•è¶‹åŠ¿å¯å®šæ˜¯äº‘è®¡ç®—å’Œå¤§æ•°æ®çš„ç´§å¯†ç»“åˆåªæœ‰åˆ†å¸ƒå¼æ¶æ„èƒ½æ»¡è¶³éœ€æ±‚ 21.2 é›†ç¾¤æè¿°Redisé›†ç¾¤æ­å»ºæ–¹æ¡ˆï¼š 123(1)ã€Twitterå¼€å‘çš„twemproxy(2)ã€è±Œè±†èšå¼€å‘çš„codis(3)ã€redisè§‚æ³•çš„redis-cluster Redisé›†ç¾¤æ­å»ºçš„æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œä½†ä»redis 3.0 ä¹‹åå˜åŠ¨è¡¨å‘¢æ”¯æŒredis-clusteré›†ç¾¤ï¼Œå¿—è¶…éœ€è¦3ï¼ˆmasterï¼‰+3ï¼ˆSlaveï¼‰æ‰èƒ½ç®€å†é›†ç¾¤ã€‚Redisâ€”â€”Clusteré‡‡ç”¨æ— ä¸­å¿ƒç»“æ„ï¼Œæ²¡ä¸ªèŠ‚ç‚¹ä¿å­˜æ•°æ®å’Œæ•´ä¸ªé›†ç¾¤çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å’Œå…¶ä»–æ‰€æœ‰ èŠ‚ç‚¹è¿æ¥ã€‚å…¶redis-clusteræ¶æ„å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š Redis Clusteré›†ç¾¤å‡ ç‚¹æœ€å°é…ç½®6ä¸ªèŠ‚ç‚¹ä»¥ä¸Šï¼ˆ3ä¸»3ä»ï¼‰ï¼Œå…¶ä¸­ä¸»èŠ‚ç‚¹æä¾›è¯»å†™æ“ä½œï¼Œä»èŠ‚ç‚¹ä½œä¸ºå¤‡ç”¨èŠ‚ç‚¹ï¼Œä¸æä¾›è¯·æ±‚ï¼Œåªä½œä¸ºæ•…éšœè½¬ç§»ä½¿ç”¨ã€‚ Redis Clusteré›†ç¾¤ç‰¹ç‚¹ 1ã€æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”ï¼ˆPING-PONG)ï¼Œå†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚ 2ã€èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚ 3ã€å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿ï¼Œä¸éœ€è¦ä¸­é—´proxyå±‚ã€‚å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚ 4ã€redis-clusteræŠŠæ‰€æœ‰çš„ç‰©ç†èŠ‚ç‚¹æ˜ å°„åˆ°[0-16383]slotä¸Šï¼ˆä¸ä¸€å®šæ˜¯å¹³å‡åˆ†é…ï¼‰ï¼Œclusterè´Ÿè´£ç»´æŠ¤ 5ã€redisé›†ç¾¤é¢„å…ˆåˆ†å¥½16384ä¸ªå“ˆå¸Œæ§½ï¼Œå½“éœ€è¦åœ¨redisé›†ç¾¤ä¸­æ”¾ç½®ä¸€ä¸ªkey-valueæ—¶ï¼Œrediså…ˆå¯¹keyä½¿ç”¨crc16ç®—æ³•ç®—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå¯¹16384æ±‚ä½™æ•°ï¼Œè¿™æ ·å¯¹æ¯ä¸ªkeyéƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨0-16383ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œredisä¼šæ ¹æ®èŠ‚ç‚¹æ•°é‡å¤§è‡´å‡ç­‰çš„å°†å“ˆå¸Œæ§½æ˜ å°„åˆ°ä¸åŒçš„èŠ‚ç‚¹ã€‚ 21.3 Redis Clusteré›†ç¾¤æ­å»ºé›†ç¾¤æ­å»ºå‚è€ƒå®˜ç½‘ï¼šhttps://redis.io/topic/cluster-tutorial redisé›†ç¾¤éœ€è¦è‡³å°‘ä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œæˆ‘ä»¬è¿™é‡Œæ­å»ºä¸‰ä¸ªmasterèŠ‚ç‚¹ï¼Œå¹¶ä¸”ç»™æ¯ä¸ªmasteråœ¨æ­å»ºä¸€ä¸ªslaveèŠ‚ç‚¹ï¼Œæ€»å…±6ä¸ªèŠ‚ç‚¹ï¼Œè¿™é‡Œç”¨ä¸€å°æœºå™¨ï¼ˆå¯ä»¥å¤šå°æœºå™¨éƒ¨ç½²ï¼Œä¿®æ”¹ä¸€ä¸‹ipåœ°å€å°±å¯ä»¥äº†ï¼‰éƒ¨ç½²6ä¸ªrediså®ä¾‹ï¼Œä¸‰ä¸»ä¸‰ä»ã€‚æ­å»ºé›†ç¾¤çš„æ­¥éª¤å¦‚ä¸‹ï¼š åˆ›å»ºRedisèŠ‚ç‚¹å®‰è£…ç›®å½• 1mkdir /root/apps/redis_cluster ï¼šæŒ‡å®šç›®å½•ä¸‹ åˆ›å»º redis_cluster åœ¨redis_clusterç›®å½•ï¼Œåˆ›å»º7000-7005 6ä¸ªæ–‡ä»¶å¤¹ä¸‹ 1mkdir 70000 70001 70002 70003 70004 70005 å¹¶å°†redis-confåˆ†åˆ«æ‹·è´åˆ°70000-70005æ–‡ä»¶å¤¹ä¸‹ 1cp /opt/redis-5.0.8/redis.conf ./70000 ä¿®æ”¹Redisé…ç½®æ–‡ä»¶ 12345678910111213141516171819/root/apps/redis_cluster/70000# å…³é—­ä¿æŠ¤æ¨¡å¼ ç”¨äºå…¬ç½‘è®¿é—® protected-mode no port 70000# å¼€å¯é›†ç¾¤æ¨¡å¼ cluster-enabled yes cluster-config-file nodes-70000.config cluster-node-timeout 5000# åå°å¯åŠ¨ daemonize yes pidfile /var/run/redis_70000.pid logfile &quot;70000.log&quot;# dir /redis/data# æ­¤å¤„ç»‘å®šip,å¯ä»¥æ˜¯é˜¿é‡Œå†…ç½‘ipå’Œæœ¬åœ°ipä¹Ÿå¯ä»¥ç›´æ¥æ³¨é‡Šæ‰è¯¥é¡¹# bind 127.0.0.1# ç”¨äºè¿æ¥ä¸»èŠ‚ç‚¹å¯†ç  masterauth redis#è®¾ç½®rediså¯†ç  å„ä¸ªå‡ ç‚¹è¯·ä¿æŒå¯†ç ä¸€è‡´ requirepass redis ä¾æ¬¡å¤åˆ¶å¹¶ä¿®æ”¹6ä¸ªredis.conf 12cp ./70000/redis.conf ./70001 :ä¾æ¬¡è¿›è¡Œå¤åˆ¶vim ./70001/redis.conf : æ‰§è¡Œ %s/old/new/g å…¨éƒ¨æ›¿æ¢ ï¼šwq ä¿å­˜å¹¶é€€å‡º å³å¯ 6ã€ä¾æ¬¡å¯åŠ¨6ä¸ªèŠ‚ç‚¹ å°†å®‰è£…çš„redisç›®å½•ä¸‹çš„srcå¤åˆ¶åˆ°clusterä¸‹ï¼Œæ–¹ä¾¿å¯åŠ¨æœåŠ¡ç«¯ 12cd /opt/redis-5.0.8 :è¿›å…¥rediså®‰è£…ç›®å½•cp -r ./src/ /usr/local/redis_cluster/ :å°†srcæ–‡ä»¶å¤åˆ¶åˆ°redisâ€”â€”clusterç›®å½•ä¸­ 123456./src/redis-server ./7000/redis.conf./src/redis-server ./7001/redis.conf./src/redis-server ./7002/redis.conf./src/redis-server ./7003/redis.conf./src/redis-server ./7004/redis.conf./src/redis-server ./7005/redis.conf å¯åŠ¨åï¼Œå¯ä»¥ç”¨PSæŸ¥çœ‹è¿›ç¨‹ï¼š 1ps -ef | grep -i redis åˆ›å»ºé›†ç¾¤ Redis 5ç‰ˆæœ¬å é€šè¿‡redis-cli å®¢æˆ·ç«¯å‘½ä»¤æ¥åˆ›å»ºé›†ç¾¤ã€‚ 1./src/redis-cli --cluster create -a redis 127.0.0.1:7000 127.0.0.1:7001 127.0.0.1:7002 127.0.0.1:7003 127.0.0.1:7004 127.0.0.1:7005 --cluster-replicas 1 1234Performing hash slots allocation on 6 nodesTrying to optimize slaves allocation for anti-affinity 1[OK] All 16384 slots covered. Redis Clusteré›†ç¾¤éªŒè¯ åœ¨æŸå°æœºå™¨ä¸Šï¼ˆæˆ–ï¼‰è¿æ¥é›†ç¾¤çš„7001ç«¯å£çš„å‡ ç‚¹ï¼š 1redis-cli -h 127.0.0.1 -c -p 7000 -a redis :åŠ å‚æ•° -c å¯ä»¥è¿æ¥åˆ°é›†ç¾¤ redis clusteråœ¨è®¾è®¡çš„æ—¶å€™ï¼Œå°±è€ƒè™‘äº†å»ä¸­å¿ƒåŒ–ï¼Œå»ä¸­é—´ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯å¹³ç­‰çš„å…³ç³»ï¼Œéƒ½æ˜¯å¯¹ç­‰çš„ï¼Œæ¯ä¸ªå‡ ç‚¹éƒ½ä¿å­˜å„è‡ªçš„æ•°æ®å’Œæ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½å’Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹è¿æ¥ï¼Œè€Œä¸”è¿™äº›è¿æ¥ä¿æŒæ´»è·ƒï¼Œè¿™æ ·å°±ä¿è¯äº†æˆ‘ä»¬åªéœ€è¦è¿æ¥é›†ç¾¤ä¸­çš„ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±å¯ä»¥è·å–åˆ°å…¶ä»–èŠ‚ç‚¹çš„æ•°æ®ã€‚ åŸºæœ¬å‘½ä»¤ info replication é€šè¿‡Cluster Nodes å‘½ä»¤å’ŒCluster Infoå‘½ä»¤æ¥çœ‹çœ‹é›†ç¾¤çš„æ•ˆæœ 1234567891011121314127.0.0.1:7000&gt; info replication# Replicationrole:masterconnected_slaves:1slave0:ip=127.0.0.1,port=7004,state=online,offset=1026,lag=1master_replid:2c2851db4bea0ea2f9d93d60a065e868112c47d7master_replid2:0000000000000000000000000000000000000000master_repl_offset:1026second_repl_offset:-1repl_backlog_active:1repl_backlog_size:1048576repl_backlog_first_byte_offset:1repl_backlog_histlen:1026127.0.0.1:7000&gt; è¾“å…¥å‘½ä»¤cluster nodes 1234567127.0.0.1:7000&gt; cluster nodesc58e7d40e34251897af3bee6bc6edd7a500f9fa6 127.0.0.1:7005@17005 slave 3a7ac96a39a41b395d5459eeac1f17d1f6fd96d7 0 1596391181092 6 connected71e898b018d1775214a431bd22b3408b055dbb62 127.0.0.1:7003@17003 slave 5a191a63e8c2f5dbe945451bca0552426d6e9260 0 1596391182096 4 connected60335b82c5348215c0dbbbac5b65c769f6668e4e 127.0.0.1:7000@17000 myself,master - 0 1596391181000 1 connected 0-54605a191a63e8c2f5dbe945451bca0552426d6e9260 127.0.0.1:7002@17002 master - 0 1596391183102 3 connected 10923-163839cae9ebf31a03c09a82281dcb629aac418e22831 127.0.0.1:7004@17004 slave 60335b82c5348215c0dbbbac5b65c769f6668e4e 0 1596391182000 5 connected3a7ac96a39a41b395d5459eeac1f17d1f6fd96d7 127.0.0.1:7001@17001 master - 0 1596391182598 2 connected 5461-10922 æ¯ä¸ªRedisçš„èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªIDå€¼ï¼Œæ­¤IDå°†è¢«æ­¤ç‰¹å®šrediså®ä¾‹æ°¸ä¹…ä½¿ç”¨ï¼Œä»¥ä¾¿å®ä¾‹åœ¨é›†ç¾¤ä¸Šä¸‹æ–‡ä¸­å…·æœ‰å”¯ä¸€çš„åç§°ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½éƒ½ä¼šè®°ä½ä½¿ç”¨æ­¤IDçš„æ¯ä¸ªå…¶ä»–èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯é€šè¿‡IPæˆ–ç«¯å£å·ã€‚IPåœ°å€å’Œç«¯å£å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†å”¯ä¸€çš„èŠ‚ç‚¹æ ‡è¯†ç¬¦åœ¨èŠ‚ç‚¹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éƒ½ä¸ä¼šæ”¹å˜ã€‚æˆ‘ä»¬ç®€å•ç§°è¿™ä¸ªæ ‡è¯†ç¬¦ä¸ºèŠ‚ç‚¹IDã€‚ 21.4 Redisæ€»ç»“ç®€ä»‹ï¼š redis cluster ä¸ºäº†ä¿è¯æ•°æ®çš„é«˜å¯ç”¨æ€§ï¼ŒåŠ å…¥äº†ä¸»ä»æ¨¡å¼ï¼Œä¸€ä¸ªèŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æä¾›æ•°æ®å­˜å–ï¼Œä»èŠ‚ç‚¹åˆ™æ˜¯ä»ä¸»èŠ‚ç‚¹æ‹‰å»æ•°æ®å¤‡ä»½ï¼Œå½“è¿™ä¸ªä¸»èŠ‚ç‚¹æŒ‚æ‰åï¼Œå°±ä¼šæœ‰è¿™ä¸ªä»èŠ‚ç‚¹é€‰å–ä¸€ä¸ªæ¥å……å½“ä¸»èŠ‚ç‚¹ï¼Œä»è€Œä¿è¯é›†ç¾¤ä¸ä¼šæŒ‚æ‰ã€‚ é›†ç¾¤æœ‰ABCä¸‰ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¦‚æœè¿™3ä¸ªå‡ ç‚¹éƒ½æ²¡æœ‰åŠ å…¥ä»èŠ‚ç‚¹ï¼Œå¦‚æœBæŒ‚æ‰äº†ï¼Œæˆ‘ä»¬å°±æ— æ³•è®¿é—®æ•´ä¸ªé›†ç¾¤äº†ã€‚Aå’ŒCçš„slotä¹Ÿæ— æ³•è®¿é—®ã€‚ æ‰€ä»¥æˆ‘ä»¬é›†ç¾¤å»ºç«‹çš„æ—¶å€™ï¼Œä¸€å®šè…°å›´æ¯ä¸ªä¸»èŠ‚ç‚¹éƒ½æ·»åŠ ä¸€ä¸ªä»èŠ‚ç‚¹ï¼Œæ¯”å¦‚åƒè¿™æ ·ï¼Œé›†ç¾¤åŒ…å«ä¸»èŠ‚ç‚¹A,B,C ä»¥åŠä»èŠ‚ç‚¹A1,B1,C1ï¼Œé‚£ä¹ˆåŠæ—¶BæŒ‚æ‰ç³»ç»Ÿä¹Ÿå¯ä»¥ç»§ç»­æ­£ç¡®å·¥ä½œã€‚ B1èŠ‚ç‚¹ä»£æ›¿äº†BèŠ‚ç‚¹ï¼Œæ‰€æœ‰Redisé›†ç¾¤å°†ä¼šé€‰æ‹©B1èŠ‚ç‚¹ä½œä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œé›†ç¾¤å°†ä¼šç»§ç»­æ­£ç¡®çš„æä¾›æœåŠ¡ã€‚å½“Bé‡æ–°å¼€å¯åï¼Œå®ƒå°±å˜æˆB1çš„ä»èŠ‚ç‚¹ã€‚ ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œå¦‚æœå‡ ç‚¹Bå’ŒB1åŒæ—¶æŒ‚æ‰ï¼ŒRedisé›†ç¾¤å°±æ— æ³•ç»§ç»­æ­£ç¡®çš„æä¾›æœåŠ¡äº†ã€‚ 21.5 å…³é—­é›†ç¾¤åœ¨/root/apps/redis_cluster ç›®å½•ä¸‹ç¼–å†™è„šæœ¬æ–‡ä»¶ ï¼š vim shutdowm.sh å†…å®¹å¦‚ä¸‹ï¼š 1234567/root/apps/redis_cluster/src/redis-cli -c -h 127.0.0.1 -p 7000 -a redis shutdown/root/apps/redis_cluster/src/redis-cli -c -h 127.0.0.1 -p 7001 -a redis shutdown/root/apps/redis_cluster/src/redis-cli -c -h 127.0.0.1 -p 7002 -a redis shutdown/root/apps/redis_cluster/src/redis-cli -c -h 127.0.0.1 -p 7003 -a redis shutdown/root/apps/redis_cluster/src/redis-cli -c -h 127.0.0.1 -p 7004 -a redis shutdown/root/apps/redis_cluster/src/redis-cli -c -h 127.0.0.1 -p 7005 -a redis shutdown 12345chmod u+x shutdown.sh :ç„¶åæ‰§è¡Œå°†shutdown.shå˜æˆå¯æ‰§è¡Œæ–‡ä»¶./shutdown.sh :åœ¨å½“å‰ç›®å½•ä¸‹å¯åŠ¨æŸ¥çœ‹ï¼š ps aux | grep rediså®˜æ–¹ï¼š/usr/local/redis_cluster/redis-cli -a xxx -c -h 192.168.5.100 -p 8001æç¤ºï¼š-a ï¼šè®¿é—®æœåŠ¡ç«¯å¯†ç  ï¼Œ -c è¡¨ç¤ºé›†ç¾¤æ¨¡å¼ ï¼Œ -hæŒ‡å®šipåœ°å€ ï¼Œ-pæŒ‡å®šç«¯å£å· 123456/root/apps/redis_cluster/src/redis-service ./70000/redis.conf/root/apps/redis_cluster/src/redis-service ./70001/redis.conf/root/apps/redis_cluster/src/redis-service ./70002/redis.conf/root/apps/redis_cluster/src/redis-service ./70003/redis.conf/root/apps/redis_cluster/src/redis-service ./70004/redis.conf/root/apps/redis_cluster/src/redis-service ./70005/redis.conf 12chmod u+x redisinstall.sh :ç„¶åæ‰§è¡Œå°†redisinstall.shå˜æˆå¯æ‰§è¡Œæ–‡ä»¶./redisinstall.sh äºŒåäºŒã€Redisä¸­çš„æ‹“å±•22.1 Redisä¸ºä»€ä¹ˆå•çº¿ç¨‹è¿˜è¿™ä¹ˆå¿«1ã€è¯¯åŒº1ï¼šé«˜æ€§èƒ½çš„æœåŠ¡å™¨ä¸€å®šæ˜¯å¤šçº¿ç¨‹çš„ï¼Ÿ 2ã€è¯¯åŒº2ï¼šå¤šçº¿ç¨‹ï¼ˆCUPä¸Šä¸‹æ–‡ä¼šåˆ‡æ¢ï¼ï¼‰ä¸€å®šæ¯”å•çº¿ç¨‹æ•ˆç‡é«˜ï¼ å…ˆå»CPU&gt;å†…å­˜&gt;ç¡¬ç›˜çš„é€Ÿåº¦è¦æœ‰æ‰€äº†è§£ï¼ æ ¸å¿ƒï¼šredisæ˜¯å°†æ‰€æœ‰çš„æ•°æ®å…¨éƒ¨æ”¾åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥è¯´ä½¿ç”¨å•çº¿ç¨‹å»ç‚’ä½œæ•ˆç‡å°±æ˜¯æœ€é«˜çš„ã€‚ å¤šçº¿ç§°ï¼ˆCUPä¸Šä¸‹æ–‡åˆ‡æ¢ï¼šè€—æ—¶ï¼ï¼ï¼ï¼‰ï¼Œå¯¹äºå†…å­˜æ¥è¯´ï¼Œå¦‚æœæ²¡æœ‰ä¸Šä¸‹æ–‡åˆ‡æ¢æ•ˆç‡å°±æ˜¯æœ€é«˜çš„ã€‚å¯¹æ­¤è¯»å†™å°±æ˜¯åœ¨CUPä¸Šæ‰€ä»¥Redis çš„é€Ÿåº¦æ˜¯éå¸¸ å¿«çš„ã€‚ äºŒåä¸‰ã€é‡æ–°é…ç½®RedisTemplate1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package com.yux.redisdemo.redis; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.data.redis.connection.RedisConnectionFactory; import org.springframework.data.redis.core.RedisTemplate; import org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer; import org.springframework.data.redis.serializer.StringRedisSerializer; import com.fasterxml.jackson.annotation.JsonAutoDetect; import com.fasterxml.jackson.annotation.PropertyAccessor; import com.fasterxml.jackson.databind.ObjectMapper; /**15 * redisé…ç½®ç±»16 * @author YUX17 * @date 2018å¹´6æœˆ6æ—¥18 *19 */ @Configurationpublic class RedisConfig &#123; @Bean @SuppressWarnings(&quot;all&quot;) public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) &#123; RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;String, Object&gt;(); template.setConnectionFactory(factory); Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class); ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(om); StringRedisSerializer stringRedisSerializer = new StringRedisSerializer(); // keyé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setKeySerializer(stringRedisSerializer); // hashçš„keyä¹Ÿé‡‡ç”¨Stringçš„åºåˆ—åŒ–æ–¹å¼ template.setHashKeySerializer(stringRedisSerializer); // valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson template.setValueSerializer(jackson2JsonRedisSerializer); // hashçš„valueåºåˆ—åŒ–æ–¹å¼é‡‡ç”¨jackson template.setHashValueSerializer(jackson2JsonRedisSerializer); template.afterPropertiesSet(); return template; &#125; &#125; äºŒåå››ã€é‡æ–°ç¼–å†™RedisUtils123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569570571572573574575576577578579580581582583584585586587588589590591592593594595596597598599600601602603604605606607608609610611612613614615616617618619620621622623624625626627628629630631632633634635636637638639640641642643644645646647648649650651652653654655656657658659660661662663664665666667668669670671672673674675676677678679680681682683684685686687688689690691692693694695696697698699700701702703704705706707708709710711712713714715716717718719720721722723724725726727728729730731732733734735736737738739740741742743744745746747748749750751752753754package com.yux.redisdemo.redis;import java.util.List; import java.util.Map;import java.util.Set;import java.util.concurrent.TimeUnit; import org.springframework.beans.factory.annotation.Autowired;import org.springframework.data.redis.core.RedisTemplate; import org.springframework.stereotype.Component; import org.springframework.util.CollectionUtils;/**14 * Rediså·¥å…·ç±»15 * @author YUX16 * @date 2018å¹´6æœˆ7æ—¥17 */ @Componentpublic final class RedisUtil &#123; @Autowired private RedisTemplate&lt;String, Object&gt; redisTemplate; // =============================common============================ /** * 26 * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´ * 27 * * @param key é”® * 28 * @param time æ—¶é—´(ç§’) * 29 * @return 30 */ public boolean expire(String key, long time) &#123; try &#123; if (time &gt; 0) &#123; redisTemplate.expire(key, time, TimeUnit.SECONDS); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 44 * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´ * 45 * * @param key é”® ä¸èƒ½ä¸ºnull * 46 * @return æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ * 47 */ public long getExpire(String key) &#123; return redisTemplate.getExpire(key, TimeUnit.SECONDS); &#125; /** * 53 * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨ * 54 * * @param key é”® * 55 * @return true å­˜åœ¨ falseä¸å­˜åœ¨ * 56 */ public boolean hasKey(String key) &#123; try &#123; return redisTemplate.hasKey(key); &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 67 * åˆ é™¤ç¼“å­˜ * 68 * * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª * 69 */ @SuppressWarnings(&quot;unchecked&quot;) public void del(String... key) &#123; if (key != null &amp;&amp; key.length &gt; 0) &#123; if (key.length == 1) &#123; redisTemplate.delete(key[0]); &#125; else &#123; redisTemplate.delete(CollectionUtils.arrayToList(key)); &#125; &#125; &#125; // ============================String============================= /** * 83 * æ™®é€šç¼“å­˜è·å– * 84 * * @param key é”® * 85 * @return å€¼ * 86 */ public Object get(String key) &#123; return key == null ? null : redisTemplate.opsForValue().get(key); &#125; /** * 92 * æ™®é€šç¼“å­˜æ”¾å…¥ * 93 * * @param key é”® * 94 * @param value å€¼ * 95 * @return trueæˆåŠŸ falseå¤±è´¥ * 96 */ public boolean set(String key, Object value) &#123; try &#123; redisTemplate.opsForValue().set(key, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 109 * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´ * 110 * * @param key é”® * 111 * @param value å€¼ * 112 * @param time æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ * 113 * @return trueæˆåŠŸ false å¤±è´¥ * 114 */ public boolean set(String key, Object value, long time) &#123; try &#123; if (time &gt; 0) &#123; redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS); &#125; else &#123; set(key, value); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 130 * é€’å¢ * 131 * * @param key é”® * 132 * @param delta è¦å¢åŠ å‡ (å¤§äº0) * 133 * @return 134 */ public long incr(String key, long delta) &#123; if (delta &lt; 0) &#123; throw new RuntimeException(&quot;é€’å¢å› å­å¿…é¡»å¤§äº0&quot;); &#125; return redisTemplate.opsForValue().increment(key, delta); &#125; /** * 143 * é€’å‡ * 144 * * @param key é”® * 145 * @param delta è¦å‡å°‘å‡ (å°äº0) * 146 * @return 147 */ public long decr(String key, long delta) &#123; if (delta &lt; 0) &#123; throw new RuntimeException(&quot;é€’å‡å› å­å¿…é¡»å¤§äº0&quot;); &#125; return redisTemplate.opsForValue().increment(key, -delta); &#125; // ================================Map================================= /** * 157 * HashGet * 158 * * @param key é”® ä¸èƒ½ä¸ºnull * 159 * @param item é¡¹ ä¸èƒ½ä¸ºnull * 160 * @return å€¼ * 161 */ public Object hget(String key, String item) &#123; return redisTemplate.opsForHash().get(key, item); &#125; /** * 167 * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼ * 168 * * @param key é”® * 169 * @return å¯¹åº”çš„å¤šä¸ªé”®å€¼ * 170 */ public Map&lt;Object, Object&gt; hmget(String key) &#123; return redisTemplate.opsForHash().entries(key); &#125; /** * 176 * HashSet * 177 * * @param key é”® * 178 * @param map å¯¹åº”å¤šä¸ªé”®å€¼ * 179 * @return true æˆåŠŸ false å¤±è´¥ * 180 */ public boolean hmset(String key, Map&lt;String, Object&gt; map) &#123; try &#123; redisTemplate.opsForHash().putAll(key, map); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 192 * HashSet å¹¶è®¾ç½®æ—¶é—´ * 193 * * @param key é”® * 194 * @param map å¯¹åº”å¤šä¸ªé”®å€¼ * 195 * @param time æ—¶é—´(ç§’) * 196 * @return trueæˆåŠŸ falseå¤±è´¥ * 197 */ public boolean hmset(String key, Map&lt;String, Object&gt; map, long time) &#123; try &#123; redisTemplate.opsForHash().putAll(key, map); if (time &gt; 0) &#123; expire(key, time); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 212 * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º * 213 * * @param key é”® * 214 * @param item é¡¹ * 215 * @param value å€¼ * 216 * @return true æˆåŠŸ falseå¤±è´¥ * 217 */ public boolean hset(String key, String item, Object value) &#123; try &#123; redisTemplate.opsForHash().put(key, item, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 229 * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º * 230 * * @param key é”® * 231 * @param item é¡¹ * 232 * @param value å€¼ * 233 * @param time æ—¶é—´(ç§’) æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´ * 234 * @return true æˆåŠŸ falseå¤±è´¥ * 235 */ public boolean hset(String key, String item, Object value, long time) &#123; try &#123; redisTemplate.opsForHash().put(key, item, value); if (time &gt; 0) &#123; expire(key, time); &#125; return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false &#125; &#125; /** * 250 * åˆ é™¤hashè¡¨ä¸­çš„å€¼ * 251 * * @param key é”® ä¸èƒ½ä¸ºnull * 252 * @param item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull * 253 */ public void hdel(String key, Object... item) &#123; redisTemplate.opsForHash().delete(key, item); &#125; /** * 259 * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼ * 260 * * @param key é”® ä¸èƒ½ä¸ºnull * 261 * @param item é¡¹ ä¸èƒ½ä¸ºnull * 262 * @return true å­˜åœ¨ falseä¸å­˜åœ¨ * 263 */ public boolean hHasKey(String key, String item) &#123; return redisTemplate.opsForHash().hasKey(key, item); &#125; /** * 269 * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å› * 270 * * @param key é”® * 271 * @param item é¡¹ * 272 * @param by è¦å¢åŠ å‡ (å¤§äº0) * 273 * @return 274 */ public double hincr(String key, String item, double by) &#123; return redisTemplate.opsForHash().increment(key, item, by); &#125; /** * 280 * hashé€’å‡ * 281 * * @param key é”® * 282 * @param item é¡¹ * 283 * @param by è¦å‡å°‘è®°(å°äº0) * 284 * @return 285 */ public double hdecr(String key, String item, double by) &#123; return redisTemplate.opsForHash().increment(key, item, -by); &#125; // ============================set============================= /** * 292 * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼ * 293 * * @param key é”® * 294 * @return 295 */ public Set&lt;Object&gt; sGet(String key) &#123; try &#123; return redisTemplate.opsForSet().members(key); &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * 306 * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨ * 307 * * @param key é”® * 308 * @param value å€¼ * 309 * @return true å­˜åœ¨ falseä¸å­˜åœ¨ * 310 */ public boolean sHasKey(String key, Object value) &#123; try &#123; return redisTemplate.opsForSet().isMember(key, value); &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 321 * å°†æ•°æ®æ”¾å…¥setç¼“å­˜ * 322 * * @param key é”® * 323 * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * 324 * @return æˆåŠŸä¸ªæ•° * 325 */ public long sSet(String key, Object... values) &#123; try &#123; return redisTemplate.opsForSet().add(key, values); &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * 336 * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜ * 337 * * @param key é”® * 338 * @param time æ—¶é—´(ç§’) * 339 * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * 340 * @return æˆåŠŸä¸ªæ•° * 341 */ public long sSetAndTime(String key, long time, Object... values) &#123; try &#123; Long count = redisTemplate.opsForSet().add(key, values); if (time &gt; 0) expire(key, time); return count; &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * 355 * è·å–setç¼“å­˜çš„é•¿åº¦ * 356 * * @param key é”® * 357 * @return 358 */ public long sGetSetSize(String key) &#123; try &#123; return redisTemplate.opsForSet().size(key); &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * 369 * ç§»é™¤å€¼ä¸ºvalueçš„ * 370 * * @param key é”® * 371 * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª * 372 * @return ç§»é™¤çš„ä¸ªæ•° * 373 */ public long setRemove(String key, Object... values) &#123; try &#123; Long count = redisTemplate.opsForSet().remove(key, values); return count; &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; // ===============================list================================= /** * 386 * è·å–listç¼“å­˜çš„å†…å®¹ * 387 * * @param key é”® * 388 * @param start å¼€å§‹ * 389 * @param end ç»“æŸ 0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼ * 390 * @return 391 */ public List&lt;Object&gt; lGet(String key, long start, long end) try &#123; return redisTemplate.opsForList().range(key, start, end); &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * 402 * è·å–listç¼“å­˜çš„é•¿åº¦ * 403 * * @param key é”® * 404 * @return 405 */ public long lGetListSize(String key) &#123; try &#123; return redisTemplate.opsForList().size(key); &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125; /** * 416 * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼ * 417 * * @param key é”® * 418 * @param index ç´¢å¼• index&gt;=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index&lt;0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ * 419 * @return 420 */ public Object lGetIndex(String key, long index) &#123; try &#123; return redisTemplate.opsForList().index(key, index); &#125; catch (Exception e) &#123; e.printStackTrace(); return null; &#125; &#125; /** * 431 * å°†listæ”¾å…¥ç¼“å­˜ * 432 * * @param key é”® * 433 * @param value å€¼ * 434 * @param time æ—¶é—´(ç§’) * 435 * @return 436 */ public boolean lSet(String key, Object value) &#123; try &#123; redisTemplate.opsForList().rightPush(key, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * å°†listæ”¾å…¥ç¼“å­˜ * * @param key é”® * @param value å€¼ * @param time æ—¶é—´(ç§’) * @return */ public boolean lSet(String key, Object value, long time) &#123; try &#123; redisTemplate.opsForList().rightPush(key, value); if (time &gt; 0) expire(key, time); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 467 * å°†listæ”¾å…¥ç¼“å­˜ * 468 * * @param key é”® * 469 * @param value å€¼ * 470 * @param time æ—¶é—´(ç§’) * 471 * @return 472 */ public boolean lSet(String key, List&lt;Object&gt; value) &#123; try &#123; redisTemplate.opsForList().rightPushAll(key, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 484 * å°†listæ”¾å…¥ç¼“å­˜ * 485 * &lt;p&gt; * 486 * * @param key é”® * 487 * @param value å€¼ * 488 * @param time æ—¶é—´(ç§’) * 489 * @return 490 */ public boolean lSet(String key, List&lt;Object&gt; value, long time) &#123; try &#123; redisTemplate.opsForList().rightPushAll(key, value); if (time &gt; 0) expire(key, time); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 504 * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ® * 505 * * @param key é”® * 506 * @param index ç´¢å¼• * 507 * @param value å€¼ * 508 * @return 509 */ public boolean lUpdateIndex(String key, long index, Object value) &#123; try &#123; redisTemplate.opsForList().set(key, index, value); return true; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; &#125; /** * 521 * ç§»é™¤Nä¸ªå€¼ä¸ºvalue * 522 * * @param key é”® * 523 * @param count ç§»é™¤å¤šå°‘ä¸ª * 524 * @param value å€¼ * 525 * @return ç§»é™¤çš„ä¸ªæ•° * 526 */ public long lRemove(String key, long count, Object value) &#123; try &#123; Long remove = redisTemplate.opsForList().remove(key, count, value); return remove; &#125; catch (Exception e) &#123; e.printStackTrace(); return 0; &#125; &#125;&#125; äºŒåäº”ã€å“¨å…µæ¨¡å¼25.1 è‡ªåŠ¨é€‰ä¸¾masterçš„æ¨¡å¼ä¸»ä»åˆ‡æ¢çš„æŠ€æœ¯æ–¹å¼æ˜¯ï¼šå½“ä¸»æœºå®•æœºä¹‹åï¼Œéœ€è¦æ‰‹åŠ¨æŠŠä¸€å°æœåŠ¡å™¨åˆ‡æ¢ä¸ºä¸»æœºæœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦äººå·¥å¹²é¢„ï¼Œè´¹æ—¶è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¿™æ˜¯ä¸€ç§ä¸æ¨èçš„æ–¹å¼ï¼Œæ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è€ƒè™‘ä½¿ç”¨å“¨å…µæ¨¡å¼ã€‚redisä¸­2.8ä¹‹åæä¾›äº†å“¨å…µæ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ å“¨å…µæ¨¡å¼æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ¨¡å¼ï¼Œé¦–å…ˆredisæä¾›å“¨å…µå‘½ä»¤ï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹ï¼Œå®ƒä¼šç‹¬ç«‹è¿è¡Œã€‚å…¶åŸç†æ˜¯å“¨å…µåŒè¿‡å‘é€å‘½ä»¤ï¼Œç­‰å¾…redis æœåŠ¡å™¨å“åº”ï¼Œä»è€Œç›‘æ§è¿è¡Œçš„å¤šä¸ªrediså®ä¾‹ã€‚ è¿™é‡Œçš„å“¨å…µæœ‰ä¸¤ä¸ªä½œç”¨ï¼š é€šè¿‡å‘é€å‘½ä»¤ï¼Œè®©redisæœåŠ¡å™¨è¿”å›ç›‘æ§å…¶è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ã€‚ å½“å“¨å…µæ£€æµ‹åˆ°masterå®•æœºï¼Œä¼šè‡ªåŠ¨å°†slaveåˆ‡æ¢æˆä¸ºmasterï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šçŸ¥å…¶ä»–çš„æœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®©å¥¹ä»¬åˆ‡æ¢ä¸»æœºã€‚ ç„¶è€Œä¸€ä¸ªå“¨å…µè¿›ç¨‹å¯¹RedisæœåŠ¡å™¨è¿›è¡Œç›‘æ§å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªå“¨å…µè¿›è¡Œç›‘æ§ã€‚å„ä¸ªå“¨å…µä¹‹é—´è¿˜ä¼šè¿›è¡Œç›‘æ§ï¼Œè¿™æ ·å°±å½¢æˆäº†å¤šå“¨å…µæ¨¡å¼ã€‚ å‡è®¾ä¸»æœåŠ¡å®•æœºï¼Œå“¨å…µ1å…ˆæ£€æµ‹åˆ°è¿™ä¸ªç»“æœï¼Œç³»ç»Ÿå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œfailoverè¿‡ç¨‹ï¼Œä»…ä»…æ˜¯å“¨å…µ1ä¸»ç®¡çš„è®¤ä¸ºæœåŠ¡å™¨ä¸å¯ç”¨ï¼Œè¿™ä¸ªç°è±¡ç§°ä¸ºä¸»è§‚ä¸‹çº¿ã€‚å½“åé¢çš„å“¨å…µä¹Ÿæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œå¹¶ä¸”æ•°é‡è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œé‚£ä¹ˆå“¨å…µä¹‹é—´å°±ä¼šè¿›è¡Œä¸€ä¾§æŠ•ç¥¨ï¼ŒæŠ•ç¥¨çš„ç»“æœç”±ä¸€ä¸ªå“¨å…µå‘èµ·ï¼Œè¿›è¡Œfailover[æ•…éšœè½¬ç§»]æ“ä½œã€‚åˆ‡æ¢æˆåŠŸåï¼Œå°±ä¼šé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè®©å“¥å“¥å“¨å…µæŠŠè‡ªå·±ç›‘æ§çš„æœåŠ¡å™¨å®ç°åˆ‡æ¢ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå¯è§‚ä¸‹çº¿ã€‚ æˆ‘ä»¬ç›®å‰çš„è£…å¡«æ˜¯ä¸€ä¸»äºŒä»ï¼ 1ã€é…ç½®å“¨å…µé…ç½®æ–‡ä»¶sentinel.conf 12# sentinel monitor è¢«ç›‘æ§çš„åç§°host port 1sentinel monitor myredis 127.0.0.1 6379 1 å€™å‘½çš„è¿™ä¸ªæ•°å­—1ï¼Œä»£è¡¨ä¸»æœºæŒ‚äº†ï¼ŒslaveæŠ•ç¥¨çœ‹è®©è°é˜¶æ¢¯ç§°ä¸ºä¸»æœºï¼Œç¥¨æ•°æœ€å¤šçš„ï¼Œå°±ä¼šç§°ä¸ºä¸»æœºï¼ 1redis-sentinel bin/sentinel.conf ä¼˜ç‚¹ï¼š å“¨å…µé›†ç¾¤ï¼ŒåŸºäºä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œæ‰€æœ‰çš„ä¸»ä»é…ç½®ä¼˜ç‚¹ï¼Œå®ƒå…¨æœ‰ ä¸»ä»å¯ä»¥åˆ‡æ¢ï¼Œæ•…éšœå¯ä»¥è½¬ç§»ï¼Œç³»ç»Ÿçš„å¯ç”¨æ€§å°±ä¼šæ›´å¥½ å“¨å…µæ¨¡å¼å°±æ˜¯ä¸»ä»æ¨¡å¼çš„å‡çº§ä¹°æ‰‹åŠ¨åˆ°è‡ªåŠ¨ï¼Œæ›´åŠ å¥å£®ï¼ ç¼ºç‚¹ ï¼š redisä¸å¥½åœ¨çº¿æ‰©å®¹ï¼Œé›†ç¾¤å®¹é‡ä¸€æ—¦è¾¾åˆ°ä¸Šé™ï¼Œåœ¨å‘æ‰©å®¹å°±ååˆ†éº»çƒ¦ï¼ å®ç°å“¨å…µæ¨¡å¼çš„é…ç½®å…¶å®æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œé‡Œé¢æœ‰å¾ˆå¤šé€‰æ‹©ï¼ åŸè§†é¢‘åœ°å€ åŸæ–‡ç« åœ°å€","categories":[{"name":"Redis","slug":"Redis","permalink":"https://lwy0518.github.io/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://lwy0518.github.io/tags/Redis/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://lwy0518.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"lwy"},{"title":"kubernetesç›¸å…³çŸ¥è¯†","slug":"kubernetesç›¸å…³çŸ¥è¯†","date":"2022-02-12T13:34:24.000Z","updated":"2022-02-13T13:49:40.714Z","comments":true,"path":"2022/02/12/kubernetesç›¸å…³çŸ¥è¯†/","link":"","permalink":"https://lwy0518.github.io/2022/02/12/kubernetes%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/","excerpt":"ç›®å½•","text":"ç›®å½• Kubernetesè¯¦ç»†æ•™ç¨‹1. Kubernetesä»‹ç»1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ä¸Šï¼Œä¸»è¦ç»å†äº†ä¸‰ä¸ªæ—¶ä»£ï¼š ä¼ ç»Ÿéƒ¨ç½²ï¼šäº’è”ç½‘æ—©æœŸï¼Œä¼šç›´æ¥å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ç‰©ç†æœºä¸Š ä¼˜ç‚¹ï¼šç®€å•ï¼Œä¸éœ€è¦å…¶å®ƒæŠ€æœ¯çš„å‚ä¸ ç¼ºç‚¹ï¼šä¸èƒ½ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰èµ„æºä½¿ç”¨è¾¹ç•Œï¼Œå¾ˆéš¾åˆç†åœ°åˆ†é…è®¡ç®—èµ„æºï¼Œè€Œä¸”ç¨‹åºä¹‹é—´å®¹æ˜“äº§ç”Ÿå½±å“ è™šæ‹ŸåŒ–éƒ¨ç½²ï¼šå¯ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªç¯å¢ƒ ä¼˜ç‚¹ï¼šç¨‹åºç¯å¢ƒä¸ä¼šç›¸äº’äº§ç”Ÿå½±å“ï¼Œæä¾›äº†ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§ ç¼ºç‚¹ï¼šå¢åŠ äº†æ“ä½œç³»ç»Ÿï¼Œæµªè´¹äº†éƒ¨åˆ†èµ„æº å®¹å™¨åŒ–éƒ¨ç½²ï¼šä¸è™šæ‹ŸåŒ–ç±»ä¼¼ï¼Œä½†æ˜¯å…±äº«äº†æ“ä½œç³»ç»Ÿ ä¼˜ç‚¹ï¼š å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰ è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„èµ„æºéƒ½è¢«å®¹å™¨åŒ…è£…ï¼Œå¹¶å’Œåº•å±‚åŸºç¡€æ¶æ„è§£è€¦ å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºå¯ä»¥è·¨äº‘æœåŠ¡å•†ã€è·¨Linuxæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆè¿›è¡Œéƒ¨ç½² å®¹å™¨åŒ–éƒ¨ç½²æ–¹å¼ç»™å¸¦æ¥å¾ˆå¤šçš„ä¾¿åˆ©ï¼Œä½†æ˜¯ä¹Ÿä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼š ä¸€ä¸ªå®¹å™¨æ•…éšœåœæœºäº†ï¼Œæ€ä¹ˆæ ·è®©å¦å¤–ä¸€ä¸ªå®¹å™¨ç«‹åˆ»å¯åŠ¨å»æ›¿è¡¥åœæœºçš„å®¹å™¨ å½“å¹¶å‘è®¿é—®é‡å˜å¤§çš„æ—¶å€™ï¼Œæ€ä¹ˆæ ·åšåˆ°æ¨ªå‘æ‰©å±•å®¹å™¨æ•°é‡ è¿™äº›å®¹å™¨ç®¡ç†çš„é—®é¢˜ç»Ÿç§°ä¸ºå®¹å™¨ç¼–æ’é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›å®¹å™¨ç¼–æ’é—®é¢˜ï¼Œå°±äº§ç”Ÿäº†ä¸€äº›å®¹å™¨ç¼–æ’çš„è½¯ä»¶ï¼š Swarmï¼šDockerè‡ªå·±çš„å®¹å™¨ç¼–æ’å·¥å…· Mesosï¼šApacheçš„ä¸€ä¸ªèµ„æºç»Ÿä¸€ç®¡æ§çš„å·¥å…·ï¼Œéœ€è¦å’ŒMarathonç»“åˆä½¿ç”¨ Kubernetesï¼šGoogleå¼€æºçš„çš„å®¹å™¨ç¼–æ’å·¥å…· 1.2 kubernetesç®€ä»‹ kubernetesï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„åŸºäºå®¹å™¨æŠ€æœ¯çš„åˆ†å¸ƒå¼æ¶æ„é¢†å…ˆæ–¹æ¡ˆï¼Œæ˜¯è°·æ­Œä¸¥æ ¼ä¿å¯†åå‡ å¹´çš„ç§˜å¯†æ­¦å™¨â€”-Borgç³»ç»Ÿçš„ä¸€ä¸ªå¼€æºç‰ˆæœ¬ï¼Œäº2014å¹´9æœˆå‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œ2015å¹´7æœˆå‘å¸ƒç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ã€‚ kubernetesçš„æœ¬è´¨æ˜¯ä¸€ç»„æœåŠ¡å™¨é›†ç¾¤ï¼Œå®ƒå¯ä»¥åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç‰¹å®šçš„ç¨‹åºï¼Œæ¥å¯¹èŠ‚ç‚¹ä¸­çš„å®¹å™¨è¿›è¡Œç®¡ç†ã€‚ç›®çš„æ˜¯å®ç°èµ„æºç®¡ç†çš„è‡ªåŠ¨åŒ–ï¼Œä¸»è¦æä¾›äº†å¦‚ä¸‹çš„ä¸»è¦åŠŸèƒ½ï¼š è‡ªæˆ‘ä¿®å¤ï¼šä¸€æ—¦æŸä¸€ä¸ªå®¹å™¨å´©æºƒï¼Œèƒ½å¤Ÿåœ¨1ç§’ä¸­å·¦å³è¿…é€Ÿå¯åŠ¨æ–°çš„å®¹å™¨ å¼¹æ€§ä¼¸ç¼©ï¼šå¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªåŠ¨å¯¹é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ•°é‡è¿›è¡Œè°ƒæ•´ æœåŠ¡å‘ç°ï¼šæœåŠ¡å¯ä»¥é€šè¿‡è‡ªåŠ¨å‘ç°çš„å½¢å¼æ‰¾åˆ°å®ƒæ‰€ä¾èµ–çš„æœåŠ¡ è´Ÿè½½å‡è¡¡ï¼šå¦‚æœä¸€ä¸ªæœåŠ¡èµ·åŠ¨äº†å¤šä¸ªå®¹å™¨ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡ ç‰ˆæœ¬å›é€€ï¼šå¦‚æœå‘ç°æ–°å‘å¸ƒçš„ç¨‹åºç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›é€€åˆ°åŸæ¥çš„ç‰ˆæœ¬ å­˜å‚¨ç¼–æ’ï¼šå¯ä»¥æ ¹æ®å®¹å™¨è‡ªèº«çš„éœ€æ±‚è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å· 1.3 kubernetesç»„ä»¶ä¸€ä¸ªkubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±**æ§åˆ¶èŠ‚ç‚¹(master)ã€å·¥ä½œèŠ‚ç‚¹(node)**æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚ masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† ) ApiServer : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶ Scheduler : è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„nodeèŠ‚ç‚¹ä¸Š ControllerManager : è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ Etcd ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯ nodeï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ( å¹²æ´» ) Kubelet : è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶dockerï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨ KubeProxy : è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ Docker : è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ ä¸‹é¢ï¼Œä»¥éƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡æ¥è¯´æ˜kubernetesç³»ç»Ÿå„ä¸ªç»„ä»¶è°ƒç”¨å…³ç³»ï¼š é¦–å…ˆè¦æ˜ç¡®ï¼Œä¸€æ—¦kubernetesç¯å¢ƒå¯åŠ¨ä¹‹åï¼Œmasterå’Œnodeéƒ½ä¼šå°†è‡ªèº«çš„ä¿¡æ¯å­˜å‚¨åˆ°etcdæ•°æ®åº“ä¸­ ä¸€ä¸ªnginxæœåŠ¡çš„å®‰è£…è¯·æ±‚ä¼šé¦–å…ˆè¢«å‘é€åˆ°masterèŠ‚ç‚¹çš„apiServerç»„ä»¶ apiServerç»„ä»¶ä¼šè°ƒç”¨schedulerç»„ä»¶æ¥å†³å®šåˆ°åº•åº”è¯¥æŠŠè¿™ä¸ªæœåŠ¡å®‰è£…åˆ°å“ªä¸ªnodeèŠ‚ç‚¹ä¸Š åœ¨æ­¤æ—¶ï¼Œå®ƒä¼šä»etcdä¸­è¯»å–å„ä¸ªnodeèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥apiServer apiServerè°ƒç”¨controller-managerå»è°ƒåº¦NodeèŠ‚ç‚¹å®‰è£…nginxæœåŠ¡ kubeletæ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šé€šçŸ¥dockerï¼Œç„¶åç”±dockeræ¥å¯åŠ¨ä¸€ä¸ªnginxçš„pod podæ˜¯kubernetesçš„æœ€å°æ“ä½œå•å…ƒï¼Œå®¹å™¨å¿…é¡»è·‘åœ¨podä¸­è‡³æ­¤ï¼Œ ä¸€ä¸ªnginxæœåŠ¡å°±è¿è¡Œäº†ï¼Œå¦‚æœéœ€è¦è®¿é—®nginxï¼Œå°±éœ€è¦é€šè¿‡kube-proxyæ¥å¯¹podäº§ç”Ÿè®¿é—®çš„ä»£ç† è¿™æ ·ï¼Œå¤–ç•Œç”¨æˆ·å°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„nginxæœåŠ¡äº† 1.4 kubernetesæ¦‚å¿µMasterï¼šé›†ç¾¤æ§åˆ¶èŠ‚ç‚¹ï¼Œæ¯ä¸ªé›†ç¾¤éœ€è¦è‡³å°‘ä¸€ä¸ªmasterèŠ‚ç‚¹è´Ÿè´£é›†ç¾¤çš„ç®¡æ§ Nodeï¼šå·¥ä½œè´Ÿè½½èŠ‚ç‚¹ï¼Œç”±masteråˆ†é…å®¹å™¨åˆ°è¿™äº›nodeå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œç„¶ånodeèŠ‚ç‚¹ä¸Šçš„dockerè´Ÿè´£å®¹å™¨çš„è¿è¡Œ Podï¼škubernetesçš„æœ€å°æ§åˆ¶å•å…ƒï¼Œå®¹å™¨éƒ½æ˜¯è¿è¡Œåœ¨podä¸­çš„ï¼Œä¸€ä¸ªpodä¸­å¯ä»¥æœ‰1ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ Controllerï¼šæ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒæ¥å®ç°å¯¹podçš„ç®¡ç†ï¼Œæ¯”å¦‚å¯åŠ¨podã€åœæ­¢podã€ä¼¸ç¼©podçš„æ•°é‡ç­‰ç­‰ Serviceï¼špodå¯¹å¤–æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œä¸‹é¢å¯ä»¥ç»´æŠ¤è€…åŒä¸€ç±»çš„å¤šä¸ªpod Labelï¼šæ ‡ç­¾ï¼Œç”¨äºå¯¹podè¿›è¡Œåˆ†ç±»ï¼ŒåŒä¸€ç±»podä¼šæ‹¥æœ‰ç›¸åŒçš„æ ‡ç­¾ NameSpaceï¼šå‘½åç©ºé—´ï¼Œç”¨æ¥éš”ç¦»podçš„è¿è¡Œç¯å¢ƒ 2. kubernetesé›†ç¾¤ç¯å¢ƒæ­å»º2.1 å‰ç½®çŸ¥è¯†ç‚¹ç›®å‰ç”Ÿäº§éƒ¨ç½²Kubernetes é›†ç¾¤ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š kubeadm Kubeadm æ˜¯ä¸€ä¸ªK8s éƒ¨ç½²å·¥å…·ï¼Œæä¾›kubeadm init å’Œkubeadm joinï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½²Kubernetes é›†ç¾¤ã€‚ å®˜æ–¹åœ°å€ï¼šhttps://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/ äºŒè¿›åˆ¶åŒ… ä»github ä¸‹è½½å‘è¡Œç‰ˆçš„äºŒè¿›åˆ¶åŒ…ï¼Œæ‰‹åŠ¨éƒ¨ç½²æ¯ä¸ªç»„ä»¶ï¼Œç»„æˆKubernetes é›†ç¾¤ã€‚ Kubeadm é™ä½éƒ¨ç½²é—¨æ§›ï¼Œä½†å±è”½äº†å¾ˆå¤šç»†èŠ‚ï¼Œé‡åˆ°é—®é¢˜å¾ˆéš¾æ’æŸ¥ã€‚å¦‚æœæƒ³æ›´å®¹æ˜“å¯æ§ï¼Œæ¨èä½¿ç”¨äºŒè¿›åˆ¶åŒ…éƒ¨ç½²Kubernetes é›†ç¾¤ï¼Œè™½ç„¶æ‰‹åŠ¨éƒ¨ç½²éº»çƒ¦ç‚¹ï¼ŒæœŸé—´å¯ä»¥å­¦ä¹ å¾ˆå¤šå·¥ä½œåŸç†ï¼Œä¹Ÿåˆ©äºåæœŸç»´æŠ¤ã€‚ 2.2 kubeadm éƒ¨ç½²æ–¹å¼ä»‹ç»kubeadm æ˜¯å®˜æ–¹ç¤¾åŒºæ¨å‡ºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½²kubernetes é›†ç¾¤çš„å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·èƒ½é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®Œæˆä¸€ä¸ªkubernetes é›†ç¾¤çš„éƒ¨ç½²ï¼š åˆ›å»ºä¸€ä¸ªMaster èŠ‚ç‚¹kubeadm init å°†Node èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ä¸­$ kubeadm join &lt;Master èŠ‚ç‚¹çš„IP å’Œç«¯å£&gt; 2.3 å®‰è£…è¦æ±‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œéƒ¨ç½²Kubernetes é›†ç¾¤æœºå™¨éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š ä¸€å°æˆ–å¤šå°æœºå™¨ï¼Œæ“ä½œç³»ç»ŸCentOS7.x-86_x64 ç¡¬ä»¶é…ç½®ï¼š2GB æˆ–æ›´å¤šRAMï¼Œ2 ä¸ªCPU æˆ–æ›´å¤šCPUï¼Œç¡¬ç›˜30GB æˆ–æ›´å¤š é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¹‹é—´ç½‘ç»œäº’é€š å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒ ç¦æ­¢swap åˆ†åŒº 2.4 æœ€ç»ˆç›®æ ‡ åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…Docker å’Œkubeadm éƒ¨ç½²Kubernetes Master éƒ¨ç½²å®¹å™¨ç½‘ç»œæ’ä»¶ éƒ¨ç½²Kubernetes Nodeï¼Œå°†èŠ‚ç‚¹åŠ å…¥Kubernetes é›†ç¾¤ä¸­ éƒ¨ç½²Dashboard Web é¡µé¢ï¼Œå¯è§†åŒ–æŸ¥çœ‹Kubernetes èµ„æº 2.5 å‡†å¤‡ç¯å¢ƒ è§’è‰² IPåœ°å€ ç»„ä»¶ master01 192.168.5.3 dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet node01 192.168.5.4 dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet node02 192.168.5.5 dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet 2.6 ç¯å¢ƒåˆå§‹åŒ–2.6.1 æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬123# æ­¤æ–¹å¼ä¸‹å®‰è£…kubernetesé›†ç¾¤è¦æ±‚Centosç‰ˆæœ¬è¦åœ¨7.5æˆ–ä¹‹ä¸Š[root@master ~]# cat /etc/redhat-releaseCentos Linux 7.5.1804 (Core) 2.6.2 ä¸»æœºåè§£æä¸ºäº†æ–¹ä¾¿é›†ç¾¤èŠ‚ç‚¹é—´çš„ç›´æ¥è°ƒç”¨ï¼Œåœ¨è¿™ä¸ªé…ç½®ä¸€ä¸‹ä¸»æœºåè§£æï¼Œä¼ä¸šä¸­æ¨èä½¿ç”¨å†…éƒ¨DNSæœåŠ¡å™¨ 1234# ä¸»æœºåæˆè§£æ ç¼–è¾‘ä¸‰å°æœåŠ¡å™¨çš„/etc/hostsæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢å†…å®¹192.168.90.100 master192.168.90.106 node1192.168.90.107 node2 2.6.3 æ—¶é—´åŒæ­¥kubernetesè¦æ±‚é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ—¶é—´å¿…é¡»ç²¾ç¡®ä¸€ç›´ï¼Œè¿™é‡Œä½¿ç”¨chronydæœåŠ¡ä»ç½‘ç»œåŒæ­¥æ—¶é—´ ä¼ä¸šä¸­å»ºè®®é…ç½®å†…éƒ¨çš„ä¼šè§åŒæ­¥æœåŠ¡å™¨ 1234# å¯åŠ¨chronydæœåŠ¡[root@master ~]# systemctl start chronyd[root@master ~]# systemctl enable chronyd[root@master ~]# date 2.6.4 ç¦ç”¨iptableå’ŒfirewalldæœåŠ¡kuberneteså’Œdocker åœ¨è¿è¡Œçš„ä¸­ä¼šäº§ç”Ÿå¤§é‡çš„iptablesè§„åˆ™ï¼Œä¸ºäº†ä¸è®©ç³»ç»Ÿè§„åˆ™è·Ÿå®ƒä»¬æ··æ·†ï¼Œç›´æ¥å…³é—­ç³»ç»Ÿçš„è§„åˆ™ 123456# 1 å…³é—­firewalldæœåŠ¡[root@master ~]# systemctl stop firewalld[root@master ~]# systemctl disable firewalld# 2 å…³é—­iptablesæœåŠ¡[root@master ~]# systemctl stop iptables[root@master ~]# systemctl disable iptables 2.6.5 ç¦ç”¨selinuxselinuxæ˜¯linuxç³»ç»Ÿä¸‹çš„ä¸€ä¸ªå®‰å…¨æœåŠ¡ï¼Œå¦‚æœä¸å…³é—­å®ƒï¼Œåœ¨å®‰è£…é›†ç¾¤ä¸­ä¼šäº§ç”Ÿå„ç§å„æ ·çš„å¥‡è‘©é—®é¢˜ 123# ç¼–è¾‘ /etc/selinux/config æ–‡ä»¶ï¼Œä¿®æ”¹SELINUXçš„å€¼ä¸ºdisable# æ³¨æ„ä¿®æ”¹å®Œæ¯•ä¹‹åéœ€è¦é‡å¯linuxæœåŠ¡SELINUX=disabled 2.6.6 ç¦ç”¨swapåˆ†åŒºswapåˆ†åŒºæŒ‡çš„æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯ç‰©ç†å†…å­˜ä½¿ç”¨å®Œï¼Œä¹‹åå°†ç£ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜æ¥ä½¿ç”¨ï¼Œå¯ç”¨swapè®¾å¤‡ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿéå¸¸è´Ÿé¢çš„å½±å“ï¼Œå› æ­¤kubernetesè¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç¦ç”¨swapè®¾å¤‡ï¼Œä½†æ˜¯å¦‚æœå› ä¸ºæŸäº›åŸå› ç¡®å®ä¸èƒ½å…³é—­swapåˆ†åŒºï¼Œå°±éœ€è¦åœ¨é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡æ˜ç¡®çš„å‚æ•°è¿›è¡Œé…ç½®è¯´æ˜ 12345# ç¼–è¾‘åˆ†åŒºé…ç½®æ–‡ä»¶/etc/fstabï¼Œæ³¨é‡Šæ‰swapåˆ†åŒºä¸€è¡Œ# æ³¨æ„ä¿®æ”¹å®Œæ¯•ä¹‹åéœ€è¦é‡å¯linuxæœåŠ¡vim /etc/fstabæ³¨é‡Šæ‰ /dev/mapper/centos-swap swap# /dev/mapper/centos-swap swap 2.6.7 ä¿®æ”¹linuxçš„å†…æ ¸å‚æ•°123456789101112# ä¿®æ”¹linuxçš„å†…æ ¸é‡‡çº³æ•°ï¼Œæ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½# ç¼–è¾‘/etc/sysctl.d/kubernetes.confæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼šnet.bridge.bridge-nf-call-ip6tables = 1net.bridge.bridge-nf-call-iptables = 1net.ipv4.ip_forward = 1# é‡æ–°åŠ è½½é…ç½®[root@master ~]# sysctl -p# åŠ è½½ç½‘æ¡¥è¿‡æ»¤æ¨¡å—[root@master ~]# modprobe br_netfilter# æŸ¥çœ‹ç½‘æ¡¥è¿‡æ»¤æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ[root@master ~]# lsmod | grep br_netfilter 2.6.8 é…ç½®ipvsåŠŸèƒ½åœ¨Kubernetesä¸­Serviceæœ‰ä¸¤ç§å¸¦æ¥æ¨¡å‹ï¼Œä¸€ç§æ˜¯åŸºäºiptablesçš„ï¼Œä¸€ç§æ˜¯åŸºäºipvsçš„ä¸¤è€…æ¯”è¾ƒçš„è¯ï¼Œipvsçš„æ€§èƒ½æ˜æ˜¾è¦é«˜ä¸€äº›ï¼Œä½†æ˜¯å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥ipvsæ¨¡å— 1234567891011121314151617# 1.å®‰è£…ipsetå’Œipvsadm[root@master ~]# yum install ipset ipvsadmin -y# 2.æ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—å†™å…¥è„šæœ¬æ–‡ä»¶[root@master ~]# cat &lt;&lt;EOF&gt; /etc/sysconfig/modules/ipvs.modules#!/bin/bashmodprobe -- ip_vsmodprobe -- ip_vs_rrmodprobe -- ip_vs_wrrmodprobe -- ip_vs_shmodprobe -- nf_conntrack_ipv4EOF# 3.ä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™[root@master ~]# chmod +x /etc/sysconfig/modules/ipvs.modules# 4.æ‰§è¡Œè„šæœ¬æ–‡ä»¶[root@master ~]# /bin/bash /etc/sysconfig/modules/ipvs.modules# 5.æŸ¥çœ‹å¯¹åº”çš„æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ[root@master ~]# lsmod | grep -e ip_vs -e nf_conntrack_ipv4 2.6.9 å®‰è£…docker1234567891011121314151617181920212223# 1ã€åˆ‡æ¢é•œåƒæº[root@master ~]# wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo# 2ã€æŸ¥çœ‹å½“å‰é•œåƒæºä¸­æ”¯æŒçš„dockerç‰ˆæœ¬[root@master ~]# yum list docker-ce --showduplicates# 3ã€å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„docker-ce# å¿…é¡»åˆ¶å®š--setopt=obsoletes=0ï¼Œå¦åˆ™yumä¼šè‡ªåŠ¨å®‰è£…æ›´é«˜ç‰ˆæœ¬[root@master ~]# yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 -y# 4ã€æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶#Docker åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨Vgroup Driverä¸ºcgroupfsï¼Œè€ŒKubernetesæ¨èä½¿ç”¨systemdæ¥æ›¿ä»£cgroupfs[root@master ~]# mkdir /etc/docker[root@master ~]# cat &lt;&lt;EOF&gt; /etc/docker/daemon.json&#123; &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;], &quot;registry-mirrors&quot;: [&quot;https://kn0t2bca.mirror.aliyuncs.com&quot;]&#125;EOF# 5ã€å¯åŠ¨dokcer[root@master ~]# systemctl restart docker[root@master ~]# systemctl enable docker 2.6.10 å®‰è£…Kubernetesç»„ä»¶123456789101112131415161718192021# 1ã€ç”±äºkubernetesçš„é•œåƒåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™é‡Œåˆ‡æ¢æˆå›½å†…çš„é•œåƒæº# 2ã€ç¼–è¾‘/etc/yum.repos.d/kubernetes.repo,æ·»åŠ ä¸‹é¢çš„é…ç½®[kubernetes]name=Kubernetesbaseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64enabled=1gpgchech=0repo_gpgcheck=0gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg# 3ã€å®‰è£…kubeadmã€kubeletå’Œkubectl[root@master ~]# yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y# 4ã€é…ç½®kubeletçš„cgroup#ç¼–è¾‘/etc/sysconfig/kubelet, æ·»åŠ ä¸‹é¢çš„é…ç½®KUBELET_CGROUP_ARGS=&quot;--cgroup-driver=systemd&quot;KUBE_PROXY_MODE=&quot;ipvs&quot;# 5ã€è®¾ç½®kubeletå¼€æœºè‡ªå¯[root@master ~]# systemctl enable kubelet 2.6.11 å‡†å¤‡é›†ç¾¤é•œåƒ123456789101112131415161718192021# åœ¨å®‰è£…kubernetesé›†ç¾¤ä¹‹å‰ï¼Œå¿…é¡»è¦æå‰å‡†å¤‡å¥½é›†ç¾¤éœ€è¦çš„é•œåƒï¼Œæ‰€éœ€é•œåƒå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹[root@master ~]# kubeadm config images list# ä¸‹è½½é•œåƒ# æ­¤é•œåƒkubernetesçš„ä»“åº“ä¸­ï¼Œç”±äºç½‘ç»œåŸå› ï¼Œæ— æ³•è¿æ¥ï¼Œä¸‹é¢æä¾›äº†ä¸€ç§æ›¿æ¢æ–¹æ¡ˆimages=( kube-apiserver:v1.17.4 kube-controller-manager:v1.17.4 kube-scheduler:v1.17.4 kube-proxy:v1.17.4 pause:3.1 etcd:3.4.3-0 coredns:1.6.5)for imageName in $&#123;images[@]&#125;;do docker pull registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName docker tag registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName k8s.gcr.io/$imageName docker rmi registry.cn-hangzhou.aliyuncs.com/google_containers/$imageName done 2.6.11 é›†ç¾¤åˆå§‹åŒ– ä¸‹é¢çš„æ“ä½œåªéœ€è¦åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œå³å¯ 1234567891011# åˆ›å»ºé›†ç¾¤[root@master ~]# kubeadm init \\ --apiserver-advertise-address=192.168.90.100 \\ --image-repository registry.aliyuncs.com/google_containers \\ --kubernetes-version=v1.17.4 \\ --service-cidr=10.96.0.0/12 \\ --pod-network-cidr=10.244.0.0/16# åˆ›å»ºå¿…è¦æ–‡ä»¶[root@master ~]# mkdir -p $HOME/.kube[root@master ~]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config[root@master ~]# sudo chown $(id -u):$(id -g) $HOME/.kube/config ä¸‹é¢çš„æ“ä½œåªéœ€è¦åœ¨nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œå³å¯ 12kubeadm join 192.168.0.100:6443 --token awk15p.t6bamck54w69u4s8 \\ --discovery-token-ca-cert-hash sha256:a94fa09562466d32d29523ab6cff122186f1127599fa4dcd5fa0152694f17117 åœ¨masterä¸ŠæŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ 12345[root@master ~]# kubectl get nodesNAME STATUS ROLES AGE VERSIONmaster NotReady master 6m v1.17.4node1 NotReady &lt;none&gt; 22s v1.17.4node2 NotReady &lt;none&gt; 19s v1.17.4 2.6.13 å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œåªåœ¨masterèŠ‚ç‚¹æ“ä½œå³å¯1wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml ç”±äºå¤–ç½‘ä¸å¥½è®¿é—®ï¼Œå¦‚æœå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸‹é¢çš„ è®°å¾—æ–‡ä»¶åæ˜¯kube-flannel.ymlï¼Œä½ç½®ï¼š/root/kube-flannel.ymlå†…å®¹ï¼š 1https://github.com/flannel-io/flannel/tree/master/Documentation/kube-flannel.yml ![æˆªå±2021-10-01 ä¸‹åˆ10.23.00](images/æˆªå±2021-10-01 ä¸‹åˆ10.23.00.png) 2.6.14 ä½¿ç”¨kubeadm reseté‡ç½®é›†ç¾¤12345678910111213141516#åœ¨masterèŠ‚ç‚¹ä¹‹å¤–çš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œkubeadm resetsystemctl stop kubeletsystemctl stop dockerrm -rf /var/lib/cni/rm -rf /var/lib/kubelet/*rm -rf /etc/cni/ifconfig cni0 downifconfig flannel.1 downifconfig docker0 downip link delete cni0ip link delete flannel.1##é‡å¯kubeletsystemctl restart kubelet##é‡å¯dockersystemctl restart docker 2.6.15 é‡å¯kubeletå’Œdocker1234# é‡å¯kubeletsystemctl restart kubelet# é‡å¯dockersystemctl restart docker ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨fannel 1kubectl apply -f kube-flannel.yml ç­‰å¾…å®ƒå®‰è£…å®Œæ¯• å‘ç°å·²ç»æ˜¯ é›†ç¾¤çš„çŠ¶æ€å·²ç»æ˜¯Ready 2.6.16 kubeadmä¸­çš„å‘½ä»¤12# ç”Ÿæˆ æ–°çš„token[root@master ~]# kubeadm token create --print-join-command 2.7 é›†ç¾¤æµ‹è¯•2.7.1 åˆ›å»ºä¸€ä¸ªnginxæœåŠ¡1kubectl create deployment nginx --image=nginx:1.14-alpine 2.7.2 æš´éœ²ç«¯å£1kubectl expose deploy nginx --port=80 --target-port=80 --type=NodePort 2.7.3 æŸ¥çœ‹æœåŠ¡1kubectl get pod,svc 2.7.4 æŸ¥çœ‹pod æµè§ˆå™¨æµ‹è¯•ç»“æœï¼š 3. èµ„æºç®¡ç†3.1 èµ„æºç®¡ç†ä»‹ç»åœ¨kubernetesä¸­ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œç”¨æˆ·éœ€è¦é€šè¿‡æ“ä½œèµ„æºæ¥ç®¡ç†kubernetesã€‚ kubernetesçš„æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å„ç§æœåŠ¡ï¼Œæ‰€è°“çš„éƒ¨ç½²æœåŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨kubernetesé›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªä¸ªçš„å®¹å™¨ï¼Œå¹¶å°†æŒ‡å®šçš„ç¨‹åºè·‘åœ¨å®¹å™¨ä¸­ã€‚ kubernetesçš„æœ€å°ç®¡ç†å•å…ƒæ˜¯podè€Œä¸æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥åªèƒ½å°†å®¹å™¨æ”¾åœ¨Podä¸­ï¼Œè€Œkubernetesä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ç®¡ç†Podï¼Œè€Œæ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥ç®¡ç†Podçš„ã€‚ Podå¯ä»¥æä¾›æœåŠ¡ä¹‹åï¼Œå°±è¦è€ƒè™‘å¦‚ä½•è®¿é—®Podä¸­æœåŠ¡ï¼Œkubernetesæä¾›äº†Serviceèµ„æºå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚ å½“ç„¶ï¼Œå¦‚æœPodä¸­ç¨‹åºçš„æ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œkubernetesè¿˜æä¾›äº†å„ç§å­˜å‚¨ç³»ç»Ÿã€‚ å­¦ä¹ kubernetesçš„æ ¸å¿ƒï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•å¯¹é›†ç¾¤ä¸Šçš„Podã€Podæ§åˆ¶å™¨ã€Serviceã€å­˜å‚¨ç­‰å„ç§èµ„æºè¿›è¡Œæ“ä½œ 3.2 YAMLè¯­è¨€ä»‹ç»YAMLæ˜¯ä¸€ä¸ªç±»ä¼¼ XMLã€JSON çš„æ ‡è®°æ€§è¯­è¨€ã€‚å®ƒå¼ºè°ƒä»¥æ•°æ®ä¸ºä¸­å¿ƒï¼Œå¹¶ä¸æ˜¯ä»¥æ ‡è¯†è¯­è¨€ä¸ºé‡ç‚¹ã€‚å› è€ŒYAMLæœ¬èº«çš„å®šä¹‰æ¯”è¾ƒç®€å•ï¼Œå·ç§°â€ä¸€ç§äººæ€§åŒ–çš„æ•°æ®æ ¼å¼è¯­è¨€â€ã€‚ 1234&lt;heima&gt; &lt;age&gt;15&lt;/age&gt; &lt;address&gt;Beijing&lt;/address&gt;&lt;/heima&gt; 123heima: age: 15 address: Beijing YAMLçš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªï¼š å¤§å°å†™æ•æ„Ÿ ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³» ç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼( ä½ç‰ˆæœ¬é™åˆ¶ ) ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯ â€˜#â€™è¡¨ç¤ºæ³¨é‡Š YAMLæ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š çº¯é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼ å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/ å“ˆå¸Œï¼ˆhashï¼‰ / å­—å…¸ï¼ˆdictionaryï¼‰ æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ / åˆ—è¡¨ï¼ˆlistï¼‰ 1234567891011121314151617# çº¯é‡, å°±æ˜¯æŒ‡çš„ä¸€ä¸ªç®€å•çš„å€¼ï¼Œå­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€Nullã€æ—¶é—´ã€æ—¥æœŸ# 1 å¸ƒå°”ç±»å‹c1: true (æˆ–è€…True)# 2 æ•´å‹c2: 234# 3 æµ®ç‚¹å‹c3: 3.14# 4 nullç±»å‹ c4: ~ # ä½¿ç”¨~è¡¨ç¤ºnull# 5 æ—¥æœŸç±»å‹c5: 2018-02-17 # æ—¥æœŸå¿…é¡»ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œå³yyyy-MM-dd# 6 æ—¶é—´ç±»å‹c6: 2018-02-17T15:02:31+08:00 # æ—¶é—´ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œæ—¶é—´å’Œæ—¥æœŸä¹‹é—´ä½¿ç”¨Tè¿æ¥ï¼Œæœ€åä½¿ç”¨+ä»£è¡¨æ—¶åŒº# 7 å­—ç¬¦ä¸²ç±»å‹c7: heima # ç®€å•å†™æ³•ï¼Œç›´æ¥å†™å€¼ , å¦‚æœå­—ç¬¦ä¸²ä¸­é—´æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æˆ–è€…å•å¼•å·åŒ…è£¹ c8: line1 line2 # å­—ç¬¦ä¸²è¿‡å¤šçš„æƒ…å†µå¯ä»¥æ‹†æˆå¤šè¡Œï¼Œæ¯ä¸€è¡Œä¼šè¢«è½¬åŒ–æˆä¸€ä¸ªç©ºæ ¼ 1234567# å¯¹è±¡# å½¢å¼ä¸€(æ¨è):heima: age: 15 address: Beijing# å½¢å¼äºŒ(äº†è§£):heima: &#123;age: 15,address: Beijing&#125; 1234567# æ•°ç»„# å½¢å¼ä¸€(æ¨è):address: - é¡ºä¹‰ - æ˜Œå¹³ # å½¢å¼äºŒ(äº†è§£):address: [é¡ºä¹‰,æ˜Œå¹³] å°æç¤ºï¼š 1 ä¹¦å†™yamlåˆ‡è®°: åé¢è¦åŠ ä¸€ä¸ªç©ºæ ¼ 2 å¦‚æœéœ€è¦å°†å¤šæ®µyamlé…ç½®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸­é—´è¦ä½¿ç”¨---åˆ†éš” 3 ä¸‹é¢æ˜¯ä¸€ä¸ªyamlè½¬jsonçš„ç½‘ç«™ï¼Œå¯ä»¥é€šè¿‡å®ƒéªŒè¯yamlæ˜¯å¦ä¹¦å†™æ­£ç¡® https://www.json2yaml.com/convert-yaml-to-json 3.3 èµ„æºç®¡ç†æ–¹å¼ å‘½ä»¤å¼å¯¹è±¡ç®¡ç†ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤å»æ“ä½œkubernetesèµ„æº 1kubectl run nginx-pod --image=nginx:1.17.1 --port=80 å‘½ä»¤å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡å‘½ä»¤é…ç½®å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº 1kubectl create/patch -f nginx-pod.yaml å£°æ˜å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡applyå‘½ä»¤å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº 1kubectl apply -f nginx-pod.yaml ç±»å‹ æ“ä½œå¯¹è±¡ é€‚ç”¨ç¯å¢ƒ ä¼˜ç‚¹ ç¼ºç‚¹ å‘½ä»¤å¼å¯¹è±¡ç®¡ç† å¯¹è±¡ æµ‹è¯• ç®€å• åªèƒ½æ“ä½œæ´»åŠ¨å¯¹è±¡ï¼Œæ— æ³•å®¡è®¡ã€è·Ÿè¸ª å‘½ä»¤å¼å¯¹è±¡é…ç½® æ–‡ä»¶ å¼€å‘ å¯ä»¥å®¡è®¡ã€è·Ÿè¸ª é¡¹ç›®å¤§æ—¶ï¼Œé…ç½®æ–‡ä»¶å¤šï¼Œæ“ä½œéº»çƒ¦ å£°æ˜å¼å¯¹è±¡é…ç½® ç›®å½• å¼€å‘ æ”¯æŒç›®å½•æ“ä½œ æ„å¤–æƒ…å†µä¸‹éš¾ä»¥è°ƒè¯• 3.3.1 å‘½ä»¤å¼å¯¹è±¡ç®¡ç†kubectlå‘½ä»¤ kubectlæ˜¯kubernetesé›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…éƒ¨ç½²ã€‚kubectlå‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š 1kubectl [command] [type] [name] [flags] comandï¼šæŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚createã€getã€delete typeï¼šæŒ‡å®šèµ„æºç±»å‹ï¼Œæ¯”å¦‚deploymentã€podã€service nameï¼šæŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ flagsï¼šæŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•° 12345678# æŸ¥çœ‹æ‰€æœ‰podkubectl get pod # æŸ¥çœ‹æŸä¸ªpodkubectl get pod pod_name# æŸ¥çœ‹æŸä¸ªpod,ä»¥yamlæ ¼å¼å±•ç¤ºç»“æœkubectl get pod pod_name -o yaml èµ„æºç±»å‹ kubernetesä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹: 1kubectl api-resources ç»å¸¸ä½¿ç”¨çš„èµ„æºæœ‰ä¸‹é¢è¿™äº›ï¼š èµ„æºåˆ†ç±» èµ„æºåç§° ç¼©å†™ èµ„æºä½œç”¨ é›†ç¾¤çº§åˆ«èµ„æº nodes no é›†ç¾¤ç»„æˆéƒ¨åˆ† namespaces ns éš”ç¦»Pod podèµ„æº pods po è£…è½½å®¹å™¨ podèµ„æºæ§åˆ¶å™¨ replicationcontrollers rc æ§åˆ¶podèµ„æº replicasets rs æ§åˆ¶podèµ„æº deployments deploy æ§åˆ¶podèµ„æº daemonsets ds æ§åˆ¶podèµ„æº jobs æ§åˆ¶podèµ„æº cronjobs cj æ§åˆ¶podèµ„æº horizontalpodautoscalers hpa æ§åˆ¶podèµ„æº statefulsets sts æ§åˆ¶podèµ„æº æœåŠ¡å‘ç°èµ„æº services svc ç»Ÿä¸€podå¯¹å¤–æ¥å£ ingress ing ç»Ÿä¸€podå¯¹å¤–æ¥å£ å­˜å‚¨èµ„æº volumeattachments å­˜å‚¨ persistentvolumes pv å­˜å‚¨ persistentvolumeclaims pvc å­˜å‚¨ é…ç½®èµ„æº configmaps cm é…ç½® secrets é…ç½® æ“ä½œ kuberneteså…è®¸å¯¹èµ„æºè¿›è¡Œå¤šç§æ“ä½œï¼Œå¯ä»¥é€šè¿‡â€“helpæŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤ 1kubectl --help ç»å¸¸ä½¿ç”¨çš„æ“ä½œæœ‰ä¸‹é¢è¿™äº›ï¼š å‘½ä»¤åˆ†ç±» å‘½ä»¤ ç¿»è¯‘ å‘½ä»¤ä½œç”¨ åŸºæœ¬å‘½ä»¤ create åˆ›å»º åˆ›å»ºä¸€ä¸ªèµ„æº edit ç¼–è¾‘ ç¼–è¾‘ä¸€ä¸ªèµ„æº get è·å– è·å–ä¸€ä¸ªèµ„æº patch æ›´æ–° æ›´æ–°ä¸€ä¸ªèµ„æº delete åˆ é™¤ åˆ é™¤ä¸€ä¸ªèµ„æº explain è§£é‡Š å±•ç¤ºèµ„æºæ–‡æ¡£ è¿è¡Œå’Œè°ƒè¯• run è¿è¡Œ åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ expose æš´éœ² æš´éœ²èµ„æºä¸ºService describe æè¿° æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯ logs æ—¥å¿—è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿— è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿— attach ç¼ ç»•è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨ exec æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤ æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤ cp å¤åˆ¶ åœ¨Podå†…å¤–å¤åˆ¶æ–‡ä»¶ rollout é¦–æ¬¡å±•ç¤º ç®¡ç†èµ„æºçš„å‘å¸ƒ scale è§„æ¨¡ æ‰©(ç¼©)å®¹Podçš„æ•°é‡ autoscale è‡ªåŠ¨è°ƒæ•´ è‡ªåŠ¨è°ƒæ•´Podçš„æ•°é‡ é«˜çº§å‘½ä»¤ apply rc é€šè¿‡æ–‡ä»¶å¯¹èµ„æºè¿›è¡Œé…ç½® label æ ‡ç­¾ æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾ å…¶ä»–å‘½ä»¤ cluster-info é›†ç¾¤ä¿¡æ¯ æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯ version ç‰ˆæœ¬ æ˜¾ç¤ºå½“å‰Serverå’ŒClientçš„ç‰ˆæœ¬ ä¸‹é¢ä»¥ä¸€ä¸ªnamespace / podçš„åˆ›å»ºå’Œåˆ é™¤ç®€å•æ¼”ç¤ºä¸‹å‘½ä»¤çš„ä½¿ç”¨ï¼š 123456789101112131415161718192021222324252627282930# åˆ›å»ºä¸€ä¸ªnamespace[root@master ~]# kubectl create namespace devnamespace/dev created# è·å–namespace[root@master ~]# kubectl get nsNAME STATUS AGEdefault Active 21hdev Active 21skube-node-lease Active 21hkube-public Active 21hkube-system Active 21h# åœ¨æ­¤namespaceä¸‹åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªnginxçš„Pod[root@master ~]# kubectl run pod --image=nginx:latest -n devkubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.deployment.apps/pod created# æŸ¥çœ‹æ–°åˆ›å»ºçš„pod[root@master ~]# kubectl get pod -n devNAME READY STATUS RESTARTS AGEpod 1/1 Running 0 21s# åˆ é™¤æŒ‡å®šçš„pod[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7xpod &quot;pod&quot; deleted# åˆ é™¤æŒ‡å®šçš„namespace[root@master ~]# kubectl delete ns devnamespace &quot;dev&quot; deleted 3.3.2 å‘½ä»¤å¼å¯¹è±¡é…ç½®å‘½ä»¤å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨å‘½ä»¤é…åˆé…ç½®æ–‡ä»¶ä¸€èµ·æ¥æ“ä½œkubernetesèµ„æºã€‚ 1ï¼‰ åˆ›å»ºä¸€ä¸ªnginxpod.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516apiVersion: v1kind: Namespacemetadata: name: dev---apiVersion: v1kind: Podmetadata: name: nginxpod namespace: devspec: containers: - name: nginx-containers image: nginx:latest 2ï¼‰æ‰§è¡Œcreateå‘½ä»¤ï¼Œåˆ›å»ºèµ„æºï¼š 123[root@master ~]# kubectl create -f nginxpod.yamlnamespace/dev createdpod/nginxpod created æ­¤æ—¶å‘ç°åˆ›å»ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯namespaceå’Œpod 3ï¼‰æ‰§è¡Œgetå‘½ä»¤ï¼ŒæŸ¥çœ‹èµ„æºï¼š 123456[root@master ~]# kubectl get -f nginxpod.yamlNAME STATUS AGEnamespace/dev Active 18sNAME READY STATUS RESTARTS AGEpod/nginxpod 1/1 Running 0 17s è¿™æ ·å°±æ˜¾ç¤ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡çš„ä¿¡æ¯ 4ï¼‰æ‰§è¡Œdeleteå‘½ä»¤ï¼Œåˆ é™¤èµ„æºï¼š 123[root@master ~]# kubectl delete -f nginxpod.yamlnamespace &quot;dev&quot; deletedpod &quot;nginxpod&quot; deleted æ­¤æ—¶å‘ç°ä¸¤ä¸ªèµ„æºå¯¹è±¡è¢«åˆ é™¤äº† 12æ€»ç»“: å‘½ä»¤å¼å¯¹è±¡é…ç½®çš„æ–¹å¼æ“ä½œèµ„æºï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºï¼šå‘½ä»¤ + yamlé…ç½®æ–‡ä»¶ï¼ˆé‡Œé¢æ˜¯å‘½ä»¤éœ€è¦çš„å„ç§å‚æ•°ï¼‰ 3.3.3 å£°æ˜å¼å¯¹è±¡é…ç½®å£°æ˜å¼å¯¹è±¡é…ç½®è·Ÿå‘½ä»¤å¼å¯¹è±¡é…ç½®å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤applyã€‚ 123456789# é¦–å…ˆæ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°åˆ›å»ºäº†èµ„æº[root@master ~]# kubectl apply -f nginxpod.yamlnamespace/dev createdpod/nginxpod created# å†æ¬¡æ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°è¯´èµ„æºæ²¡æœ‰å˜åŠ¨[root@master ~]# kubectl apply -f nginxpod.yamlnamespace/dev unchangedpod/nginxpod unchanged 12345æ€»ç»“: å…¶å®å£°æ˜å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨applyæè¿°ä¸€ä¸ªèµ„æºæœ€ç»ˆçš„çŠ¶æ€ï¼ˆåœ¨yamlä¸­å®šä¹‰çŠ¶æ€ï¼‰ ä½¿ç”¨applyæ“ä½œèµ„æºï¼š å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºï¼Œç›¸å½“äº kubectl create å¦‚æœèµ„æºå·²å­˜åœ¨ï¼Œå°±æ›´æ–°ï¼Œç›¸å½“äº kubectl patch æ‰©å±•ï¼škubectlå¯ä»¥åœ¨nodeèŠ‚ç‚¹ä¸Šè¿è¡Œå— ? kubectlçš„è¿è¡Œæ˜¯éœ€è¦è¿›è¡Œé…ç½®çš„ï¼Œå®ƒçš„é…ç½®æ–‡ä»¶æ˜¯$HOME/.kubeï¼Œå¦‚æœæƒ³è¦åœ¨nodeèŠ‚ç‚¹è¿è¡Œæ­¤å‘½ä»¤ï¼Œéœ€è¦å°†masterä¸Šçš„.kubeæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹ä¸Šï¼Œå³åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸‹é¢æ“ä½œï¼š 1scp -r HOME/.kube node1: HOME/ ä½¿ç”¨æ¨è: ä¸‰ç§æ–¹å¼åº”è¯¥æ€ä¹ˆç”¨ ? åˆ›å»º/æ›´æ–°èµ„æº ä½¿ç”¨å£°æ˜å¼å¯¹è±¡é…ç½® kubectl apply -f XXX.yaml åˆ é™¤èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡é…ç½® kubectl delete -f XXX.yaml æŸ¥è¯¢èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡ç®¡ç† kubectl get(describe) èµ„æºåç§° 4. å®æˆ˜å…¥é—¨æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•åœ¨kubernetesé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚ 4.1 NamespaceNamespaceæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç°å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»æˆ–è€…å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œkubernetesé›†ç¾¤ä¸­çš„æ‰€æœ‰çš„Podéƒ½æ˜¯å¯ä»¥ç›¸äº’è®¿é—®çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œå¯èƒ½ä¸æƒ³è®©ä¸¤ä¸ªPodä¹‹é—´è¿›è¡Œäº’ç›¸çš„è®¿é—®ï¼Œé‚£æ­¤æ—¶å°±å¯ä»¥å°†ä¸¤ä¸ªPodåˆ’åˆ†åˆ°ä¸åŒçš„namespaceä¸‹ã€‚kubernetesé€šè¿‡å°†é›†ç¾¤å†…éƒ¨çš„èµ„æºåˆ†é…åˆ°ä¸åŒçš„Namespaceä¸­ï¼Œå¯ä»¥å½¢æˆé€»è¾‘ä¸Šçš„â€ç»„â€ï¼Œä»¥æ–¹ä¾¿ä¸åŒçš„ç»„çš„èµ„æºè¿›è¡Œéš”ç¦»ä½¿ç”¨å’Œç®¡ç†ã€‚ å¯ä»¥é€šè¿‡kubernetesçš„æˆæƒæœºåˆ¶ï¼Œå°†ä¸åŒçš„namespaceäº¤ç»™ä¸åŒç§Ÿæˆ·è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±å®ç°äº†å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚æ­¤æ—¶è¿˜èƒ½ç»“åˆkubernetesçš„èµ„æºé…é¢æœºåˆ¶ï¼Œé™å®šä¸åŒç§Ÿæˆ·èƒ½å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚CPUä½¿ç”¨é‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ç­‰ï¼Œæ¥å®ç°ç§Ÿæˆ·å¯ç”¨èµ„æºçš„ç®¡ç†ã€‚ kubernetesåœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œä¼šé»˜è®¤åˆ›å»ºå‡ ä¸ªnamespace 123456[root@master ~]# kubectl get namespaceNAME STATUS AGEdefault Active 45h # æ‰€æœ‰æœªæŒ‡å®šNamespaceçš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨defaultå‘½åç©ºé—´kube-node-lease Active 45h # é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œv1.13å¼€å§‹å¼•å…¥kube-public Active 45h # æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰kube-system Active 45h # æ‰€æœ‰ç”±Kubernetesç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´ ä¸‹é¢æ¥çœ‹namespaceèµ„æºçš„å…·ä½“æ“ä½œï¼š 4.1.1 æŸ¥çœ‹1234567891011121314151617181920212223242526272829303132333435363738394041# 1 æŸ¥çœ‹æ‰€æœ‰çš„ns å‘½ä»¤ï¼škubectl get ns[root@master ~]# kubectl get nsNAME STATUS AGEdefault Active 45hkube-node-lease Active 45hkube-public Active 45h kube-system Active 45h # 2 æŸ¥çœ‹æŒ‡å®šçš„ns å‘½ä»¤ï¼škubectl get ns nsåç§°[root@master ~]# kubectl get ns defaultNAME STATUS AGEdefault Active 45h# 3 æŒ‡å®šè¾“å‡ºæ ¼å¼ å‘½ä»¤ï¼škubectl get ns nsåç§° -o æ ¼å¼å‚æ•°# kubernetesæ”¯æŒçš„æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯wideã€jsonã€yaml[root@master ~]# kubectl get ns default -o yamlapiVersion: v1kind: Namespacemetadata: creationTimestamp: &quot;2021-05-08T04:44:16Z&quot; name: default resourceVersion: &quot;151&quot; selfLink: /api/v1/namespaces/default uid: 7405f73a-e486-43d4-9db6-145f1409f090spec: finalizers: - kubernetesstatus: phase: Active # 4 æŸ¥çœ‹nsè¯¦æƒ… å‘½ä»¤ï¼škubectl describe ns nsåç§°[root@master ~]# kubectl describe ns defaultName: defaultLabels: &lt;none&gt;Annotations: &lt;none&gt;Status: Active # Active å‘½åç©ºé—´æ­£åœ¨ä½¿ç”¨ä¸­ Terminating æ­£åœ¨åˆ é™¤å‘½åç©ºé—´# ResourceQuota é’ˆå¯¹namespaceåšçš„èµ„æºé™åˆ¶# LimitRangeé’ˆå¯¹namespaceä¸­çš„æ¯ä¸ªç»„ä»¶åšçš„èµ„æºé™åˆ¶No resource quota.No LimitRange resource. 4.1.2 åˆ›å»º123# åˆ›å»ºnamespace[root@master ~]# kubectl create ns devnamespace/dev created 4.1.3 åˆ é™¤123# åˆ é™¤namespace[root@master ~]# kubectl delete ns devnamespace &quot;dev&quot; deleted 4.1.4 é…ç½®æ–¹å¼é¦–å…ˆå‡†å¤‡ä¸€ä¸ªyamlæ–‡ä»¶ï¼šns-dev.yaml 1234apiVersion: v1kind: Namespacemetadata: name: dev ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š åˆ›å»ºï¼škubectl create -f ns-dev.yaml åˆ é™¤ï¼škubectl delete -f ns-dev.yaml 4.2 PodPodæ˜¯kubernetesé›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒï¼Œç¨‹åºè¦è¿è¡Œå¿…é¡»éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œè€Œå®¹å™¨å¿…é¡»å­˜åœ¨äºPodä¸­ã€‚ Podå¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„å°è£…ï¼Œä¸€ä¸ªPodä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚ kubernetesåœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªç»„ä»¶ä¹Ÿéƒ½æ˜¯ä»¥Podæ–¹å¼è¿è¡Œçš„ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š 123456789101112[root@master ~]# kubectl get pod -n kube-systemNAMESPACE NAME READY STATUS RESTARTS AGEkube-system coredns-6955765f44-68g6v 1/1 Running 0 2d1hkube-system coredns-6955765f44-cs5r8 1/1 Running 0 2d1hkube-system etcd-master 1/1 Running 0 2d1hkube-system kube-apiserver-master 1/1 Running 0 2d1hkube-system kube-controller-manager-master 1/1 Running 0 2d1hkube-system kube-flannel-ds-amd64-47r25 1/1 Running 0 2d1hkube-system kube-flannel-ds-amd64-ls5lh 1/1 Running 0 2d1hkube-system kube-proxy-685tk 1/1 Running 0 2d1hkube-system kube-proxy-87spt 1/1 Running 0 2d1hkube-system kube-scheduler-master 1/1 Running 0 2d1h 4.2.1 åˆ›å»ºå¹¶è¿è¡Œkubernetesæ²¡æœ‰æä¾›å•ç‹¬è¿è¡ŒPodçš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®ç°çš„ 123456# å‘½ä»¤æ ¼å¼ï¼š kubectl run (podæ§åˆ¶å™¨åç§°) [å‚æ•°] # --image æŒ‡å®šPodçš„é•œåƒ# --port æŒ‡å®šç«¯å£# --namespace æŒ‡å®šnamespace[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev deployment.apps/nginx created 4.2.2 æŸ¥çœ‹podä¿¡æ¯123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657# æŸ¥çœ‹PodåŸºæœ¬ä¿¡æ¯[root@master ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEnginx 1/1 Running 0 43s# æŸ¥çœ‹Podçš„è¯¦ç»†ä¿¡æ¯[root@master ~]# kubectl describe pod nginx -n devName: nginxNamespace: devPriority: 0Node: node1/192.168.5.4Start Time: Wed, 08 May 2021 09:29:24 +0800Labels: pod-template-hash=5ff7956ff6 run=nginxAnnotations: &lt;none&gt;Status: RunningIP: 10.244.1.23IPs: IP: 10.244.1.23Controlled By: ReplicaSet/nginxContainers: nginx: Container ID: docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c Image: nginx:latest Image ID: docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7 Port: 80/TCP Host Port: 0/TCP State: Running Started: Wed, 08 May 2021 09:30:01 +0800 Ready: True Restart Count: 0 Environment: &lt;none&gt; Mounts: /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)Conditions: Type Status Initialized True Ready True ContainersReady True PodScheduled TrueVolumes: default-token-hwvvw: Type: Secret (a volume populated by a Secret) SecretName: default-token-hwvvw Optional: falseQoS Class: BestEffortNode-Selectors: &lt;none&gt;Tolerations: node.kubernetes.io/not-ready:NoExecute for 300s node.kubernetes.io/unreachable:NoExecute for 300sEvents: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled &lt;unknown&gt; default-scheduler Successfully assigned dev/nginx-5ff7956ff6-fg2db to node1 Normal Pulling 4m11s kubelet, node1 Pulling image &quot;nginx:latest&quot; Normal Pulled 3m36s kubelet, node1 Successfully pulled image &quot;nginx:latest&quot; Normal Created 3m36s kubelet, node1 Created container nginx Normal Started 3m36s kubelet, node1 Started container nginx 4.2.3 è®¿é—®Pod12345678910111213141516# è·å–podIP[root@master ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ... nginx 1/1 Running 0 190s 10.244.1.23 node1 ...#è®¿é—®POD[root@master ~]# curl http://10.244.1.23:80&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;/head&gt;&lt;body&gt; &lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt; 4.2.4 åˆ é™¤æŒ‡å®šPod123456789101112131415161718192021222324# åˆ é™¤æŒ‡å®šPod[root@master ~]# kubectl delete pod nginx -n devpod &quot;nginx&quot; deleted# æ­¤æ—¶ï¼Œæ˜¾ç¤ºåˆ é™¤PodæˆåŠŸï¼Œä½†æ˜¯å†æŸ¥è¯¢ï¼Œå‘ç°åˆæ–°äº§ç”Ÿäº†ä¸€ä¸ª [root@master ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEnginx 1/1 Running 0 21s# è¿™æ˜¯å› ä¸ºå½“å‰Podæ˜¯ç”±Podæ§åˆ¶å™¨åˆ›å»ºçš„ï¼Œæ§åˆ¶å™¨ä¼šç›‘æ§PodçŠ¶å†µï¼Œä¸€æ—¦å‘ç°Podæ­»äº¡ï¼Œä¼šç«‹å³é‡å»º# æ­¤æ—¶è¦æƒ³åˆ é™¤Podï¼Œå¿…é¡»åˆ é™¤Podæ§åˆ¶å™¨# å…ˆæ¥æŸ¥è¯¢ä¸€ä¸‹å½“å‰namespaceä¸‹çš„Podæ§åˆ¶å™¨[root@master ~]# kubectl get deploy -n devNAME READY UP-TO-DATE AVAILABLE AGEnginx 1/1 1 1 9m7s# æ¥ä¸‹æ¥ï¼Œåˆ é™¤æ­¤PodPodæ§åˆ¶å™¨[root@master ~]# kubectl delete deploy nginx -n devdeployment.apps &quot;nginx&quot; deleted# ç¨ç­‰ç‰‡åˆ»ï¼Œå†æŸ¥è¯¢Podï¼Œå‘ç°Podè¢«åˆ é™¤äº†[root@master ~]# kubectl get pods -n devNo resources found in dev namespace. 4.2.5 é…ç½®æ“ä½œåˆ›å»ºä¸€ä¸ªpod-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213apiVersion: v1kind: Podmetadata: name: nginx namespace: devspec: containers: - image: nginx:latest name: pod ports: - name: nginx-port containerPort: 80 protocol: TCP ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š åˆ›å»ºï¼škubectl create -f pod-nginx.yaml åˆ é™¤ï¼škubectl delete -f pod-nginx.yaml 4.3 LabelLabelæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨èµ„æºä¸Šæ·»åŠ æ ‡è¯†ï¼Œç”¨æ¥å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†å’Œé€‰æ‹©ã€‚ Labelçš„ç‰¹ç‚¹ï¼š ä¸€ä¸ªLabelä¼šä»¥key/valueé”®å€¼å¯¹çš„å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Šï¼Œå¦‚Nodeã€Podã€Serviceç­‰ç­‰ ä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„Label ï¼ŒåŒä¸€ä¸ªLabelä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå» Labelé€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤ å¯ä»¥é€šè¿‡Labelå®ç°èµ„æºçš„å¤šç»´åº¦åˆ†ç»„ï¼Œä»¥ä¾¿çµæ´»ã€æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ã€é…ç½®ã€éƒ¨ç½²ç­‰ç®¡ç†å·¥ä½œã€‚ ä¸€äº›å¸¸ç”¨çš„Label ç¤ºä¾‹å¦‚ä¸‹ï¼š ç‰ˆæœ¬æ ‡ç­¾ï¼šâ€versionâ€:â€releaseâ€, â€œversionâ€:â€stableâ€â€¦â€¦ ç¯å¢ƒæ ‡ç­¾ï¼šâ€environmentâ€:â€devâ€ï¼Œâ€environmentâ€:â€testâ€ï¼Œâ€environmentâ€:â€proâ€ æ¶æ„æ ‡ç­¾ï¼šâ€tierâ€:â€frontendâ€ï¼Œâ€tierâ€:â€backendâ€ æ ‡ç­¾å®šä¹‰å®Œæ¯•ä¹‹åï¼Œè¿˜è¦è€ƒè™‘åˆ°æ ‡ç­¾çš„é€‰æ‹©ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ°Label Selectorï¼Œå³ï¼š Labelç”¨äºç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰æ ‡è¯† Label Selectorç”¨äºæŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›æ ‡ç­¾çš„èµ„æºå¯¹è±¡ å½“å‰æœ‰ä¸¤ç§Label Selectorï¼š åŸºäºç­‰å¼çš„Label Selector name = slave: é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­key=â€nameâ€ä¸”value=â€slaveâ€çš„å¯¹è±¡ env != production: é€‰æ‹©æ‰€æœ‰åŒ…æ‹¬Labelä¸­çš„key=â€envâ€ä¸”valueä¸ç­‰äºâ€productionâ€çš„å¯¹è±¡ åŸºäºé›†åˆçš„Label Selector name in (master, slave): é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key=â€nameâ€ä¸”value=â€masterâ€æˆ–â€slaveâ€çš„å¯¹è±¡ name not in (frontend): é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key=â€nameâ€ä¸”valueä¸ç­‰äºâ€frontendâ€çš„å¯¹è±¡ æ ‡ç­¾çš„é€‰æ‹©æ¡ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œæ­¤æ—¶å°†å¤šä¸ªLabel Selectorè¿›è¡Œç»„åˆï¼Œä½¿ç”¨é€—å·â€,â€è¿›è¡Œåˆ†éš”å³å¯ã€‚ä¾‹å¦‚ï¼š name=slaveï¼Œenv!=production name not in (frontend)ï¼Œenv!=production 4.3.1 å‘½ä»¤æ–¹å¼1234567891011121314151617181920212223# ä¸ºpodèµ„æºæ‰“æ ‡ç­¾[root@master ~]# kubectl label pod nginx-pod version=1.0 -n devpod/nginx-pod labeled# ä¸ºpodèµ„æºæ›´æ–°æ ‡ç­¾[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwritepod/nginx-pod labeled# æŸ¥çœ‹æ ‡ç­¾[root@master ~]# kubectl get pod nginx-pod -n dev --show-labelsNAME READY STATUS RESTARTS AGE LABELSnginx-pod 1/1 Running 0 10m version=2.0# ç­›é€‰æ ‡ç­¾[root@master ~]# kubectl get pod -n dev -l version=2.0 --show-labelsNAME READY STATUS RESTARTS AGE LABELSnginx-pod 1/1 Running 0 17m version=2.0[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labelsNo resources found in dev namespace.#åˆ é™¤æ ‡ç­¾[root@master ~]# kubectl label pod nginx-pod version- -n devpod/nginx-pod labeled 4.3.2 é…ç½®æ–¹å¼12345678910111213141516apiVersion: v1kind: Podmetadata: name: nginx namespace: dev labels: version: &quot;3.0&quot; env: &quot;test&quot;spec: containers: - image: nginx:latest name: pod ports: - name: nginx-port containerPort: 80 protocol: TCP ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„æ›´æ–°å‘½ä»¤äº†ï¼škubectl apply -f pod-nginx.yaml 4.4 Deploymentåœ¨kubernetesä¸­ï¼ŒPodæ˜¯æœ€å°çš„æ§åˆ¶å•å…ƒï¼Œä½†æ˜¯kuberneteså¾ˆå°‘ç›´æ¥æ§åˆ¶Podï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®Œæˆçš„ã€‚Podæ§åˆ¶å™¨ç”¨äºpodçš„ç®¡ç†ï¼Œç¡®ä¿podèµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€ï¼Œå½“podçš„èµ„æºå‡ºç°æ•…éšœæ—¶ï¼Œä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–é‡å»ºpodã€‚ åœ¨kubernetesä¸­Podæ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼Œæœ¬ç« èŠ‚åªä»‹ç»ä¸€ç§ï¼šDeploymentã€‚ 4.4.1 å‘½ä»¤æ“ä½œ123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263# å‘½ä»¤æ ¼å¼: kubectl create deployment åç§° [å‚æ•°] # --image æŒ‡å®špodçš„é•œåƒ# --port æŒ‡å®šç«¯å£# --replicas æŒ‡å®šåˆ›å»ºpodæ•°é‡# --namespace æŒ‡å®šnamespace[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n devdeployment.apps/nginx created# æŸ¥çœ‹åˆ›å»ºçš„Pod[root@master ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEnginx-5ff7956ff6-6k8cb 1/1 Running 0 19snginx-5ff7956ff6-jxfjt 1/1 Running 0 19snginx-5ff7956ff6-v6jqw 1/1 Running 0 19s# æŸ¥çœ‹deploymentçš„ä¿¡æ¯[root@master ~]# kubectl get deploy -n devNAME READY UP-TO-DATE AVAILABLE AGEnginx 3/3 3 3 2m42s# UP-TO-DATEï¼šæˆåŠŸå‡çº§çš„å‰¯æœ¬æ•°é‡# AVAILABLEï¼šå¯ç”¨å‰¯æœ¬çš„æ•°é‡[root@master ~]# kubectl get deploy -n dev -o wideNAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES SELECTORnginx 3/3 3 3 2m51s nginx nginx:latest run=nginx# æŸ¥çœ‹deploymentçš„è¯¦ç»†ä¿¡æ¯[root@master ~]# kubectl describe deploy nginx -n devName: nginxNamespace: devCreationTimestamp: Wed, 08 May 2021 11:14:14 +0800Labels: run=nginxAnnotations: deployment.kubernetes.io/revision: 1Selector: run=nginxReplicas: 3 desired | 3 updated | 3 total | 3 available | 0 unavailableStrategyType: RollingUpdateMinReadySeconds: 0RollingUpdateStrategy: 25% max unavailable, 25% max surgePod Template: Labels: run=nginx Containers: nginx: Image: nginx:latest Port: 80/TCP Host Port: 0/TCP Environment: &lt;none&gt; Mounts: &lt;none&gt; Volumes: &lt;none&gt;Conditions: Type Status Reason ---- ------ ------ Available True MinimumReplicasAvailable Progressing True NewReplicaSetAvailableOldReplicaSets: &lt;none&gt;NewReplicaSet: nginx-5ff7956ff6 (3/3 replicas created)Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal ScalingReplicaSet 5m43s deployment-controller Scaled up replicaset nginx-5ff7956ff6 to 3 # åˆ é™¤ [root@master ~]# kubectl delete deploy nginx -n devdeployment.apps &quot;nginx&quot; deleted 4.4.2 é…ç½®æ“ä½œåˆ›å»ºä¸€ä¸ªdeploy-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021apiVersion: apps/v1kind: Deploymentmetadata: name: nginx namespace: devspec: replicas: 3 selector: matchLabels: run: nginx template: metadata: labels: run: nginx spec: containers: - image: nginx:latest name: nginx ports: - containerPort: 80 protocol: TCP ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š åˆ›å»ºï¼škubectl create -f deploy-nginx.yaml åˆ é™¤ï¼škubectl delete -f deploy-nginx.yaml 4.5 Serviceé€šè¿‡ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ ï¼Œå·²ç»èƒ½å¤Ÿåˆ©ç”¨Deploymentæ¥åˆ›å»ºä¸€ç»„Podæ¥æä¾›å…·æœ‰é«˜å¯ç”¨æ€§çš„æœåŠ¡ã€‚ è™½ç„¶æ¯ä¸ªPodéƒ½ä¼šåˆ†é…ä¸€ä¸ªå•ç‹¬çš„Pod IPï¼Œç„¶è€Œå´å­˜åœ¨å¦‚ä¸‹ä¸¤é—®é¢˜ï¼š Pod IP ä¼šéšç€Podçš„é‡å»ºäº§ç”Ÿå˜åŒ– Pod IP ä»…ä»…æ˜¯é›†ç¾¤å†…å¯è§çš„è™šæ‹ŸIPï¼Œå¤–éƒ¨æ— æ³•è®¿é—® è¿™æ ·å¯¹äºè®¿é—®è¿™ä¸ªæœåŠ¡å¸¦æ¥äº†éš¾åº¦ã€‚å› æ­¤ï¼Œkubernetesè®¾è®¡äº†Serviceæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ Serviceå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„åŒç±»Podå¯¹å¤–çš„è®¿é—®æ¥å£ã€‚å€ŸåŠ©Serviceï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚ 4.5.1 åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„Service12345678910111213141516171819202122# æš´éœ²Service[root@master ~]# kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n devservice/svc-nginx1 exposed# æŸ¥çœ‹service[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORsvc-nginx1 ClusterIP 10.109.179.231 &lt;none&gt; 80/TCP 3m51s run=nginx# è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ªCLUSTER-IPï¼Œè¿™å°±æ˜¯serviceçš„IPï¼Œåœ¨Serviceçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸ä¼šå˜åŠ¨çš„# å¯ä»¥é€šè¿‡è¿™ä¸ªIPè®¿é—®å½“å‰serviceå¯¹åº”çš„POD[root@master ~]# curl 10.109.179.231:80&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;Welcome to nginx!&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;.......&lt;/body&gt;&lt;/html&gt; 4.5.2 åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„Service12345678910111213# ä¸Šé¢åˆ›å»ºçš„Serviceçš„typeç±»å‹ä¸ºClusterIPï¼Œè¿™ä¸ªipåœ°å€åªç”¨é›†ç¾¤å†…éƒ¨å¯è®¿é—®# å¦‚æœéœ€è¦åˆ›å»ºå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®çš„Serviceï¼Œéœ€è¦ä¿®æ”¹typeä¸ºNodePort[root@master ~]# kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n devservice/svc-nginx2 exposed# æ­¤æ—¶æŸ¥çœ‹ï¼Œä¼šå‘ç°å‡ºç°äº†NodePortç±»å‹çš„Serviceï¼Œè€Œä¸”æœ‰ä¸€å¯¹Portï¼ˆ80:31928/TCï¼‰[root@master ~]# kubectl get svc svc-nginx2 -n dev -o wideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORsvc-nginx2 NodePort 10.100.94.0 &lt;none&gt; 80:31928/TCP 9s run=nginx# æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡é›†ç¾¤å¤–çš„ä¸»æœºè®¿é—® èŠ‚ç‚¹IP:31928è®¿é—®æœåŠ¡äº†# ä¾‹å¦‚åœ¨çš„ç”µè„‘ä¸»æœºä¸Šé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸‹é¢çš„åœ°å€http://192.168.90.100:31928/ 4.5.3 åˆ é™¤Service12[root@master ~]# kubectl delete svc svc-nginx-1 -n dev service &quot;svc-nginx-1&quot; deleted 4.5.4 é…ç½®æ–¹å¼åˆ›å»ºä¸€ä¸ªsvc-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314apiVersion: v1kind: Servicemetadata: name: svc-nginx namespace: devspec: clusterIP: 10.109.179.231 #å›ºå®šsvcçš„å†…ç½‘ip ports: - port: 80 protocol: TCP targetPort: 80 selector: run: nginx type: ClusterIP ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š åˆ›å»ºï¼škubectl create -f svc-nginx.yaml åˆ é™¤ï¼škubectl delete -f svc-nginx.yaml å°ç»“ è‡³æ­¤ï¼Œå·²ç»æŒæ¡äº†Namespaceã€Podã€Deploymentã€Serviceèµ„æºçš„åŸºæœ¬æ“ä½œï¼Œæœ‰äº†è¿™äº›æ“ä½œï¼Œå°±å¯ä»¥åœ¨kubernetesé›†ç¾¤ä¸­å®ç°ä¸€ä¸ªæœåŠ¡çš„ç®€å•éƒ¨ç½²å’Œè®¿é—®äº†ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦æ›´å¥½çš„ä½¿ç”¨kubernetesï¼Œå°±éœ€è¦æ·±å…¥å­¦ä¹ è¿™å‡ ç§èµ„æºçš„ç»†èŠ‚å’ŒåŸç†ã€‚ 5. Podè¯¦è§£5.1 Podä»‹ç»5.1.1 Podç»“æ„ æ¯ä¸ªPodä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š ç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨ï¼Œæ•°é‡å¯å¤šå¯å°‘ Pauseå®¹å™¨ï¼Œè¿™æ˜¯æ¯ä¸ªPodéƒ½ä¼šæœ‰çš„ä¸€ä¸ªæ ¹å®¹å™¨ï¼Œå®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š å¯ä»¥ä»¥å®ƒä¸ºä¾æ®ï¼Œè¯„ä¼°æ•´ä¸ªPodçš„å¥åº·çŠ¶æ€ å¯ä»¥åœ¨æ ¹å®¹å™¨ä¸Šè®¾ç½®Ipåœ°å€ï¼Œå…¶å®ƒå®¹å™¨éƒ½æ­¤Ipï¼ˆPod IPï¼‰ï¼Œä»¥å®ç°Podå†…éƒ¨çš„ç½‘è·¯é€šä¿¡ 1è¿™é‡Œæ˜¯Podå†…éƒ¨çš„é€šè®¯ï¼ŒPodçš„ä¹‹é—´çš„é€šè®¯é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œæˆ‘ä»¬å½“å‰ç¯å¢ƒç”¨çš„æ˜¯Flannel 5.1.2 Podå®šä¹‰ä¸‹é¢æ˜¯Podçš„èµ„æºæ¸…å•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778apiVersion: v1 #å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1kind: Pod #å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Podmetadata: #å¿…é€‰ï¼Œå…ƒæ•°æ® name: string #å¿…é€‰ï¼ŒPodåç§° namespace: string #Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&quot;default&quot; labels: #è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨ - name: string spec: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰ containers: #å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨ - name: string #å¿…é€‰ï¼Œå®¹å™¨åç§° image: string #å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§° imagePullPolicy: [ Always|Never|IfNotPresent ] #è·å–é•œåƒçš„ç­–ç•¥ command: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤ args: [string] #å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨ workingDir: string #å®¹å™¨çš„å·¥ä½œç›®å½• volumeMounts: #æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½® - name: string #å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å mountPath: string #å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦ readOnly: boolean #æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼ ports: #éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨ - name: string #ç«¯å£çš„åç§° containerPort: int #å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å· hostPort: int #å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ protocol: string #ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP env: #å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨ - name: string #ç¯å¢ƒå˜é‡åç§° value: string #ç¯å¢ƒå˜é‡çš„å€¼ resources: #èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½® limits: #èµ„æºé™åˆ¶çš„è®¾ç½® cpu: string #Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•° memory: string #å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•° requests: #èµ„æºè¯·æ±‚çš„è®¾ç½® cpu: string #Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ memory: string #å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡ lifecycle: #ç”Ÿå‘½å‘¨æœŸé’©å­ postStart: #å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯ preStop: #å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢ livenessProbe: #å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ exec: #å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼ command: [string] #execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬ httpGet: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port path: string port: number host: string scheme: string HttpHeaders: - name: string value: string tcpSocket: #å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼ port: number initialDelaySeconds: 0 #å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ timeoutSeconds: 0 #å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’ periodSeconds: 0 #å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡ successThreshold: 0 failureThreshold: 0 securityContext: privileged: false restartPolicy: [Always | Never | OnFailure] #Podçš„é‡å¯ç­–ç•¥ nodeName: &lt;string&gt; #è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š nodeSelector: obeject #è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š imagePullSecrets: #Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š - name: string hostNetwork: false #æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ volumes: #åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨ - name: string #å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰ emptyDir: &#123;&#125; #ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼ hostPath: string #ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½• path: string #Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½• secret: #ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ scretname: string items: - key: string path: string configMap: #ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨ name: string items: - key: string path: string 1234567891011121314151617181920212223242526272829303132333435#å°æç¤ºï¼š# åœ¨è¿™é‡Œï¼Œå¯é€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹æ¯ç§èµ„æºçš„å¯é…ç½®é¡¹# kubectl explain èµ„æºç±»å‹ æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§å±æ€§# kubectl explain èµ„æºç±»å‹.å±æ€§ æŸ¥çœ‹å±æ€§çš„å­å±æ€§[root@k8s-master01 ~]# kubectl explain podKIND: PodVERSION: v1FIELDS: apiVersion &lt;string&gt; kind &lt;string&gt; metadata &lt;Object&gt; spec &lt;Object&gt; status &lt;Object&gt;[root@k8s-master01 ~]# kubectl explain pod.metadataKIND: PodVERSION: v1RESOURCE: metadata &lt;Object&gt;FIELDS: annotations &lt;map[string]string&gt; clusterName &lt;string&gt; creationTimestamp &lt;string&gt; deletionGracePeriodSeconds &lt;integer&gt; deletionTimestamp &lt;string&gt; finalizers &lt;[]string&gt; generateName &lt;string&gt; generation &lt;integer&gt; labels &lt;map[string]string&gt; managedFields &lt;[]Object&gt; name &lt;string&gt; namespace &lt;string&gt; ownerReferences &lt;[]Object&gt; resourceVersion &lt;string&gt; selfLink &lt;string&gt; uid &lt;string&gt; åœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š apiVersion ç‰ˆæœ¬ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ° kind ç±»å‹ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ° metadata å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰nameã€namespaceã€labelsç­‰ spec æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿° status çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”±kubernetesè‡ªåŠ¨ç”Ÿæˆ åœ¨ä¸Šé¢çš„å±æ€§ä¸­ï¼Œspecæ˜¯æ¥ä¸‹æ¥ç ”ç©¶çš„é‡ç‚¹ï¼Œç»§ç»­çœ‹ä¸‹å®ƒçš„å¸¸è§å­å±æ€§: containers &lt;[]Object&gt; å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯ nodeName æ ¹æ®nodeNameçš„å€¼å°†podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Š nodeSelector &lt;map[]&gt; æ ¹æ®NodeSelectorä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™äº›labelçš„Node ä¸Š hostNetwork æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ volumes &lt;[]Object&gt; å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰Podä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯ restartPolicy é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤ºPodåœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥ 5.2 Podé…ç½®æœ¬å°èŠ‚ä¸»è¦æ¥ç ”ç©¶pod.spec.containerså±æ€§ï¼Œè¿™ä¹Ÿæ˜¯podé…ç½®ä¸­æœ€ä¸ºå…³é”®çš„ä¸€é¡¹é…ç½®ã€‚ 12345678910111213[root@k8s-master01 ~]# kubectl explain pod.spec.containersKIND: PodVERSION: v1RESOURCE: containers &lt;[]Object&gt; # æ•°ç»„ï¼Œä»£è¡¨å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨FIELDS: name &lt;string&gt; # å®¹å™¨åç§° image &lt;string&gt; # å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€ imagePullPolicy &lt;string&gt; # é•œåƒæ‹‰å–ç­–ç•¥ command &lt;[]string&gt; # å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤ args &lt;[]string&gt; # å®¹å™¨çš„å¯åŠ¨å‘½ä»¤éœ€è¦çš„å‚æ•°åˆ—è¡¨ env &lt;[]Object&gt; # å®¹å™¨ç¯å¢ƒå˜é‡çš„é…ç½® ports &lt;[]Object&gt; # å®¹å™¨éœ€è¦æš´éœ²çš„ç«¯å£å·åˆ—è¡¨ resources &lt;Object&gt; # èµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„è®¾ç½® 5.2.1 åŸºæœ¬é…ç½®åˆ›å»ºpod-base.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213apiVersion: v1kind: Podmetadata: name: pod-base namespace: dev labels: user: heimaspec: containers: - name: nginx image: nginx:1.17.1 - name: busybox image: busybox:1.30 ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•Podçš„é…ç½®ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå®¹å™¨ï¼š nginxï¼šç”¨1.17.1ç‰ˆæœ¬çš„nginxé•œåƒåˆ›å»ºï¼Œï¼ˆnginxæ˜¯ä¸€ä¸ªè½»é‡çº§webå®¹å™¨ï¼‰ busyboxï¼šç”¨1.30ç‰ˆæœ¬çš„busyboxé•œåƒåˆ›å»ºï¼Œï¼ˆbusyboxæ˜¯ä¸€ä¸ªå°å·§çš„linuxå‘½ä»¤é›†åˆï¼‰ 1234567891011121314# åˆ›å»ºPod[root@k8s-master01 pod]# kubectl apply -f pod-base.yamlpod/pod-base created# æŸ¥çœ‹PodçŠ¶å†µ# READY 1/2 : è¡¨ç¤ºå½“å‰Podä¸­æœ‰2ä¸ªå®¹å™¨ï¼Œå…¶ä¸­1ä¸ªå‡†å¤‡å°±ç»ªï¼Œ1ä¸ªæœªå°±ç»ª# RESTARTS : é‡å¯æ¬¡æ•°ï¼Œå› ä¸ºæœ‰1ä¸ªå®¹å™¨æ•…éšœäº†ï¼ŒPodä¸€ç›´åœ¨é‡å¯è¯•å›¾æ¢å¤å®ƒ[root@k8s-master01 pod]# kubectl get pod -n devNAME READY STATUS RESTARTS AGEpod-base 1/2 Running 4 95s# å¯ä»¥é€šè¿‡describeæŸ¥çœ‹å†…éƒ¨çš„è¯¦æƒ…# æ­¤æ—¶å·²ç»è¿è¡Œèµ·æ¥äº†ä¸€ä¸ªåŸºæœ¬çš„Podï¼Œè™½ç„¶å®ƒæš‚æ—¶æœ‰é—®é¢˜[root@k8s-master01 pod]# kubectl describe pod pod-base -n dev 5.2.2 é•œåƒæ‹‰å–åˆ›å»ºpod-imagepullpolicy.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112apiVersion: v1kind: Podmetadata: name: pod-imagepullpolicy namespace: devspec: containers: - name: nginx image: nginx:1.17.1 imagePullPolicy: Never # ç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥ - name: busybox image: busybox:1.30 imagePullPolicyï¼Œç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥ï¼Œkubernetesæ”¯æŒé…ç½®ä¸‰ç§æ‹‰å–ç­–ç•¥ï¼š Alwaysï¼šæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆä¸€ç›´è¿œç¨‹ä¸‹è½½ï¼‰ IfNotPresentï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆæœ¬åœ°æœ‰å°±æœ¬åœ° æœ¬åœ°æ²¡è¿œç¨‹ä¸‹è½½ï¼‰ Neverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒï¼Œä»ä¸å»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œæœ¬åœ°æ²¡æœ‰å°±æŠ¥é”™ ï¼ˆä¸€ç›´ä½¿ç”¨æœ¬åœ°ï¼‰ é»˜è®¤å€¼è¯´æ˜ï¼š å¦‚æœé•œåƒtagä¸ºå…·ä½“ç‰ˆæœ¬å·ï¼Œ é»˜è®¤ç­–ç•¥æ˜¯ï¼šIfNotPresent å¦‚æœé•œåƒtagä¸ºï¼šlatestï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰ ï¼Œé»˜è®¤ç­–ç•¥æ˜¯always 12345678910111213141516171819# åˆ›å»ºPod[root@k8s-master01 pod]# kubectl create -f pod-imagepullpolicy.yamlpod/pod-imagepullpolicy created# æŸ¥çœ‹Podè¯¦æƒ…# æ­¤æ—¶æ˜æ˜¾å¯ä»¥çœ‹åˆ°nginxé•œåƒæœ‰ä¸€æ­¥Pulling image &quot;nginx:1.17.1&quot;çš„è¿‡ç¨‹[root@k8s-master01 pod]# kubectl describe pod pod-imagepullpolicy -n dev......Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled &lt;unknown&gt; default-scheduler Successfully assigned dev/pod-imagePullPolicy to node1 Normal Pulling 32s kubelet, node1 Pulling image &quot;nginx:1.17.1&quot; Normal Pulled 26s kubelet, node1 Successfully pulled image &quot;nginx:1.17.1&quot; Normal Created 26s kubelet, node1 Created container nginx Normal Started 25s kubelet, node1 Started container nginx Normal Pulled 7s (x3 over 25s) kubelet, node1 Container image &quot;busybox:1.30&quot; already present on machine Normal Created 7s (x3 over 25s) kubelet, node1 Created container busybox Normal Started 7s (x3 over 25s) kubelet, node1 Started container busybox 5.2.3 å¯åŠ¨å‘½ä»¤åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯çš„busyboxå®¹å™¨ä¸€ç›´æ²¡æœ‰æˆåŠŸè¿è¡Œï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´è¿™ä¸ªå®¹å™¨çš„æ•…éšœå‘¢ï¼Ÿ åŸæ¥busyboxå¹¶ä¸æ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œæ˜¯ç±»ä¼¼äºä¸€ä¸ªå·¥å…·ç±»çš„é›†åˆï¼Œkubernetesé›†ç¾¤å¯åŠ¨ç®¡ç†åï¼Œå®ƒä¼šè‡ªåŠ¨å…³é—­ã€‚è§£å†³æ–¹æ³•å°±æ˜¯è®©å…¶ä¸€ç›´åœ¨è¿è¡Œï¼Œè¿™å°±ç”¨åˆ°äº†commandé…ç½®ã€‚ åˆ›å»ºpod-command.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112apiVersion: v1kind: Podmetadata: name: pod-command namespace: devspec: containers: - name: nginx image: nginx:1.17.1 - name: busybox image: busybox:1.30 command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done;&quot;] commandï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ä¹‹åè¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‚ ç¨å¾®è§£é‡Šä¸‹ä¸Šé¢å‘½ä»¤çš„æ„æ€ï¼š â€œ/bin/shâ€,â€-câ€, ä½¿ç”¨shæ‰§è¡Œå‘½ä»¤ touch /tmp/hello.txt; åˆ›å»ºä¸€ä¸ª/tmp/hello.txt æ–‡ä»¶ while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done; æ¯éš”3ç§’å‘æ–‡ä»¶ä¸­å†™å…¥å½“å‰æ—¶é—´ 12345678910111213141516171819# åˆ›å»ºPod[root@k8s-master01 pod]# kubectl create -f pod-command.yamlpod/pod-command created# æŸ¥çœ‹PodçŠ¶æ€# æ­¤æ—¶å‘ç°ä¸¤ä¸ªpodéƒ½æ­£å¸¸è¿è¡Œäº†[root@k8s-master01 pod]# kubectl get pods pod-command -n devNAME READY STATUS RESTARTS AGEpod-command 2/2 Runing 0 2s# è¿›å…¥podä¸­çš„busyboxå®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹# è¡¥å……ä¸€ä¸ªå‘½ä»¤: kubectl exec podåç§° -n å‘½åç©ºé—´ -it -c å®¹å™¨åç§° /bin/sh åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤# ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥è¿›å…¥æŸä¸ªå®¹å™¨çš„å†…éƒ¨ï¼Œç„¶åè¿›è¡Œç›¸å…³æ“ä½œäº†# æ¯”å¦‚ï¼Œå¯ä»¥æŸ¥çœ‹txtæ–‡ä»¶çš„å†…å®¹[root@k8s-master01 pod]# kubectl exec pod-command -n dev -it -c busybox /bin/sh/ # tail -f /tmp/hello.txt14:44:1914:44:2214:44:25 123456ç‰¹åˆ«è¯´æ˜ï¼š é€šè¿‡ä¸Šé¢å‘ç°commandå·²ç»å¯ä»¥å®Œæˆå¯åŠ¨å‘½ä»¤å’Œä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦æä¾›ä¸€ä¸ªargsé€‰é¡¹ï¼Œç”¨äºä¼ é€’å‚æ•°å‘¢?è¿™å…¶å®è·Ÿdockeræœ‰ç‚¹å…³ç³»ï¼Œkubernetesä¸­çš„commandã€argsä¸¤é¡¹å…¶å®æ˜¯å®ç°è¦†ç›–Dockerfileä¸­ENTRYPOINTçš„åŠŸèƒ½ã€‚ 1 å¦‚æœcommandå’Œargså‡æ²¡æœ‰å†™ï¼Œé‚£ä¹ˆç”¨Dockerfileçš„é…ç½®ã€‚ 2 å¦‚æœcommandå†™äº†ï¼Œä½†argsæ²¡æœ‰å†™ï¼Œé‚£ä¹ˆDockerfileé»˜è®¤çš„é…ç½®ä¼šè¢«å¿½ç•¥ï¼Œæ‰§è¡Œè¾“å…¥çš„command 3 å¦‚æœcommandæ²¡å†™ï¼Œä½†argså†™äº†ï¼Œé‚£ä¹ˆDockerfileä¸­é…ç½®çš„ENTRYPOINTçš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œï¼Œä½¿ç”¨å½“å‰argsçš„å‚æ•° 4 å¦‚æœcommandå’Œargséƒ½å†™äº†ï¼Œé‚£ä¹ˆDockerfileçš„é…ç½®è¢«å¿½ç•¥ï¼Œæ‰§è¡Œcommandå¹¶è¿½åŠ ä¸Šargså‚æ•° 5.2.4 ç¯å¢ƒå˜é‡åˆ›å»ºpod-env.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415apiVersion: v1kind: Podmetadata: name: pod-env namespace: devspec: containers: - name: busybox image: busybox:1.30 command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;while true;do /bin/echo $(date +%T);sleep 60; done;&quot;] env: # è®¾ç½®ç¯å¢ƒå˜é‡åˆ—è¡¨ - name: &quot;username&quot; value: &quot;admin&quot; - name: &quot;password&quot; value: &quot;123456&quot; envï¼Œç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚ 12345678910# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-env.yamlpod/pod-env created# è¿›å…¥å®¹å™¨ï¼Œè¾“å‡ºç¯å¢ƒå˜é‡[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh/ # echo $usernameadmin/ # echo $password123456 è¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆæ¨èï¼Œæ¨èå°†è¿™äº›é…ç½®å•ç‹¬å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–¹å¼å°†åœ¨åé¢ä»‹ç»ã€‚ 5.2.5 ç«¯å£è®¾ç½®æœ¬å°èŠ‚æ¥ä»‹ç»å®¹å™¨çš„ç«¯å£è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯containersçš„portsé€‰é¡¹ã€‚ é¦–å…ˆçœ‹ä¸‹portsæ”¯æŒçš„å­é€‰é¡¹ï¼š 12345678910[root@k8s-master01 ~]# kubectl explain pod.spec.containers.portsKIND: PodVERSION: v1RESOURCE: ports &lt;[]Object&gt;FIELDS: name &lt;string&gt; # ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œå¿…é¡»ä¿è¯nameåœ¨podä¸­æ˜¯å”¯ä¸€çš„ containerPort&lt;integer&gt; # å®¹å™¨è¦ç›‘å¬çš„ç«¯å£(0&lt;x&lt;65536) hostPort &lt;integer&gt; # å®¹å™¨è¦åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ï¼Œä¸»æœºä¸Šåªèƒ½è¿è¡Œå®¹å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ä¸€èˆ¬çœç•¥) hostIP &lt;string&gt; # è¦å°†å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°çš„ä¸»æœºIP(ä¸€èˆ¬çœç•¥) protocol &lt;string&gt; # ç«¯å£åè®®ã€‚å¿…é¡»æ˜¯UDPã€TCPæˆ–SCTPã€‚é»˜è®¤ä¸ºâ€œTCPâ€ã€‚ æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-ports.yaml 12345678910111213apiVersion: v1kind: Podmetadata: name: pod-ports namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: # è®¾ç½®å®¹å™¨æš´éœ²çš„ç«¯å£åˆ—è¡¨ - name: nginx-port containerPort: 80 protocol: TCP 123456789101112131415161718# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-ports.yamlpod/pod-ports created# æŸ¥çœ‹pod# åœ¨ä¸‹é¢å¯ä»¥æ˜æ˜¾çœ‹åˆ°é…ç½®ä¿¡æ¯[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml......spec: containers: - image: nginx:1.17.1 imagePullPolicy: IfNotPresent name: nginx ports: - containerPort: 80 name: nginx-port protocol: TCP...... è®¿é—®å®¹å™¨ä¸­çš„ç¨‹åºéœ€è¦ä½¿ç”¨çš„æ˜¯Podip:containerPort 5.2.6 èµ„æºé…é¢å®¹å™¨ä¸­çš„ç¨‹åºè¦è¿è¡Œï¼Œè‚¯å®šæ˜¯è¦å ç”¨ä¸€å®šèµ„æºçš„ï¼Œæ¯”å¦‚cpuå’Œå†…å­˜ç­‰ï¼Œå¦‚æœä¸å¯¹æŸä¸ªå®¹å™¨çš„èµ„æºåšé™åˆ¶ï¼Œé‚£ä¹ˆå®ƒå°±å¯èƒ½åƒæ‰å¤§é‡èµ„æºï¼Œå¯¼è‡´å…¶å®ƒå®¹å™¨æ— æ³•è¿è¡Œã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†å¯¹å†…å­˜å’Œcpuçš„èµ„æºè¿›è¡Œé…é¢çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¸»è¦é€šè¿‡resourcesé€‰é¡¹å®ç°ï¼Œä»–æœ‰ä¸¤ä¸ªå­é€‰é¡¹ï¼š limitsï¼šç”¨äºé™åˆ¶è¿è¡Œæ—¶å®¹å™¨çš„æœ€å¤§å ç”¨èµ„æºï¼Œå½“å®¹å™¨å ç”¨èµ„æºè¶…è¿‡limitsæ—¶ä¼šè¢«ç»ˆæ­¢ï¼Œå¹¶è¿›è¡Œé‡å¯ requests ï¼šç”¨äºè®¾ç½®å®¹å™¨éœ€è¦çš„æœ€å°èµ„æºï¼Œå¦‚æœç¯å¢ƒèµ„æºä¸å¤Ÿï¼Œå®¹å™¨å°†æ— æ³•å¯åŠ¨ å¯ä»¥é€šè¿‡ä¸Šé¢ä¸¤ä¸ªé€‰é¡¹è®¾ç½®èµ„æºçš„ä¸Šä¸‹é™ã€‚ æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-resources.yaml 12345678910111213141516apiVersion: v1kind: Podmetadata: name: pod-resources namespace: devspec: containers: - name: nginx image: nginx:1.17.1 resources: # èµ„æºé…é¢ limits: # é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰ cpu: &quot;2&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•° memory: &quot;10Gi&quot; # å†…å­˜é™åˆ¶ requests: # è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰ cpu: &quot;1&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•° memory: &quot;10Mi&quot; # å†…å­˜é™åˆ¶ åœ¨è¿™å¯¹cpuå’Œmemoryçš„å•ä½åšä¸€ä¸ªè¯´æ˜ï¼š cpuï¼šcoreæ•°ï¼Œå¯ä»¥ä¸ºæ•´æ•°æˆ–å°æ•° memoryï¼š å†…å­˜å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨Giã€Miã€Gã€Mç­‰å½¢å¼ 1234567891011121314151617181920212223242526272829# è¿è¡ŒPod[root@k8s-master01 ~]# kubectl create -f pod-resources.yamlpod/pod-resources created# æŸ¥çœ‹å‘ç°podè¿è¡Œæ­£å¸¸[root@k8s-master01 ~]# kubectl get pod pod-resources -n devNAME READY STATUS RESTARTS AGE pod-resources 1/1 Running 0 39s # æ¥ä¸‹æ¥ï¼Œåœæ­¢Pod[root@k8s-master01 ~]# kubectl delete -f pod-resources.yamlpod &quot;pod-resources&quot; deleted# ç¼–è¾‘podï¼Œä¿®æ”¹resources.requests.memoryçš„å€¼ä¸º10Gi[root@k8s-master01 ~]# vim pod-resources.yaml# å†æ¬¡å¯åŠ¨pod[root@k8s-master01 ~]# kubectl create -f pod-resources.yamlpod/pod-resources created# æŸ¥çœ‹PodçŠ¶æ€ï¼Œå‘ç°Podå¯åŠ¨å¤±è´¥[root@k8s-master01 ~]# kubectl get pod pod-resources -n dev -o wideNAME READY STATUS RESTARTS AGE pod-resources 0/1 Pending 0 20s # æŸ¥çœ‹podè¯¦æƒ…ä¼šå‘ç°ï¼Œå¦‚ä¸‹æç¤º[root@k8s-master01 ~]# kubectl describe pod pod-resources -n dev......Warning FailedScheduling 35s default-scheduler 0/3 nodes are available: 1 node(s) had taint &#123;node-role.kubernetes.io/master: &#125;, that the pod didn&#x27;t tolerate, 2 Insufficient memory.(å†…å­˜ä¸è¶³) 5.3 Podç”Ÿå‘½å‘¨æœŸæˆ‘ä»¬ä¸€èˆ¬å°†podå¯¹è±¡ä»åˆ›å»ºè‡³ç»ˆçš„è¿™æ®µæ—¶é—´èŒƒå›´ç§°ä¸ºpodçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¸»è¦åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š podåˆ›å»ºè¿‡ç¨‹ è¿è¡Œåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰è¿‡ç¨‹ è¿è¡Œä¸»å®¹å™¨ï¼ˆmain containerï¼‰ å®¹å™¨å¯åŠ¨åé’©å­ï¼ˆpost startï¼‰ã€å®¹å™¨ç»ˆæ­¢å‰é’©å­ï¼ˆpre stopï¼‰ å®¹å™¨çš„å­˜æ´»æ€§æ¢æµ‹ï¼ˆliveness probeï¼‰ã€å°±ç»ªæ€§æ¢æµ‹ï¼ˆreadiness probeï¼‰ podç»ˆæ­¢è¿‡ç¨‹ åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒPodä¼šå‡ºç°5ç§çŠ¶æ€ï¼ˆç›¸ä½ï¼‰ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š æŒ‚èµ·ï¼ˆPendingï¼‰ï¼šapiserverå·²ç»åˆ›å»ºäº†podèµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­ è¿è¡Œä¸­ï¼ˆRunningï¼‰ï¼špodå·²ç»è¢«è°ƒåº¦è‡³æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«kubeletåˆ›å»ºå®Œæˆ æˆåŠŸï¼ˆSucceededï¼‰ï¼špodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯ å¤±è´¥ï¼ˆFailedï¼‰ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é0å€¼çš„é€€å‡ºçŠ¶æ€ æœªçŸ¥ï¼ˆUnknownï¼‰ï¼šapiserveræ— æ³•æ­£å¸¸è·å–åˆ°podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±ç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´ 5.3.1 åˆ›å»ºå’Œç»ˆæ­¢podçš„åˆ›å»ºè¿‡ç¨‹ ç”¨æˆ·é€šè¿‡kubectlæˆ–å…¶ä»–apiå®¢æˆ·ç«¯æäº¤éœ€è¦åˆ›å»ºçš„podä¿¡æ¯ç»™apiServer apiServerå¼€å§‹ç”Ÿæˆpodå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯å­˜å…¥etcdï¼Œç„¶åè¿”å›ç¡®è®¤ä¿¡æ¯è‡³å®¢æˆ·ç«¯ apiServerå¼€å§‹åæ˜ etcdä¸­çš„podå¯¹è±¡çš„å˜åŒ–ï¼Œå…¶å®ƒç»„ä»¶ä½¿ç”¨watchæœºåˆ¶æ¥è·Ÿè¸ªæ£€æŸ¥apiServerä¸Šçš„å˜åŠ¨ schedulerå‘ç°æœ‰æ–°çš„podå¯¹è±¡è¦åˆ›å»ºï¼Œå¼€å§‹ä¸ºPodåˆ†é…ä¸»æœºå¹¶å°†ç»“æœä¿¡æ¯æ›´æ–°è‡³apiServer nodeèŠ‚ç‚¹ä¸Šçš„kubeletå‘ç°æœ‰podè°ƒåº¦è¿‡æ¥ï¼Œå°è¯•è°ƒç”¨dockerå¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†ç»“æœå›é€è‡³apiServer apiServerå°†æ¥æ”¶åˆ°çš„podçŠ¶æ€ä¿¡æ¯å­˜å…¥etcdä¸­ podçš„ç»ˆæ­¢è¿‡ç¨‹ ç”¨æˆ·å‘apiServerå‘é€åˆ é™¤podå¯¹è±¡çš„å‘½ä»¤ apiServcerä¸­çš„podå¯¹è±¡ä¿¡æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ›´æ–°ï¼Œåœ¨å®½é™æœŸå†…ï¼ˆé»˜è®¤30sï¼‰ï¼Œpodè¢«è§†ä¸ºdead å°†podæ ‡è®°ä¸ºterminatingçŠ¶æ€ kubeletåœ¨ç›‘æ§åˆ°podå¯¹è±¡è½¬ä¸ºterminatingçŠ¶æ€çš„åŒæ—¶å¯åŠ¨podå…³é—­è¿‡ç¨‹ ç«¯ç‚¹æ§åˆ¶å™¨ç›‘æ§åˆ°podå¯¹è±¡çš„å…³é—­è¡Œä¸ºæ—¶å°†å…¶ä»æ‰€æœ‰åŒ¹é…åˆ°æ­¤ç«¯ç‚¹çš„serviceèµ„æºçš„ç«¯ç‚¹åˆ—è¡¨ä¸­ç§»é™¤ å¦‚æœå½“å‰podå¯¹è±¡å®šä¹‰äº†preStopé’©å­å¤„ç†å™¨ï¼Œåˆ™åœ¨å…¶æ ‡è®°ä¸ºterminatingåå³ä¼šä»¥åŒæ­¥çš„æ–¹å¼å¯åŠ¨æ‰§è¡Œ podå¯¹è±¡ä¸­çš„å®¹å™¨è¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å· å®½é™æœŸç»“æŸåï¼Œè‹¥podä¸­è¿˜å­˜åœ¨ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆpodå¯¹è±¡ä¼šæ”¶åˆ°ç«‹å³ç»ˆæ­¢çš„ä¿¡å· kubeletè¯·æ±‚apiServerå°†æ­¤podèµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º0ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶podå¯¹äºç”¨æˆ·å·²ä¸å¯è§ 5.3.2 åˆå§‹åŒ–å®¹å™¨åˆå§‹åŒ–å®¹å™¨æ˜¯åœ¨podçš„ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰è¦è¿è¡Œçš„å®¹å™¨ï¼Œä¸»è¦æ˜¯åšä¸€äº›ä¸»å®¹å™¨çš„å‰ç½®å·¥ä½œï¼Œå®ƒå…·æœ‰ä¸¤å¤§ç‰¹å¾ï¼š åˆå§‹åŒ–å®¹å™¨å¿…é¡»è¿è¡Œå®Œæˆç›´è‡³ç»“æŸï¼Œè‹¥æŸåˆå§‹åŒ–å®¹å™¨è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆkuberneteséœ€è¦é‡å¯å®ƒç›´åˆ°æˆåŠŸå®Œæˆ åˆå§‹åŒ–å®¹å™¨å¿…é¡»æŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œå½“ä¸”ä»…å½“å‰ä¸€ä¸ªæˆåŠŸä¹‹åï¼Œåé¢çš„ä¸€ä¸ªæ‰èƒ½è¿è¡Œ åˆå§‹åŒ–å®¹å™¨æœ‰å¾ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æœ€å¸¸è§çš„å‡ ä¸ªï¼š æä¾›ä¸»å®¹å™¨é•œåƒä¸­ä¸å…·å¤‡çš„å·¥å…·ç¨‹åºæˆ–è‡ªå®šä¹‰ä»£ç  åˆå§‹åŒ–å®¹å™¨è¦å…ˆäºåº”ç”¨å®¹å™¨ä¸²è¡Œå¯åŠ¨å¹¶è¿è¡Œå®Œæˆï¼Œå› æ­¤å¯ç”¨äºå»¶ååº”ç”¨å®¹å™¨çš„å¯åŠ¨ç›´è‡³å…¶ä¾èµ–çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³ æ¥ä¸‹æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¨¡æ‹Ÿä¸‹é¢è¿™ä¸ªéœ€æ±‚ï¼š å‡è®¾è¦ä»¥ä¸»å®¹å™¨æ¥è¿è¡Œnginxï¼Œä½†æ˜¯è¦æ±‚åœ¨è¿è¡Œnginxä¹‹å‰å…ˆè¦èƒ½å¤Ÿè¿æ¥ä¸Šmysqlå’Œredisæ‰€åœ¨æœåŠ¡å™¨ ä¸ºäº†ç®€åŒ–æµ‹è¯•ï¼Œäº‹å…ˆè§„å®šå¥½mysql(192.168.90.14)å’Œredis(192.168.90.15)æœåŠ¡å™¨çš„åœ°å€ åˆ›å»ºpod-initcontainer.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819apiVersion: v1kind: Podmetadata: name: pod-initcontainer namespace: devspec: containers: - name: main-container image: nginx:1.17.1 ports: - name: nginx-port containerPort: 80 initContainers: - name: test-mysql image: busybox:1.30 command: [&#x27;sh&#x27;, &#x27;-c&#x27;, &#x27;until ping 192.168.90.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;&#x27;] - name: test-redis image: busybox:1.30 command: [&#x27;sh&#x27;, &#x27;-c&#x27;, &#x27;until ping 192.168.90.15 -c 1 ; do echo waiting for reids...; sleep 2; done;&#x27;] 12345678910111213141516171819202122232425262728# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pod-initcontainer.yamlpod/pod-initcontainer created# æŸ¥çœ‹podçŠ¶æ€# å‘ç°podå¡åœ¨å¯åŠ¨ç¬¬ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨è¿‡ç¨‹ä¸­ï¼Œåé¢çš„å®¹å™¨ä¸ä¼šè¿è¡Œroot@k8s-master01 ~]# kubectl describe pod pod-initcontainer -n dev........Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled 49s default-scheduler Successfully assigned dev/pod-initcontainer to node1 Normal Pulled 48s kubelet, node1 Container image &quot;busybox:1.30&quot; already present on machine Normal Created 48s kubelet, node1 Created container test-mysql Normal Started 48s kubelet, node1 Started container test-mysql# åŠ¨æ€æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods pod-initcontainer -n dev -wNAME READY STATUS RESTARTS AGEpod-initcontainer 0/1 Init:0/2 0 15spod-initcontainer 0/1 Init:1/2 0 52spod-initcontainer 0/1 Init:1/2 0 53spod-initcontainer 0/1 PodInitializing 0 89spod-initcontainer 1/1 Running 0 90s# æ¥ä¸‹æ¥æ–°å¼€ä¸€ä¸ªshellï¼Œä¸ºå½“å‰æœåŠ¡å™¨æ–°å¢ä¸¤ä¸ªipï¼Œè§‚å¯Ÿpodçš„å˜åŒ–[root@k8s-master01 ~]# ifconfig ens33:1 192.168.90.14 netmask 255.255.255.0 up[root@k8s-master01 ~]# ifconfig ens33:2 192.168.90.15 netmask 255.255.255.0 up 5.3.3 é’©å­å‡½æ•°é’©å­å‡½æ•°èƒ½å¤Ÿæ„ŸçŸ¥è‡ªèº«ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ï¼Œå¹¶åœ¨ç›¸åº”çš„æ—¶åˆ»åˆ°æ¥æ—¶è¿è¡Œç”¨æˆ·æŒ‡å®šçš„ç¨‹åºä»£ç ã€‚ kubernetesåœ¨ä¸»å®¹å™¨çš„å¯åŠ¨ä¹‹åå’Œåœæ­¢ä¹‹å‰æä¾›äº†ä¸¤ä¸ªé’©å­å‡½æ•°ï¼š post startï¼šå®¹å™¨åˆ›å»ºä¹‹åæ‰§è¡Œï¼Œå¦‚æœå¤±è´¥äº†ä¼šé‡å¯å®¹å™¨ pre stop ï¼šå®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åå®¹å™¨å°†æˆåŠŸç»ˆæ­¢ï¼Œåœ¨å…¶å®Œæˆä¹‹å‰ä¼šé˜»å¡åˆ é™¤å®¹å™¨çš„æ“ä½œ é’©å­å¤„ç†å™¨æ”¯æŒä½¿ç”¨ä¸‹é¢ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š Execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ 12345678â€¦â€¦ lifecycle: postStart: exec: command: - cat - /tmp/healthyâ€¦â€¦ TCPSocketï¼šåœ¨å½“å‰å®¹å™¨å°è¯•è®¿é—®æŒ‡å®šçš„socket 123456â€¦â€¦ lifecycle: postStart: tcpSocket: port: 8080â€¦â€¦ HTTPGetï¼šåœ¨å½“å‰å®¹å™¨ä¸­å‘æŸurlå‘èµ·httpè¯·æ±‚ 123456789â€¦â€¦ lifecycle: postStart: httpGet: path: / #URIåœ°å€ port: 80 #ç«¯å£å· host: 192.168.5.3 #ä¸»æœºåœ°å€ scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…httpsâ€¦â€¦ æ¥ä¸‹æ¥ï¼Œä»¥execæ–¹å¼ä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹é’©å­å‡½æ•°çš„ä½¿ç”¨ï¼Œåˆ›å»ºpod-hook-exec.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819apiVersion: v1kind: Podmetadata: name: pod-hook-exec namespace: devspec: containers: - name: main-container image: nginx:1.17.1 ports: - name: nginx-port containerPort: 80 lifecycle: postStart: exec: # åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä¿®æ”¹æ‰nginxçš„é»˜è®¤é¦–é¡µå†…å®¹ command: [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;echo postStart... &gt; /usr/share/nginx/html/index.html&quot;] preStop: exec: # åœ¨å®¹å™¨åœæ­¢ä¹‹å‰åœæ­¢nginxæœåŠ¡ command: [&quot;/usr/sbin/nginx&quot;,&quot;-s&quot;,&quot;quit&quot;] 123456789101112# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pod-hook-exec.yamlpod/pod-hook-exec created# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods pod-hook-exec -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE pod-hook-exec 1/1 Running 0 29s 10.244.2.48 node2 # è®¿é—®pod[root@k8s-master01 ~]# curl 10.244.2.48postStart... 5.3.4 å®¹å™¨æ¢æµ‹å®¹å™¨æ¢æµ‹ç”¨äºæ£€æµ‹å®¹å™¨ä¸­çš„åº”ç”¨å®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯ä¿éšœä¸šåŠ¡å¯ç”¨æ€§çš„ä¸€ç§ä¼ ç»Ÿæœºåˆ¶ã€‚å¦‚æœç»è¿‡æ¢æµ‹ï¼Œå®ä¾‹çš„çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆkuberneteså°±ä¼šæŠŠè¯¥é—®é¢˜å®ä¾‹â€ æ‘˜é™¤ â€œï¼Œä¸æ‰¿æ‹…ä¸šåŠ¡æµé‡ã€‚kubernetesæä¾›äº†ä¸¤ç§æ¢é’ˆæ¥å®ç°å®¹å™¨æ¢æµ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š liveness probesï¼šå­˜æ´»æ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œk8sä¼šé‡å¯å®¹å™¨ readiness probesï¼šå°±ç»ªæ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¯ä»¥æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœä¸èƒ½ï¼Œk8sä¸ä¼šè½¬å‘æµé‡ livenessProbe å†³å®šæ˜¯å¦é‡å¯å®¹å™¨ï¼ŒreadinessProbe å†³å®šæ˜¯å¦å°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨ã€‚ ä¸Šé¢ä¸¤ç§æ¢é’ˆç›®å‰å‡æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹å¼ï¼š Execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º0ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸ 1234567â€¦â€¦ livenessProbe: exec: command: - cat - /tmp/healthyâ€¦â€¦ TCPSocketï¼šå°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸ 12345â€¦â€¦ livenessProbe: tcpSocket: port: 8080â€¦â€¦ HTTPGetï¼šè°ƒç”¨å®¹å™¨å†…Webåº”ç”¨çš„URLï¼Œå¦‚æœè¿”å›çš„çŠ¶æ€ç åœ¨200å’Œ399ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸ 12345678â€¦â€¦ livenessProbe: httpGet: path: / #URIåœ°å€ port: 80 #ç«¯å£å· host: 127.0.0.1 #ä¸»æœºåœ°å€ scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…httpsâ€¦â€¦ ä¸‹é¢ä»¥liveness probesä¸ºä¾‹ï¼Œåšå‡ ä¸ªæ¼”ç¤ºï¼š æ–¹å¼ä¸€ï¼šExec åˆ›å»ºpod-liveness-exec.yaml 123456789101112131415apiVersion: v1kind: Podmetadata: name: pod-liveness-exec namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - name: nginx-port containerPort: 80 livenessProbe: exec: command: [&quot;/bin/cat&quot;,&quot;/tmp/hello.txt&quot;] # æ‰§è¡Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤ åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ 1234567891011121314151617181920# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-liveness-exec.yamlpod/pod-liveness-exec created# æŸ¥çœ‹Podè¯¦æƒ…[root@k8s-master01 ~]# kubectl describe pods pod-liveness-exec -n dev...... Normal Created 20s (x2 over 50s) kubelet, node1 Created container nginx Normal Started 20s (x2 over 50s) kubelet, node1 Started container nginx Normal Killing 20s kubelet, node1 Container nginx failed liveness probe, will be restarted Warning Unhealthy 0s (x5 over 40s) kubelet, node1 Liveness probe failed: cat: can&#x27;t open &#x27;/tmp/hello11.txt&#x27;: No such file or directory # è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯å°±ä¼šå‘ç°nginxå®¹å™¨å¯åŠ¨ä¹‹åå°±è¿›è¡Œäº†å¥åº·æ£€æŸ¥# æ£€æŸ¥å¤±è´¥ä¹‹åï¼Œå®¹å™¨è¢«killæ‰ï¼Œç„¶åå°è¯•è¿›è¡Œé‡å¯ï¼ˆè¿™æ˜¯é‡å¯ç­–ç•¥çš„ä½œç”¨ï¼Œåé¢è®²è§£ï¼‰# ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿[root@k8s-master01 ~]# kubectl get pods pod-liveness-exec -n devNAME READY STATUS RESTARTS AGEpod-liveness-exec 0/1 CrashLoopBackOff 2 3m19s# å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚/tmp/hello.txtï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†...... æ–¹å¼äºŒï¼šTCPSocket åˆ›å»ºpod-liveness-tcpsocket.yaml 123456789101112131415apiVersion: v1kind: Podmetadata: name: pod-liveness-tcpsocket namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - name: nginx-port containerPort: 80 livenessProbe: tcpSocket: port: 8080 # å°è¯•è®¿é—®8080ç«¯å£ åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ 1234567891011121314151617181920# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-liveness-tcpsocket.yamlpod/pod-liveness-tcpsocket created# æŸ¥çœ‹Podè¯¦æƒ…[root@k8s-master01 ~]# kubectl describe pods pod-liveness-tcpsocket -n dev...... Normal Scheduled 31s default-scheduler Successfully assigned dev/pod-liveness-tcpsocket to node2 Normal Pulled &lt;invalid&gt; kubelet, node2 Container image &quot;nginx:1.17.1&quot; already present on machine Normal Created &lt;invalid&gt; kubelet, node2 Created container nginx Normal Started &lt;invalid&gt; kubelet, node2 Started container nginx Warning Unhealthy &lt;invalid&gt; (x2 over &lt;invalid&gt;) kubelet, node2 Liveness probe failed: dial tcp 10.244.2.44:8080: connect: connection refused # è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯ï¼Œå‘ç°å°è¯•è®¿é—®8080ç«¯å£,ä½†æ˜¯å¤±è´¥äº†# ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿[root@k8s-master01 ~]# kubectl get pods pod-liveness-tcpsocket -n devNAME READY STATUS RESTARTS AGEpod-liveness-tcpsocket 0/1 CrashLoopBackOff 2 3m19s# å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„ç«¯å£ï¼Œæ¯”å¦‚80ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†...... æ–¹å¼ä¸‰ï¼šHTTPGet åˆ›å»ºpod-liveness-httpget.yaml 1234567891011121314151617apiVersion: v1kind: Podmetadata: name: pod-liveness-httpget namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - name: nginx-port containerPort: 80 livenessProbe: httpGet: # å…¶å®å°±æ˜¯è®¿é—®http://127.0.0.1:80/hello scheme: HTTP #æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https port: 80 #ç«¯å£å· path: /hello #URIåœ°å€ åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ 1234567891011121314151617181920# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-liveness-httpget.yamlpod/pod-liveness-httpget created# æŸ¥çœ‹Podè¯¦æƒ…[root@k8s-master01 ~]# kubectl describe pod pod-liveness-httpget -n dev....... Normal Pulled 6s (x3 over 64s) kubelet, node1 Container image &quot;nginx:1.17.1&quot; already present on machine Normal Created 6s (x3 over 64s) kubelet, node1 Created container nginx Normal Started 6s (x3 over 63s) kubelet, node1 Started container nginx Warning Unhealthy 6s (x6 over 56s) kubelet, node1 Liveness probe failed: HTTP probe failed with statuscode: 404 Normal Killing 6s (x2 over 36s) kubelet, node1 Container nginx failed liveness probe, will be restarted # è§‚å¯Ÿä¸Šé¢ä¿¡æ¯ï¼Œå°è¯•è®¿é—®è·¯å¾„ï¼Œä½†æ˜¯æœªæ‰¾åˆ°,å‡ºç°404é”™è¯¯# ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿[root@k8s-master01 ~]# kubectl get pod pod-liveness-httpget -n devNAME READY STATUS RESTARTS AGEpod-liveness-httpget 1/1 Running 5 3m17s# å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„è·¯å¾„pathï¼Œæ¯”å¦‚/ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†...... è‡³æ­¤ï¼Œå·²ç»ä½¿ç”¨liveness Probeæ¼”ç¤ºäº†ä¸‰ç§æ¢æµ‹æ–¹å¼ï¼Œä½†æ˜¯æŸ¥çœ‹livenessProbeçš„å­å±æ€§ï¼Œä¼šå‘ç°é™¤äº†è¿™ä¸‰ç§æ–¹å¼ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®ï¼Œåœ¨è¿™é‡Œä¸€å¹¶è§£é‡Šä¸‹ï¼š 12345678910[root@k8s-master01 ~]# kubectl explain pod.spec.containers.livenessProbeFIELDS: exec &lt;Object&gt; tcpSocket &lt;Object&gt; httpGet &lt;Object&gt; initialDelaySeconds &lt;integer&gt; # å®¹å™¨å¯åŠ¨åç­‰å¾…å¤šå°‘ç§’æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹ timeoutSeconds &lt;integer&gt; # æ¢æµ‹è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤1ç§’ï¼Œæœ€å°1ç§’ periodSeconds &lt;integer&gt; # æ‰§è¡Œæ¢æµ‹çš„é¢‘ç‡ã€‚é»˜è®¤æ˜¯10ç§’ï¼Œæœ€å°1ç§’ failureThreshold &lt;integer&gt; # è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯3ã€‚æœ€å°å€¼æ˜¯1 successThreshold &lt;integer&gt; # è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯1 ä¸‹é¢ç¨å¾®é…ç½®ä¸¤ä¸ªï¼Œæ¼”ç¤ºä¸‹æ•ˆæœå³å¯ï¼š 1234567891011121314151617181920[root@k8s-master01 ~]# more pod-liveness-httpget.yamlapiVersion: v1kind: Podmetadata: name: pod-liveness-httpget namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - name: nginx-port containerPort: 80 livenessProbe: httpGet: scheme: HTTP port: 80 path: / initialDelaySeconds: 30 # å®¹å™¨å¯åŠ¨å30så¼€å§‹æ¢æµ‹ timeoutSeconds: 5 # æ¢æµ‹è¶…æ—¶æ—¶é—´ä¸º5s 5.3.5 é‡å¯ç­–ç•¥åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œä¸€æ—¦å®¹å™¨æ¢æµ‹å‡ºç°äº†é—®é¢˜ï¼Œkuberneteså°±ä¼šå¯¹å®¹å™¨æ‰€åœ¨çš„Podè¿›è¡Œé‡å¯ï¼Œå…¶å®è¿™æ˜¯ç”±podçš„é‡å¯ç­–ç•¥å†³å®šçš„ï¼Œpodçš„é‡å¯ç­–ç•¥æœ‰ 3 ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š Always ï¼šå®¹å™¨å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚ OnFailure ï¼š å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶é‡å¯ Never ï¼š ä¸è®ºçŠ¶æ€ä¸ºä½•ï¼Œéƒ½ä¸é‡å¯è¯¥å®¹å™¨ é‡å¯ç­–ç•¥é€‚ç”¨äºpodå¯¹è±¡ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œé¦–æ¬¡éœ€è¦é‡å¯çš„å®¹å™¨ï¼Œå°†åœ¨å…¶éœ€è¦æ—¶ç«‹å³è¿›è¡Œé‡å¯ï¼Œéšåå†æ¬¡éœ€è¦é‡å¯çš„æ“ä½œå°†ç”±kubeletå»¶è¿Ÿä¸€æ®µæ—¶é—´åè¿›è¡Œï¼Œä¸”åå¤çš„é‡å¯æ“ä½œçš„å»¶è¿Ÿæ—¶é•¿ä»¥æ­¤ä¸º10sã€20sã€40sã€80sã€160så’Œ300sï¼Œ300sæ˜¯æœ€å¤§å»¶è¿Ÿæ—¶é•¿ã€‚ åˆ›å»ºpod-restartpolicy.yamlï¼š 123456789101112131415161718apiVersion: v1kind: Podmetadata: name: pod-restartpolicy namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - name: nginx-port containerPort: 80 livenessProbe: httpGet: scheme: HTTP port: 80 path: /hello restartPolicy: Never # è®¾ç½®é‡å¯ç­–ç•¥ä¸ºNever è¿è¡ŒPodæµ‹è¯• 1234567891011121314# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-restartpolicy.yamlpod/pod-restartpolicy created# æŸ¥çœ‹Podè¯¦æƒ…ï¼Œå‘ç°nginxå®¹å™¨å¤±è´¥[root@k8s-master01 ~]# kubectl describe pods pod-restartpolicy -n dev...... Warning Unhealthy 15s (x3 over 35s) kubelet, node1 Liveness probe failed: HTTP probe failed with statuscode: 404 Normal Killing 15s kubelet, node1 Container nginx failed liveness probe # å¤šç­‰ä¸€ä¼šï¼Œå†è§‚å¯Ÿpodçš„é‡å¯æ¬¡æ•°ï¼Œå‘ç°ä¸€ç›´æ˜¯0ï¼Œå¹¶æœªé‡å¯ [root@k8s-master01 ~]# kubectl get pods pod-restartpolicy -n devNAME READY STATUS RESTARTS AGEpod-restartpolicy 0/1 Running 0 5min42s 5.4 Podè°ƒåº¦åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªPodåœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ˜¯ç”±Schedulerç»„ä»¶é‡‡ç”¨ç›¸åº”çš„ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å—äººå·¥æ§åˆ¶çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ»¡è¶³çš„éœ€æ±‚ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶æŸäº›Podåˆ°è¾¾æŸäº›èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦æ±‚äº†è§£kuberneteså¯¹Podçš„è°ƒåº¦è§„åˆ™ï¼Œkubernetesæä¾›äº†å››å¤§ç±»è°ƒåº¦æ–¹å¼ï¼š è‡ªåŠ¨è°ƒåº¦ï¼šè¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šå®Œå…¨ç”±Schedulerç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•è®¡ç®—å¾—å‡º å®šå‘è°ƒåº¦ï¼šNodeNameã€NodeSelector äº²å’Œæ€§è°ƒåº¦ï¼šNodeAffinityã€PodAffinityã€PodAntiAffinity æ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼šTaintsã€Toleration 5.4.1 å®šå‘è°ƒåº¦å®šå‘è°ƒåº¦ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨åœ¨podä¸Šå£°æ˜nodeNameæˆ–è€…nodeSelectorï¼Œä»¥æ­¤å°†Podè°ƒåº¦åˆ°æœŸæœ›çš„nodeèŠ‚ç‚¹ä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„è°ƒåº¦æ˜¯å¼ºåˆ¶çš„ï¼Œè¿™å°±æ„å‘³ç€å³ä½¿è¦è°ƒåº¦çš„ç›®æ ‡Nodeä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‘ä¸Šé¢è¿›è¡Œè°ƒåº¦ï¼Œåªä¸è¿‡podè¿è¡Œå¤±è´¥è€Œå·²ã€‚ NodeName NodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„Nameçš„NodeèŠ‚ç‚¹ä¸Šã€‚è¿™ç§æ–¹å¼ï¼Œå…¶å®æ˜¯ç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å°†Podè°ƒåº¦åˆ°æŒ‡å®šåç§°çš„èŠ‚ç‚¹ã€‚ æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼šåˆ›å»ºä¸€ä¸ªpod-nodename.yamlæ–‡ä»¶ 12345678910apiVersion: v1kind: Podmetadata: name: pod-nodename namespace: devspec: containers: - name: nginx image: nginx:1.17.1 nodeName: node1 # æŒ‡å®šè°ƒåº¦åˆ°node1èŠ‚ç‚¹ä¸Š 1234567891011121314151617181920#åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-nodename.yamlpod/pod-nodename created#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ......pod-nodename 1/1 Running 0 56s 10.244.1.87 node1 ...... # æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeNameçš„å€¼ä¸ºnode3ï¼ˆå¹¶æ²¡æœ‰node3èŠ‚ç‚¹ï¼‰[root@k8s-master01 ~]# kubectl delete -f pod-nodename.yamlpod &quot;pod-nodename&quot; deleted[root@k8s-master01 ~]# vim pod-nodename.yaml[root@k8s-master01 ~]# kubectl create -f pod-nodename.yamlpod/pod-nodename created#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°å·²ç»å‘Node3èŠ‚ç‚¹è°ƒåº¦ï¼Œä½†æ˜¯ç”±äºä¸å­˜åœ¨node3èŠ‚ç‚¹ï¼Œæ‰€ä»¥podæ— æ³•æ­£å¸¸è¿è¡Œ[root@k8s-master01 ~]# kubectl get pods pod-nodename -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ......pod-nodename 0/1 Pending 0 6s &lt;none&gt; node3 ...... NodeSelector NodeSelectorç”¨äºå°†podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„nodeèŠ‚ç‚¹ä¸Šã€‚å®ƒæ˜¯é€šè¿‡kubernetesçš„label-selectoræœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨podåˆ›å»ºä¹‹å‰ï¼Œä¼šç”±schedulerä½¿ç”¨MatchNodeSelectorè°ƒåº¦ç­–ç•¥è¿›è¡ŒlabelåŒ¹é…ï¼Œæ‰¾å‡ºç›®æ ‡nodeï¼Œç„¶åå°†podè°ƒåº¦åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶çº¦æŸã€‚ æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼š 1 é¦–å…ˆåˆ†åˆ«ä¸ºnodeèŠ‚ç‚¹æ·»åŠ æ ‡ç­¾ 1234[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pronode/node2 labeled[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=testnode/node2 labeled 2 åˆ›å»ºä¸€ä¸ªpod-nodeselector.yamlæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒåˆ›å»ºPod 1234567891011apiVersion: v1kind: Podmetadata: name: pod-nodeselector namespace: devspec: containers: - name: nginx image: nginx:1.17.1 nodeSelector: nodeenv: pro # æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰nodeenv=proæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š 12345678910111213141516171819202122232425262728#åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yamlpod/pod-nodeselector created#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š[root@k8s-master01 ~]# kubectl get pods pod-nodeselector -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ......pod-nodeselector 1/1 Running 0 47s 10.244.1.87 node1 ......# æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeSelectorçš„å€¼ä¸ºnodeenv: xxxxï¼ˆä¸å­˜åœ¨æ‰“æœ‰æ­¤æ ‡ç­¾çš„èŠ‚ç‚¹ï¼‰[root@k8s-master01 ~]# kubectl delete -f pod-nodeselector.yamlpod &quot;pod-nodeselector&quot; deleted[root@k8s-master01 ~]# vim pod-nodeselector.yaml[root@k8s-master01 ~]# kubectl create -f pod-nodeselector.yamlpod/pod-nodeselector created#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°podæ— æ³•æ­£å¸¸è¿è¡Œ,Nodeçš„å€¼ä¸ºnone[root@k8s-master01 ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE pod-nodeselector 0/1 Pending 0 2m20s &lt;none&gt; &lt;none&gt;# æŸ¥çœ‹è¯¦æƒ…,å‘ç°node selectoråŒ¹é…å¤±è´¥çš„æç¤º[root@k8s-master01 ~]# kubectl describe pods pod-nodeselector -n dev.......Events: Type Reason Age From Message ---- ------ ---- ---- ------- Warning FailedScheduling &lt;unknown&gt; default-scheduler 0/3 nodes are available: 3 node(s) didn&#x27;t match node selector. 5.4.2 äº²å’Œæ€§è°ƒåº¦ä¸Šä¸€èŠ‚ï¼Œä»‹ç»äº†ä¸¤ç§å®šå‘è°ƒåº¦çš„æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„Nodeï¼Œé‚£ä¹ˆPodå°†ä¸ä¼šè¢«è¿è¡Œï¼Œå³ä½¿åœ¨é›†ç¾¤ä¸­è¿˜æœ‰å¯ç”¨Nodeåˆ—è¡¨ä¹Ÿä¸è¡Œï¼Œè¿™å°±é™åˆ¶äº†å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚ åŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œkubernetesè¿˜æä¾›äº†ä¸€ç§äº²å’Œæ€§è°ƒåº¦ï¼ˆAffinityï¼‰ã€‚å®ƒåœ¨NodeSelectorçš„åŸºç¡€ä¹‹ä¸Šçš„è¿›è¡Œäº†æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼ï¼Œå®ç°ä¼˜å…ˆé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„Nodeè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿è°ƒåº¦æ›´åŠ çµæ´»ã€‚ Affinityä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š nodeAffinity(nodeäº²å’Œæ€§ï¼‰: ä»¥nodeä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥è°ƒåº¦åˆ°å“ªäº›nodeçš„é—®é¢˜ podAffinity(podäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥å’Œå“ªäº›å·²å­˜åœ¨çš„podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ podAntiAffinity(podåäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podä¸èƒ½å’Œå“ªäº›å·²å­˜åœ¨podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜ å…³äºäº²å’Œæ€§(åäº²å’Œæ€§)ä½¿ç”¨åœºæ™¯çš„è¯´æ˜ï¼š äº²å’Œæ€§ï¼šå¦‚æœä¸¤ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œé‚£å°±æœ‰å¿…è¦åˆ©ç”¨äº²å’Œæ€§è®©ä¸¤ä¸ªåº”ç”¨çš„å°½å¯èƒ½çš„é è¿‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å› ç½‘ç»œé€šä¿¡è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚ åäº²å’Œæ€§ï¼šå½“åº”ç”¨çš„é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²æ—¶ï¼Œæœ‰å¿…è¦é‡‡ç”¨åäº²å’Œæ€§è®©å„ä¸ªåº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ªnodeä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚ NodeAffinity é¦–å…ˆæ¥çœ‹ä¸€ä¸‹NodeAffinityçš„å¯é…ç½®é¡¹ï¼š 12345678910111213141516pod.spec.affinity.nodeAffinity requiredDuringSchedulingIgnoredDuringExecution NodeèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬é™åˆ¶ nodeSelectorTerms èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨ matchFields æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨ matchExpressions æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è) key é”® values å€¼ operat or å…³ç³»ç¬¦ æ”¯æŒExists, DoesNotExist, In, NotIn, Gt, Lt preferredDuringSchedulingIgnoredDuringExecution ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æŒ‡å®šçš„è§„åˆ™çš„Nodeï¼Œç›¸å½“äºè½¯é™åˆ¶ (å€¾å‘) preference ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©å™¨é¡¹ï¼Œä¸ç›¸åº”çš„æƒé‡ç›¸å…³è” matchFields æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨ matchExpressions æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è) key é”® values å€¼ operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist, Gt, Lt weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100ã€‚ 1234567891011å…³ç³»ç¬¦çš„ä½¿ç”¨è¯´æ˜:- matchExpressions: - key: nodeenv # åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„keyä¸ºnodeenvçš„èŠ‚ç‚¹ operator: Exists - key: nodeenv # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueæ˜¯&quot;xxx&quot;æˆ–&quot;yyy&quot;çš„èŠ‚ç‚¹ operator: In values: [&quot;xxx&quot;,&quot;yyy&quot;] - key: nodeenv # åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueå¤§äº&quot;xxx&quot;çš„èŠ‚ç‚¹ operator: Gt values: &quot;xxx&quot; æ¥ä¸‹æ¥é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹requiredDuringSchedulingIgnoredDuringExecution , åˆ›å»ºpod-nodeaffinity-required.yaml 1234567891011121314151617apiVersion: v1kind: Podmetadata: name: pod-nodeaffinity-required namespace: devspec: containers: - name: nginx image: nginx:1.17.1 affinity: #äº²å’Œæ€§è®¾ç½® nodeAffinity: #è®¾ç½®nodeäº²å’Œæ€§ requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶ nodeSelectorTerms: - matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾ - key: nodeenv operator: In values: [&quot;xxx&quot;,&quot;yyy&quot;] 12345678910111213141516171819202122232425262728293031# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yamlpod/pod-nodeaffinity-required created# æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡Œå¤±è´¥ï¼‰[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ...... pod-nodeaffinity-required 0/1 Pending 0 16s &lt;none&gt; &lt;none&gt; ......# æŸ¥çœ‹Podçš„è¯¦æƒ…# å‘ç°è°ƒåº¦å¤±è´¥ï¼Œæç¤ºnodeé€‰æ‹©å¤±è´¥[root@k8s-master01 ~]# kubectl describe pod pod-nodeaffinity-required -n dev...... Warning FailedScheduling &lt;unknown&gt; default-scheduler 0/3 nodes are available: 3 node(s) didn&#x27;t match node selector. Warning FailedScheduling &lt;unknown&gt; default-scheduler 0/3 nodes are available: 3 node(s) didn&#x27;t match node selector.#æ¥ä¸‹æ¥ï¼Œåœæ­¢pod[root@k8s-master01 ~]# kubectl delete -f pod-nodeaffinity-required.yamlpod &quot;pod-nodeaffinity-required&quot; deleted# ä¿®æ”¹æ–‡ä»¶ï¼Œå°†values: [&quot;xxx&quot;,&quot;yyy&quot;]------&gt; [&quot;pro&quot;,&quot;yyy&quot;][root@k8s-master01 ~]# vim pod-nodeaffinity-required.yaml# å†æ¬¡å¯åŠ¨[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-required.yamlpod/pod-nodeaffinity-required created# æ­¤æ—¶æŸ¥çœ‹ï¼Œå‘ç°è°ƒåº¦æˆåŠŸï¼Œå·²ç»å°†podè°ƒåº¦åˆ°äº†node1ä¸Š[root@k8s-master01 ~]# kubectl get pods pod-nodeaffinity-required -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ...... pod-nodeaffinity-required 1/1 Running 0 11s 10.244.1.89 node1 ...... æ¥ä¸‹æ¥å†æ¼”ç¤ºä¸€ä¸‹requiredDuringSchedulingIgnoredDuringExecution , åˆ›å»ºpod-nodeaffinity-preferred.yaml 123456789101112131415161718apiVersion: v1kind: Podmetadata: name: pod-nodeaffinity-preferred namespace: devspec: containers: - name: nginx image: nginx:1.17.1 affinity: #äº²å’Œæ€§è®¾ç½® nodeAffinity: #è®¾ç½®nodeäº²å’Œæ€§ preferredDuringSchedulingIgnoredDuringExecution: # è½¯é™åˆ¶ - weight: 1 preference: matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾(å½“å‰ç¯å¢ƒæ²¡æœ‰) - key: nodeenv operator: In values: [&quot;xxx&quot;,&quot;yyy&quot;] 12345678# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pod-nodeaffinity-preferred.yamlpod/pod-nodeaffinity-preferred created# æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡ŒæˆåŠŸï¼‰[root@k8s-master01 ~]# kubectl get pod pod-nodeaffinity-preferred -n devNAME READY STATUS RESTARTS AGEpod-nodeaffinity-preferred 1/1 Running 0 40s 12345NodeAffinityè§„åˆ™è®¾ç½®çš„æ³¨æ„äº‹é¡¹ï¼š 1 å¦‚æœåŒæ—¶å®šä¹‰äº†nodeSelectorå’ŒnodeAffinityï¼Œé‚£ä¹ˆå¿…é¡»ä¸¤ä¸ªæ¡ä»¶éƒ½å¾—åˆ°æ»¡è¶³ï¼ŒPodæ‰èƒ½è¿è¡Œåœ¨æŒ‡å®šçš„Nodeä¸Š 2 å¦‚æœnodeAffinityæŒ‡å®šäº†å¤šä¸ªnodeSelectorTermsï¼Œé‚£ä¹ˆåªéœ€è¦å…¶ä¸­ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…æˆåŠŸå³å¯ 3 å¦‚æœä¸€ä¸ªnodeSelectorTermsä¸­æœ‰å¤šä¸ªmatchExpressions ï¼Œåˆ™ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„æ‰èƒ½åŒ¹é…æˆåŠŸ 4 å¦‚æœä¸€ä¸ªpodæ‰€åœ¨çš„Nodeåœ¨Podè¿è¡ŒæœŸé—´å…¶æ ‡ç­¾å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†ç¬¦åˆè¯¥Podçš„èŠ‚ç‚¹äº²å’Œæ€§éœ€æ±‚ï¼Œåˆ™ç³»ç»Ÿå°†å¿½ç•¥æ­¤å˜åŒ– PodAffinity PodAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œå®ç°è®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podåœ¨ä¸€ä¸ªåŒºåŸŸçš„åŠŸèƒ½ã€‚ é¦–å…ˆæ¥çœ‹ä¸€ä¸‹PodAffinityçš„å¯é…ç½®é¡¹ï¼š 123456789101112131415161718192021pod.spec.affinity.podAffinity requiredDuringSchedulingIgnoredDuringExecution ç¡¬é™åˆ¶ namespaces æŒ‡å®šå‚ç…§podçš„namespace topologyKey æŒ‡å®šè°ƒåº¦ä½œç”¨åŸŸ labelSelector æ ‡ç­¾é€‰æ‹©å™¨ matchExpressions æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è) key é”® values å€¼ operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist. matchLabels æŒ‡å¤šä¸ªmatchExpressionsæ˜ å°„çš„å†…å®¹ preferredDuringSchedulingIgnoredDuringExecution è½¯é™åˆ¶ podAffinityTerm é€‰é¡¹ namespaces topologyKey labelSelector matchExpressions key é”® values å€¼ operator matchLabels weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100 123topologyKeyç”¨äºæŒ‡å®šè°ƒåº¦æ—¶ä½œç”¨åŸŸ,ä¾‹å¦‚: å¦‚æœæŒ‡å®šä¸ºkubernetes.io/hostnameï¼Œé‚£å°±æ˜¯ä»¥NodeèŠ‚ç‚¹ä¸ºåŒºåˆ†èŒƒå›´ å¦‚æœæŒ‡å®šä¸ºbeta.kubernetes.io/os,åˆ™ä»¥NodeèŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç±»å‹æ¥åŒºåˆ† æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹requiredDuringSchedulingIgnoredDuringExecution, 1ï¼‰é¦–å…ˆåˆ›å»ºä¸€ä¸ªå‚ç…§Podï¼Œpod-podaffinity-target.yamlï¼š 123456789101112apiVersion: v1kind: Podmetadata: name: pod-podaffinity-target namespace: dev labels: podenv: pro #è®¾ç½®æ ‡ç­¾spec: containers: - name: nginx image: nginx:1.17.1 nodeName: node1 # å°†ç›®æ ‡podåç¡®æŒ‡å®šåˆ°node1ä¸Š 12345678# å¯åŠ¨ç›®æ ‡pod[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yamlpod/pod-podaffinity-target created# æŸ¥çœ‹podçŠ¶å†µ[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-target -n devNAME READY STATUS RESTARTS AGEpod-podaffinity-target 1/1 Running 0 4s 2ï¼‰åˆ›å»ºpod-podaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718apiVersion: v1kind: Podmetadata: name: pod-podaffinity-required namespace: devspec: containers: - name: nginx image: nginx:1.17.1 affinity: #äº²å’Œæ€§è®¾ç½® podAffinity: #è®¾ç½®podäº²å’Œæ€§ requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶ - labelSelector: matchExpressions: # åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾ - key: podenv operator: In values: [&quot;xxx&quot;,&quot;yyy&quot;] topologyKey: kubernetes.io/hostname ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=xxxæˆ–è€…nodeenv=yyyçš„podåœ¨åŒä¸€Nodeä¸Šï¼Œæ˜¾ç„¶ç°åœ¨æ²¡æœ‰è¿™æ ·podï¼Œæ¥ä¸‹æ¥ï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚ 12345678910111213141516171819202122232425262728293031# å¯åŠ¨pod[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yamlpod/pod-podaffinity-required created# æŸ¥çœ‹podçŠ¶æ€ï¼Œå‘ç°æœªè¿è¡Œ[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n devNAME READY STATUS RESTARTS AGEpod-podaffinity-required 0/1 Pending 0 9s# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯[root@k8s-master01 ~]# kubectl describe pods pod-podaffinity-required -n dev......Events: Type Reason Age From Message ---- ------ ---- ---- ------- Warning FailedScheduling &lt;unknown&gt; default-scheduler 0/3 nodes are available: 2 node(s) didn&#x27;t match pod affinity rules, 1 node(s) had taints that the pod didn&#x27;t tolerate.# æ¥ä¸‹æ¥ä¿®æ”¹ values: [&quot;xxx&quot;,&quot;yyy&quot;]-----&gt;values:[&quot;pro&quot;,&quot;yyy&quot;]# æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=xxxæˆ–è€…nodeenv=yyyçš„podåœ¨åŒä¸€Nodeä¸Š[root@k8s-master01 ~]# vim pod-podaffinity-required.yaml# ç„¶åé‡æ–°åˆ›å»ºpodï¼ŒæŸ¥çœ‹æ•ˆæœ[root@k8s-master01 ~]# kubectl delete -f pod-podaffinity-required.yamlpod &quot;pod-podaffinity-required&quot; de leted[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-required.yamlpod/pod-podaffinity-required created# å‘ç°æ­¤æ—¶Podè¿è¡Œæ­£å¸¸[root@k8s-master01 ~]# kubectl get pods pod-podaffinity-required -n devNAME READY STATUS RESTARTS AGE LABELSpod-podaffinity-required 1/1 Running 0 6s &lt;none&gt; å…³äºPodAffinityçš„ preferredDuringSchedulingIgnoredDuringExecutionï¼Œè¿™é‡Œä¸å†æ¼”ç¤ºã€‚ PodAntiAffinity PodAntiAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œè®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podä¸åœ¨ä¸€ä¸ªåŒºåŸŸä¸­çš„åŠŸèƒ½ã€‚ å®ƒçš„é…ç½®æ–¹å¼å’Œé€‰é¡¹è·ŸPodAffintyæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†åšè¯¦ç»†è§£é‡Šï¼Œç›´æ¥åšä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ã€‚ 1ï¼‰ç»§ç»­ä½¿ç”¨ä¸Šä¸ªæ¡ˆä¾‹ä¸­ç›®æ ‡pod 1234[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labelsNAME READY STATUS RESTARTS AGE IP NODE LABELSpod-podaffinity-required 1/1 Running 0 3m29s 10.244.1.38 node1 &lt;none&gt; pod-podaffinity-target 1/1 Running 0 9m25s 10.244.1.37 node1 podenv=pro 2ï¼‰åˆ›å»ºpod-podantiaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718apiVersion: v1kind: Podmetadata: name: pod-podantiaffinity-required namespace: devspec: containers: - name: nginx image: nginx:1.17.1 affinity: #äº²å’Œæ€§è®¾ç½® podAntiAffinity: #è®¾ç½®podäº²å’Œæ€§ requiredDuringSchedulingIgnoredDuringExecution: # ç¡¬é™åˆ¶ - labelSelector: matchExpressions: # åŒ¹é…podenvçš„å€¼åœ¨[&quot;pro&quot;]ä¸­çš„æ ‡ç­¾ - key: podenv operator: In values: [&quot;pro&quot;] topologyKey: kubernetes.io/hostname ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=proçš„podä¸åœ¨åŒä¸€Nodeä¸Šï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚ 123456789# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pod-podantiaffinity-required.yamlpod/pod-podantiaffinity-required created# æŸ¥çœ‹pod# å‘ç°è°ƒåº¦åˆ°äº†node2ä¸Š[root@k8s-master01 ~]# kubectl get pods pod-podantiaffinity-required -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE .. pod-podantiaffinity-required 1/1 Running 0 30s 10.244.1.96 node2 .. 5.4.3 æ±¡ç‚¹å’Œå®¹å¿æ±¡ç‚¹ï¼ˆTaintsï¼‰ å‰é¢çš„è°ƒåº¦æ–¹å¼éƒ½æ˜¯ç«™åœ¨Podçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Podä¸Šæ·»åŠ å±æ€§ï¼Œæ¥ç¡®å®šPodæ˜¯å¦è¦è°ƒåº¦åˆ°æŒ‡å®šçš„Nodeä¸Šï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨Nodeçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Nodeä¸Šæ·»åŠ æ±¡ç‚¹å±æ€§ï¼Œæ¥å†³å®šæ˜¯å¦å…è®¸Podè°ƒåº¦è¿‡æ¥ã€‚ Nodeè¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’ŒPodä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç»Podè°ƒåº¦è¿›æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²ç»å­˜åœ¨çš„Podé©±é€å‡ºå»ã€‚ æ±¡ç‚¹çš„æ ¼å¼ä¸ºï¼škey=value:effect, keyå’Œvalueæ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffectæè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š PreferNoScheduleï¼škuberneteså°†å°½é‡é¿å…æŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯è°ƒåº¦ NoScheduleï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œä½†ä¸ä¼šå½±å“å½“å‰Nodeä¸Šå·²å­˜åœ¨çš„Pod NoExecuteï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†Nodeä¸Šå·²å­˜åœ¨çš„Podé©±ç¦» ä½¿ç”¨kubectlè®¾ç½®å’Œå»é™¤æ±¡ç‚¹çš„å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678# è®¾ç½®æ±¡ç‚¹kubectl taint nodes node1 key=value:effect# å»é™¤æ±¡ç‚¹kubectl taint nodes node1 key:effect-# å»é™¤æ‰€æœ‰æ±¡ç‚¹kubectl taint nodes node1 key- æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹æ±¡ç‚¹çš„æ•ˆæœï¼š å‡†å¤‡èŠ‚ç‚¹node1ï¼ˆä¸ºäº†æ¼”ç¤ºæ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œæš‚æ—¶åœæ­¢node2èŠ‚ç‚¹ï¼‰ ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:PreferNoScheduleï¼›ç„¶ååˆ›å»ºpod1( pod1 å¯ä»¥ ) ä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:NoScheduleï¼›ç„¶ååˆ›å»ºpod2( pod1 æ­£å¸¸ pod2 å¤±è´¥ ) ä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: tag=heima:NoExecuteï¼›ç„¶ååˆ›å»ºpod3 ( 3ä¸ªpodéƒ½å¤±è´¥ ) 12345678910111213141516171819202122232425262728293031# ä¸ºnode1è®¾ç½®æ±¡ç‚¹(PreferNoSchedule)[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:PreferNoSchedule# åˆ›å»ºpod1[root@k8s-master01 ~]# kubectl run taint1 --image=nginx:1.17.1 -n dev[root@k8s-master01 ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE taint1-7665f7fd85-574h4 1/1 Running 0 2m24s 10.244.1.59 node1 # ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆPreferNoScheduleï¼Œè®¾ç½®NoSchedule)[root@k8s-master01 ~]# kubectl taint nodes node1 tag:PreferNoSchedule-[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoSchedule# åˆ›å»ºpod2[root@k8s-master01 ~]# kubectl run taint2 --image=nginx:1.17.1 -n dev[root@k8s-master01 ~]# kubectl get pods taint2 -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODEtaint1-7665f7fd85-574h4 1/1 Running 0 2m24s 10.244.1.59 node1 taint2-544694789-6zmlf 0/1 Pending 0 21s &lt;none&gt; &lt;none&gt; # ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆNoScheduleï¼Œè®¾ç½®NoExecute)[root@k8s-master01 ~]# kubectl taint nodes node1 tag:NoSchedule-[root@k8s-master01 ~]# kubectl taint nodes node1 tag=heima:NoExecute# åˆ›å»ºpod3[root@k8s-master01 ~]# kubectl run taint3 --image=nginx:1.17.1 -n dev[root@k8s-master01 ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED taint1-7665f7fd85-htkmp 0/1 Pending 0 35s &lt;none&gt; &lt;none&gt; &lt;none&gt; taint2-544694789-bn7wb 0/1 Pending 0 35s &lt;none&gt; &lt;none&gt; &lt;none&gt; taint3-6d78dbd749-tktkq 0/1 Pending 0 6s &lt;none&gt; &lt;none&gt; &lt;none&gt; 12å°æç¤ºï¼š ä½¿ç”¨kubeadmæ­å»ºçš„é›†ç¾¤ï¼Œé»˜è®¤å°±ä¼šç»™masterèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°,æ‰€ä»¥podå°±ä¸ä¼šè°ƒåº¦åˆ°masterèŠ‚ç‚¹ä¸Š. å®¹å¿ï¼ˆTolerationï¼‰ ä¸Šé¢ä»‹ç»äº†æ±¡ç‚¹çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nodeä¸Šæ·»åŠ æ±¡ç‚¹ç”¨äºæ‹’ç»podè°ƒåº¦ä¸Šæ¥ï¼Œä½†æ˜¯å¦‚æœå°±æ˜¯æƒ³å°†ä¸€ä¸ªpodè°ƒåº¦åˆ°ä¸€ä¸ªæœ‰æ±¡ç‚¹çš„nodeä¸Šå»ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦ä½¿ç”¨åˆ°å®¹å¿ã€‚ æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç» ä¸‹é¢å…ˆé€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹çœ‹ä¸‹æ•ˆæœï¼š ä¸Šä¸€å°èŠ‚ï¼Œå·²ç»åœ¨node1èŠ‚ç‚¹ä¸Šæ‰“ä¸Šäº†NoExecuteçš„æ±¡ç‚¹ï¼Œæ­¤æ—¶podæ˜¯è°ƒåº¦ä¸ä¸Šå»çš„ æœ¬å°èŠ‚ï¼Œå¯ä»¥é€šè¿‡ç»™podæ·»åŠ å®¹å¿ï¼Œç„¶åå°†å…¶è°ƒåº¦ä¸Šå» åˆ›å»ºpod-toleration.yaml,å†…å®¹å¦‚ä¸‹ 1234567891011121314apiVersion: v1kind: Podmetadata: name: pod-toleration namespace: devspec: containers: - name: nginx image: nginx:1.17.1 tolerations: # æ·»åŠ å®¹å¿ - key: &quot;tag&quot; # è¦å®¹å¿çš„æ±¡ç‚¹çš„key operator: &quot;Equal&quot; # æ“ä½œç¬¦ value: &quot;heima&quot; # å®¹å¿çš„æ±¡ç‚¹çš„value effect: &quot;NoExecute&quot; # æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ 123456789# æ·»åŠ å®¹å¿ä¹‹å‰çš„pod[root@k8s-master01 ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATED pod-toleration 0/1 Pending 0 3s &lt;none&gt; &lt;none&gt; &lt;none&gt; # æ·»åŠ å®¹å¿ä¹‹åçš„pod[root@k8s-master01 ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE NOMINATEDpod-toleration 1/1 Running 0 3s 10.244.1.62 node1 &lt;none&gt; ä¸‹é¢çœ‹ä¸€ä¸‹å®¹å¿çš„è¯¦ç»†é…ç½®: 12345678[root@k8s-master01 ~]# kubectl explain pod.spec.tolerations......FIELDS: key # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„é”®ï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„é”® value # å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„å€¼ operator # key-valueçš„è¿ç®—ç¬¦ï¼Œæ”¯æŒEqualå’ŒExistsï¼ˆé»˜è®¤ï¼‰ effect # å¯¹åº”æ±¡ç‚¹çš„effectï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰å½±å“ tolerationSeconds # å®¹å¿æ—¶é—´, å½“effectä¸ºNoExecuteæ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºpodåœ¨Nodeä¸Šçš„åœç•™æ—¶é—´ 6. Podæ§åˆ¶å™¨è¯¦è§£6.1 Podæ§åˆ¶å™¨ä»‹ç»Podæ˜¯kubernetesçš„æœ€å°ç®¡ç†å•å…ƒï¼Œåœ¨kubernetesä¸­ï¼ŒæŒ‰ç…§podçš„åˆ›å»ºæ–¹å¼å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š è‡ªä¸»å¼podï¼škubernetesç›´æ¥åˆ›å»ºå‡ºæ¥çš„Podï¼Œè¿™ç§podåˆ é™¤åå°±æ²¡æœ‰äº†ï¼Œä¹Ÿä¸ä¼šé‡å»º æ§åˆ¶å™¨åˆ›å»ºçš„podï¼škubernetesé€šè¿‡æ§åˆ¶å™¨åˆ›å»ºçš„podï¼Œè¿™ç§podåˆ é™¤äº†ä¹‹åè¿˜ä¼šè‡ªåŠ¨é‡å»º ä»€ä¹ˆæ˜¯Podæ§åˆ¶å™¨ Podæ§åˆ¶å™¨æ˜¯ç®¡ç†podçš„ä¸­é—´å±‚ï¼Œä½¿ç”¨Podæ§åˆ¶å™¨ä¹‹åï¼Œåªéœ€è¦å‘Šè¯‰Podæ§åˆ¶å™¨ï¼Œæƒ³è¦å¤šå°‘ä¸ªä»€ä¹ˆæ ·çš„Podå°±å¯ä»¥äº†ï¼Œå®ƒä¼šåˆ›å»ºå‡ºæ»¡è¶³æ¡ä»¶çš„Podå¹¶ç¡®ä¿æ¯ä¸€ä¸ªPodèµ„æºå¤„äºç”¨æˆ·æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ã€‚å¦‚æœPodèµ„æºåœ¨è¿è¡Œä¸­å‡ºç°æ•…éšœï¼Œå®ƒä¼šåŸºäºæŒ‡å®šç­–ç•¥é‡æ–°ç¼–æ’Podã€‚ åœ¨kubernetesä¸­ï¼Œæœ‰å¾ˆå¤šç±»å‹çš„podæ§åˆ¶å™¨ï¼Œæ¯ç§éƒ½æœ‰è‡ªå·±çš„é€‚åˆçš„åœºæ™¯ï¼Œå¸¸è§çš„æœ‰ä¸‹é¢è¿™äº›ï¼š ReplicationControllerï¼šæ¯”è¾ƒåŸå§‹çš„podæ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±ReplicaSetæ›¿ä»£ ReplicaSetï¼šä¿è¯å‰¯æœ¬æ•°é‡ä¸€ç›´ç»´æŒåœ¨æœŸæœ›å€¼ï¼Œå¹¶æ”¯æŒpodæ•°é‡æ‰©ç¼©å®¹ï¼Œé•œåƒç‰ˆæœ¬å‡çº§ Deploymentï¼šé€šè¿‡æ§åˆ¶ReplicaSetæ¥æ§åˆ¶Podï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€å›é€€ç‰ˆæœ¬ Horizontal Pod Autoscalerï¼šå¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨æ°´å¹³è°ƒæ•´Podçš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°· DaemonSetï¼šåœ¨é›†ç¾¤ä¸­çš„æŒ‡å®šNodeä¸Šè¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡ Jobï¼šå®ƒåˆ›å»ºå‡ºæ¥çš„podåªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œä¸éœ€è¦é‡å¯æˆ–é‡å»ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡ Cronjobï¼šå®ƒåˆ›å»ºçš„Podè´Ÿè´£å‘¨æœŸæ€§ä»»åŠ¡æ§åˆ¶ï¼Œä¸éœ€è¦æŒç»­åå°è¿è¡Œ StatefulSetï¼šç®¡ç†æœ‰çŠ¶æ€åº”ç”¨ 6.2 ReplicaSet(RS)ReplicaSetçš„ä¸»è¦ä½œç”¨æ˜¯ä¿è¯ä¸€å®šæ•°é‡çš„podæ­£å¸¸è¿è¡Œï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›Podçš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦Podå‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹podæ•°é‡çš„æ‰©ç¼©å®¹å’Œé•œåƒç‰ˆæœ¬çš„å‡é™çº§ã€‚ ReplicaSetçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š 123456789101112131415161718192021222324apiVersion: apps/v1 # ç‰ˆæœ¬å·kind: ReplicaSet # ç±»å‹ metadata: # å…ƒæ•°æ® name: # rsåç§° namespace: # æ‰€å±å‘½åç©ºé—´ labels: #æ ‡ç­¾ controller: rsspec: # è¯¦æƒ…æè¿° replicas: 3 # å‰¯æœ¬æ•°é‡ selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod matchLabels: # LabelsåŒ¹é…è§„åˆ™ app: nginx-pod matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™ - &#123;key: app, operator: In, values: [nginx-pod]&#125; template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80 åœ¨è¿™é‡Œé¢ï¼Œéœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯specä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š replicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“å‰rsåˆ›å»ºå‡ºæ¥çš„podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1 selectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹podæ§åˆ¶å™¨å’Œpodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨çš„Label Selectoræœºåˆ¶ åœ¨podæ¨¡æ¿ä¸Šå®šä¹‰labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›podäº† templateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºpodæ‰€ä½¿ç”¨çš„æ¨¡æ¿æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰ä¸€ç« å­¦è¿‡çš„podçš„å®šä¹‰ åˆ›å»ºReplicaSet åˆ›å»ºpc-replicaset.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718apiVersion: apps/v1kind: ReplicaSet metadata: name: pc-replicaset namespace: devspec: replicas: 3 selector: matchLabels: app: nginx-pod template: metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 12345678910111213141516171819# åˆ›å»ºrs[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yamlreplicaset.apps/pc-replicaset created# æŸ¥çœ‹rs# DESIRED:æœŸæœ›å‰¯æœ¬æ•°é‡ # CURRENT:å½“å‰å‰¯æœ¬æ•°é‡ # READY:å·²ç»å‡†å¤‡å¥½æä¾›æœåŠ¡çš„å‰¯æœ¬æ•°é‡[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wideNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES SELECTORpc-replicaset 3 3 3 22s nginx nginx:1.17.1 app=nginx-pod# æŸ¥çœ‹å½“å‰æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„pod# è¿™é‡Œå‘ç°æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„podçš„åç§°æ˜¯åœ¨æ§åˆ¶å™¨åç§°åé¢æ‹¼æ¥äº†-xxxxxéšæœºç [root@k8s-master01 ~]# kubectl get pod -n devNAME READY STATUS RESTARTS AGEpc-replicaset-6vmvt 1/1 Running 0 54spc-replicaset-fmb8f 1/1 Running 0 54spc-replicaset-snrk2 1/1 Running 0 54s æ‰©ç¼©å®¹ 12345678910111213141516171819202122232425262728293031323334# ç¼–è¾‘rsçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 6å³å¯[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n devreplicaset.apps/pc-replicaset edited# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-replicaset-6vmvt 1/1 Running 0 114mpc-replicaset-cftnp 1/1 Running 0 10spc-replicaset-fjlm6 1/1 Running 0 10spc-replicaset-fmb8f 1/1 Running 0 114mpc-replicaset-s2whj 1/1 Running 0 10spc-replicaset-snrk2 1/1 Running 0 114m# å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤å®ç°# ä½¿ç”¨scaleå‘½ä»¤å®ç°æ‰©ç¼©å®¹ï¼Œ åé¢--replicas=nç›´æ¥æŒ‡å®šç›®æ ‡æ•°é‡å³å¯[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n devreplicaset.apps/pc-replicaset scaled# å‘½ä»¤è¿è¡Œå®Œæ¯•ï¼Œç«‹å³æŸ¥çœ‹ï¼Œå‘ç°å·²ç»æœ‰4ä¸ªå¼€å§‹å‡†å¤‡é€€å‡ºäº†[root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-replicaset-6vmvt 0/1 Terminating 0 118mpc-replicaset-cftnp 0/1 Terminating 0 4m17spc-replicaset-fjlm6 0/1 Terminating 0 4m17spc-replicaset-fmb8f 1/1 Running 0 118mpc-replicaset-s2whj 0/1 Terminating 0 4m17spc-replicaset-snrk2 1/1 Running 0 118m#ç¨ç­‰ç‰‡åˆ»ï¼Œå°±åªå‰©ä¸‹2ä¸ªäº†[root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-replicaset-fmb8f 1/1 Running 0 119mpc-replicaset-snrk2 1/1 Running 0 119m é•œåƒå‡çº§ 123456789101112131415161718# ç¼–è¾‘rsçš„å®¹å™¨é•œåƒ - image: nginx:1.17.2[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n devreplicaset.apps/pc-replicaset edited# å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†[root@k8s-master01 ~]# kubectl get rs -n dev -o wideNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES ...pc-replicaset 2 2 2 140m nginx nginx:1.17.2 ...# åŒæ ·çš„é“ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤å®Œæˆè¿™ä¸ªå·¥ä½œ# kubectl set image rs rsåç§° å®¹å™¨=é•œåƒç‰ˆæœ¬ -n namespace[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1 -n devreplicaset.apps/pc-replicaset image updated# å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†[root@k8s-master01 ~]# kubectl get rs -n dev -o wideNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES ...pc-replicaset 2 2 2 145m nginx nginx:1.17.1 ... åˆ é™¤ReplicaSet 123456789101112131415161718# ä½¿ç”¨kubectl deleteå‘½ä»¤ä¼šåˆ é™¤æ­¤RSä»¥åŠå®ƒç®¡ç†çš„Pod# åœ¨kubernetesåˆ é™¤RSå‰ï¼Œä¼šå°†RSçš„replicasclearè°ƒæ•´ä¸º0ï¼Œç­‰å¾…æ‰€æœ‰çš„Podè¢«åˆ é™¤åï¼Œåœ¨æ‰§è¡ŒRSå¯¹è±¡çš„åˆ é™¤[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n devreplicaset.apps &quot;pc-replicaset&quot; deleted[root@k8s-master01 ~]# kubectl get pod -n dev -o wideNo resources found in dev namespace.# å¦‚æœå¸Œæœ›ä»…ä»…åˆ é™¤RSå¯¹è±¡ï¼ˆä¿ç•™Podï¼‰ï¼Œå¯ä»¥ä½¿ç”¨kubectl deleteå‘½ä»¤æ—¶æ·»åŠ --cascade=falseé€‰é¡¹ï¼ˆä¸æ¨èï¼‰ã€‚[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=falsereplicaset.apps &quot;pc-replicaset&quot; deleted[root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-replicaset-cl82j 1/1 Running 0 75spc-replicaset-dslhb 1/1 Running 0 75s# ä¹Ÿå¯ä»¥ä½¿ç”¨yamlç›´æ¥åˆ é™¤(æ¨è)[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yamlreplicaset.apps &quot;pc-replicaset&quot; deleted 6.3 Deployment(Deploy)ä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œkubernetesåœ¨V1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†Deploymentæ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†podï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†ReplicaSetæ¥ç®€ä»‹ç®¡ç†Podï¼Œå³ï¼šDeploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podã€‚æ‰€ä»¥Deploymentæ¯”ReplicaSetåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚ Deploymentä¸»è¦åŠŸèƒ½æœ‰ä¸‹é¢å‡ ä¸ªï¼š æ”¯æŒReplicaSetçš„æ‰€æœ‰åŠŸèƒ½ æ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­ æ”¯æŒæ»šåŠ¨å‡çº§å’Œå›æ»šç‰ˆæœ¬ Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132apiVersion: apps/v1 # ç‰ˆæœ¬å·kind: Deployment # ç±»å‹ metadata: # å…ƒæ•°æ® name: # rsåç§° namespace: # æ‰€å±å‘½åç©ºé—´ labels: #æ ‡ç­¾ controller: deployspec: # è¯¦æƒ…æè¿° replicas: 3 # å‰¯æœ¬æ•°é‡ revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬ paused: false # æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false progressDeadlineSeconds: 600 # éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600 strategy: # ç­–ç•¥ type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥ rollingUpdate: # æ»šåŠ¨æ›´æ–° maxSurge: 30% # æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•° maxUnavailable: 30% # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•° selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod matchLabels: # LabelsåŒ¹é…è§„åˆ™ app: nginx-pod matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™ - &#123;key: app, operator: In, values: [nginx-pod]&#125; template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80 6.3.1 åˆ›å»ºdeploymentåˆ›å»ºpc-deployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718apiVersion: apps/v1kind: Deployment metadata: name: pc-deployment namespace: devspec: replicas: 3 selector: matchLabels: app: nginx-pod template: metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 1234567891011121314151617181920212223# åˆ›å»ºdeployment[root@k8s-master01 ~]# kubectl create -f pc-deployment.yaml --record=truedeployment.apps/pc-deployment created# æŸ¥çœ‹deployment# UP-TO-DATE æœ€æ–°ç‰ˆæœ¬çš„podçš„æ•°é‡# AVAILABLE å½“å‰å¯ç”¨çš„podçš„æ•°é‡[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n devNAME READY UP-TO-DATE AVAILABLE AGEpc-deployment 3/3 3 3 15s# æŸ¥çœ‹rs# å‘ç°rsçš„åç§°æ˜¯åœ¨åŸæ¥deploymentçš„åå­—åé¢æ·»åŠ äº†ä¸€ä¸ª10ä½æ•°çš„éšæœºä¸²[root@k8s-master01 ~]# kubectl get rs -n devNAME DESIRED CURRENT READY AGEpc-deployment-6696798b78 3 3 3 23s# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-deployment-6696798b78-d2c8n 1/1 Running 0 107spc-deployment-6696798b78-smpvp 1/1 Running 0 107spc-deployment-6696798b78-wvjd8 1/1 Running 0 107s 6.3.2 æ‰©ç¼©å®¹1234567891011121314151617181920212223242526272829# å˜æ›´å‰¯æœ¬æ•°é‡ä¸º5ä¸ª[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5 -n devdeployment.apps/pc-deployment scaled# æŸ¥çœ‹deployment[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n devNAME READY UP-TO-DATE AVAILABLE AGEpc-deployment 5/5 5 5 2m# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-deployment-6696798b78-d2c8n 1/1 Running 0 4m19spc-deployment-6696798b78-jxmdq 1/1 Running 0 94spc-deployment-6696798b78-mktqv 1/1 Running 0 93spc-deployment-6696798b78-smpvp 1/1 Running 0 4m19spc-deployment-6696798b78-wvjd8 1/1 Running 0 4m19s# ç¼–è¾‘deploymentçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 4å³å¯[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n devdeployment.apps/pc-deployment edited# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-deployment-6696798b78-d2c8n 1/1 Running 0 5m23spc-deployment-6696798b78-jxmdq 1/1 Running 0 2m38spc-deployment-6696798b78-smpvp 1/1 Running 0 5m23spc-deployment-6696798b78-wvjd8 1/1 Running 0 5m23s é•œåƒæ›´æ–° deploymentæ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥:é‡å»ºæ›´æ–°å’Œæ»šåŠ¨æ›´æ–°,å¯ä»¥é€šè¿‡strategyæŒ‡å®šç­–ç•¥ç±»å‹,æ”¯æŒä¸¤ä¸ªå±æ€§: 1234567strategyï¼šæŒ‡å®šæ–°çš„Podæ›¿æ¢æ—§çš„Podçš„ç­–ç•¥ï¼Œ æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š typeï¼šæŒ‡å®šç­–ç•¥ç±»å‹ï¼Œæ”¯æŒä¸¤ç§ç­–ç•¥ Recreateï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„Podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²å­˜åœ¨çš„Pod RollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼Œå°±æ˜¯æ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬Pod rollingUpdateï¼šå½“typeä¸ºRollingUpdateæ—¶ç”Ÿæ•ˆï¼Œç”¨äºä¸ºRollingUpdateè®¾ç½®å‚æ•°ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§ï¼š maxUnavailableï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚ maxSurgeï¼š ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚ é‡å»ºæ›´æ–° ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥ 123spec: strategy: # ç­–ç•¥ type: Recreate # é‡å»ºæ›´æ–° åˆ›å»ºdeployè¿›è¡ŒéªŒè¯ 1234567891011121314151617181920212223242526# å˜æ›´é•œåƒ[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n devdeployment.apps/pc-deployment image updated# è§‚å¯Ÿå‡çº§è¿‡ç¨‹[root@k8s-master01 ~]# kubectl get pods -n dev -wNAME READY STATUS RESTARTS AGEpc-deployment-5d89bdfbf9-65qcw 1/1 Running 0 31spc-deployment-5d89bdfbf9-w5nzv 1/1 Running 0 31spc-deployment-5d89bdfbf9-xpt7w 1/1 Running 0 31spc-deployment-5d89bdfbf9-xpt7w 1/1 Terminating 0 41spc-deployment-5d89bdfbf9-65qcw 1/1 Terminating 0 41spc-deployment-5d89bdfbf9-w5nzv 1/1 Terminating 0 41spc-deployment-675d469f8b-grn8z 0/1 Pending 0 0spc-deployment-675d469f8b-hbl4v 0/1 Pending 0 0spc-deployment-675d469f8b-67nz2 0/1 Pending 0 0spc-deployment-675d469f8b-grn8z 0/1 ContainerCreating 0 0spc-deployment-675d469f8b-hbl4v 0/1 ContainerCreating 0 0spc-deployment-675d469f8b-67nz2 0/1 ContainerCreating 0 0spc-deployment-675d469f8b-grn8z 1/1 Running 0 1spc-deployment-675d469f8b-67nz2 1/1 Running 0 1spc-deployment-675d469f8b-hbl4v 1/1 Running 0 2s æ»šåŠ¨æ›´æ–° ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥ 123456spec: strategy: # ç­–ç•¥ type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥ rollingUpdate: maxSurge: 25% maxUnavailable: 25% åˆ›å»ºdeployè¿›è¡ŒéªŒè¯ 12345678910111213141516171819202122232425262728293031323334# å˜æ›´é•œåƒ[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev deployment.apps/pc-deployment image updated# è§‚å¯Ÿå‡çº§è¿‡ç¨‹[root@k8s-master01 ~]# kubectl get pods -n dev -wNAME READY STATUS RESTARTS AGEpc-deployment-c848d767-8rbzt 1/1 Running 0 31mpc-deployment-c848d767-h4p68 1/1 Running 0 31mpc-deployment-c848d767-hlmz4 1/1 Running 0 31mpc-deployment-c848d767-rrqcn 1/1 Running 0 31mpc-deployment-966bf7f44-226rx 0/1 Pending 0 0spc-deployment-966bf7f44-226rx 0/1 ContainerCreating 0 0spc-deployment-966bf7f44-226rx 1/1 Running 0 1spc-deployment-c848d767-h4p68 0/1 Terminating 0 34mpc-deployment-966bf7f44-cnd44 0/1 Pending 0 0spc-deployment-966bf7f44-cnd44 0/1 ContainerCreating 0 0spc-deployment-966bf7f44-cnd44 1/1 Running 0 2spc-deployment-c848d767-hlmz4 0/1 Terminating 0 34mpc-deployment-966bf7f44-px48p 0/1 Pending 0 0spc-deployment-966bf7f44-px48p 0/1 ContainerCreating 0 0spc-deployment-966bf7f44-px48p 1/1 Running 0 0spc-deployment-c848d767-8rbzt 0/1 Terminating 0 34mpc-deployment-966bf7f44-dkmqp 0/1 Pending 0 0spc-deployment-966bf7f44-dkmqp 0/1 ContainerCreating 0 0spc-deployment-966bf7f44-dkmqp 1/1 Running 0 2spc-deployment-c848d767-rrqcn 0/1 Terminating 0 34m# è‡³æ­¤ï¼Œæ–°ç‰ˆæœ¬çš„podåˆ›å»ºå®Œæ¯•ï¼Œå°±ç‰ˆæœ¬çš„podé”€æ¯å®Œæ¯•# ä¸­é—´è¿‡ç¨‹æ˜¯æ»šåŠ¨è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¾¹é”€æ¯è¾¹åˆ›å»º æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ï¼š é•œåƒæ›´æ–°ä¸­rsçš„å˜åŒ– 1234567# æŸ¥çœ‹rs,å‘ç°åŸæ¥çš„rsçš„ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯podæ•°é‡å˜ä¸ºäº†0ï¼Œè€Œååˆæ–°äº§ç”Ÿäº†ä¸€ä¸ªrsï¼Œpodæ•°é‡ä¸º4# å…¶å®è¿™å°±æ˜¯deploymentèƒ½å¤Ÿè¿›è¡Œç‰ˆæœ¬å›é€€çš„å¥¥å¦™æ‰€åœ¨ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Š[root@k8s-master01 ~]# kubectl get rs -n devNAME DESIRED CURRENT READY AGEpc-deployment-6696798b78 0 0 0 7m37spc-deployment-6696798b11 0 0 0 5m37spc-deployment-c848d76789 4 4 4 72s 6.3.3 ç‰ˆæœ¬å›é€€deploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœã€ç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹. kubectl rolloutï¼š ç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼š status æ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€ history æ˜¾ç¤º å‡çº§å†å²è®°å½• pause æš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹ resume ç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹ restart é‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹ undo å›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨â€“to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰ 12345678910111213141516171819202122232425262728293031# æŸ¥çœ‹å½“å‰å‡çº§ç‰ˆæœ¬çš„çŠ¶æ€[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n devdeployment &quot;pc-deployment&quot; successfully rolled out# æŸ¥çœ‹å‡çº§å†å²è®°å½•[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n devdeployment.apps/pc-deploymentREVISION CHANGE-CAUSE1 kubectl create --filename=pc-deployment.yaml --record=true2 kubectl create --filename=pc-deployment.yaml --record=true3 kubectl create --filename=pc-deployment.yaml --record=true# å¯ä»¥å‘ç°æœ‰ä¸‰æ¬¡ç‰ˆæœ¬è®°å½•ï¼Œè¯´æ˜å®Œæˆè¿‡ä¸¤æ¬¡å‡çº§# ç‰ˆæœ¬å›æ»š# è¿™é‡Œç›´æ¥ä½¿ç”¨--to-revision=1å›æ»šåˆ°äº†1ç‰ˆæœ¬ï¼Œ å¦‚æœçœç•¥è¿™ä¸ªé€‰é¡¹ï¼Œå°±æ˜¯å›é€€åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯2ç‰ˆæœ¬[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n devdeployment.apps/pc-deployment rolled back# æŸ¥çœ‹å‘ç°ï¼Œé€šè¿‡nginxé•œåƒç‰ˆæœ¬å¯ä»¥å‘ç°åˆ°äº†ç¬¬ä¸€ç‰ˆ[root@k8s-master01 ~]# kubectl get deploy -n dev -o wideNAME READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES pc-deployment 4/4 4 4 74m nginx nginx:1.17.1 # æŸ¥çœ‹rsï¼Œå‘ç°ç¬¬ä¸€ä¸ªrsä¸­æœ‰4ä¸ªpodè¿è¡Œï¼Œåé¢ä¸¤ä¸ªç‰ˆæœ¬çš„rsä¸­podä¸ºè¿è¡Œ# å…¶å®deploymentä¹‹æ‰€ä»¥å¯æ˜¯å®ç°ç‰ˆæœ¬çš„å›æ»šï¼Œå°±æ˜¯é€šè¿‡è®°å½•ä¸‹å†å²rsæ¥å®ç°çš„ï¼Œ# ä¸€æ—¦æƒ³å›æ»šåˆ°å“ªä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å°†å½“å‰ç‰ˆæœ¬podæ•°é‡é™ä¸º0ï¼Œç„¶åå°†å›æ»šç‰ˆæœ¬çš„podæå‡ä¸ºç›®æ ‡æ•°é‡å°±å¯ä»¥äº†[root@k8s-master01 ~]# kubectl get rs -n devNAME DESIRED CURRENT READY AGEpc-deployment-6696798b78 4 4 4 78mpc-deployment-966bf7f44 0 0 0 37mpc-deployment-c848d767 0 0 0 71m 6.3.4 é‡‘ä¸é›€å‘å¸ƒDeploymentæ§åˆ¶å™¨æ”¯æŒæ§åˆ¶æ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚â€œæš‚åœ(pause)â€æˆ–â€œç»§ç»­(resume)â€æ›´æ–°æ“ä½œã€‚ æ¯”å¦‚æœ‰ä¸€æ‰¹æ–°çš„Podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ï¼Œä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚ç„¶åï¼Œå†ç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°ç‰ˆæœ¬çš„Podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šåœ°æŒ‰æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„Podèµ„æºæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚è¿™å°±æ˜¯æ‰€è°“çš„é‡‘ä¸é›€å‘å¸ƒã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041# æ›´æ–°deploymentçš„ç‰ˆæœ¬ï¼Œå¹¶é…ç½®æš‚åœdeployment[root@k8s-master01 ~]# kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deployment pc-deployment -n devdeployment.apps/pc-deployment image updateddeployment.apps/pc-deployment paused#è§‚å¯Ÿæ›´æ–°çŠ¶æ€[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev Waiting for deployment &quot;pc-deployment&quot; rollout to finish: 2 out of 4 new replicas have been updated...# ç›‘æ§æ›´æ–°çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ–°å¢äº†ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å¹¶æœªæŒ‰ç…§é¢„æœŸçš„çŠ¶æ€å»åˆ é™¤ä¸€ä¸ªæ—§çš„èµ„æºï¼Œå°±æ˜¯å› ä¸ºä½¿ç”¨äº†pauseæš‚åœå‘½ä»¤[root@k8s-master01 ~]# kubectl get rs -n dev -o wideNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES pc-deployment-5d89bdfbf9 3 3 3 19m nginx nginx:1.17.1 pc-deployment-675d469f8b 0 0 0 14m nginx nginx:1.17.2 pc-deployment-6c9f56fcfb 2 2 2 3m16s nginx nginx:1.17.4 [root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-deployment-5d89bdfbf9-rj8sq 1/1 Running 0 7m33spc-deployment-5d89bdfbf9-ttwgg 1/1 Running 0 7m35spc-deployment-5d89bdfbf9-v4wvc 1/1 Running 0 7m34spc-deployment-6c9f56fcfb-996rt 1/1 Running 0 3m31spc-deployment-6c9f56fcfb-j2gtj 1/1 Running 0 3m31s# ç¡®ä¿æ›´æ–°çš„podæ²¡é—®é¢˜äº†ï¼Œç»§ç»­æ›´æ–°[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n devdeployment.apps/pc-deployment resumed# æŸ¥çœ‹æœ€åçš„æ›´æ–°æƒ…å†µ[root@k8s-master01 ~]# kubectl get rs -n dev -o wideNAME DESIRED CURRENT READY AGE CONTAINERS IMAGES pc-deployment-5d89bdfbf9 0 0 0 21m nginx nginx:1.17.1 pc-deployment-675d469f8b 0 0 0 16m nginx nginx:1.17.2 pc-deployment-6c9f56fcfb 4 4 4 5m11s nginx nginx:1.17.4 [root@k8s-master01 ~]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEpc-deployment-6c9f56fcfb-7bfwh 1/1 Running 0 37spc-deployment-6c9f56fcfb-996rt 1/1 Running 0 5m27spc-deployment-6c9f56fcfb-j2gtj 1/1 Running 0 5m27spc-deployment-6c9f56fcfb-rf84v 1/1 Running 0 37s åˆ é™¤Deployment 123# åˆ é™¤deploymentï¼Œå…¶ä¸‹çš„rså’Œpodä¹Ÿå°†è¢«åˆ é™¤[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yamldeployment.apps &quot;pc-deployment&quot; deleted 6.4 Horizontal Pod Autoscaler(HPA)åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®ç°é€šè¿‡æ‰‹å·¥æ‰§è¡Œkubectl scaleå‘½ä»¤å®ç°Podæ‰©å®¹æˆ–ç¼©å®¹ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶ä¸ç¬¦åˆKubernetesçš„å®šä½ç›®æ ‡â€“è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€‚ KubernetesæœŸæœ›å¯ä»¥å®ç°é€šè¿‡ç›‘æµ‹Podçš„ä½¿ç”¨æƒ…å†µï¼Œå®ç°podæ•°é‡çš„è‡ªåŠ¨è°ƒæ•´ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†Horizontal Pod Autoscalerï¼ˆHPAï¼‰è¿™ç§æ§åˆ¶å™¨ã€‚ HPAå¯ä»¥è·å–æ¯ä¸ªPodåˆ©ç”¨ç‡ï¼Œç„¶åå’ŒHPAä¸­å®šä¹‰çš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ï¼ŒåŒæ—¶è®¡ç®—å‡ºéœ€è¦ä¼¸ç¼©çš„å…·ä½“å€¼ï¼Œæœ€åå®ç°Podçš„æ•°é‡çš„è°ƒæ•´ã€‚å…¶å®HPAä¸ä¹‹å‰çš„Deploymentä¸€æ ·ï¼Œä¹Ÿå±äºä¸€ç§Kubernetesèµ„æºå¯¹è±¡ï¼Œå®ƒé€šè¿‡è¿½è¸ªåˆ†æRCæ§åˆ¶çš„æ‰€æœ‰ç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦é’ˆå¯¹æ€§åœ°è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°ï¼Œè¿™æ˜¯HPAçš„å®ç°åŸç†ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªå®éªŒ 6.4.1 å®‰è£…metrics-servermetrics-serverå¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µ 12345678910111213# å®‰è£…git[root@k8s-master01 ~]# yum install git -y# è·å–metrics-server, æ³¨æ„ä½¿ç”¨çš„ç‰ˆæœ¬[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server# ä¿®æ”¹deployment, æ³¨æ„ä¿®æ”¹çš„æ˜¯é•œåƒå’Œåˆå§‹åŒ–å‚æ•°[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/[root@k8s-master01 1.8+]# vim metrics-server-deployment.yamlæŒ‰å›¾ä¸­æ·»åŠ ä¸‹é¢é€‰é¡¹hostNetwork: trueimage: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6args:- --kubelet-insecure-tls- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP 1234567891011121314151617181920# å®‰è£…metrics-server[root@k8s-master01 1.8+]# kubectl apply -f ./# æŸ¥çœ‹podè¿è¡Œæƒ…å†µ[root@k8s-master01 1.8+]# kubectl get pod -n kube-systemmetrics-server-6b976979db-2xwbj 1/1 Running 0 90s# ä½¿ç”¨kubectl top node æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ[root@k8s-master01 1.8+]# kubectl top nodeNAME CPU(cores) CPU% MEMORY(bytes) MEMORY%k8s-master01 289m 14% 1582Mi 54% k8s-node01 81m 4% 1195Mi 40% k8s-node02 72m 3% 1211Mi 41% [root@k8s-master01 1.8+]# kubectl top pod -n kube-systemNAME CPU(cores) MEMORY(bytes)coredns-6955765f44-7ptsb 3m 9Micoredns-6955765f44-vcwr5 3m 8Mietcd-master 14m 145Mi...# è‡³æ­¤,metrics-serverå®‰è£…å®Œæˆ 6.4.2 å‡†å¤‡deploymentå’Œservieåˆ›å»ºpc-hpa-pod.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425apiVersion: apps/v1kind: Deploymentmetadata: name: nginx namespace: devspec: strategy: # ç­–ç•¥ type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥ replicas: 1 selector: matchLabels: app: nginx-pod template: metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 resources: # èµ„æºé…é¢ limits: # é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰ cpu: &quot;1&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•° requests: # è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰ cpu: &quot;100m&quot; # CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•° 1234# åˆ›å»ºdeployment[root@k8s-master01 1.8+]# kubectl run nginx --image=nginx:1.17.1 --requests=cpu=100m -n dev# åˆ›å»ºservice[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=NodePort --port=80 -n dev 12345678910# æŸ¥çœ‹[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n devNAME READY UP-TO-DATE AVAILABLE AGEdeployment.apps/nginx 1/1 1 1 47sNAME READY STATUS RESTARTS AGEpod/nginx-7df9756ccc-bh8dr 1/1 Running 0 47sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/nginx NodePort 10.101.18.29 &lt;none&gt; 80:31830/TCP 35s 6.4.3 éƒ¨ç½²HPAåˆ›å»ºpc-hpa.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213apiVersion: autoscaling/v1kind: HorizontalPodAutoscalermetadata: name: pc-hpa namespace: devspec: minReplicas: 1 #æœ€å°podæ•°é‡ maxReplicas: 10 #æœ€å¤§podæ•°é‡ targetCPUUtilizationPercentage: 3 # CPUä½¿ç”¨ç‡æŒ‡æ ‡ scaleTargetRef: # æŒ‡å®šè¦æ§åˆ¶çš„nginxä¿¡æ¯ apiVersion: /v1 kind: Deployment name: nginx 12345678# åˆ›å»ºhpa[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yamlhorizontalpodautoscaler.autoscaling/pc-hpa created# æŸ¥çœ‹hpa [root@k8s-master01 1.8+]# kubectl get hpa -n devNAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGEpc-hpa Deployment/nginx 0%/3% 1 10 1 62s 6.4.4 æµ‹è¯•ä½¿ç”¨å‹æµ‹å·¥å…·å¯¹serviceåœ°å€192.168.5.4:31830è¿›è¡Œå‹æµ‹ï¼Œç„¶åé€šè¿‡æ§åˆ¶å°æŸ¥çœ‹hpaå’Œpodçš„å˜åŒ– hpaå˜åŒ– 1234567891011[root@k8s-master01 ~]# kubectl get hpa -n dev -wNAME REFERENCE TARGETS MINPODS MAXPODS REPLICAS AGEpc-hpa Deployment/nginx 0%/3% 1 10 1 4m11spc-hpa Deployment/nginx 0%/3% 1 10 1 5m19spc-hpa Deployment/nginx 22%/3% 1 10 1 6m50spc-hpa Deployment/nginx 22%/3% 1 10 4 7m5spc-hpa Deployment/nginx 22%/3% 1 10 8 7m21spc-hpa Deployment/nginx 6%/3% 1 10 8 7m51spc-hpa Deployment/nginx 0%/3% 1 10 8 9m6spc-hpa Deployment/nginx 0%/3% 1 10 8 13mpc-hpa Deployment/nginx 0%/3% 1 10 1 14m deploymentå˜åŒ– 123456789101112131415161718192021[root@k8s-master01 ~]# kubectl get deployment -n dev -wNAME READY UP-TO-DATE AVAILABLE AGEnginx 1/1 1 1 11mnginx 1/4 1 1 13mnginx 1/4 1 1 13mnginx 1/4 1 1 13mnginx 1/4 4 1 13mnginx 1/8 4 1 14mnginx 1/8 4 1 14mnginx 1/8 4 1 14mnginx 1/8 8 1 14mnginx 2/8 8 2 14mnginx 3/8 8 3 14mnginx 4/8 8 4 14mnginx 5/8 8 5 14mnginx 6/8 8 6 14mnginx 7/8 8 7 14mnginx 8/8 8 8 15mnginx 8/1 8 8 20mnginx 8/1 8 8 20mnginx 1/1 1 1 20m podå˜åŒ– 12345678910111213141516171819202122232425262728293031[root@k8s-master01 ~]# kubectl get pods -n dev -wNAME READY STATUS RESTARTS AGEnginx-7df9756ccc-bh8dr 1/1 Running 0 11mnginx-7df9756ccc-cpgrv 0/1 Pending 0 0snginx-7df9756ccc-8zhwk 0/1 Pending 0 0snginx-7df9756ccc-rr9bn 0/1 Pending 0 0snginx-7df9756ccc-cpgrv 0/1 ContainerCreating 0 0snginx-7df9756ccc-8zhwk 0/1 ContainerCreating 0 0snginx-7df9756ccc-rr9bn 0/1 ContainerCreating 0 0snginx-7df9756ccc-m9gsj 0/1 Pending 0 0snginx-7df9756ccc-g56qb 0/1 Pending 0 0snginx-7df9756ccc-sl9c6 0/1 Pending 0 0snginx-7df9756ccc-fgst7 0/1 Pending 0 0snginx-7df9756ccc-g56qb 0/1 ContainerCreating 0 0snginx-7df9756ccc-m9gsj 0/1 ContainerCreating 0 0snginx-7df9756ccc-sl9c6 0/1 ContainerCreating 0 0snginx-7df9756ccc-fgst7 0/1 ContainerCreating 0 0snginx-7df9756ccc-8zhwk 1/1 Running 0 19snginx-7df9756ccc-rr9bn 1/1 Running 0 30snginx-7df9756ccc-m9gsj 1/1 Running 0 21snginx-7df9756ccc-cpgrv 1/1 Running 0 47snginx-7df9756ccc-sl9c6 1/1 Running 0 33snginx-7df9756ccc-g56qb 1/1 Running 0 48snginx-7df9756ccc-fgst7 1/1 Running 0 66snginx-7df9756ccc-fgst7 1/1 Terminating 0 6m50snginx-7df9756ccc-8zhwk 1/1 Terminating 0 7m5snginx-7df9756ccc-cpgrv 1/1 Terminating 0 7m5snginx-7df9756ccc-g56qb 1/1 Terminating 0 6m50snginx-7df9756ccc-rr9bn 1/1 Terminating 0 7m5snginx-7df9756ccc-m9gsj 1/1 Terminating 0 6m50snginx-7df9756ccc-sl9c6 1/1 Terminating 0 6m50s 6.5 DaemonSet(DS)DaemonSetç±»å‹çš„æ§åˆ¶å™¨å¯ä»¥ä¿è¯åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ã€‚ä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªPodæä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»Podå°±é€‚åˆä½¿ç”¨DaemonSetç±»å‹çš„æ§åˆ¶å™¨åˆ›å»ºã€‚ DaemonSetæ§åˆ¶å™¨çš„ç‰¹ç‚¹ï¼š æ¯å½“å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒæŒ‡å®šçš„ Pod å‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Š å½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤æ—¶ï¼ŒPod ä¹Ÿå°±è¢«åƒåœ¾å›æ”¶äº† ä¸‹é¢å…ˆæ¥çœ‹ä¸‹DaemonSetçš„èµ„æºæ¸…å•æ–‡ä»¶ 12345678910111213141516171819202122232425262728apiVersion: apps/v1 # ç‰ˆæœ¬å·kind: DaemonSet # ç±»å‹ metadata: # å…ƒæ•°æ® name: # rsåç§° namespace: # æ‰€å±å‘½åç©ºé—´ labels: #æ ‡ç­¾ controller: daemonsetspec: # è¯¦æƒ…æè¿° revisionHistoryLimit: 3 # ä¿ç•™å†å²ç‰ˆæœ¬ updateStrategy: # æ›´æ–°ç­–ç•¥ type: RollingUpdate # æ»šåŠ¨æ›´æ–°ç­–ç•¥ rollingUpdate: # æ»šåŠ¨æ›´æ–° maxUnavailable: 1 # æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•° selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod matchLabels: # LabelsåŒ¹é…è§„åˆ™ app: nginx-pod matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™ - &#123;key: app, operator: In, values: [nginx-pod]&#125; template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80 åˆ›å»ºpc-daemonset.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314151617apiVersion: apps/v1kind: DaemonSet metadata: name: pc-daemonset namespace: devspec: selector: matchLabels: app: nginx-pod template: metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 123456789101112131415161718# åˆ›å»ºdaemonset[root@k8s-master01 ~]# kubectl create -f pc-daemonset.yamldaemonset.apps/pc-daemonset created# æŸ¥çœ‹daemonset[root@k8s-master01 ~]# kubectl get ds -n dev -o wideNAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE AGE CONTAINERS IMAGES pc-daemonset 2 2 2 2 2 24s nginx nginx:1.17.1 # æŸ¥çœ‹pod,å‘ç°åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªpod[root@k8s-master01 ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE pc-daemonset-9bck8 1/1 Running 0 37s 10.244.1.43 node1 pc-daemonset-k224w 1/1 Running 0 37s 10.244.2.74 node2 # åˆ é™¤daemonset[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yamldaemonset.apps &quot;pc-daemonset&quot; deleted 6.6 JobJobï¼Œä¸»è¦ç”¨äºè´Ÿè´£**æ‰¹é‡å¤„ç†(ä¸€æ¬¡è¦å¤„ç†æŒ‡å®šæ•°é‡ä»»åŠ¡)çŸ­æš‚çš„ä¸€æ¬¡æ€§(æ¯ä¸ªä»»åŠ¡ä»…è¿è¡Œä¸€æ¬¡å°±ç»“æŸ)**ä»»åŠ¡ã€‚Jobç‰¹ç‚¹å¦‚ä¸‹ï¼š å½“Jobåˆ›å»ºçš„podæ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼ŒJobå°†è®°å½•æˆåŠŸç»“æŸçš„podæ•°é‡ å½“æˆåŠŸç»“æŸçš„podè¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼ŒJobå°†å®Œæˆæ‰§è¡Œ Jobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š 12345678910111213141516171819202122232425262728apiVersion: batch/v1 # ç‰ˆæœ¬å·kind: Job # ç±»å‹ metadata: # å…ƒæ•°æ® name: # rsåç§° namespace: # æ‰€å±å‘½åç©ºé—´ labels: #æ ‡ç­¾ controller: jobspec: # è¯¦æƒ…æè¿° completions: 1 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ã€‚é»˜è®¤å€¼: 1 parallelism: 1 # æŒ‡å®šjobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ã€‚é»˜è®¤å€¼: 1 activeDeadlineSeconds: 30 # æŒ‡å®šjobå¯è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æœªç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢ã€‚ backoffLimit: 6 # æŒ‡å®šjobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ã€‚é»˜è®¤æ˜¯6 manualSelector: true # æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©podï¼Œé»˜è®¤æ˜¯false selector: # é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod matchLabels: # LabelsåŒ¹é…è§„åˆ™ app: counter-pod matchExpressions: # ExpressionsåŒ¹é…è§„åˆ™ - &#123;key: app, operator: In, values: [counter-pod]&#125; template: # æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬ metadata: labels: app: counter-pod spec: restartPolicy: Never # é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–è€…OnFailure containers: - name: counter image: busybox:1.30 command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done&quot;] 1234å…³äºé‡å¯ç­–ç•¥è®¾ç½®çš„è¯´æ˜ï¼š å¦‚æœæŒ‡å®šä¸ºOnFailureï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºpodï¼Œfailedæ¬¡æ•°ä¸å˜ å¦‚æœæŒ‡å®šä¸ºNeverï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶åˆ›å»ºæ–°çš„podï¼Œå¹¶ä¸”æ•…éšœpodä¸ä¼šæ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šé‡å¯ï¼Œfailedæ¬¡æ•°åŠ 1 å¦‚æœæŒ‡å®šä¸ºAlwaysçš„è¯ï¼Œå°±æ„å‘³ç€ä¸€ç›´é‡å¯ï¼Œæ„å‘³ç€jobä»»åŠ¡ä¼šé‡å¤å»æ‰§è¡Œäº†ï¼Œå½“ç„¶ä¸å¯¹ï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸ºAlways åˆ›å»ºpc-job.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314151617181920apiVersion: batch/v1kind: Job metadata: name: pc-job namespace: devspec: manualSelector: true selector: matchLabels: app: counter-pod template: metadata: labels: app: counter-pod spec: restartPolicy: Never containers: - name: counter image: busybox:1.30 command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;] 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647# åˆ›å»ºjob[root@k8s-master01 ~]# kubectl create -f pc-job.yamljob.batch/pc-job created# æŸ¥çœ‹job[root@k8s-master01 ~]# kubectl get job -n dev -o wide -wNAME COMPLETIONS DURATION AGE CONTAINERS IMAGES SELECTORpc-job 0/1 21s 21s counter busybox:1.30 app=counter-podpc-job 1/1 31s 79s counter busybox:1.30 app=counter-pod# é€šè¿‡è§‚å¯ŸpodçŠ¶æ€å¯ä»¥çœ‹åˆ°ï¼Œpodåœ¨è¿è¡Œå®Œæ¯•ä»»åŠ¡åï¼Œå°±ä¼šå˜æˆCompletedçŠ¶æ€[root@k8s-master01 ~]# kubectl get pods -n dev -wNAME READY STATUS RESTARTS AGEpc-job-rxg96 1/1 Running 0 29spc-job-rxg96 0/1 Completed 0 33s# æ¥ä¸‹æ¥ï¼Œè°ƒæ•´ä¸‹podè¿è¡Œçš„æ€»æ•°é‡å’Œå¹¶è¡Œæ•°é‡ å³ï¼šåœ¨specä¸‹è®¾ç½®ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹# completions: 6 # æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ä¸º6# parallelism: 3 # æŒ‡å®šjobå¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ä¸º3# ç„¶åé‡æ–°è¿è¡Œjobï¼Œè§‚å¯Ÿæ•ˆæœï¼Œæ­¤æ—¶ä¼šå‘ç°ï¼Œjobä¼šæ¯æ¬¡è¿è¡Œ3ä¸ªpodï¼Œæ€»å…±æ‰§è¡Œäº†6ä¸ªpod[root@k8s-master01 ~]# kubectl get pods -n dev -wNAME READY STATUS RESTARTS AGEpc-job-684ft 1/1 Running 0 5spc-job-jhj49 1/1 Running 0 5spc-job-pfcvh 1/1 Running 0 5spc-job-684ft 0/1 Completed 0 11spc-job-v7rhr 0/1 Pending 0 0spc-job-v7rhr 0/1 Pending 0 0spc-job-v7rhr 0/1 ContainerCreating 0 0spc-job-jhj49 0/1 Completed 0 11spc-job-fhwf7 0/1 Pending 0 0spc-job-fhwf7 0/1 Pending 0 0spc-job-pfcvh 0/1 Completed 0 11spc-job-5vg2j 0/1 Pending 0 0spc-job-fhwf7 0/1 ContainerCreating 0 0spc-job-5vg2j 0/1 Pending 0 0spc-job-5vg2j 0/1 ContainerCreating 0 0spc-job-fhwf7 1/1 Running 0 2spc-job-v7rhr 1/1 Running 0 2spc-job-5vg2j 1/1 Running 0 3spc-job-fhwf7 0/1 Completed 0 12spc-job-v7rhr 0/1 Completed 0 12spc-job-5vg2j 0/1 Completed 0 12s# åˆ é™¤job[root@k8s-master01 ~]# kubectl delete -f pc-job.yamljob.batch &quot;pc-job&quot; deleted 6.7 CronJob(CJ)CronJobæ§åˆ¶å™¨ä»¥ Jobæ§åˆ¶å™¨èµ„æºä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†podèµ„æºå¯¹è±¡ï¼ŒJobæ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†CronJobå¯ä»¥ä»¥ç±»ä¼¼äºLinuxæ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å…¶è¿è¡Œæ—¶é—´ç‚¹åŠé‡å¤è¿è¡Œçš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒCronJobå¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹(åå¤çš„)å»è¿è¡Œjobä»»åŠ¡ã€‚ CronJobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š 123456789101112131415161718192021222324252627282930313233343536apiVersion: batch/v1beta1 # ç‰ˆæœ¬å·kind: CronJob # ç±»å‹ metadata: # å…ƒæ•°æ® name: # rsåç§° namespace: # æ‰€å±å‘½åç©ºé—´ labels: #æ ‡ç­¾ controller: cronjobspec: # è¯¦æƒ…æè¿° schedule: # cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹,ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨ä»€ä¹ˆæ—¶é—´æ‰§è¡Œ concurrencyPolicy: # å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼Œç”¨äºå®šä¹‰å‰ä¸€æ¬¡ä½œä¸šè¿è¡Œå°šæœªå®Œæˆæ—¶æ˜¯å¦ä»¥åŠå¦‚ä½•è¿è¡Œåä¸€æ¬¡çš„ä½œä¸š failedJobHistoryLimit: # ä¸ºå¤±è´¥çš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º1 successfulJobHistoryLimit: # ä¸ºæˆåŠŸçš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º3 startingDeadlineSeconds: # å¯åŠ¨ä½œä¸šé”™è¯¯çš„è¶…æ—¶æ—¶é•¿ jobTemplate: # jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡;ä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰ metadata: spec: completions: 1 parallelism: 1 activeDeadlineSeconds: 30 backoffLimit: 6 manualSelector: true selector: matchLabels: app: counter-pod matchExpressions: è§„åˆ™ - &#123;key: app, operator: In, values: [counter-pod]&#125; template: metadata: labels: app: counter-pod spec: restartPolicy: Never containers: - name: counter image: busybox:1.30 command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done&quot;] 123456789101112131415éœ€è¦é‡ç‚¹è§£é‡Šçš„å‡ ä¸ªé€‰é¡¹ï¼šschedule: cronè¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ */1 * * * * &lt;åˆ†é’Ÿ&gt; &lt;å°æ—¶&gt; &lt;æ—¥&gt; &lt;æœˆä»½&gt; &lt;æ˜ŸæœŸ&gt; åˆ†é’Ÿ å€¼ä» 0 åˆ° 59. å°æ—¶ å€¼ä» 0 åˆ° 23. æ—¥ å€¼ä» 1 åˆ° 31. æœˆ å€¼ä» 1 åˆ° 12. æ˜ŸæœŸ å€¼ä» 0 åˆ° 6, 0 ä»£è¡¨æ˜ŸæœŸæ—¥ å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼› èŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼›*å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼› /è¡¨ç¤ºæ¯...concurrencyPolicy: Allow: å…è®¸Jobså¹¶å‘è¿è¡Œ(é»˜è®¤) Forbid: ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¸Šä¸€æ¬¡è¿è¡Œå°šæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€æ¬¡è¿è¡Œ Replace: æ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ åˆ›å»ºpc-cronjob.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819apiVersion: batch/v1beta1kind: CronJobmetadata: name: pc-cronjob namespace: dev labels: controller: cronjobspec: schedule: &quot;*/1 * * * *&quot; jobTemplate: metadata: spec: template: spec: restartPolicy: Never containers: - name: counter image: busybox:1.30 command: [&quot;bin/sh&quot;,&quot;-c&quot;,&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;] 1234567891011121314151617181920212223242526# åˆ›å»ºcronjob[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yamlcronjob.batch/pc-cronjob created# æŸ¥çœ‹cronjob[root@k8s-master01 ~]# kubectl get cronjobs -n devNAME SCHEDULE SUSPEND ACTIVE LAST SCHEDULE AGEpc-cronjob */1 * * * * False 0 &lt;none&gt; 6s# æŸ¥çœ‹job[root@k8s-master01 ~]# kubectl get jobs -n devNAME COMPLETIONS DURATION AGEpc-cronjob-1592587800 1/1 28s 3m26spc-cronjob-1592587860 1/1 28s 2m26spc-cronjob-1592587920 1/1 28s 86s# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods -n devpc-cronjob-1592587800-x4tsm 0/1 Completed 0 2m24spc-cronjob-1592587860-r5gv4 0/1 Completed 0 84spc-cronjob-1592587920-9dxxq 1/1 Running 0 24s# åˆ é™¤cronjob[root@k8s-master01 ~]# kubectl delete -f pc-cronjob.yamlcronjob.batch &quot;pc-cronjob&quot; deleted 7. Serviceè¯¦è§£7.1 Serviceä»‹ç»åœ¨kubernetesä¸­ï¼Œpodæ˜¯åº”ç”¨ç¨‹åºçš„è½½ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡podçš„ipæ¥è®¿é—®åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯podçš„ipåœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä¸æ–¹ä¾¿ç›´æ¥é‡‡ç”¨podçš„ipå¯¹æœåŠ¡è¿›è¡Œè®¿é—®ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œkubernetesæä¾›äº†Serviceèµ„æºï¼ŒServiceä¼šå¯¹æä¾›åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªpodè¿›è¡Œèšåˆï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ã€‚é€šè¿‡è®¿é—®Serviceçš„å…¥å£åœ°å€å°±èƒ½è®¿é—®åˆ°åé¢çš„podæœåŠ¡ã€‚ Serviceåœ¨å¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒçœŸæ­£èµ·ä½œç”¨çš„å…¶å®æ˜¯kube-proxyæœåŠ¡è¿›ç¨‹ï¼Œæ¯ä¸ªNodeèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€ä¸€ä¸ªkube-proxyæœåŠ¡è¿›ç¨‹ã€‚å½“åˆ›å»ºServiceçš„æ—¶å€™ä¼šé€šè¿‡api-serverå‘etcdå†™å…¥åˆ›å»ºçš„serviceçš„ä¿¡æ¯ï¼Œè€Œkube-proxyä¼šåŸºäºç›‘å¬çš„æœºåˆ¶å‘ç°è¿™ç§Serviceçš„å˜åŠ¨ï¼Œç„¶åå®ƒä¼šå°†æœ€æ–°çš„Serviceä¿¡æ¯è½¬æ¢æˆå¯¹åº”çš„è®¿é—®è§„åˆ™ã€‚ 123456789101112# 10.97.97.97:80 æ˜¯serviceæä¾›çš„è®¿é—®å…¥å£# å½“è®¿é—®è¿™ä¸ªå…¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°åé¢æœ‰ä¸‰ä¸ªpodçš„æœåŠ¡åœ¨ç­‰å¾…è°ƒç”¨ï¼Œ# kube-proxyä¼šåŸºäºrrï¼ˆè½®è¯¢ï¼‰çš„ç­–ç•¥ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å…¶ä¸­ä¸€ä¸ªpodä¸Šå»# è¿™ä¸ªè§„åˆ™ä¼šåŒæ—¶åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½ç”Ÿæˆï¼Œæ‰€ä»¥åœ¨ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè®¿é—®éƒ½å¯ä»¥ã€‚[root@node1 ~]# ipvsadm -LnIP Virtual Server version 1.2.1 (size=4096)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 10.97.97.97:80 rr -&gt; 10.244.1.39:80 Masq 1 0 0 -&gt; 10.244.1.40:80 Masq 1 0 0 -&gt; 10.244.2.33:80 Masq 1 0 0 kube-proxyç›®å‰æ”¯æŒä¸‰ç§å·¥ä½œæ¨¡å¼: 7.1.1 userspace æ¨¡å¼userspaceæ¨¡å¼ä¸‹ï¼Œkube-proxyä¼šä¸ºæ¯ä¸€ä¸ªServiceåˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå‘å‘Cluster IPçš„è¯·æ±‚è¢«Iptablesè§„åˆ™é‡å®šå‘åˆ°kube-proxyç›‘å¬çš„ç«¯å£ä¸Šï¼Œkube-proxyæ ¹æ®LBç®—æ³•é€‰æ‹©ä¸€ä¸ªæä¾›æœåŠ¡çš„Podå¹¶å’Œå…¶å»ºç«‹é“¾æ¥ï¼Œä»¥å°†è¯·æ±‚è½¬å‘åˆ°Podä¸Šã€‚ è¯¥æ¨¡å¼ä¸‹ï¼Œkube-proxyå……å½“äº†ä¸€ä¸ªå››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ã€‚ç”±äºkube-proxyè¿è¡Œåœ¨userspaceä¸­ï¼Œåœ¨è¿›è¡Œè½¬å‘å¤„ç†æ—¶ä¼šå¢åŠ å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œè™½ç„¶æ¯”è¾ƒç¨³å®šï¼Œä½†æ˜¯æ•ˆç‡æ¯”è¾ƒä½ã€‚ 7.1.2 iptables æ¨¡å¼iptablesæ¨¡å¼ä¸‹ï¼Œkube-proxyä¸ºserviceåç«¯çš„æ¯ä¸ªPodåˆ›å»ºå¯¹åº”çš„iptablesè§„åˆ™ï¼Œç›´æ¥å°†å‘å‘Cluster IPçš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ªPod IPã€‚ è¯¥æ¨¡å¼ä¸‹kube-proxyä¸æ‰¿æ‹…å››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ï¼Œåªè´Ÿè´£åˆ›å»ºiptablesè§„åˆ™ã€‚è¯¥æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯è¾ƒuserspaceæ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†ä¸èƒ½æä¾›çµæ´»çš„LBç­–ç•¥ï¼Œå½“åç«¯Podä¸å¯ç”¨æ—¶ä¹Ÿæ— æ³•è¿›è¡Œé‡è¯•ã€‚ 7.1.3 ipvs æ¨¡å¼ipvsæ¨¡å¼å’Œiptablesç±»ä¼¼ï¼Œkube-proxyç›‘æ§Podçš„å˜åŒ–å¹¶åˆ›å»ºç›¸åº”çš„ipvsè§„åˆ™ã€‚ipvsç›¸å¯¹iptablesè½¬å‘æ•ˆç‡æ›´é«˜ã€‚é™¤æ­¤ä»¥å¤–ï¼Œipvsæ”¯æŒæ›´å¤šçš„LBç®—æ³•ã€‚ 12345678910111213# æ­¤æ¨¡å¼å¿…é¡»å®‰è£…ipvså†…æ ¸æ¨¡å—ï¼Œå¦åˆ™ä¼šé™çº§ä¸ºiptables# å¼€å¯ipvs[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system# ä¿®æ”¹mode: &quot;ipvs&quot;[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system[root@node1 ~]# ipvsadm -LnIP Virtual Server version 1.2.1 (size=4096)Prot LocalAddress:Port Scheduler Flags -&gt; RemoteAddress:Port Forward Weight ActiveConn InActConnTCP 10.97.97.97:80 rr -&gt; 10.244.1.39:80 Masq 1 0 0 -&gt; 10.244.1.40:80 Masq 1 0 0 -&gt; 10.244.2.33:80 Masq 1 0 0 7.2 Serviceç±»å‹Serviceçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š 12345678910111213141516kind: Service # èµ„æºç±»å‹apiVersion: v1 # èµ„æºç‰ˆæœ¬metadata: # å…ƒæ•°æ® name: service # èµ„æºåç§° namespace: dev # å‘½åç©ºé—´spec: # æè¿° selector: # æ ‡ç­¾é€‰æ‹©å™¨ï¼Œç”¨äºç¡®å®šå½“å‰serviceä»£ç†å“ªäº›pod app: nginx type: # Serviceç±»å‹ï¼ŒæŒ‡å®šserviceçš„è®¿é—®æ–¹å¼ clusterIP: # è™šæ‹ŸæœåŠ¡çš„ipåœ°å€ sessionAffinity: # sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹ ports: # ç«¯å£ä¿¡æ¯ - protocol: TCP port: 3017 # serviceç«¯å£ targetPort: 5003 # podç«¯å£ nodePort: 31122 # ä¸»æœºç«¯å£ ClusterIPï¼šé»˜è®¤å€¼ï¼Œå®ƒæ˜¯Kubernetesç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—® NodePortï¼šå°†Serviceé€šè¿‡æŒ‡å®šçš„Nodeä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡ LoadBalancerï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒæ”¯æŒ ExternalNameï¼š æŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨ 7.3 Serviceä½¿ç”¨7.3.1 å®éªŒç¯å¢ƒå‡†å¤‡åœ¨ä½¿ç”¨serviceä¹‹å‰ï¼Œé¦–å…ˆåˆ©ç”¨Deploymentåˆ›å»ºå‡º3ä¸ªpodï¼Œæ³¨æ„è¦ä¸ºpodè®¾ç½®app=nginx-podçš„æ ‡ç­¾ åˆ›å»ºdeployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314151617181920apiVersion: apps/v1kind: Deployment metadata: name: pc-deployment namespace: devspec: replicas: 3 selector: matchLabels: app: nginx-pod template: metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80 123456789101112131415161718192021[root@k8s-master01 ~]# kubectl create -f deployment.yamldeployment.apps/pc-deployment created# æŸ¥çœ‹podè¯¦æƒ…[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labelsNAME READY STATUS IP NODE LABELSpc-deployment-66cb59b984-8p84h 1/1 Running 10.244.1.39 node1 app=nginx-podpc-deployment-66cb59b984-vx8vx 1/1 Running 10.244.2.33 node2 app=nginx-podpc-deployment-66cb59b984-wnncx 1/1 Running 10.244.1.40 node1 app=nginx-pod# ä¸ºäº†æ–¹ä¾¿åé¢çš„æµ‹è¯•ï¼Œä¿®æ”¹ä¸‹ä¸‰å°nginxçš„index.htmlé¡µé¢ï¼ˆä¸‰å°ä¿®æ”¹çš„IPåœ°å€ä¸ä¸€è‡´ï¼‰# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh# echo &quot;10.244.1.39&quot; &gt; /usr/share/nginx/html/index.html#ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œè®¿é—®æµ‹è¯•[root@k8s-master01 ~]# curl 10.244.1.3910.244.1.39[root@k8s-master01 ~]# curl 10.244.2.3310.244.2.33[root@k8s-master01 ~]# curl 10.244.1.4010.244.1.40 7.3.2 ClusterIPç±»å‹çš„Serviceåˆ›å»ºservice-clusterip.yamlæ–‡ä»¶ 12345678910111213apiVersion: v1kind: Servicemetadata: name: service-clusterip namespace: devspec: selector: app: nginx-pod clusterIP: 10.97.97.97 # serviceçš„ipåœ°å€ï¼Œå¦‚æœä¸å†™ï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ª type: ClusterIP ports: - port: 80 # Serviceç«¯å£ targetPort: 80 # podç«¯å£ 1234567891011121314151617181920212223242526272829303132333435# åˆ›å»ºservice[root@k8s-master01 ~]# kubectl create -f service-clusterip.yamlservice/service-clusterip created# æŸ¥çœ‹service[root@k8s-master01 ~]# kubectl get svc -n dev -o wideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORservice-clusterip ClusterIP 10.97.97.97 &lt;none&gt; 80/TCP 13s app=nginx-pod# æŸ¥çœ‹serviceçš„è¯¦ç»†ä¿¡æ¯# åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªEndpointsåˆ—è¡¨ï¼Œé‡Œé¢å°±æ˜¯å½“å‰serviceå¯ä»¥è´Ÿè½½åˆ°çš„æœåŠ¡å…¥å£[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n devName: service-clusteripNamespace: devLabels: &lt;none&gt;Annotations: &lt;none&gt;Selector: app=nginx-podType: ClusterIPIP: 10.97.97.97Port: &lt;unset&gt; 80/TCPTargetPort: 80/TCPEndpoints: 10.244.1.39:80,10.244.1.40:80,10.244.2.33:80Session Affinity: NoneEvents: &lt;none&gt;# æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™[root@k8s-master01 ~]# ipvsadm -LnTCP 10.97.97.97:80 rr -&gt; 10.244.1.39:80 Masq 1 0 0 -&gt; 10.244.1.40:80 Masq 1 0 0 -&gt; 10.244.2.33:80 Masq 1 0 0# è®¿é—®10.97.97.97:80è§‚å¯Ÿæ•ˆæœ[root@k8s-master01 ~]# curl 10.97.97.97:8010.244.2.33 7.3.3 EndpointEndpointæ˜¯kubernetesä¸­çš„ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨etcdä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªserviceå¯¹åº”çš„æ‰€æœ‰podçš„è®¿é—®åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ®serviceé…ç½®æ–‡ä»¶ä¸­selectoræè¿°äº§ç”Ÿçš„ã€‚ ä¸€ä¸ªServiceç”±ä¸€ç»„Podç»„æˆï¼Œè¿™äº›Podé€šè¿‡Endpointsæš´éœ²å‡ºæ¥ï¼ŒEndpointsæ˜¯å®ç°å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆã€‚æ¢å¥è¯è¯´ï¼Œserviceå’Œpodä¹‹é—´çš„è”ç³»æ˜¯é€šè¿‡endpointså®ç°çš„ã€‚ è´Ÿè½½åˆ†å‘ç­–ç•¥ å¯¹Serviceçš„è®¿é—®è¢«åˆ†å‘åˆ°äº†åç«¯çš„Podä¸Šå»ï¼Œç›®å‰kubernetesæä¾›äº†ä¸¤ç§è´Ÿè½½åˆ†å‘ç­–ç•¥ï¼š å¦‚æœä¸å®šä¹‰ï¼Œé»˜è®¤ä½¿ç”¨kube-proxyçš„ç­–ç•¥ï¼Œæ¯”å¦‚éšæœºã€è½®è¯¢ åŸºäºå®¢æˆ·ç«¯åœ°å€çš„ä¼šè¯ä¿æŒæ¨¡å¼ï¼Œå³æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€ä¸ªPodä¸Š æ­¤æ¨¡å¼å¯ä»¥ä½¿åœ¨specä¸­æ·»åŠ sessionAffinity:ClientIPé€‰é¡¹ 12345678910111213141516171819202122232425262728293031323334# æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™ã€rr è½®è¯¢ã€‘[root@k8s-master01 ~]# ipvsadm -LnTCP 10.97.97.97:80 rr -&gt; 10.244.1.39:80 Masq 1 0 0 -&gt; 10.244.1.40:80 Masq 1 0 0 -&gt; 10.244.2.33:80 Masq 1 0 0# å¾ªç¯è®¿é—®æµ‹è¯•[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;10.244.1.4010.244.1.3910.244.2.3310.244.1.4010.244.1.3910.244.2.33# ä¿®æ”¹åˆ†å‘ç­–ç•¥----sessionAffinity:ClientIP# æŸ¥çœ‹ipvsè§„åˆ™ã€persistent ä»£è¡¨æŒä¹…ã€‘[root@k8s-master01 ~]# ipvsadm -LnTCP 10.97.97.97:80 rr persistent 10800 -&gt; 10.244.1.39:80 Masq 1 0 0 -&gt; 10.244.1.40:80 Masq 1 0 0 -&gt; 10.244.2.33:80 Masq 1 0 0# å¾ªç¯è®¿é—®æµ‹è¯•[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;10.244.2.3310.244.2.3310.244.2.33 # åˆ é™¤service[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yamlservice &quot;service-clusterip&quot; deleted 7.3.4 HeadLinessç±»å‹çš„Serviceåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸æƒ³ä½¿ç”¨Serviceæä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œå¸Œæœ›è‡ªå·±æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†HeadLiness Serviceï¼Œè¿™ç±»Serviceä¸ä¼šåˆ†é…Cluster IPï¼Œå¦‚æœæƒ³è¦è®¿é—®serviceï¼Œåªèƒ½é€šè¿‡serviceçš„åŸŸåè¿›è¡ŒæŸ¥è¯¢ã€‚ åˆ›å»ºservice-headliness.yaml 12345678910111213apiVersion: v1kind: Servicemetadata: name: service-headliness namespace: devspec: selector: app: nginx-pod clusterIP: None # å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service type: ClusterIP ports: - port: 80 targetPort: 80 12345678910111213141516171819202122232425262728293031323334# åˆ›å»ºservice[root@k8s-master01 ~]# kubectl create -f service-headliness.yamlservice/service-headliness created# è·å–serviceï¼Œ å‘ç°CLUSTER-IPæœªåˆ†é…[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE SELECTORservice-headliness ClusterIP None &lt;none&gt; 80/TCP 11s app=nginx-pod# æŸ¥çœ‹serviceè¯¦æƒ…[root@k8s-master01 ~]# kubectl describe svc service-headliness -n devName: service-headlinessNamespace: devLabels: &lt;none&gt;Annotations: &lt;none&gt;Selector: app=nginx-podType: ClusterIPIP: NonePort: &lt;unset&gt; 80/TCPTargetPort: 80/TCPEndpoints: 10.244.1.39:80,10.244.1.40:80,10.244.2.33:80Session Affinity: NoneEvents: &lt;none&gt;# æŸ¥çœ‹åŸŸåçš„è§£ææƒ…å†µ[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh/ # cat /etc/resolv.confnameserver 10.96.0.10search dev.svc.cluster.local svc.cluster.local cluster.local[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.localservice-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40service-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39service-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33 7.3.5 NodePortç±»å‹çš„Serviceåœ¨ä¹‹å‰çš„æ ·ä¾‹ä¸­ï¼Œåˆ›å»ºçš„Serviceçš„ipåœ°å€åªæœ‰é›†ç¾¤å†…éƒ¨æ‰å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¸Œæœ›å°†Serviceæš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨åˆ°å¦å¤–ä¸€ç§ç±»å‹çš„Serviceï¼Œç§°ä¸ºNodePortç±»å‹ã€‚NodePortçš„å·¥ä½œåŸç†å…¶å®å°±æ˜¯å°†serviceçš„ç«¯å£æ˜ å°„åˆ°Nodeçš„ä¸€ä¸ªç«¯å£ä¸Šï¼Œç„¶åå°±å¯ä»¥é€šè¿‡NodeIp:NodePortæ¥è®¿é—®serviceäº†ã€‚ åˆ›å»ºservice-nodeport.yaml 12345678910111213apiVersion: v1kind: Servicemetadata: name: service-nodeport namespace: devspec: selector: app: nginx-pod type: NodePort # serviceç±»å‹ ports: - port: 80 nodePort: 30002 # æŒ‡å®šç»‘å®šçš„nodeçš„ç«¯å£(é»˜è®¤çš„å–å€¼èŒƒå›´æ˜¯ï¼š30000-32767), å¦‚æœä¸æŒ‡å®šï¼Œä¼šé»˜è®¤åˆ†é… targetPort: 80 12345678910# åˆ›å»ºservice[root@k8s-master01 ~]# kubectl create -f service-nodeport.yamlservice/service-nodeport created# æŸ¥çœ‹service[root@k8s-master01 ~]# kubectl get svc -n dev -o wideNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) SELECTORservice-nodeport NodePort 10.105.64.191 &lt;none&gt; 80:30002/TCP app=nginx-pod# æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡ç”µè„‘ä¸»æœºçš„æµè§ˆå™¨å»è®¿é—®é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªnodeipçš„30002ç«¯å£ï¼Œå³å¯è®¿é—®åˆ°pod 7.3.6 LoadBalancerç±»å‹çš„ServiceLoadBalancerå’ŒNodePortå¾ˆç›¸ä¼¼ï¼Œç›®çš„éƒ½æ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€ä¸ªç«¯å£ï¼ŒåŒºåˆ«åœ¨äºLoadBalancerä¼šåœ¨é›†ç¾¤çš„å¤–éƒ¨å†æ¥åšä¸€ä¸ªè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè€Œè¿™ä¸ªè®¾å¤‡éœ€è¦å¤–éƒ¨ç¯å¢ƒæ”¯æŒçš„ï¼Œå¤–éƒ¨æœåŠ¡å‘é€åˆ°è¿™ä¸ªè®¾å¤‡ä¸Šçš„è¯·æ±‚ï¼Œä¼šè¢«è®¾å¤‡è´Ÿè½½ä¹‹åè½¬å‘åˆ°é›†ç¾¤ä¸­ã€‚ 7.3.7 ExternalNameç±»å‹çš„ServiceExternalNameç±»å‹çš„Serviceç”¨äºå¼•å…¥é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡externalNameå±æ€§æŒ‡å®šå¤–éƒ¨ä¸€ä¸ªæœåŠ¡çš„åœ°å€ï¼Œç„¶ååœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æ­¤serviceå°±å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„æœåŠ¡äº†ã€‚ 12345678apiVersion: v1kind: Servicemetadata: name: service-externalname namespace: devspec: type: ExternalName # serviceç±»å‹ externalName: www.baidu.com #æ”¹æˆipåœ°å€ä¹Ÿå¯ä»¥ 12345678910# åˆ›å»ºservice[root@k8s-master01 ~]# kubectl create -f service-externalname.yamlservice/service-externalname created# åŸŸåè§£æ[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.localservice-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.www.baidu.com. 30 IN CNAME www.a.shifen.com.www.a.shifen.com. 30 IN A 39.156.66.18www.a.shifen.com. 30 IN A 39.156.66.14 7.4 Ingressä»‹ç»åœ¨å‰é¢è¯¾ç¨‹ä¸­å·²ç»æåˆ°ï¼ŒServiceå¯¹é›†ç¾¤ä¹‹å¤–æš´éœ²æœåŠ¡çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼šNotePortå’ŒLoadBalancerï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼ï¼Œéƒ½æœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼š NodePortæ–¹å¼çš„ç¼ºç‚¹æ˜¯ä¼šå ç”¨å¾ˆå¤šé›†ç¾¤æœºå™¨çš„ç«¯å£ï¼Œé‚£ä¹ˆå½“é›†ç¾¤æœåŠ¡å˜å¤šçš„æ—¶å€™ï¼Œè¿™ä¸ªç¼ºç‚¹å°±æ„ˆå‘æ˜æ˜¾ LBæ–¹å¼çš„ç¼ºç‚¹æ˜¯æ¯ä¸ªserviceéœ€è¦ä¸€ä¸ªLBï¼Œæµªè´¹ã€éº»çƒ¦ï¼Œå¹¶ä¸”éœ€è¦kubernetesä¹‹å¤–è®¾å¤‡çš„æ”¯æŒ åŸºäºè¿™ç§ç°çŠ¶ï¼Œkubernetesæä¾›äº†Ingressèµ„æºå¯¹è±¡ï¼ŒIngressåªéœ€è¦ä¸€ä¸ªNodePortæˆ–è€…ä¸€ä¸ªLBå°±å¯ä»¥æ»¡è¶³æš´éœ²å¤šä¸ªServiceçš„éœ€æ±‚ã€‚å·¥ä½œæœºåˆ¶å¤§è‡´å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š å®é™…ä¸Šï¼ŒIngressç›¸å½“äºä¸€ä¸ª7å±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ˜¯kuberneteså¯¹åå‘ä»£ç†çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºNginxï¼Œå¯ä»¥ç†è§£æˆåœ¨Ingressé‡Œå»ºç«‹è¯¸å¤šæ˜ å°„è§„åˆ™ï¼ŒIngress Controlleré€šè¿‡ç›‘å¬è¿™äº›é…ç½®è§„åˆ™å¹¶è½¬åŒ–æˆNginxçš„åå‘ä»£ç†é…ç½® , ç„¶åå¯¹å¤–éƒ¨æä¾›æœåŠ¡ã€‚åœ¨è¿™é‡Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š ingressï¼škubernetesä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½œç”¨æ˜¯å®šä¹‰è¯·æ±‚å¦‚ä½•è½¬å‘åˆ°serviceçš„è§„åˆ™ ingress controllerï¼šå…·ä½“å®ç°åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡çš„ç¨‹åºï¼Œå¯¹ingresså®šä¹‰çš„è§„åˆ™è¿›è¡Œè§£æï¼Œæ ¹æ®é…ç½®çš„è§„åˆ™æ¥å®ç°è¯·æ±‚è½¬å‘ï¼Œå®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Nginx, Contour, Haproxyç­‰ç­‰ Ingressï¼ˆä»¥Nginxä¸ºä¾‹ï¼‰çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š ç”¨æˆ·ç¼–å†™Ingressè§„åˆ™ï¼Œè¯´æ˜å“ªä¸ªåŸŸåå¯¹åº”kubernetesé›†ç¾¤ä¸­çš„å“ªä¸ªService Ingressæ§åˆ¶å™¨åŠ¨æ€æ„ŸçŸ¥IngressæœåŠ¡è§„åˆ™çš„å˜åŒ–ï¼Œç„¶åç”Ÿæˆä¸€æ®µå¯¹åº”çš„Nginxåå‘ä»£ç†é…ç½® Ingressæ§åˆ¶å™¨ä¼šå°†ç”Ÿæˆçš„Nginxé…ç½®å†™å…¥åˆ°ä¸€ä¸ªè¿è¡Œç€çš„NginxæœåŠ¡ä¸­ï¼Œå¹¶åŠ¨æ€æ›´æ–° åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¶å®çœŸæ­£åœ¨å·¥ä½œçš„å°±æ˜¯ä¸€ä¸ªNginxäº†ï¼Œå†…éƒ¨é…ç½®äº†ç”¨æˆ·å®šä¹‰çš„è¯·æ±‚è½¬å‘è§„åˆ™ 7.5 Ingressä½¿ç”¨7.5.1 ç¯å¢ƒå‡†å¤‡ æ­å»ºingressç¯å¢ƒ1234567891011121314151617181920212223# åˆ›å»ºæ–‡ä»¶å¤¹[root@k8s-master01 ~]# mkdir ingress-controller[root@k8s-master01 ~]# cd ingress-controller/# è·å–ingress-nginxï¼Œæœ¬æ¬¡æ¡ˆä¾‹ä½¿ç”¨çš„æ˜¯0.30ç‰ˆæœ¬[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml[root@k8s-master01 ingress-controller]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml# ä¿®æ”¹mandatory.yamlæ–‡ä»¶ä¸­çš„ä»“åº“# ä¿®æ”¹quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0# ä¸ºquay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0# åˆ›å»ºingress-nginx[root@k8s-master01 ingress-controller]# kubectl apply -f ./# æŸ¥çœ‹ingress-nginx[root@k8s-master01 ingress-controller]# kubectl get pod -n ingress-nginxNAME READY STATUS RESTARTS AGEpod/nginx-ingress-controller-fbf967dd5-4qpbp 1/1 Running 0 12h# æŸ¥çœ‹service[root@k8s-master01 ingress-controller]# kubectl get svc -n ingress-nginxNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEingress-nginx NodePort 10.98.75.163 &lt;none&gt; 80:32240/TCP,443:31335/TCP 11h 7.5.2 å‡†å¤‡serviceå’Œpodä¸ºäº†åé¢çš„å®éªŒæ¯”è¾ƒæ–¹ä¾¿ï¼Œåˆ›å»ºå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ¨¡å‹ åˆ›å»ºtomcat-nginx.yaml 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475apiVersion: apps/v1kind: Deploymentmetadata: name: nginx-deployment namespace: devspec: replicas: 3 selector: matchLabels: app: nginx-pod template: metadata: labels: app: nginx-pod spec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80---apiVersion: apps/v1kind: Deploymentmetadata: name: tomcat-deployment namespace: devspec: replicas: 3 selector: matchLabels: app: tomcat-pod template: metadata: labels: app: tomcat-pod spec: containers: - name: tomcat image: tomcat:8.5-jre10-slim ports: - containerPort: 8080---apiVersion: v1kind: Servicemetadata: name: nginx-service namespace: devspec: selector: app: nginx-pod clusterIP: None type: ClusterIP ports: - port: 80 targetPort: 80---apiVersion: v1kind: Servicemetadata: name: tomcat-service namespace: devspec: selector: app: tomcat-pod clusterIP: None type: ClusterIP ports: - port: 8080 targetPort: 8080 12345678# åˆ›å»º[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml# æŸ¥çœ‹[root@k8s-master01 ~]# kubectl get svc -n devNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEnginx-service ClusterIP None &lt;none&gt; 80/TCP 48stomcat-service ClusterIP None &lt;none&gt; 8080/TCP 48s 7.5.3 Httpä»£ç†åˆ›å»ºingress-http.yaml 123456789101112131415161718192021apiVersion: extensions/v1beta1kind: Ingressmetadata: name: ingress-http namespace: devspec: rules: - host: nginx.itheima.com http: paths: - path: / backend: serviceName: nginx-service servicePort: 80 - host: tomcat.itheima.com http: paths: - path: / backend: serviceName: tomcat-service servicePort: 8080 123456789101112131415161718192021# åˆ›å»º[root@k8s-master01 ~]# kubectl create -f ingress-http.yamlingress.extensions/ingress-http created# æŸ¥çœ‹[root@k8s-master01 ~]# kubectl get ing ingress-http -n devNAME HOSTS ADDRESS PORTS AGEingress-http nginx.itheima.com,tomcat.itheima.com 80 22s# æŸ¥çœ‹è¯¦æƒ…[root@k8s-master01 ~]# kubectl describe ing ingress-http -n dev...Rules:Host Path Backends---- ---- --------nginx.itheima.com / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)tomcat.itheima.com / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)...# æ¥ä¸‹æ¥,åœ¨æœ¬åœ°ç”µè„‘ä¸Šé…ç½®hostæ–‡ä»¶,è§£æä¸Šé¢çš„ä¸¤ä¸ªåŸŸååˆ°192.168.109.100(master)ä¸Š# ç„¶å,å°±å¯ä»¥åˆ†åˆ«è®¿é—®tomcat.itheima.com:32240 å’Œ nginx.itheima.com:32240 æŸ¥çœ‹æ•ˆæœäº† 7.5.4 Httpsä»£ç†åˆ›å»ºè¯ä¹¦ 12345# ç”Ÿæˆè¯ä¹¦openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &quot;/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com&quot;# åˆ›å»ºå¯†é’¥kubectl create secret tls tls-secret --key tls.key --cert tls.crt åˆ›å»ºingress-https.yaml 1234567891011121314151617181920212223242526apiVersion: extensions/v1beta1kind: Ingressmetadata: name: ingress-https namespace: devspec: tls: - hosts: - nginx.itheima.com - tomcat.itheima.com secretName: tls-secret # æŒ‡å®šç§˜é’¥ rules: - host: nginx.itheima.com http: paths: - path: / backend: serviceName: nginx-service servicePort: 80 - host: tomcat.itheima.com http: paths: - path: / backend: serviceName: tomcat-service servicePort: 8080 12345678910111213141516171819202122# åˆ›å»º[root@k8s-master01 ~]# kubectl create -f ingress-https.yamlingress.extensions/ingress-https created# æŸ¥çœ‹[root@k8s-master01 ~]# kubectl get ing ingress-https -n devNAME HOSTS ADDRESS PORTS AGEingress-https nginx.itheima.com,tomcat.itheima.com 10.104.184.38 80, 443 2m42s# æŸ¥çœ‹è¯¦æƒ…[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev...TLS: tls-secret terminates nginx.itheima.com,tomcat.itheima.comRules:Host Path Backends---- ---- --------nginx.itheima.com / nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)tomcat.itheima.com / tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)...# ä¸‹é¢å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®https://nginx.itheima.com:31335 å’Œ https://tomcat.itheima.com:31335æ¥æŸ¥çœ‹äº† 8. æ•°æ®å­˜å‚¨åœ¨å‰é¢å·²ç»æåˆ°ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯æ—¶ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µã€‚ Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å®¹å™¨ä¸ä¸Podä¸­å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯æ—¶ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚ kubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢å‡ ä¸ªï¼š ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS é«˜çº§å­˜å‚¨ï¼šPVã€PVC é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret 8.1 åŸºæœ¬å­˜å‚¨8.1.1 EmptyDirEmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½•ã€‚ EmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼Œ EmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirç”¨é€”å¦‚ä¸‹ï¼š ä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™ ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰ æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´æ–‡ä»¶å…±äº«çš„æ¡ˆä¾‹æ¥ä½¿ç”¨ä¸€ä¸‹EmptyDirã€‚ åœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxï¼Œç„¶åå£°æ˜ä¸€ä¸ªVolumeåˆ†åˆ«æŒ‚åœ¨åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘Volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°ã€‚ åˆ›å»ºä¸€ä¸ªvolume-emptydir.yaml 1234567891011121314151617181920212223apiVersion: v1kind: Podmetadata: name: volume-emptydir namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80 volumeMounts: # å°†logs-volumeæŒ‚åœ¨åˆ°nginxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º /var/log/nginx - name: logs-volume mountPath: /var/log/nginx - name: busybox image: busybox:1.30 command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;tail -f /logs/access.log&quot;] # åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­å†…å®¹ volumeMounts: # å°†logs-volume æŒ‚åœ¨åˆ°busyboxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º /logs - name: logs-volume mountPath: /logs volumes: # å£°æ˜volumeï¼Œ nameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir - name: logs-volume emptyDir: &#123;&#125; 12345678910111213141516# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yamlpod/volume-emptydir created# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ...... volume-emptydir 2/2 Running 0 97s 10.42.2.9 node1 ......# é€šè¿‡podIpè®¿é—®nginx[root@k8s-master01 ~]# curl 10.42.2.9......# é€šè¿‡kubectl logså‘½ä»¤æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ ‡å‡†è¾“å‡º[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox10.42.1.0 - - [27/Jun/2021:15:08:54 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot; 8.1.2 HostPathä¸ŠèŠ‚è¯¾æåˆ°ï¼ŒEmptyDirä¸­æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œå®ƒä¼šéšç€Podçš„ç»“æŸè€Œé”€æ¯ï¼Œå¦‚æœæƒ³ç®€å•çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸»æœºä¸­ï¼Œå¯ä»¥é€‰æ‹©HostPathã€‚ HostPathå°±æ˜¯å°†Nodeä¸»æœºä¸­ä¸€ä¸ªå®é™…ç›®å½•æŒ‚åœ¨åˆ°Podä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯Podé”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ®å¯ä»¥å­˜åœ¨äºNodeä¸»æœºä¸Šã€‚ åˆ›å»ºä¸€ä¸ªvolume-hostpath.yamlï¼š 12345678910111213141516171819202122232425apiVersion: v1kind: Podmetadata: name: volume-hostpath namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80 volumeMounts: - name: logs-volume mountPath: /var/log/nginx - name: busybox image: busybox:1.30 command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;tail -f /logs/access.log&quot;] volumeMounts: - name: logs-volume mountPath: /logs volumes: - name: logs-volume hostPath: path: /root/logs type: DirectoryOrCreate # ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨ 12345678å…³äºtypeçš„å€¼çš„ä¸€ç‚¹è¯´æ˜ï¼š DirectoryOrCreate ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨ Directory ç›®å½•å¿…é¡»å­˜åœ¨ FileOrCreate æ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨ File æ–‡ä»¶å¿…é¡»å­˜åœ¨ Socket unixå¥—æ¥å­—å¿…é¡»å­˜åœ¨ CharDevice å­—ç¬¦è®¾å¤‡å¿…é¡»å­˜åœ¨ BlockDevice å—è®¾å¤‡å¿…é¡»å­˜åœ¨ 1234567891011121314151617181920# åˆ›å»ºPod[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yamlpod/volume-hostpath created# æŸ¥çœ‹Pod[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE ......pod-volume-hostpath 2/2 Running 0 16s 10.42.2.10 node1 ......#è®¿é—®nginx[root@k8s-master01 ~]# curl 10.42.2.10[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox# æ¥ä¸‹æ¥å°±å¯ä»¥å»hostçš„/root/logsç›®å½•ä¸‹æŸ¥çœ‹å­˜å‚¨çš„æ–‡ä»¶äº†### æ³¨æ„: ä¸‹é¢çš„æ“ä½œéœ€è¦åˆ°Podæ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œï¼ˆæ¡ˆä¾‹ä¸­æ˜¯node1ï¼‰[root@node1 ~]# ls /root/logs/access.log error.log# åŒæ ·çš„é“ç†ï¼Œå¦‚æœåœ¨æ­¤ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ°å®¹å™¨ä¸­ä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°çš„ 8.1.3 NFSHostPathå¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦NodeèŠ‚ç‚¹æ•…éšœäº†ï¼ŒPodå¦‚æœè½¬ç§»åˆ°äº†åˆ«çš„èŠ‚ç‚¹ï¼Œåˆä¼šå‡ºç°é—®é¢˜äº†ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç”¨NFSã€CIFSã€‚ NFSæ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°NFSæœåŠ¡å™¨ï¼Œç„¶åå°†Podä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°NFSç³»ç»Ÿä¸Šï¼Œè¿™æ ·çš„è¯ï¼Œæ— è®ºPodåœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦Nodeè·ŸNFSçš„å¯¹æ¥æ²¡é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®ã€‚ 1ï¼‰é¦–å…ˆè¦å‡†å¤‡nfsçš„æœåŠ¡å™¨ï¼Œè¿™é‡Œä¸ºäº†ç®€å•ï¼Œç›´æ¥æ˜¯masterèŠ‚ç‚¹åšnfsæœåŠ¡å™¨ 12345678910111213# åœ¨nfsä¸Šå®‰è£…nfsæœåŠ¡[root@nfs ~]# yum install nfs-utils -y# å‡†å¤‡ä¸€ä¸ªå…±äº«ç›®å½•[root@nfs ~]# mkdir /root/data/nfs -pv# å°†å…±äº«ç›®å½•ä»¥è¯»å†™æƒé™æš´éœ²ç»™192.168.5.0/24ç½‘æ®µä¸­çš„æ‰€æœ‰ä¸»æœº[root@nfs ~]# vim /etc/exports[root@nfs ~]# more /etc/exports/root/data/nfs 192.168.5.0/24(rw,no_root_squash)# å¯åŠ¨nfsæœåŠ¡[root@nfs ~]# systemctl restart nfs 2ï¼‰æ¥ä¸‹æ¥ï¼Œè¦åœ¨çš„æ¯ä¸ªnodeèŠ‚ç‚¹ä¸Šéƒ½å®‰è£…ä¸‹nfsï¼Œè¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†nodeèŠ‚ç‚¹å¯ä»¥é©±åŠ¨nfsè®¾å¤‡ 12# åœ¨nodeä¸Šå®‰è£…nfsæœåŠ¡ï¼Œæ³¨æ„ä¸éœ€è¦å¯åŠ¨[root@k8s-master01 ~]# yum install nfs-utils -y 3ï¼‰æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç¼–å†™podçš„é…ç½®æ–‡ä»¶äº†ï¼Œåˆ›å»ºvolume-nfs.yaml 12345678910111213141516171819202122232425apiVersion: v1kind: Podmetadata: name: volume-nfs namespace: devspec: containers: - name: nginx image: nginx:1.17.1 ports: - containerPort: 80 volumeMounts: - name: logs-volume mountPath: /var/log/nginx - name: busybox image: busybox:1.30 command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;tail -f /logs/access.log&quot;] volumeMounts: - name: logs-volume mountPath: /logs volumes: - name: logs-volume nfs: server: 192.168.5.6 #nfsæœåŠ¡å™¨åœ°å€ path: /root/data/nfs #å…±äº«æ–‡ä»¶è·¯å¾„ 4ï¼‰æœ€åï¼Œè¿è¡Œä¸‹podï¼Œè§‚å¯Ÿç»“æœ 123456789101112# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f volume-nfs.yamlpod/volume-nfs created# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods volume-nfs -n devNAME READY STATUS RESTARTS AGEvolume-nfs 2/2 Running 0 2m9s# æŸ¥çœ‹nfsæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•ï¼Œå‘ç°å·²ç»æœ‰æ–‡ä»¶äº†[root@k8s-master01 ~]# ls /root/data/access.log error.log 8.2 é«˜çº§å­˜å‚¨å‰é¢å·²ç»å­¦ä¹ äº†ä½¿ç”¨NFSæä¾›å­˜å‚¨ï¼Œæ­¤æ—¶å°±è¦æ±‚ç”¨æˆ·ä¼šæ­å»ºNFSç³»ç»Ÿï¼Œå¹¶ä¸”ä¼šåœ¨yamlé…ç½®nfsã€‚ç”±äºkubernetesæ”¯æŒçš„å­˜å‚¨ç³»ç»Ÿæœ‰å¾ˆå¤šï¼Œè¦æ±‚å®¢æˆ·å…¨éƒ½æŒæ¡ï¼Œæ˜¾ç„¶ä¸ç°å®ã€‚ä¸ºäº†èƒ½å¤Ÿå±è”½åº•å±‚å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œ kuberneteså¼•å…¥PVå’ŒPVCä¸¤ç§èµ„æºå¯¹è±¡ã€‚ PVï¼ˆPersistent Volumeï¼‰æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹PVç”±kubernetesç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒä¸åº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆä¸å…±äº«å­˜å‚¨çš„å¯¹æ¥ã€‚ PVCï¼ˆPersistent Volume Claimï¼‰æ˜¯æŒä¹…å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢å¥è¯è¯´ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘kubernetesç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·ã€‚ ä½¿ç”¨äº†PVå’ŒPVCä¹‹åï¼Œå·¥ä½œå¯ä»¥å¾—åˆ°è¿›ä¸€æ­¥çš„ç»†åˆ†ï¼š å­˜å‚¨ï¼šå­˜å‚¨å·¥ç¨‹å¸ˆç»´æŠ¤ PVï¼š kubernetesç®¡ç†å‘˜ç»´æŠ¤ PVCï¼škubernetesç”¨æˆ·ç»´æŠ¤ 8.2.1 PVPVæ˜¯å­˜å‚¨èµ„æºçš„æŠ½è±¡ï¼Œä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶: 1234567891011apiVersion: v1 kind: PersistentVolumemetadata: name: pv2spec: nfs: # å­˜å‚¨ç±»å‹ï¼Œä¸åº•å±‚çœŸæ­£å­˜å‚¨å¯¹åº” capacity: # å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½® storage: 2Gi accessModes: # è®¿é—®æ¨¡å¼ storageClassName: # å­˜å‚¨ç±»åˆ« persistentVolumeReclaimPolicy: # å›æ”¶ç­–ç•¥ PV çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š å­˜å‚¨ç±»å‹ åº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œkubernetesæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®éƒ½æœ‰æ‰€å·®å¼‚ å­˜å‚¨èƒ½åŠ›ï¼ˆcapacityï¼‰ ç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®( storage=1Gi )ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥IOPSã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½® è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰ ç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼ï¼š ReadWriteOnceï¼ˆRWOï¼‰ï¼šè¯»å†™æƒé™ï¼Œä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½ ReadOnlyManyï¼ˆROXï¼‰ï¼š åªè¯»æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½ ReadWriteManyï¼ˆRWXï¼‰ï¼šè¯»å†™æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ å›æ”¶ç­–ç•¥ï¼ˆpersistentVolumeReclaimPolicyï¼‰ å½“PVä¸å†è¢«ä½¿ç”¨äº†ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ã€‚ç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥ï¼š Retain ï¼ˆä¿ç•™ï¼‰ ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹å·¥æ¸…ç†æ•°æ® Recycleï¼ˆå›æ”¶ï¼‰ æ¸…é™¤ PV ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äºæ‰§è¡Œ rm -rf /thevolume/* Delete ï¼ˆåˆ é™¤ï¼‰ ä¸ PV ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ volume çš„åˆ é™¤æ“ä½œï¼Œå½“ç„¶è¿™å¸¸è§äºäº‘æœåŠ¡å•†çš„å­˜å‚¨æœåŠ¡ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ å­˜å‚¨ç±»åˆ« PVå¯ä»¥é€šè¿‡storageClassNameå‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ« å…·æœ‰ç‰¹å®šç±»åˆ«çš„PVåªèƒ½ä¸è¯·æ±‚äº†è¯¥ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š æœªè®¾å®šç±»åˆ«çš„PVåˆ™åªèƒ½ä¸ä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š çŠ¶æ€ï¼ˆstatusï¼‰ ä¸€ä¸ª PV çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¯èƒ½ä¼šå¤„äº4ä¸­ä¸åŒçš„é˜¶æ®µï¼š Availableï¼ˆå¯ç”¨ï¼‰ï¼š è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½• PVC ç»‘å®š Boundï¼ˆå·²ç»‘å®šï¼‰ï¼š è¡¨ç¤º PV å·²ç»è¢« PVC ç»‘å®š Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼š è¡¨ç¤º PVC è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜ Failedï¼ˆå¤±è´¥ï¼‰ï¼š è¡¨ç¤ºè¯¥ PV çš„è‡ªåŠ¨å›æ”¶å¤±è´¥ å®éªŒ ä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ï¼Œæ¥æ¼”ç¤ºPVçš„ä½¿ç”¨ï¼Œåˆ›å»º3ä¸ªPVï¼Œå¯¹åº”NFSä¸­çš„3ä¸ªæš´éœ²çš„è·¯å¾„ã€‚ å‡†å¤‡NFSç¯å¢ƒ 1234567891011# åˆ›å»ºç›®å½•[root@nfs ~]# mkdir /root/data/&#123;pv1,pv2,pv3&#125; -pv# æš´éœ²æœåŠ¡[root@nfs ~]# more /etc/exports/root/data/pv1 192.168.5.0/24(rw,no_root_squash)/root/data/pv2 192.168.5.0/24(rw,no_root_squash)/root/data/pv3 192.168.5.0/24(rw,no_root_squash)# é‡å¯æœåŠ¡[root@nfs ~]# systemctl restart nfs åˆ›å»ºpv.yaml 123456789101112131415161718192021222324252627282930313233343536373839404142434445apiVersion: v1kind: PersistentVolumemetadata: name: pv1spec: capacity: storage: 1Gi accessModes: - ReadWriteMany persistentVolumeReclaimPolicy: Retain nfs: path: /root/data/pv1 server: 192.168.5.6---apiVersion: v1kind: PersistentVolumemetadata: name: pv2spec: capacity: storage: 2Gi accessModes: - ReadWriteMany persistentVolumeReclaimPolicy: Retain nfs: path: /root/data/pv2 server: 192.168.5.6 ---apiVersion: v1kind: PersistentVolumemetadata: name: pv3spec: capacity: storage: 3Gi accessModes: - ReadWriteMany persistentVolumeReclaimPolicy: Retain nfs: path: /root/data/pv3 server: 192.168.5.6 123456789101112# åˆ›å»º pv[root@k8s-master01 ~]# kubectl create -f pv.yamlpersistentvolume/pv1 createdpersistentvolume/pv2 createdpersistentvolume/pv3 created# æŸ¥çœ‹pv[root@k8s-master01 ~]# kubectl get pv -o wideNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS AGE VOLUMEMODEpv1 1Gi RWX Retain Available 10s Filesystempv2 2Gi RWX Retain Available 10s Filesystempv3 3Gi RWX Retain Available 9s Filesystem 8.2.2 PVCPVCæ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶: 123456789101112apiVersion: v1kind: PersistentVolumeClaimmetadata: name: pvc namespace: devspec: accessModes: # è®¿é—®æ¨¡å¼ selector: # é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹© storageClassName: # å­˜å‚¨ç±»åˆ« resources: # è¯·æ±‚ç©ºé—´ requests: storage: 5Gi PVC çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰ ç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ é€‰æ‹©æ¡ä»¶ï¼ˆselectorï¼‰ é€šè¿‡Label Selectorçš„è®¾ç½®ï¼Œå¯ä½¿PVCå¯¹äºç³»ç»Ÿä¸­å·±å­˜åœ¨çš„PVè¿›è¡Œç­›é€‰ å­˜å‚¨ç±»åˆ«ï¼ˆstorageClassNameï¼‰ PVCåœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥classçš„pvæ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º èµ„æºè¯·æ±‚ï¼ˆResources ï¼‰ æè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚ å®éªŒ åˆ›å»ºpvc.yamlï¼Œç”³è¯·pv 1234567891011121314151617181920212223242526272829303132333435apiVersion: v1kind: PersistentVolumeClaimmetadata: name: pvc1 namespace: devspec: accessModes: - ReadWriteMany resources: requests: storage: 1Gi---apiVersion: v1kind: PersistentVolumeClaimmetadata: name: pvc2 namespace: devspec: accessModes: - ReadWriteMany resources: requests: storage: 1Gi---apiVersion: v1kind: PersistentVolumeClaimmetadata: name: pvc3 namespace: devspec: accessModes: - ReadWriteMany resources: requests: storage: 1Gi 12345678910111213141516171819# åˆ›å»ºpvc[root@k8s-master01 ~]# kubectl create -f pvc.yamlpersistentvolumeclaim/pvc1 createdpersistentvolumeclaim/pvc2 createdpersistentvolumeclaim/pvc3 created# æŸ¥çœ‹pvc[root@k8s-master01 ~]# kubectl get pvc -n dev -o wideNAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE VOLUMEMODEpvc1 Bound pv1 1Gi RWX 15s Filesystempvc2 Bound pv2 2Gi RWX 15s Filesystempvc3 Bound pv3 3Gi RWX 15s Filesystem# æŸ¥çœ‹pv[root@k8s-master01 ~]# kubectl get pv -o wideNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM AGE VOLUMEMODEpv1 1Gi RWx Retain Bound dev/pvc1 3h37m Filesystempv2 2Gi RWX Retain Bound dev/pvc2 3h37m Filesystempv3 3Gi RWX Retain Bound dev/pvc3 3h37m Filesystem åˆ›å»ºpods.yaml, ä½¿ç”¨pv 12345678910111213141516171819202122232425262728293031323334353637apiVersion: v1kind: Podmetadata: name: pod1 namespace: devspec: containers: - name: busybox image: busybox:1.30 command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&quot;] volumeMounts: - name: volume mountPath: /root/ volumes: - name: volume persistentVolumeClaim: claimName: pvc1 readOnly: false---apiVersion: v1kind: Podmetadata: name: pod2 namespace: devspec: containers: - name: busybox image: busybox:1.30 command: [&quot;/bin/sh&quot;,&quot;-c&quot;,&quot;while true;do echo pod2 &gt;&gt; /root/out.txt; sleep 10; done;&quot;] volumeMounts: - name: volume mountPath: /root/ volumes: - name: volume persistentVolumeClaim: claimName: pvc2 readOnly: false 1234567891011121314151617181920212223242526272829303132# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pods.yamlpod/pod1 createdpod/pod2 created# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pods -n dev -o wideNAME READY STATUS RESTARTS AGE IP NODE pod1 1/1 Running 0 14s 10.244.1.69 node1 pod2 1/1 Running 0 14s 10.244.1.70 node1 # æŸ¥çœ‹pvc[root@k8s-master01 ~]# kubectl get pvc -n dev -o wideNAME STATUS VOLUME CAPACITY ACCESS MODES AGE VOLUMEMODEpvc1 Bound pv1 1Gi RWX 94m Filesystempvc2 Bound pv2 2Gi RWX 94m Filesystempvc3 Bound pv3 3Gi RWX 94m Filesystem# æŸ¥çœ‹pv[root@k8s-master01 ~]# kubectl get pv -n dev -o wideNAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM AGE VOLUMEMODEpv1 1Gi RWX Retain Bound dev/pvc1 5h11m Filesystempv2 2Gi RWX Retain Bound dev/pvc2 5h11m Filesystempv3 3Gi RWX Retain Bound dev/pvc3 5h11m Filesystem# æŸ¥çœ‹nfsä¸­çš„æ–‡ä»¶å­˜å‚¨[root@nfs ~]# more /root/data/pv1/out.txtnode1node1[root@nfs ~]# more /root/data/pv2/out.txtnode2node2 8.2.3 ç”Ÿå‘½å‘¨æœŸPVCå’ŒPVæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒPVå’ŒPVCä¹‹é—´çš„ç›¸äº’ä½œç”¨éµå¾ªä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š èµ„æºä¾›åº”ï¼šç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºåº•å±‚å­˜å‚¨å’ŒPV èµ„æºç»‘å®šï¼šç”¨æˆ·åˆ›å»ºPVCï¼Œkubernetesè´Ÿè´£æ ¹æ®PVCçš„å£°æ˜å»å¯»æ‰¾PVï¼Œå¹¶ç»‘å®š åœ¨ç”¨æˆ·å®šä¹‰å¥½PVCä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®PVCå¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚åœ¨å·²å­˜åœ¨çš„PVä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„ ä¸€æ—¦æ‰¾åˆ°ï¼Œå°±å°†è¯¥PVä¸ç”¨æˆ·å®šä¹‰çš„PVCè¿›è¡Œç»‘å®šï¼Œç”¨æˆ·çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªPVCäº† å¦‚æœæ‰¾ä¸åˆ°ï¼ŒPVCåˆ™ä¼šæ— é™æœŸå¤„äºPendingçŠ¶æ€ï¼Œç›´åˆ°ç­‰åˆ°ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºäº†ä¸€ä¸ªç¬¦åˆå…¶è¦æ±‚çš„PV PVä¸€æ—¦ç»‘å®šåˆ°æŸä¸ªPVCä¸Šï¼Œå°±ä¼šè¢«è¿™ä¸ªPVCç‹¬å ï¼Œä¸èƒ½å†ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šäº† èµ„æºä½¿ç”¨ï¼šç”¨æˆ·å¯åœ¨podä¸­åƒvolumeä¸€æ ·ä½¿ç”¨pvc Podä½¿ç”¨Volumeçš„å®šä¹‰ï¼Œå°†PVCæŒ‚è½½åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„è¿›è¡Œä½¿ç”¨ã€‚ èµ„æºé‡Šæ”¾ï¼šç”¨æˆ·åˆ é™¤pvcæ¥é‡Šæ”¾pv å½“å­˜å‚¨èµ„æºä½¿ç”¨å®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥åˆ é™¤PVCï¼Œä¸è¯¥PVCç»‘å®šçš„PVå°†ä¼šè¢«æ ‡è®°ä¸ºâ€œå·²é‡Šæ”¾â€ï¼Œä½†è¿˜ä¸èƒ½ç«‹åˆ»ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šã€‚é€šè¿‡ä¹‹å‰PVCå†™å…¥çš„æ•°æ®å¯èƒ½è¿˜è¢«ç•™åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåªæœ‰åœ¨æ¸…é™¤ä¹‹åè¯¥PVæ‰èƒ½å†æ¬¡ä½¿ç”¨ã€‚ èµ„æºå›æ”¶ï¼škubernetesæ ¹æ®pvè®¾ç½®çš„å›æ”¶ç­–ç•¥è¿›è¡Œèµ„æºçš„å›æ”¶ å¯¹äºPVï¼Œç®¡ç†å‘˜å¯ä»¥è®¾å®šå›æ”¶ç­–ç•¥ï¼Œç”¨äºè®¾ç½®ä¸ä¹‹ç»‘å®šçš„PVCé‡Šæ”¾èµ„æºä¹‹åå¦‚ä½•å¤„ç†é—ç•™æ•°æ®çš„é—®é¢˜ã€‚åªæœ‰PVçš„å­˜å‚¨ç©ºé—´å®Œæˆå›æ”¶ï¼Œæ‰èƒ½ä¾›æ–°çš„PVCç»‘å®šå’Œä½¿ç”¨ 8.3 é…ç½®å­˜å‚¨8.3.1 ConfigMapConfigMapæ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„ã€‚ åˆ›å»ºconfigmap.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789apiVersion: v1kind: ConfigMapmetadata: name: configmap namespace: devdata: info: | username:admin password:123456 æ¥ä¸‹æ¥ï¼Œä½¿ç”¨æ­¤é…ç½®æ–‡ä»¶åˆ›å»ºconfigmap 12345678910111213141516171819# åˆ›å»ºconfigmap[root@k8s-master01 ~]# kubectl create -f configmap.yamlconfigmap/configmap created# æŸ¥çœ‹configmapè¯¦æƒ…[root@k8s-master01 ~]# kubectl describe cm configmap -n devName: configmapNamespace: devLabels: &lt;none&gt;Annotations: &lt;none&gt;Data====info:----username:adminpassword:123456Events: &lt;none&gt; æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªpod-configmap.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„configmapæŒ‚è½½è¿›å» 12345678910111213141516apiVersion: v1kind: Podmetadata: name: pod-configmap namespace: devspec: containers: - name: nginx image: nginx:1.17.1 volumeMounts: # å°†configmapæŒ‚è½½åˆ°ç›®å½• - name: config mountPath: /configmap/config volumes: # å¼•ç”¨configmap - name: config configMap: name: configmap 123456789101112131415161718192021# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pod-configmap.yamlpod/pod-configmap created# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pod pod-configmap -n devNAME READY STATUS RESTARTS AGEpod-configmap 1/1 Running 0 6s#è¿›å…¥å®¹å™¨[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh# cd /configmap/config/# lsinfo# more infousername:adminpassword:123456# å¯ä»¥çœ‹åˆ°æ˜ å°„å·²ç»æˆåŠŸï¼Œæ¯ä¸ªconfigmapéƒ½æ˜ å°„æˆäº†ä¸€ä¸ªç›®å½•# key---&gt;æ–‡ä»¶ value----&gt;æ–‡ä»¶ä¸­çš„å†…å®¹# æ­¤æ—¶å¦‚æœæ›´æ–°configmapçš„å†…å®¹, å®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–° 8.3.2 Secretåœ¨kubernetesä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’ŒConfigMapéå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸ºSecretå¯¹è±¡ã€‚å®ƒä¸»è¦ç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€ç§˜é’¥ã€è¯ä¹¦ç­‰ç­‰ã€‚ é¦–å…ˆä½¿ç”¨base64å¯¹æ•°æ®è¿›è¡Œç¼–ç  1234[root@k8s-master01 ~]# echo -n &#x27;admin&#x27; | base64 #å‡†å¤‡usernameYWRtaW4=[root@k8s-master01 ~]# echo -n &#x27;123456&#x27; | base64 #å‡†å¤‡passwordMTIzNDU2 æ¥ä¸‹æ¥ç¼–å†™secret.yamlï¼Œå¹¶åˆ›å»ºSecret 123456789apiVersion: v1kind: Secretmetadata: name: secret namespace: devtype: Opaquedata: username: YWRtaW4= password: MTIzNDU2 123456789101112131415# åˆ›å»ºsecret[root@k8s-master01 ~]# kubectl create -f secret.yamlsecret/secret created# æŸ¥çœ‹secretè¯¦æƒ…[root@k8s-master01 ~]# kubectl describe secret secret -n devName: secretNamespace: devLabels: &lt;none&gt;Annotations: &lt;none&gt;Type: OpaqueData====password: 6 bytesusername: 5 bytes åˆ›å»ºpod-secret.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„secretæŒ‚è½½è¿›å»ï¼š 12345678910111213141516apiVersion: v1kind: Podmetadata: name: pod-secret namespace: devspec: containers: - name: nginx image: nginx:1.17.1 volumeMounts: # å°†secretæŒ‚è½½åˆ°ç›®å½• - name: config mountPath: /secret/config volumes: - name: config secret: secretName: secret 1234567891011121314151617# åˆ›å»ºpod[root@k8s-master01 ~]# kubectl create -f pod-secret.yamlpod/pod-secret created# æŸ¥çœ‹pod[root@k8s-master01 ~]# kubectl get pod pod-secret -n devNAME READY STATUS RESTARTS AGEpod-secret 1/1 Running 0 2m28s# è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹secretä¿¡æ¯ï¼Œå‘ç°å·²ç»è‡ªåŠ¨è§£ç äº†[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev/ # ls /secret/config/password username/ # more /secret/config/usernameadmin/ # more /secret/config/password123456 è‡³æ­¤ï¼Œå·²ç»å®ç°äº†åˆ©ç”¨secretå®ç°äº†ä¿¡æ¯çš„ç¼–ç ã€‚ 9. å®‰å…¨è®¤è¯9.1 è®¿é—®æ§åˆ¶æ¦‚è¿°Kubernetesä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯å…¶ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚æ‰€è°“çš„å®‰å…¨æ€§å…¶å®å°±æ˜¯ä¿è¯å¯¹Kubernetesçš„å„ç§å®¢æˆ·ç«¯è¿›è¡Œè®¤è¯å’Œé‰´æƒæ“ä½œã€‚ å®¢æˆ·ç«¯ åœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯é€šå¸¸æœ‰ä¸¤ç±»ï¼š User Accountï¼šä¸€èˆ¬æ˜¯ç‹¬ç«‹äºkubernetesä¹‹å¤–çš„å…¶ä»–æœåŠ¡ç®¡ç†çš„ç”¨æˆ·è´¦å·ã€‚ Service Accountï¼škubernetesç®¡ç†çš„è´¦å·ï¼Œç”¨äºä¸ºPodä¸­çš„æœåŠ¡è¿›ç¨‹åœ¨è®¿é—®Kubernetesæ—¶æä¾›èº«ä»½æ ‡è¯†ã€‚ è®¤è¯ã€æˆæƒä¸å‡†å…¥æ§åˆ¶ ApiServeræ˜¯è®¿é—®åŠç®¡ç†èµ„æºå¯¹è±¡çš„å”¯ä¸€å…¥å£ã€‚ä»»ä½•ä¸€ä¸ªè¯·æ±‚è®¿é—®ApiServerï¼Œéƒ½è¦ç»è¿‡ä¸‹é¢ä¸‰ä¸ªæµç¨‹ï¼š Authenticationï¼ˆè®¤è¯ï¼‰ï¼šèº«ä»½é‰´åˆ«ï¼Œåªæœ‰æ­£ç¡®çš„è´¦å·æ‰èƒ½å¤Ÿé€šè¿‡è®¤è¯ Authorizationï¼ˆæˆæƒï¼‰ï¼š åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹è®¿é—®çš„èµ„æºæ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ Admission Controlï¼ˆå‡†å…¥æ§åˆ¶ï¼‰ï¼šç”¨äºè¡¥å……æˆæƒæœºåˆ¶ä»¥å®ç°æ›´åŠ ç²¾ç»†çš„è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚ 9.2 è®¤è¯ç®¡ç†Kubernetesé›†ç¾¤å®‰å…¨çš„æœ€å…³é”®ç‚¹åœ¨äºå¦‚ä½•è¯†åˆ«å¹¶è®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå®ƒæä¾›äº†3ç§å®¢æˆ·ç«¯èº«ä»½è®¤è¯æ–¹å¼ï¼š HTTP Baseè®¤è¯ï¼šé€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è®¤è¯ 1è¿™ç§è®¤è¯æ–¹å¼æ˜¯æŠŠâ€œç”¨æˆ·å:å¯†ç â€ç”¨BASE64ç®—æ³•è¿›è¡Œç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨HTTPè¯·æ±‚ä¸­çš„Header AuthorizationåŸŸé‡Œå‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œè§£ç ï¼Œè·å–ç”¨æˆ·ååŠå¯†ç ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚ HTTP Tokenè®¤è¯ï¼šé€šè¿‡ä¸€ä¸ªTokenæ¥è¯†åˆ«åˆæ³•ç”¨æˆ· 1è¿™ç§è®¤è¯æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²--Tokenæ¥è¡¨æ˜å®¢æˆ·èº«ä»½çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ªTokenå¯¹åº”ä¸€ä¸ªç”¨æˆ·åï¼Œå½“å®¢æˆ·ç«¯å‘èµ·APIè°ƒç”¨è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨HTTP Headeré‡Œæ”¾å…¥Tokenï¼ŒAPI Serveræ¥åˆ°Tokenåä¼šè·ŸæœåŠ¡å™¨ä¸­ä¿å­˜çš„tokenè¿›è¡Œæ¯”å¯¹ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚ HTTPSè¯ä¹¦è®¤è¯ï¼šåŸºäºCAæ ¹è¯ä¹¦ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼ 1è¿™ç§è®¤è¯æ–¹å¼æ˜¯å®‰å…¨æ€§æœ€é«˜çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæ˜¯æ“ä½œèµ·æ¥æœ€éº»çƒ¦çš„ä¸€ç§æ–¹å¼ã€‚ HTTPSè®¤è¯å¤§ä½“åˆ†ä¸º3ä¸ªè¿‡ç¨‹ï¼š è¯ä¹¦ç”³è¯·å’Œä¸‹å‘ 1HTTPSé€šä¿¡åŒæ–¹çš„æœåŠ¡å™¨å‘CAæœºæ„ç”³è¯·è¯ä¹¦ï¼ŒCAæœºæ„ä¸‹å‘æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦åŠç§é’¥ç»™ç”³è¯·è€… å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒå‘è®¤è¯ 123451&gt; å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸‹å‘è‡ªå·±çš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œ å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å¾—æœåŠ¡ç«¯çš„å…¬é’¥ï¼Œ å®¢æˆ·ç«¯åˆ©ç”¨æœåŠ¡å™¨ç«¯çš„å…¬é’¥è®¤è¯è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è®¤å¯è¿™ä¸ªæœåŠ¡å™¨2&gt; å®¢æˆ·ç«¯å‘é€è‡ªå·±çš„è¯ä¹¦ç»™æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œ åœ¨è¯ä¹¦ä¸­è·å¾—å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦åˆæ³• æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ 12æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å¥½åŠ å¯†æ–¹æ¡ˆåï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ç§˜é’¥å¹¶åŠ å¯†ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚æœåŠ¡å™¨ç«¯æ¥æ”¶è¿™ä¸ªç§˜é’¥åï¼ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡è¯¥éšæœºç§˜é’¥åŠ å¯† æ³¨æ„: Kuberneteså…è®¸åŒæ—¶é…ç½®å¤šç§è®¤è¯æ–¹å¼ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªæ–¹å¼è®¤è¯é€šè¿‡å³å¯ 9.3 æˆæƒç®¡ç†æˆæƒå‘ç”Ÿåœ¨è®¤è¯æˆåŠŸä¹‹åï¼Œé€šè¿‡è®¤è¯å°±å¯ä»¥çŸ¥é“è¯·æ±‚ç”¨æˆ·æ˜¯è°ï¼Œ ç„¶åKubernetesä¼šæ ¹æ®äº‹å…ˆå®šä¹‰çš„æˆæƒç­–ç•¥æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæˆæƒã€‚ æ¯ä¸ªå‘é€åˆ°ApiServerçš„è¯·æ±‚éƒ½å¸¦ä¸Šäº†ç”¨æˆ·å’Œèµ„æºçš„ä¿¡æ¯ï¼šæ¯”å¦‚å‘é€è¯·æ±‚çš„ç”¨æˆ·ã€è¯·æ±‚çš„è·¯å¾„ã€è¯·æ±‚çš„åŠ¨ä½œç­‰ï¼Œæˆæƒå°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯å’Œæˆæƒç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆç­–ç•¥ï¼Œåˆ™è®¤ä¸ºæˆæƒé€šè¿‡ï¼Œå¦åˆ™ä¼šè¿”å›é”™è¯¯ã€‚ API Serverç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æˆæƒç­–ç•¥ï¼š AlwaysDenyï¼šè¡¨ç¤ºæ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯• AlwaysAllowï¼šå…è®¸æ¥æ”¶æ‰€æœ‰è¯·æ±‚ï¼Œç›¸å½“äºé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼ˆKubernetesé»˜è®¤çš„ç­–ç•¥ï¼‰ ABACï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶ Webhookï¼šé€šè¿‡è°ƒç”¨å¤–éƒ¨RESTæœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ Nodeï¼šæ˜¯ä¸€ç§ä¸“ç”¨æ¨¡å¼ï¼Œç”¨äºå¯¹kubeletå‘å‡ºçš„è¯·æ±‚è¿›è¡Œè®¿é—®æ§åˆ¶ RBACï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆkubeadmå®‰è£…æ–¹å¼ä¸‹çš„é»˜è®¤é€‰é¡¹ï¼‰ RBAC(Role-Based Access Control) åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä¸»è¦æ˜¯åœ¨æè¿°ä¸€ä»¶äº‹æƒ…ï¼šç»™å“ªäº›å¯¹è±¡æˆäºˆäº†å“ªäº›æƒé™ å…¶ä¸­æ¶‰åŠåˆ°äº†ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š å¯¹è±¡ï¼šUserã€Groupsã€ServiceAccount è§’è‰²ï¼šä»£è¡¨ç€ä¸€ç»„å®šä¹‰åœ¨èµ„æºä¸Šçš„å¯æ“ä½œåŠ¨ä½œ(æƒé™)çš„é›†åˆ ç»‘å®šï¼šå°†å®šä¹‰å¥½çš„è§’è‰²è·Ÿç”¨æˆ·ç»‘å®šåœ¨ä¸€èµ· RBACå¼•å…¥äº†4ä¸ªé¡¶çº§èµ„æºå¯¹è±¡ï¼š Roleã€ClusterRoleï¼šè§’è‰²ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™ RoleBindingã€ClusterRoleBindingï¼šè§’è‰²ç»‘å®šï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™ï¼‰èµ‹äºˆç»™å¯¹è±¡ Roleã€ClusterRole ä¸€ä¸ªè§’è‰²å°±æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œè¿™é‡Œçš„æƒé™éƒ½æ˜¯è®¸å¯å½¢å¼çš„ï¼ˆç™½åå•ï¼‰ã€‚ 12345678910# Roleåªèƒ½å¯¹å‘½åç©ºé—´å†…çš„èµ„æºè¿›è¡Œæˆæƒï¼Œéœ€è¦æŒ‡å®šnameapcekind: RoleapiVersion: rbac.authorization.k8s.io/v1beta1metadata: namespace: dev name: authorization-rolerules:- apiGroups: [&quot;&quot;] # æ”¯æŒçš„APIç»„åˆ—è¡¨,&quot;&quot; ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤ resources: [&quot;pods&quot;] # æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨ verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;] # å…è®¸çš„å¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨ 123456789# ClusterRoleå¯ä»¥å¯¹é›†ç¾¤èŒƒå›´å†…èµ„æºã€è·¨namespacesçš„èŒƒå›´èµ„æºã€éèµ„æºç±»å‹è¿›è¡Œæˆæƒkind: ClusterRoleapiVersion: rbac.authorization.k8s.io/v1beta1metadata: name: authorization-clusterrolerules:- apiGroups: [&quot;&quot;] resources: [&quot;pods&quot;] verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;] éœ€è¦è¯¦ç»†è¯´æ˜çš„æ˜¯ï¼Œrulesä¸­çš„å‚æ•°ï¼š apiGroups: æ”¯æŒçš„APIç»„åˆ—è¡¨ 1&quot;&quot;,&quot;apps&quot;, &quot;autoscaling&quot;, &quot;batch&quot; resourcesï¼šæ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨ 123&quot;services&quot;, &quot;endpoints&quot;, &quot;pods&quot;,&quot;secrets&quot;,&quot;configmaps&quot;,&quot;crontabs&quot;,&quot;deployments&quot;,&quot;jobs&quot;,&quot;nodes&quot;,&quot;rolebindings&quot;,&quot;clusterroles&quot;,&quot;daemonsets&quot;,&quot;replicasets&quot;,&quot;statefulsets&quot;,&quot;horizontalpodautoscalers&quot;,&quot;replicationcontrollers&quot;,&quot;cronjobs&quot; verbsï¼šå¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨ 1&quot;get&quot;, &quot;list&quot;, &quot;watch&quot;, &quot;create&quot;, &quot;update&quot;, &quot;patch&quot;, &quot;delete&quot;, &quot;exec&quot; RoleBindingã€ClusterRoleBinding è§’è‰²ç»‘å®šç”¨æ¥æŠŠä¸€ä¸ªè§’è‰²ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šï¼Œç»‘å®šç›®æ ‡å¯ä»¥æ˜¯Userã€Groupæˆ–è€…ServiceAccountã€‚ 1234567891011121314# RoleBindingå¯ä»¥å°†åŒä¸€namespaceä¸­çš„subjectç»‘å®šåˆ°æŸä¸ªRoleä¸‹ï¼Œåˆ™æ­¤subjectå³å…·æœ‰è¯¥Roleå®šä¹‰çš„æƒé™kind: RoleBindingapiVersion: rbac.authorization.k8s.io/v1beta1metadata: name: authorization-role-binding namespace: devsubjects:- kind: User name: heima apiGroup: rbac.authorization.k8s.ioroleRef: kind: Role name: authorization-role apiGroup: rbac.authorization.k8s.io 12345678910111213# ClusterRoleBindingåœ¨æ•´ä¸ªé›†ç¾¤çº§åˆ«å’Œæ‰€æœ‰namespaceså°†ç‰¹å®šçš„subjectä¸ClusterRoleç»‘å®šï¼Œæˆäºˆæƒé™kind: ClusterRoleBindingapiVersion: rbac.authorization.k8s.io/v1beta1metadata: name: authorization-clusterrole-bindingsubjects:- kind: User name: heima apiGroup: rbac.authorization.k8s.ioroleRef: kind: ClusterRole name: authorization-clusterrole apiGroup: rbac.authorization.k8s.io RoleBindingå¼•ç”¨ClusterRoleè¿›è¡Œæˆæƒ RoleBindingå¯ä»¥å¼•ç”¨ClusterRoleï¼Œå¯¹å±äºåŒä¸€å‘½åç©ºé—´å†…ClusterRoleå®šä¹‰çš„èµ„æºä¸»ä½“è¿›è¡Œæˆæƒã€‚ 1ä¸€ç§å¾ˆå¸¸ç”¨çš„åšæ³•å°±æ˜¯ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸ºé›†ç¾¤èŒƒå›´é¢„å®šä¹‰å¥½ä¸€ç»„è§’è‰²ï¼ˆClusterRoleï¼‰ï¼Œç„¶ååœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­é‡å¤ä½¿ç”¨è¿™äº›ClusterRoleã€‚è¿™æ ·å¯ä»¥å¤§å¹…æé«˜æˆæƒç®¡ç†å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„ä¸ªå‘½åç©ºé—´ä¸‹çš„åŸºç¡€æ€§æˆæƒè§„åˆ™ä¸ä½¿ç”¨ä½“éªŒä¿æŒä¸€è‡´ã€‚ 123456789101112131415# è™½ç„¶authorization-clusterroleæ˜¯ä¸€ä¸ªé›†ç¾¤è§’è‰²ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†RoleBinding# æ‰€ä»¥heimaåªèƒ½è¯»å–devå‘½åç©ºé—´ä¸­çš„èµ„æºkind: RoleBindingapiVersion: rbac.authorization.k8s.io/v1beta1metadata: name: authorization-role-binding-ns namespace: devsubjects:- kind: User name: heima apiGroup: rbac.authorization.k8s.ioroleRef: kind: ClusterRole name: authorization-clusterrole apiGroup: rbac.authorization.k8s.io å®æˆ˜ï¼šåˆ›å»ºä¸€ä¸ªåªèƒ½ç®¡ç†devç©ºé—´ä¸‹Podsèµ„æºçš„è´¦å· åˆ›å»ºè´¦å· 12345678910111213141516171819202122232425262728# 1) åˆ›å»ºè¯ä¹¦[root@k8s-master01 pki]# cd /etc/kubernetes/pki/[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)# 2) ç”¨apiserverçš„è¯ä¹¦å»ç­¾ç½²# 2-1) ç­¾åç”³è¯·ï¼Œç”³è¯·çš„ç”¨æˆ·æ˜¯devman,ç»„æ˜¯devgroup[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj &quot;/CN=devman/O=devgroup&quot; # 2-2) ç­¾ç½²è¯ä¹¦[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650# 3) è®¾ç½®é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ä¿¡æ¯[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman# åˆ‡æ¢è´¦æˆ·åˆ°devman[root@k8s-master01 pki]# kubectl config use-context devman@kubernetesSwitched to context &quot;devman@kubernetes&quot;.# æŸ¥çœ‹devä¸‹podï¼Œå‘ç°æ²¡æœ‰æƒé™[root@k8s-master01 pki]# kubectl get pods -n devError from server (Forbidden): pods is forbidden: User &quot;devman&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;dev&quot;# åˆ‡æ¢åˆ°adminè´¦æˆ·[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetesSwitched to context &quot;kubernetes-admin@kubernetes&quot;. 2ï¼‰ åˆ›å»ºRoleå’ŒRoleBindingï¼Œä¸ºdevmanç”¨æˆ·æˆæƒ 12345678910111213141516171819202122232425kind: RoleapiVersion: rbac.authorization.k8s.io/v1beta1metadata: namespace: dev name: dev-rolerules:- apiGroups: [&quot;&quot;] resources: [&quot;pods&quot;] verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;] ---kind: RoleBindingapiVersion: rbac.authorization.k8s.io/v1beta1metadata: name: authorization-role-binding namespace: devsubjects:- kind: User name: devman apiGroup: rbac.authorization.k8s.ioroleRef: kind: Role name: dev-role apiGroup: rbac.authorization.k8s.io 123[root@k8s-master01 pki]# kubectl create -f dev-role.yamlrole.rbac.authorization.k8s.io/dev-role createdrolebinding.rbac.authorization.k8s.io/authorization-role-binding created åˆ‡æ¢è´¦æˆ·ï¼Œå†æ¬¡éªŒè¯ 1234567891011121314# åˆ‡æ¢è´¦æˆ·åˆ°devman[root@k8s-master01 pki]# kubectl config use-context devman@kubernetesSwitched to context &quot;devman@kubernetes&quot;.# å†æ¬¡æŸ¥çœ‹[root@k8s-master01 pki]# kubectl get pods -n devNAME READY STATUS RESTARTS AGEnginx-deployment-66cb59b984-8wp2k 1/1 Running 0 4d1hnginx-deployment-66cb59b984-dc46j 1/1 Running 0 4d1hnginx-deployment-66cb59b984-thfck 1/1 Running 0 4d1h# ä¸ºäº†ä¸å½±å“åé¢çš„å­¦ä¹ ,åˆ‡å›adminè´¦æˆ·[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetesSwitched to context &quot;kubernetes-admin@kubernetes&quot;. 9.4 å‡†å…¥æ§åˆ¶é€šè¿‡äº†å‰é¢çš„è®¤è¯å’Œæˆæƒä¹‹åï¼Œè¿˜éœ€è¦ç»è¿‡å‡†å…¥æ§åˆ¶å¤„ç†é€šè¿‡ä¹‹åï¼Œapiserveræ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚ å‡†å…¥æ§åˆ¶æ˜¯ä¸€ä¸ªå¯é…ç½®çš„æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åœ¨Api-Serverä¸Šé€šè¿‡å‘½ä»¤è¡Œè®¾ç½®é€‰æ‹©æ‰§è¡Œå“ªäº›å‡†å…¥æ§åˆ¶å™¨ï¼š 12--admission-control=NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel, DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds åªæœ‰å½“æ‰€æœ‰çš„å‡†å…¥æ§åˆ¶å™¨éƒ½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œapiserveræ‰æ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿”å›æ‹’ç»ã€‚ å½“å‰å¯é…ç½®çš„Admission Controlå‡†å…¥æ§åˆ¶å¦‚ä¸‹ï¼š AlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚ AlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯• AlwaysPullImagesï¼šåœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»å»ä¸‹è½½é•œåƒ DenyExecOnPrivilegedï¼šå®ƒä¼šæ‹¦æˆªæ‰€æœ‰æƒ³åœ¨Privileged Containerä¸Šæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚ ImagePolicyWebhookï¼šè¿™ä¸ªæ’ä»¶å°†å…è®¸åç«¯çš„ä¸€ä¸ªWebhookç¨‹åºæ¥å®Œæˆadmission controllerçš„åŠŸèƒ½ã€‚ Service Accountï¼šå®ç°ServiceAccountå®ç°äº†è‡ªåŠ¨åŒ– SecurityContextDenyï¼šè¿™ä¸ªæ’ä»¶å°†ä½¿ç”¨SecurityContextçš„Podä¸­çš„å®šä¹‰å…¨éƒ¨å¤±æ•ˆ ResourceQuotaï¼šç”¨äºèµ„æºé…é¢ç®¡ç†ç›®çš„ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚ï¼Œç¡®ä¿åœ¨namespaceä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡ LimitRangerï¼šç”¨äºèµ„æºé™åˆ¶ç®¡ç†ï¼Œä½œç”¨äºnamespaceä¸Šï¼Œç¡®ä¿å¯¹Podè¿›è¡Œèµ„æºé™åˆ¶ InitialResourcesï¼šä¸ºæœªè®¾ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„Podï¼Œæ ¹æ®å…¶é•œåƒçš„å†å²èµ„æºçš„ä½¿ç”¨æƒ…å†µè¿›è¡Œè®¾ç½® NamespaceLifecycleï¼šå¦‚æœå°è¯•åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„namespaceä¸­åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œåˆ™è¯¥åˆ›å»ºè¯·æ±‚å°†è¢«æ‹’ç»ã€‚å½“åˆ é™¤ä¸€ä¸ªnamespaceæ—¶ï¼Œç³»ç»Ÿå°†ä¼šåˆ é™¤è¯¥namespaceä¸­æ‰€æœ‰å¯¹è±¡ã€‚ DefaultStorageClassï¼šä¸ºäº†å®ç°å…±äº«å­˜å‚¨çš„åŠ¨æ€ä¾›åº”ï¼Œä¸ºæœªæŒ‡å®šStorageClassæˆ–PVçš„PVCå°è¯•åŒ¹é…é»˜è®¤çš„StorageClassï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·åœ¨ç”³è¯·PVCæ—¶æ‰€éœ€äº†è§£çš„åç«¯å­˜å‚¨ç»†èŠ‚ DefaultTolerationSecondsï¼šè¿™ä¸ªæ’ä»¶ä¸ºé‚£äº›æ²¡æœ‰è®¾ç½®forgiveness tolerationså¹¶å…·æœ‰notready:NoExecuteå’Œunreachable:NoExecuteä¸¤ç§taintsçš„Podè®¾ç½®é»˜è®¤çš„â€œå®¹å¿â€æ—¶é—´ï¼Œä¸º5min PodSecurityPolicyï¼šè¿™ä¸ªæ’ä»¶ç”¨äºåœ¨åˆ›å»ºæˆ–ä¿®æ”¹Podæ—¶å†³å®šæ˜¯å¦æ ¹æ®Podçš„security contextå’Œå¯ç”¨çš„PodSecurityPolicyå¯¹Podçš„å®‰å…¨ç­–ç•¥è¿›è¡Œæ§åˆ¶ 10. DashBoardä¹‹å‰åœ¨kubernetesä¸­å®Œæˆçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡å‘½ä»¤è¡Œå·¥å…·kubectlå®Œæˆçš„ã€‚å…¶å®ï¼Œä¸ºäº†æä¾›æ›´ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒï¼Œkubernetesè¿˜å¼€å‘äº†ä¸€ä¸ªåŸºäºwebçš„ç”¨æˆ·ç•Œé¢ï¼ˆDashboardï¼‰ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨Dashboardéƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œè¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„çŠ¶æ€ï¼Œæ‰§è¡Œæ•…éšœæ’æŸ¥ä»¥åŠç®¡ç†kubernetesä¸­å„ç§èµ„æºã€‚ 10.1 éƒ¨ç½²Dashboard ä¸‹è½½yamlï¼Œå¹¶è¿è¡ŒDashboard 1234567891011121314151617181920212223242526272829303132# ä¸‹è½½yaml[root@k8s-master01 ~]# wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml# ä¿®æ”¹kubernetes-dashboardçš„Serviceç±»å‹kind: ServiceapiVersion: v1metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboardspec: type: NodePort # æ–°å¢ ports: - port: 443 targetPort: 8443 nodePort: 30009 # æ–°å¢ selector: k8s-app: kubernetes-dashboard# éƒ¨ç½²[root@k8s-master01 ~]# kubectl create -f recommended.yaml# æŸ¥çœ‹namespaceä¸‹çš„kubernetes-dashboardä¸‹çš„èµ„æº[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboardNAME READY STATUS RESTARTS AGEpod/dashboard-metrics-scraper-c79c65bb7-zwfvw 1/1 Running 0 111spod/kubernetes-dashboard-56484d4c5-z95z5 1/1 Running 0 111sNAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGEservice/dashboard-metrics-scraper ClusterIP 10.96.89.218 &lt;none&gt; 8000/TCP 111sservice/kubernetes-dashboard NodePort 10.104.178.171 &lt;none&gt; 443:30009/TCP 111s 2ï¼‰åˆ›å»ºè®¿é—®è´¦æˆ·ï¼Œè·å–token 123456789101112131415161718192021222324# åˆ›å»ºè´¦å·[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard# æˆæƒ[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin# è·å–è´¦å·token[root@k8s-master01 ~]# kubectl get secrets -n kubernetes-dashboard | grep dashboard-admindashboard-admin-token-xbqhh kubernetes.io/service-account-token 3 2m35s[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboardName: dashboard-admin-token-xbqhhNamespace: kubernetes-dashboardLabels: &lt;none&gt;Annotations: kubernetes.io/service-account.name: dashboard-admin kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039Type: kubernetes.io/service-account-tokenData====namespace: 20 bytestoken: eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLwca.crt: 1025 bytes 3ï¼‰é€šè¿‡æµè§ˆå™¨è®¿é—®Dashboardçš„UI åœ¨ç™»å½•é¡µé¢ä¸Šè¾“å…¥ä¸Šé¢çš„token å‡ºç°ä¸‹é¢çš„é¡µé¢ä»£è¡¨æˆåŠŸ 10.2 ä½¿ç”¨DashBoardæœ¬ç« èŠ‚ä»¥Deploymentä¸ºä¾‹æ¼”ç¤ºDashBoardçš„ä½¿ç”¨ æŸ¥çœ‹ é€‰æ‹©æŒ‡å®šçš„å‘½åç©ºé—´devï¼Œç„¶åç‚¹å‡»Deploymentsï¼ŒæŸ¥çœ‹devç©ºé—´ä¸‹çš„æ‰€æœ‰deployment æ‰©ç¼©å®¹ åœ¨Deploymentä¸Šç‚¹å‡»è§„æ¨¡ï¼Œç„¶åæŒ‡å®šç›®æ ‡å‰¯æœ¬æ•°é‡ï¼Œç‚¹å‡»ç¡®å®š ç¼–è¾‘ åœ¨Deploymentä¸Šç‚¹å‡»ç¼–è¾‘ï¼Œç„¶åä¿®æ”¹yamlæ–‡ä»¶ï¼Œç‚¹å‡»ç¡®å®š æŸ¥çœ‹Pod ç‚¹å‡»Pods, æŸ¥çœ‹podsåˆ—è¡¨ æ“ä½œPod é€‰ä¸­æŸä¸ªPodï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œæ—¥å¿—ï¼ˆlogsï¼‰ã€è¿›å…¥æ‰§è¡Œï¼ˆexecï¼‰ã€ç¼–è¾‘ã€åˆ é™¤æ“ä½œ Dashboardæä¾›äº†kubectlçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè¿™é‡Œä¸å†ä¸€ä¸€æ¼”ç¤º åŸè§†é¢‘åœ°å€ åŸæ–‡ç« åœ°å€","categories":[],"tags":[],"author":"lwy"},{"title":"redisç›¸å…³çŸ¥è¯†","slug":"redisç›¸å…³çŸ¥è¯†","date":"2022-02-12T06:22:21.000Z","updated":"2022-02-13T13:26:58.487Z","comments":true,"path":"2022/02/12/redisç›¸å…³çŸ¥è¯†/","link":"","permalink":"https://lwy0518.github.io/2022/02/12/redis%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/","excerpt":"ç›®å½•1ã€NoSQLæ•°æ®åº“ç®€ä»‹2ã€Redis6æ¦‚è¿°å’Œå®‰è£…3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹4ã€Redis6é…ç½®æ–‡ä»¶è¯¦è§£5ã€Redis6çš„å‘å¸ƒå’Œè®¢é˜…6ã€Redis6æ–°æ•°æ®ç±»å‹7ã€Jedisæ“ä½œRedis68ã€Redis6ä¸SpringBootæ•´åˆ9ã€Redis6çš„äº‹åŠ¡æ“ä½œ10ã€Redis6æŒä¹…åŒ–ä¹‹RDB11ã€Redis6æŒä¹…åŒ–ä¹‹AOF12ã€Redis6çš„ä¸»ä»å¤åˆ¶13ã€Redis6é›†ç¾¤14ã€Redis6åº”ç”¨é—®é¢˜è§£å†³15ã€Redis6æ–°åŠŸèƒ½","text":"ç›®å½•1ã€NoSQLæ•°æ®åº“ç®€ä»‹2ã€Redis6æ¦‚è¿°å’Œå®‰è£…3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹4ã€Redis6é…ç½®æ–‡ä»¶è¯¦è§£5ã€Redis6çš„å‘å¸ƒå’Œè®¢é˜…6ã€Redis6æ–°æ•°æ®ç±»å‹7ã€Jedisæ“ä½œRedis68ã€Redis6ä¸SpringBootæ•´åˆ9ã€Redis6çš„äº‹åŠ¡æ“ä½œ10ã€Redis6æŒä¹…åŒ–ä¹‹RDB11ã€Redis6æŒä¹…åŒ–ä¹‹AOF12ã€Redis6çš„ä¸»ä»å¤åˆ¶13ã€Redis6é›†ç¾¤14ã€Redis6åº”ç”¨é—®é¢˜è§£å†³15ã€Redis6æ–°åŠŸèƒ½ 1ã€NoSQLæ•°æ®åº“ç®€ä»‹1.1ã€æŠ€æœ¯å‘å±•1.2ã€NoSQLæ•°æ®åº“æ¦‚è¿°1.3ã€è¡Œå¼å­˜å‚¨æ•°æ®åº“1.4ã€å›¾å…³ç³»å‹æ•°æ®åº“1.5ã€æ•°æ®åº“æ’å2ã€Redis6æ¦‚è¿°å’Œå®‰è£…2.1ã€Redis6æ¦‚è¿°2.2ã€Redis6åœ¨Liunxç³»ç»Ÿå®‰è£…3ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹3.1ã€é”®ï¼ˆkeyï¼‰æ“ä½œ3.2ã€Rediså­—ç¬¦ä¸²(String)3.3ã€Redisåˆ—è¡¨(List)3.4ã€Redisé›†åˆ(Set)3.5ã€Rediså“ˆå¸Œ(Hash)3.6ã€Redisæœ‰åºé›†åˆZset4ã€Redis6é…ç½®æ–‡ä»¶è¯¦è§£5ã€Redis6çš„å‘å¸ƒå’Œè®¢é˜…5.1ã€ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…5.2ã€Redisçš„å‘å¸ƒå’Œè®¢é˜…5.3ã€å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°6ã€Redis6æ–°æ•°æ®ç±»å‹6.1ã€Bitmaps6.2ã€HyperLogLog6.3ã€Geospatial7ã€Jedisæ“ä½œRedis67.1ã€Jediså¸¸ç”¨æ“ä½œ7.2ã€Jediså®ä¾‹-æ¨¡æ‹ŸéªŒè¯ç å‘é€8ã€Redis6ä¸SpringBootæ•´åˆ9ã€Redis6çš„äº‹åŠ¡æ“ä½œ9.1ã€Redisçš„äº‹åŠ¡å®šä¹‰9.2ã€äº‹åŠ¡æ“ä½œMultiã€Execã€discard9.3ã€äº‹åŠ¡çš„é”™è¯¯å¤„ç†9.4ã€äº‹åŠ¡å†²çªçš„é—®é¢˜ï¼ˆä¹è§‚é”å’Œæ‚²è§‚é”ï¼‰9.5ã€Redisäº‹åŠ¡ä¸‰ç‰¹æ€§9.6ã€Redisäº‹åŠ¡æ¡ˆä¾‹-å•†å“ç§’æ€æ¡ˆä¾‹10ã€Redis6æŒä¹…åŒ–ä¹‹RDB11ã€Redis6æŒä¹…åŒ–ä¹‹AOF12ã€Redis6çš„ä¸»ä»å¤åˆ¶13ã€Redis6é›†ç¾¤14ã€Redis6åº”ç”¨é—®é¢˜è§£å†³14.1ã€ç¼“å­˜ç©¿é€14.2ã€ç¼“å­˜å‡»ç©¿14.3ã€ç¼“å­˜é›ªå´©14.4ã€åˆ†å¸ƒå¼é”15ã€Redis6æ–°åŠŸèƒ½15.1ã€ACL15.2ã€IOå¤šçº¿ç¨‹15.3ã€å·¥å…·æ”¯æŒ Cluster15.4ã€Redisæ–°åŠŸèƒ½æŒç»­å…³æ³¨ä¸€ã€NoSQLæ•°æ®åº“ç®€ä»‹1.1 æŠ€æœ¯å‘å±•æŠ€æœ¯çš„åˆ†ç±» 1ã€è§£å†³åŠŸèƒ½æ€§çš„é—®é¢˜ï¼šJavaã€Jspã€RDBMSã€Tomcatã€HTMLã€Linuxã€JDBCã€SVN 2ã€è§£å†³æ‰©å±•æ€§çš„é—®é¢˜ï¼šStrutsã€Springã€SpringMVCã€Hibernateã€Mybatis 3ã€è§£å†³æ€§èƒ½çš„é—®é¢˜ï¼šNoSQLã€Javaçº¿ç¨‹ã€Hadoopã€Nginxã€MQã€ElasticSearch 1.1.1 Web1.0æ—¶ä»£Web1.0çš„æ—¶ä»£ï¼Œæ•°æ®è®¿é—®é‡å¾ˆæœ‰é™ï¼Œç”¨ä¸€å¤«å½“å…³çš„é«˜æ€§èƒ½çš„å•ç‚¹æœåŠ¡å™¨å¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚ 1.1.2 Web2.0æ—¶ä»£éšç€Web2.0çš„æ—¶ä»£çš„åˆ°æ¥ï¼Œç”¨æˆ·è®¿é—®é‡å¤§å¹…åº¦æå‡ï¼ŒåŒæ—¶äº§ç”Ÿäº†å¤§é‡çš„ç”¨æˆ·æ•°æ®ã€‚åŠ ä¸Šåæ¥çš„æ™ºèƒ½ç§»åŠ¨è®¾å¤‡çš„æ™®åŠï¼Œæ‰€æœ‰çš„äº’è”ç½‘å¹³å°éƒ½é¢ä¸´äº†å·¨å¤§çš„æ€§èƒ½æŒ‘æˆ˜ã€‚ 1.1.3 è§£å†³CPUåŠå†…å­˜å‹åŠ› 1.1.4 è§£å†³IOå‹åŠ› 1.2 NoSQLæ•°æ®åº“1.2.1 NoSQLæ•°æ®åº“æ¦‚è¿°NoSQL(NoSQL = Not Only SQL)ï¼Œæ„å³â€œä¸ä»…ä»…æ˜¯SQLâ€ï¼Œæ³›æŒ‡éå…³ç³»å‹çš„æ•°æ®åº“ã€‚ NoSQL ä¸ä¾èµ–ä¸šåŠ¡é€»è¾‘æ–¹å¼å­˜å‚¨ï¼Œè€Œä»¥ç®€å•çš„key-valueæ¨¡å¼å­˜å‚¨ã€‚å› æ­¤å¤§å¤§çš„å¢åŠ äº†æ•°æ®åº“çš„æ‰©å±•èƒ½åŠ›ã€‚ ä¸éµå¾ªSQLæ ‡å‡†ã€‚ ä¸æ”¯æŒACIDã€‚ è¿œè¶…äºSQLçš„æ€§èƒ½ã€‚ 1.2.2 NoSQLé€‚ç”¨åœºæ™¯ å¯¹æ•°æ®é«˜å¹¶å‘çš„è¯»å†™ æµ·é‡æ•°æ®çš„è¯»å†™ å¯¹æ•°æ®é«˜å¯æ‰©å±•æ€§çš„ 1.2.3 NoSQLä¸é€‚ç”¨åœºæ™¯ éœ€è¦äº‹åŠ¡æ”¯æŒ åŸºäºsqlçš„ç»“æ„åŒ–æŸ¥è¯¢å­˜å‚¨ï¼Œå¤„ç†å¤æ‚çš„å…³ç³»,éœ€è¦å³å¸­æŸ¥è¯¢ã€‚ ç”¨ä¸ç€sqlçš„å’Œç”¨äº†sqlä¹Ÿä¸è¡Œçš„æƒ…å†µï¼Œè¯·è€ƒè™‘ç”¨NoSqlï¼‰ 1.2.4 Memcache Ã¼ å¾ˆæ—©å‡ºç°çš„NoSqlæ•°æ®åº“Ã¼ æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œä¸€èˆ¬ä¸æŒä¹…åŒ–Ã¼ æ”¯æŒç®€å•çš„key-valueæ¨¡å¼ï¼Œæ”¯æŒç±»å‹å•ä¸€Ã¼ ä¸€èˆ¬æ˜¯ä½œä¸ºç¼“å­˜æ•°æ®åº“è¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“ 1.2.5 Redis å‡ ä¹è¦†ç›–äº†Memcachedçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼Œä¸»è¦ç”¨ä½œå¤‡ä»½æ¢å¤é™¤äº†æ”¯æŒç®€å•çš„key-valueæ¨¡å¼ï¼Œè¿˜æ”¯æŒå¤šç§æ•°æ®ç»“æ„çš„å­˜å‚¨ï¼Œæ¯”å¦‚ listã€setã€hashã€zsetç­‰ã€‚ä¸€èˆ¬æ˜¯ä½œä¸ºç¼“å­˜æ•°æ®åº“è¾…åŠ©æŒä¹…åŒ–çš„æ•°æ®åº“ 1.2.6 MongoDB Ã¼ é«˜æ€§èƒ½ã€å¼€æºã€æ¨¡å¼è‡ªç”±(schema free)çš„æ–‡æ¡£å‹æ•°æ®åº“Ã¼ æ•°æ®éƒ½åœ¨å†…å­˜ä¸­ï¼Œ å¦‚æœå†…å­˜ä¸è¶³ï¼ŒæŠŠä¸å¸¸ç”¨çš„æ•°æ®ä¿å­˜åˆ°ç¡¬ç›˜Ã¼ è™½ç„¶æ˜¯key-valueæ¨¡å¼ï¼Œä½†æ˜¯å¯¹valueï¼ˆå°¤å…¶æ˜¯jsonï¼‰æä¾›äº†ä¸°å¯Œçš„æŸ¥è¯¢åŠŸèƒ½Ã¼ æ”¯æŒäºŒè¿›åˆ¶æ•°æ®åŠå¤§å‹å¯¹è±¡Ã¼ å¯ä»¥æ ¹æ®æ•°æ®çš„ç‰¹ç‚¹æ›¿ä»£RDBMS ï¼Œæˆä¸ºç‹¬ç«‹çš„æ•°æ®åº“ã€‚æˆ–è€…é…åˆRDBMSï¼Œå­˜å‚¨ç‰¹å®šçš„æ•°æ®ã€‚ 1.3 è¡Œå¼å­˜å‚¨æ•°æ®åº“ï¼ˆå¤§æ•°æ®æ—¶ä»£ï¼‰1.3.2 è¡Œå¼æ•°æ®åº“ 1.3.3 åˆ—å¼æ•°æ®åº“ Hbase HBaseæ˜¯Hadoopé¡¹ç›®ä¸­çš„æ•°æ®åº“ã€‚å®ƒç”¨äºéœ€è¦å¯¹å¤§é‡çš„æ•°æ®è¿›è¡Œéšæœºã€å®æ—¶çš„è¯»å†™æ“ä½œçš„åœºæ™¯ä¸­ã€‚ HBaseçš„ç›®æ ‡å°±æ˜¯å¤„ç†æ•°æ®é‡éå¸¸åºå¤§çš„è¡¨ï¼Œå¯ä»¥ç”¨æ™®é€šçš„è®¡ç®—æœºå¤„ç†è¶…è¿‡10äº¿è¡Œæ•°æ®ï¼Œè¿˜å¯å¤„ç†æœ‰æ•°ç™¾ä¸‡åˆ—å…ƒç´ çš„æ•°æ®è¡¨ã€‚ Cassandra[kÉ™ËˆsÃ¦ndrÉ™] Apache Cassandraæ˜¯ä¸€æ¬¾å…è´¹çš„å¼€æºNoSQLæ•°æ®åº“ï¼Œå…¶è®¾è®¡ç›®çš„åœ¨äºç®¡ç†ç”±å¤§é‡å•†ç”¨æœåŠ¡å™¨æ„å»ºèµ·æ¥çš„åºå¤§é›†ç¾¤ä¸Šçš„æµ·é‡æ•°æ®é›†(æ•°æ®é‡é€šå¸¸è¾¾åˆ°PBçº§åˆ«)ã€‚åœ¨ä¼—å¤šæ˜¾è‘—ç‰¹æ€§å½“ä¸­ï¼ŒCassandraæœ€ä¸ºå“è¶Šçš„é•¿å¤„æ˜¯å¯¹å†™å…¥åŠè¯»å–æ“ä½œè¿›è¡Œè§„æ¨¡è°ƒæ•´ï¼Œè€Œä¸”å…¶ä¸å¼ºè°ƒä¸»é›†ç¾¤çš„è®¾è®¡æ€è·¯èƒ½å¤Ÿä»¥ç›¸å¯¹ç›´è§‚çš„æ–¹å¼ç®€åŒ–å„é›†ç¾¤çš„åˆ›å»ºä¸æ‰©å±•æµç¨‹ã€‚ è®¡ç®—æœºå­˜å‚¨å•ä½ è®¡ç®—æœºå­˜å‚¨å•ä½ä¸€èˆ¬ç”¨Bï¼ŒKBï¼ŒMBï¼ŒGBï¼ŒTBï¼ŒEBï¼ŒZBï¼ŒYBï¼ŒBBæ¥è¡¨ç¤ºï¼Œå®ƒä»¬ä¹‹é—´çš„å…³ç³»æ˜¯ï¼š ä½ bit (æ¯”ç‰¹)(Binary Digits)ï¼šå­˜æ”¾ä¸€ä½äºŒè¿›åˆ¶æ•°ï¼Œå³ 0 æˆ– 1ï¼Œæœ€å°çš„å­˜å‚¨å•ä½ã€‚ å­—èŠ‚ byteï¼š8ä¸ªäºŒè¿›åˆ¶ä½ä¸ºä¸€ä¸ªå­—èŠ‚(B)ï¼Œæœ€å¸¸ç”¨çš„å•ä½ã€‚ 1KB (Kilobyte åƒå­—èŠ‚)=1024Bï¼Œ 1MB (Megabyte å…†å­—èŠ‚ ç®€ç§°â€œå…†â€)=1024KBï¼Œ 1GB (Gigabyte å‰å­—èŠ‚ åˆç§°â€œåƒå…†â€)=1024MBï¼Œ 1TB (Trillionbyte ä¸‡äº¿å­—èŠ‚ å¤ªå­—èŠ‚)=1024GBï¼Œå…¶ä¸­1024=2^10 ( 2 çš„10æ¬¡æ–¹)ï¼Œ 1PBï¼ˆPetabyte åƒä¸‡äº¿å­—èŠ‚ æ‹å­—èŠ‚ï¼‰=1024TBï¼Œ 1EBï¼ˆExabyte ç™¾äº¿äº¿å­—èŠ‚ è‰¾å­—èŠ‚ï¼‰=1024PBï¼Œ 1ZB (Zettabyte åä¸‡äº¿äº¿å­—èŠ‚ æ³½å­—èŠ‚)= 1024 EB, 1YB (Jottabyte ä¸€äº¿äº¿äº¿å­—èŠ‚ å°§å­—èŠ‚)= 1024 ZB, 1BB (Brontobyte ä¸€åƒäº¿äº¿äº¿å­—èŠ‚)= 1024 YB. æ³¨ï¼šâ€œå…†â€ä¸ºç™¾ä¸‡çº§æ•°é‡å•ä½ã€‚ 1.4 å›¾å…³ç³»å‹æ•°æ®åº“ ä¸»è¦åº”ç”¨ï¼šç¤¾ä¼šå…³ç³»ï¼Œå…¬å…±äº¤é€šç½‘ç»œï¼Œåœ°å›¾åŠç½‘ç»œæ‹“è°±(n*(n-1)/2) 1.5 DB-Engines æ•°æ®åº“æ’åhttp://db-engines.com/en/ranking äºŒã€Redisæ¦‚è¿°å®‰è£…Ã˜ Redisæ˜¯ä¸€ä¸ªå¼€æºçš„key-valueå­˜å‚¨ç³»ç»Ÿã€‚ Ã˜ å’ŒMemcachedç±»ä¼¼ï¼Œå®ƒæ”¯æŒå­˜å‚¨çš„valueç±»å‹ç›¸å¯¹æ›´å¤šï¼ŒåŒ…æ‹¬string(å­—ç¬¦ä¸²)ã€list(é“¾è¡¨)ã€set(é›†åˆ)ã€zset(sorted set â€“æœ‰åºé›†åˆ)å’Œhashï¼ˆå“ˆå¸Œç±»å‹ï¼‰ã€‚ Ã˜ è¿™äº›æ•°æ®ç±»å‹éƒ½æ”¯æŒpush/popã€add/removeåŠå–äº¤é›†å¹¶é›†å’Œå·®é›†åŠæ›´ä¸°å¯Œçš„æ“ä½œï¼Œè€Œä¸”è¿™äº›æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ã€‚ Ã˜ åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒRedisæ”¯æŒå„ç§ä¸åŒæ–¹å¼çš„æ’åºã€‚ Ã˜ ä¸memcachedä¸€æ ·ï¼Œä¸ºäº†ä¿è¯æ•ˆç‡ï¼Œæ•°æ®éƒ½æ˜¯ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ Ã˜ åŒºåˆ«çš„æ˜¯Redisä¼šå‘¨æœŸæ€§çš„æŠŠæ›´æ–°çš„æ•°æ®å†™å…¥ç£ç›˜æˆ–è€…æŠŠä¿®æ”¹æ“ä½œå†™å…¥è¿½åŠ çš„è®°å½•æ–‡ä»¶ã€‚ Ã˜ å¹¶ä¸”åœ¨æ­¤åŸºç¡€ä¸Šå®ç°äº†master-slave(ä¸»ä»)åŒæ­¥ã€‚ 2.1 åº”ç”¨åœºæ™¯2.1.1 é…åˆå…³ç³»å‹æ•°æ®åº“åšé«˜é€Ÿç¼“å­˜Ã˜ é«˜é¢‘æ¬¡ï¼Œçƒ­é—¨è®¿é—®çš„æ•°æ®ï¼Œé™ä½æ•°æ®åº“IO Ã˜ åˆ†å¸ƒå¼æ¶æ„ï¼Œåšsessionå…±äº« 2.1.2 å¤šæ ·çš„æ•°æ®ç»“æ„å­˜å‚¨æŒä¹…åŒ–æ•°æ® 2.2 Rediså®‰è£… Rediså®˜æ–¹ç½‘ç«™ Redisä¸­æ–‡å®˜æ–¹ç½‘ç«™ http://redis.io http://redis.cn/ 2.2.1 å®‰è£…ç‰ˆæœ¬Ã˜ 6.2.1 for Linuxï¼ˆredis-6.2.1.tar.gzï¼‰ Ã˜ ä¸ç”¨è€ƒè™‘åœ¨windowsç¯å¢ƒä¸‹å¯¹Redisçš„æ”¯æŒ 2.2.2 å®‰è£…æ­¥éª¤å‡†å¤‡å·¥ä½œï¼šä¸‹è½½å®‰è£…æœ€æ–°ç‰ˆçš„gccç¼–è¯‘å™¨ 2.2.3 å®‰è£…C è¯­è¨€çš„ç¼–è¯‘ç¯å¢ƒ yum install centos-release-scl scl-utils-build yum install -y devtoolset-8-toolchain scl enable devtoolset-8 bash æµ‹è¯• gccç‰ˆæœ¬ gcc â€“version ä¸‹è½½redis-6.2.1.tar.gzæ”¾/optç›®å½• è§£å‹å‘½ä»¤ï¼štar -zxvf redis-6.2.1.tar.gz è§£å‹å®Œæˆåè¿›å…¥ç›®å½•ï¼šcd redis-6.2.1 åœ¨redis-6.2.1ç›®å½•ä¸‹å†æ¬¡æ‰§è¡Œmakeå‘½ä»¤ï¼ˆåªæ˜¯ç¼–è¯‘å¥½ï¼‰ å¦‚æœæ²¡æœ‰å‡†å¤‡å¥½Cè¯­è¨€ç¼–è¯‘ç¯å¢ƒï¼Œmake ä¼šæŠ¥é”™â€”Jemalloc/jemalloc.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶ è§£å†³æ–¹æ¡ˆï¼šè¿è¡Œmake distclean åœ¨redis-6.2.1ç›®å½•ä¸‹å†æ¬¡æ‰§è¡Œmakeå‘½ä»¤ï¼ˆåªæ˜¯ç¼–è¯‘å¥½ï¼‰ è·³è¿‡make test ç»§ç»­æ‰§è¡Œ: make install 2.2.4 å®‰è£…ç›®å½•ï¼š/usr/local/binæŸ¥çœ‹é»˜è®¤å®‰è£…ç›®å½•ï¼š redis-benchmark:æ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥åœ¨è‡ªå·±æœ¬å­è¿è¡Œï¼Œçœ‹çœ‹è‡ªå·±æœ¬å­æ€§èƒ½å¦‚ä½• redis-check-aofï¼šä¿®å¤æœ‰é—®é¢˜çš„AOFæ–‡ä»¶ï¼Œrdbå’Œaofåé¢è®² redis-check-dumpï¼šä¿®å¤æœ‰é—®é¢˜çš„dump.rdbæ–‡ä»¶ redis-sentinelï¼šRedisé›†ç¾¤ä½¿ç”¨ redis-serverï¼šRedisæœåŠ¡å™¨å¯åŠ¨å‘½ä»¤ redis-cliï¼šå®¢æˆ·ç«¯ï¼Œæ“ä½œå…¥å£ 2.2.5 å‰å°å¯åŠ¨ï¼ˆä¸æ¨èï¼‰å‰å°å¯åŠ¨ï¼Œå‘½ä»¤è¡Œçª—å£ä¸èƒ½å…³é—­ï¼Œå¦åˆ™æœåŠ¡å™¨åœæ­¢ 2.2.6 åå°å¯åŠ¨ï¼ˆæ¨èï¼‰ å¤‡ä»½redis.conf æ‹·è´ä¸€ä»½redis.confåˆ°å…¶ä»–ç›®å½• cp /opt/redis-3.2.5/redis.conf /myredis åå°å¯åŠ¨è®¾ç½®daemonize noæ”¹æˆyes ä¿®æ”¹redis.conf(128è¡Œ)æ–‡ä»¶å°†é‡Œé¢çš„daemonize no æ”¹æˆ yesï¼Œè®©æœåŠ¡åœ¨åå°å¯åŠ¨ Rediså¯åŠ¨ redis-server/myredis/redis.conf ç”¨å®¢æˆ·ç«¯è®¿é—®ï¼šredis-cli å¤šä¸ªç«¯å£å¯ä»¥ï¼šredis-cli -p6379 æµ‹è¯•éªŒè¯ï¼š ping Rediså…³é—­ å•å®ä¾‹å…³é—­ï¼šredis-cli shutdown ä¹Ÿå¯ä»¥è¿›å…¥ç»ˆç«¯åå†å…³é—­ å¤šå®ä¾‹å…³é—­ï¼ŒæŒ‡å®šç«¯å£å…³é—­ï¼šredis-cli -p 6379 shutdown 2.2.7 Redisä»‹ç»ç›¸å…³çŸ¥è¯† ç«¯å£6379ä»ä½•è€Œæ¥Alessia Merz é»˜è®¤16ä¸ªæ•°æ®åº“ï¼Œç±»ä¼¼æ•°ç»„ä¸‹æ ‡ä»0å¼€å§‹ï¼Œåˆå§‹é»˜è®¤ä½¿ç”¨0å·åº“ä½¿ç”¨å‘½ä»¤ select æ¥åˆ‡æ¢æ•°æ®åº“ã€‚å¦‚: select 8 ç»Ÿä¸€å¯†ç ç®¡ç†ï¼Œæ‰€æœ‰åº“åŒæ ·å¯†ç ã€‚dbsizeæŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡flushdbæ¸…ç©ºå½“å‰åº“flushallé€šæ€å…¨éƒ¨åº“ Redisæ˜¯å•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨æŠ€æœ¯ å¤šè·¯å¤ç”¨æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆSocketï¼‰çš„å°±ç»ªçŠ¶æ€ï¼Œæ¯”å¦‚è°ƒç”¨selectå’Œpollå‡½æ•°ï¼Œä¼ å…¥å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å°±ç»ªï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™é˜»å¡ç›´åˆ°è¶…æ—¶ã€‚å¾—åˆ°å°±ç»ªçŠ¶æ€åè¿›è¡ŒçœŸæ­£çš„æ“ä½œå¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œæ‰§è¡Œï¼Œä¹Ÿå¯ä»¥å¯åŠ¨çº¿ç¨‹æ‰§è¡Œï¼ˆæ¯”å¦‚ä½¿ç”¨çº¿ç¨‹æ± ï¼‰ ä¸²è¡Œ vs å¤šçº¿ç¨‹+é”ï¼ˆmemcachedï¼‰ vs å•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨(Redis) ï¼ˆä¸Memcacheä¸‰ç‚¹ä¸åŒ: æ”¯æŒå¤šæ•°æ®ç±»å‹ï¼Œæ”¯æŒæŒä¹…åŒ–ï¼Œå•çº¿ç¨‹+å¤šè·¯IOå¤ç”¨ï¼‰ ä¸‰ã€å¸¸ç”¨äº”å¤§æ•°æ®ç±»å‹å“ªé‡Œå»è·å¾—rediså¸¸è§æ•°æ®ç±»å‹æ“ä½œå‘½ä»¤http://www.redis.cn/commands.html 3.1 Redisé”®(key)**keys *** æŸ¥çœ‹å½“å‰åº“æ‰€æœ‰key (åŒ¹é…ï¼škeys *1) exists key: åˆ¤æ–­æŸä¸ªkeyæ˜¯å¦å­˜åœ¨ type key : æŸ¥çœ‹ä½ çš„keyæ˜¯ä»€ä¹ˆç±»å‹ del key : åˆ é™¤æŒ‡å®šçš„keyæ•°æ® unlink key: æ ¹æ®valueé€‰æ‹©éé˜»å¡åˆ é™¤ ä»…å°†keysä»keyspaceå…ƒæ•°æ®ä¸­åˆ é™¤ï¼ŒçœŸæ­£çš„åˆ é™¤ä¼šåœ¨åç»­å¼‚æ­¥æ“ä½œã€‚ expire key 10: 10ç§’é’Ÿï¼šä¸ºç»™å®šçš„keyè®¾ç½®è¿‡æœŸæ—¶é—´ ttl key: æŸ¥çœ‹è¿˜æœ‰å¤šå°‘ç§’è¿‡æœŸï¼Œ-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸï¼Œ-2è¡¨ç¤ºå·²è¿‡æœŸ select: å‘½ä»¤åˆ‡æ¢æ•°æ®åº“ dbsize: æŸ¥çœ‹å½“å‰æ•°æ®åº“çš„keyçš„æ•°é‡ flushdb: æ¸…ç©ºå½“å‰åº“ flushall: é€šæ€å…¨éƒ¨åº“ 3.2 Rediså­—ç¬¦ä¸²(String)3.2.1 ç®€ä»‹Stringæ˜¯Redisæœ€åŸºæœ¬çš„ç±»å‹ï¼Œä½ å¯ä»¥ç†è§£æˆä¸Memcachedä¸€æ¨¡ä¸€æ ·çš„ç±»å‹ï¼Œä¸€ä¸ªkeyå¯¹åº”ä¸€ä¸ªvalueã€‚ Stringç±»å‹æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚æ„å‘³ç€Redisçš„stringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ã€‚æ¯”å¦‚jpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ Stringç±»å‹æ˜¯Redisæœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œä¸€ä¸ªRedisä¸­å­—ç¬¦ä¸²valueæœ€å¤šå¯ä»¥æ˜¯512M 3.2.2 å¸¸ç”¨å‘½ä»¤set æ·»åŠ é”®å€¼å¯¹ *NXï¼šå½“æ•°æ®åº“ä¸­keyä¸å­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“ *XXï¼šå½“æ•°æ®åº“ä¸­keyå­˜åœ¨æ—¶ï¼Œå¯ä»¥å°†key-valueæ·»åŠ æ•°æ®åº“ï¼Œä¸NXå‚æ•°äº’æ–¥ *EXï¼škeyçš„è¶…æ—¶ç§’æ•° *PXï¼škeyçš„è¶…æ—¶æ¯«ç§’æ•°ï¼Œä¸EXäº’æ–¥ get æŸ¥è¯¢å¯¹åº”é”®å€¼ append å°†ç»™å®šçš„ è¿½åŠ åˆ°åŸå€¼çš„æœ«å°¾ strlen è·å¾—å€¼çš„é•¿åº¦ setnx åªæœ‰åœ¨ key ä¸å­˜åœ¨æ—¶ è®¾ç½® key çš„å€¼ incr å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢1 åªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º1 decr å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å‡1 åªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º-1 incrby / decrby &lt;æ­¥é•¿&gt;å°† key ä¸­å‚¨å­˜çš„æ•°å­—å€¼å¢å‡ã€‚è‡ªå®šä¹‰æ­¥é•¿ã€‚ åŸå­æ€§ æ‰€è°“åŸå­æ“ä½œæ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œï¼›è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• context switch ï¼ˆåˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼‰ã€‚ï¼ˆ1ï¼‰åœ¨å•çº¿ç¨‹ä¸­ï¼Œ èƒ½å¤Ÿåœ¨å•æ¡æŒ‡ä»¤ä¸­å®Œæˆçš„æ“ä½œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯â€åŸå­æ“ä½œâ€ï¼Œå› ä¸ºä¸­æ–­åªèƒ½å‘ç”ŸäºæŒ‡ä»¤ä¹‹é—´ã€‚ï¼ˆ2ï¼‰åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œä¸èƒ½è¢«å…¶å®ƒè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰æ‰“æ–­çš„æ“ä½œå°±å«åŸå­æ“ä½œã€‚Rediså•å‘½ä»¤çš„åŸå­æ€§ä¸»è¦å¾—ç›ŠäºRedisçš„å•çº¿ç¨‹ã€‚æ¡ˆä¾‹ï¼šjavaä¸­çš„i++æ˜¯å¦æ˜¯åŸå­æ“ä½œï¼Ÿä¸æ˜¯i=0;ä¸¤ä¸ªçº¿ç¨‹åˆ†åˆ«å¯¹iè¿›è¡Œ++100æ¬¡,å€¼æ˜¯å¤šå°‘ï¼Ÿ 2~200i=0i++i=99 i=1 i++i=2i=0 i++ i=1 i++ i=100 mset â€¦.. åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-valueå¯¹ mget â€¦.. åŒæ—¶è·å–ä¸€ä¸ªæˆ–å¤šä¸ª value msetnx â€¦.. åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ª key-value å¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®š key éƒ½ä¸å­˜åœ¨ã€‚ åŸå­æ€§ï¼Œæœ‰ä¸€ä¸ªå¤±è´¥åˆ™éƒ½å¤±è´¥ getrange &lt;èµ·å§‹ä½ç½®&gt;&lt;ç»“æŸä½ç½®&gt; è·å¾—å€¼çš„èŒƒå›´ï¼Œç±»ä¼¼javaä¸­çš„substringï¼Œå‰åŒ…ï¼ŒååŒ… setrange &lt;èµ·å§‹ä½ç½®&gt; ç”¨ è¦†å†™æ‰€å‚¨å­˜çš„å­—ç¬¦ä¸²å€¼ï¼Œä»&lt;èµ·å§‹ä½ç½®&gt;å¼€å§‹(ç´¢å¼•ä»0å¼€å§‹)ã€‚ setex &lt;è¿‡æœŸæ—¶é—´&gt; è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’ã€‚ getset ä»¥æ–°æ¢æ—§ï¼Œè®¾ç½®äº†æ–°å€¼åŒæ—¶è·å¾—æ—§å€¼ã€‚ 3.2.3 æ•°æ®ç»“æ„Stringçš„æ•°æ®ç»“æ„ä¸ºç®€å•åŠ¨æ€å­—ç¬¦ä¸²(Simple Dynamic String,ç¼©å†™SDS)ã€‚æ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äºJavaçš„ArrayListï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…. å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå†…éƒ¨ä¸ºå½“å‰å­—ç¬¦ä¸²å®é™…åˆ†é…çš„ç©ºé—´capacityä¸€èˆ¬è¦é«˜äºå®é™…å­—ç¬¦ä¸²é•¿åº¦lenã€‚å½“å­—ç¬¦ä¸²é•¿åº¦å°äº1Mæ—¶ï¼Œæ‰©å®¹éƒ½æ˜¯åŠ å€ç°æœ‰çš„ç©ºé—´ï¼Œå¦‚æœè¶…è¿‡1Mï¼Œæ‰©å®¹æ—¶ä¸€æ¬¡åªä¼šå¤šæ‰©1Mçš„ç©ºé—´ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å­—ç¬¦ä¸²æœ€å¤§é•¿åº¦ä¸º512Mã€‚ 3.3 Redisåˆ—è¡¨(List)3.3.1 ç®€ä»‹å•é”®å¤šå€¼ Redis åˆ—è¡¨æ˜¯ç®€å•çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºæ’åºã€‚ä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå…ƒç´ åˆ°åˆ—è¡¨çš„å¤´éƒ¨ï¼ˆå·¦è¾¹ï¼‰æˆ–è€…å°¾éƒ¨ï¼ˆå³è¾¹ï¼‰ã€‚ å®ƒçš„åº•å±‚å®é™…æ˜¯ä¸ªåŒå‘é“¾è¡¨ï¼Œå¯¹ä¸¤ç«¯çš„æ“ä½œæ€§èƒ½å¾ˆé«˜ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ ‡çš„æ“ä½œä¸­é—´çš„èŠ‚ç‚¹æ€§èƒ½ä¼šè¾ƒå·®ã€‚ 3.3.2 å¸¸ç”¨å‘½ä»¤ lpush/rpush â€¦. ä»å·¦è¾¹/å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚ lpop/rpop ä»å·¦è¾¹/å³è¾¹åå‡ºä¸€ä¸ªå€¼ã€‚å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®äº¡ã€‚ rpoplpush ä»åˆ—è¡¨å³è¾¹åå‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°åˆ—è¡¨å·¦è¾¹ã€‚ lrange æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³) lrange mylist 0 -1 0å·¦è¾¹ç¬¬ä¸€ä¸ªï¼Œ-1å³è¾¹ç¬¬ä¸€ä¸ªï¼Œï¼ˆ0-1è¡¨ç¤ºè·å–æ‰€æœ‰ï¼‰ lindex æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³) llen è·å¾—åˆ—è¡¨é•¿åº¦ linsert before åœ¨çš„åé¢æ’å…¥æ’å…¥å€¼ lrem ä»å·¦è¾¹åˆ é™¤nä¸ªvalue(ä»å·¦åˆ°å³) lsetå°†åˆ—è¡¨keyä¸‹æ ‡ä¸ºindexçš„å€¼æ›¿æ¢æˆvalue 3.3.3 æ•°æ®ç»“æ„Listçš„æ•°æ®ç»“æ„ä¸ºå¿«é€Ÿé“¾è¡¨quickListã€‚ é¦–å…ˆåœ¨åˆ—è¡¨å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œè¿™ä¸ªç»“æ„æ˜¯ziplistï¼Œä¹Ÿå³æ˜¯å‹ç¼©åˆ—è¡¨ã€‚ å®ƒå°†æ‰€æœ‰çš„å…ƒç´ ç´§æŒ¨ç€ä¸€èµ·å­˜å‚¨ï¼Œåˆ†é…çš„æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ã€‚ å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™æ‰ä¼šæ”¹æˆquicklistã€‚ å› ä¸ºæ™®é€šçš„é“¾è¡¨éœ€è¦çš„é™„åŠ æŒ‡é’ˆç©ºé—´å¤ªå¤§ï¼Œä¼šæ¯”è¾ƒæµªè´¹ç©ºé—´ã€‚æ¯”å¦‚è¿™ä¸ªåˆ—è¡¨é‡Œå­˜çš„åªæ˜¯intç±»å‹çš„æ•°æ®ï¼Œç»“æ„ä¸Šè¿˜éœ€è¦ä¸¤ä¸ªé¢å¤–çš„æŒ‡é’ˆprevå’Œnextã€‚ Rediså°†é“¾è¡¨å’Œziplistç»“åˆèµ·æ¥ç»„æˆäº†quicklistã€‚ä¹Ÿå°±æ˜¯å°†å¤šä¸ªziplistä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™ã€‚ 3.4 Redisé›†åˆ(Set)3.4.1 ç®€ä»‹Redis setå¯¹å¤–æä¾›çš„åŠŸèƒ½ä¸listç±»ä¼¼æ˜¯ä¸€ä¸ªåˆ—è¡¨çš„åŠŸèƒ½ï¼Œç‰¹æ®Šä¹‹å¤„åœ¨äºsetæ˜¯å¯ä»¥è‡ªåŠ¨æ’é‡çš„ï¼Œå½“ä½ éœ€è¦å­˜å‚¨ä¸€ä¸ªåˆ—è¡¨æ•°æ®ï¼Œåˆä¸å¸Œæœ›å‡ºç°é‡å¤æ•°æ®æ—¶ï¼Œsetæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œå¹¶ä¸”setæä¾›äº†åˆ¤æ–­æŸä¸ªæˆå‘˜æ˜¯å¦åœ¨ä¸€ä¸ªseté›†åˆå†…çš„é‡è¦æ¥å£ï¼Œè¿™ä¸ªä¹Ÿæ˜¯listæ‰€ä¸èƒ½æä¾›çš„ã€‚ Redisçš„Setæ˜¯stringç±»å‹çš„æ— åºé›†åˆã€‚å®ƒåº•å±‚å…¶å®æ˜¯ä¸€ä¸ªvalueä¸ºnullçš„hashè¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„å¤æ‚åº¦éƒ½æ˜¯O(1)ã€‚ ä¸€ä¸ªç®—æ³•ï¼Œéšç€æ•°æ®çš„å¢åŠ ï¼Œæ‰§è¡Œæ—¶é—´çš„é•¿çŸ­ï¼Œå¦‚æœæ˜¯O(1)ï¼Œæ•°æ®å¢åŠ ï¼ŒæŸ¥æ‰¾æ•°æ®çš„æ—¶é—´ä¸å˜ 3.4.2 å¸¸ç”¨å‘½ä»¤sadd â€¦.. å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠ å…¥åˆ°é›†åˆ key ä¸­ï¼Œå·²ç»å­˜åœ¨çš„ member å…ƒç´ å°†è¢«å¿½ç•¥ smembers å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼ã€‚ sismember åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºå«æœ‰è¯¥å€¼ï¼Œæœ‰1ï¼Œæ²¡æœ‰0 scardè¿”å›è¯¥é›†åˆçš„å…ƒç´ ä¸ªæ•°ã€‚ srem â€¦. åˆ é™¤é›†åˆä¸­çš„æŸä¸ªå…ƒç´ ã€‚ spop éšæœºä»è¯¥é›†åˆä¸­åå‡ºä¸€ä¸ªå€¼ã€‚ srandmember éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ã€‚ä¸ä¼šä»é›†åˆä¸­åˆ é™¤ ã€‚ smove valueæŠŠé›†åˆä¸­ä¸€ä¸ªå€¼ä»ä¸€ä¸ªé›†åˆç§»åŠ¨åˆ°å¦ä¸€ä¸ªé›†åˆ sinter è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†å…ƒç´ ã€‚ sunion è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†å…ƒç´ ã€‚ sdiff è¿”å›ä¸¤ä¸ªé›†åˆçš„å·®é›†å…ƒç´ (key1ä¸­çš„ï¼Œä¸åŒ…å«key2ä¸­çš„) 3.4.3 æ•°æ®ç»“æ„Setæ•°æ®ç»“æ„æ˜¯dictå­—å…¸ï¼Œå­—å…¸æ˜¯ç”¨å“ˆå¸Œè¡¨å®ç°çš„ã€‚ Javaä¸­HashSetçš„å†…éƒ¨å®ç°ä½¿ç”¨çš„æ˜¯HashMapï¼Œåªä¸è¿‡æ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚Redisçš„setç»“æ„ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå®ƒçš„å†…éƒ¨ä¹Ÿä½¿ç”¨hashç»“æ„ï¼Œæ‰€æœ‰çš„valueéƒ½æŒ‡å‘åŒä¸€ä¸ªå†…éƒ¨å€¼ã€‚ 3.5 Rediså“ˆå¸Œ(Hash)3.5.1 ç®€ä»‹Redis hash æ˜¯ä¸€ä¸ªé”®å€¼å¯¹é›†åˆã€‚ Redis hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äºå­˜å‚¨å¯¹è±¡ã€‚ ç±»ä¼¼Javaé‡Œé¢çš„Map&lt;String,Object&gt; ç”¨æˆ·IDä¸ºæŸ¥æ‰¾çš„keyï¼Œå­˜å‚¨çš„valueç”¨æˆ·å¯¹è±¡åŒ…å«å§“åï¼Œå¹´é¾„ï¼Œç”Ÿæ—¥ç­‰ä¿¡æ¯ï¼Œå¦‚æœç”¨æ™®é€šçš„key/valueç»“æ„æ¥å­˜å‚¨ ä¸»è¦æœ‰ä»¥ä¸‹2ç§å­˜å‚¨æ–¹å¼ï¼š æ¯æ¬¡ä¿®æ”¹ç”¨æˆ·çš„æŸä¸ªå±æ€§éœ€è¦ï¼Œå…ˆååºåˆ—åŒ–æ”¹å¥½åå†åºåˆ—åŒ–å›å»ã€‚å¼€é”€è¾ƒå¤§ã€‚ ç”¨æˆ·IDæ•°æ®å†—ä½™ é€šè¿‡ key(ç”¨æˆ·ID) + field(å±æ€§æ ‡ç­¾) å°±å¯ä»¥æ“ä½œå¯¹åº”å±æ€§æ•°æ®äº†ï¼Œæ—¢ä¸éœ€è¦é‡å¤å­˜å‚¨æ•°æ®ï¼Œä¹Ÿä¸ä¼šå¸¦æ¥åºåˆ—åŒ–å’Œå¹¶å‘ä¿®æ”¹æ§åˆ¶çš„é—®é¢˜ 3.5.2 å¸¸ç”¨å‘½ä»¤ hset ç»™é›†åˆä¸­çš„ é”®èµ‹å€¼ hget ä»é›†åˆå–å‡º value hmset â€¦ æ‰¹é‡è®¾ç½®hashçš„å€¼ hexistsæŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨ã€‚ hkeys åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field hvals åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value hincrby ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡ 1 -1 hsetnx å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œå½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨ . 3.5.3 æ•°æ®ç»“æ„Hashç±»å‹å¯¹åº”çš„æ•°æ®ç»“æ„æ˜¯ä¸¤ç§ï¼šziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼Œhashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ã€‚å½“field-valueé•¿åº¦è¾ƒçŸ­ä¸”ä¸ªæ•°è¾ƒå°‘æ—¶ï¼Œä½¿ç”¨ziplistï¼Œå¦åˆ™ä½¿ç”¨hashtableã€‚ 3.6 Redisæœ‰åºé›†åˆZset(sorted set)3.6.1 ç®€ä»‹Redisæœ‰åºé›†åˆzsetä¸æ™®é€šé›†åˆsetéå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚ ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰,è¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥æ˜¯é‡å¤äº† ã€‚ å› ä¸ºå…ƒç´ æ˜¯æœ‰åºçš„, æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å¾ˆå¿«çš„æ ¹æ®è¯„åˆ†ï¼ˆscoreï¼‰æˆ–è€…æ¬¡åºï¼ˆpositionï¼‰æ¥è·å–ä¸€ä¸ªèŒƒå›´çš„å…ƒç´ ã€‚ è®¿é—®æœ‰åºé›†åˆçš„ä¸­é—´å…ƒç´ ä¹Ÿæ˜¯éå¸¸å¿«çš„,å› æ­¤ä½ èƒ½å¤Ÿä½¿ç”¨æœ‰åºé›†åˆä½œä¸ºä¸€ä¸ªæ²¡æœ‰é‡å¤æˆå‘˜çš„æ™ºèƒ½åˆ—è¡¨ã€‚ 3.6.2 å¸¸ç”¨å‘½ä»¤ zadd â€¦ å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠå…¶ score å€¼åŠ å…¥åˆ°æœ‰åºé›† key å½“ä¸­ã€‚ zrange [WITHSCORES] è¿”å›æœ‰åºé›† key ä¸­ï¼Œä¸‹æ ‡åœ¨ä¹‹é—´çš„å…ƒç´  å¸¦WITHSCORESï¼Œå¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†ã€‚ zrangebyscore key minmax [withscores] [limit offset count] è¿”å›æœ‰åºé›† key ä¸­ï¼Œæ‰€æœ‰ score å€¼ä»‹äº min å’Œ max ä¹‹é—´(åŒ…æ‹¬ç­‰äº min æˆ– max )çš„æˆå‘˜ã€‚æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢(ä»å°åˆ°å¤§)æ¬¡åºæ’åˆ—ã€‚ zrevrangebyscore key maxmin [withscores] [limit offset count] åŒä¸Šï¼Œæ”¹ä¸ºä»å¤§åˆ°å°æ’åˆ—ã€‚ zincrby ä¸ºå…ƒç´ çš„scoreåŠ ä¸Šå¢é‡ zrem åˆ é™¤è¯¥é›†åˆä¸‹ï¼ŒæŒ‡å®šå€¼çš„å…ƒç´  zcount ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•° zrank è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹ã€‚ æ¡ˆä¾‹ï¼šå¦‚ä½•åˆ©ç”¨zsetå®ç°ä¸€ä¸ªæ–‡ç« è®¿é—®é‡çš„æ’è¡Œæ¦œï¼Ÿ 3.6.3 æ•°æ®ç»“æ„SortedSet(zset)æ˜¯Redisæä¾›çš„ä¸€ä¸ªéå¸¸ç‰¹åˆ«çš„æ•°æ®ç»“æ„ï¼Œä¸€æ–¹é¢å®ƒç­‰ä»·äºJavaçš„æ•°æ®ç»“æ„Map&lt;String, Double&gt;ï¼Œå¯ä»¥ç»™æ¯ä¸€ä¸ªå…ƒç´ valueèµ‹äºˆä¸€ä¸ªæƒé‡scoreï¼Œå¦ä¸€æ–¹é¢å®ƒåˆç±»ä¼¼äºTreeSetï¼Œå†…éƒ¨çš„å…ƒç´ ä¼šæŒ‰ç…§æƒé‡scoreè¿›è¡Œæ’åºï¼Œå¯ä»¥å¾—åˆ°æ¯ä¸ªå…ƒç´ çš„åæ¬¡ï¼Œè¿˜å¯ä»¥é€šè¿‡scoreçš„èŒƒå›´æ¥è·å–å…ƒç´ çš„åˆ—è¡¨ã€‚ zsetåº•å±‚ä½¿ç”¨äº†ä¸¤ä¸ªæ•°æ®ç»“æ„ ï¼ˆ1ï¼‰hashï¼Œhashçš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´ valueå’Œæƒé‡scoreï¼Œä¿éšœå…ƒç´ valueçš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ valueæ‰¾åˆ°ç›¸åº”çš„scoreå€¼ã€‚ ï¼ˆ2ï¼‰è·³è·ƒè¡¨ï¼Œè·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´ valueæ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨ã€‚ 3.6.4 è·³è·ƒè¡¨ï¼ˆè·³è¡¨ï¼‰1ã€ç®€ä»‹ æœ‰åºé›†åˆåœ¨ç”Ÿæ´»ä¸­æ¯”è¾ƒå¸¸è§ï¼Œä¾‹å¦‚æ ¹æ®æˆç»©å¯¹å­¦ç”Ÿæ’åï¼Œæ ¹æ®å¾—åˆ†å¯¹ç©å®¶æ’åç­‰ã€‚å¯¹äºæœ‰åºé›†åˆçš„åº•å±‚å®ç°ï¼Œå¯ä»¥ç”¨æ•°ç»„ã€å¹³è¡¡æ ‘ã€é“¾è¡¨ç­‰ã€‚æ•°ç»„ä¸ä¾¿å…ƒç´ çš„æ’å…¥ã€åˆ é™¤ï¼›å¹³è¡¡æ ‘æˆ–çº¢é»‘æ ‘è™½ç„¶æ•ˆç‡é«˜ä½†ç»“æ„å¤æ‚ï¼›é“¾è¡¨æŸ¥è¯¢éœ€è¦éå†æ‰€æœ‰æ•ˆç‡ä½ã€‚Redisé‡‡ç”¨çš„æ˜¯è·³è·ƒè¡¨ã€‚è·³è·ƒè¡¨æ•ˆç‡å ªæ¯”çº¢é»‘æ ‘ï¼Œå®ç°è¿œæ¯”çº¢é»‘æ ‘ç®€å•ã€‚ 2ã€å®ä¾‹ å¯¹æ¯”æœ‰åºé“¾è¡¨å’Œè·³è·ƒè¡¨ï¼Œä»é“¾è¡¨ä¸­æŸ¥è¯¢å‡º51 ï¼ˆ1ï¼‰ æœ‰åºé“¾è¡¨ è¦æŸ¥æ‰¾å€¼ä¸º51çš„å…ƒç´ ï¼Œéœ€è¦ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ä¾æ¬¡æŸ¥æ‰¾ã€æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ã€‚å…±éœ€è¦6æ¬¡æ¯”è¾ƒã€‚ ï¼ˆ2ï¼‰ è·³è·ƒè¡¨ ä»ç¬¬2å±‚å¼€å§‹ï¼Œ1èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œå‘åæ¯”è¾ƒã€‚ 21èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åæ¯”è¾ƒï¼Œåé¢å°±æ˜¯NULLäº†ï¼Œæ‰€ä»¥ä»21èŠ‚ç‚¹å‘ä¸‹åˆ°ç¬¬1å±‚ åœ¨ç¬¬1å±‚ï¼Œ41èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å°ï¼Œç»§ç»­å‘åï¼Œ61èŠ‚ç‚¹æ¯”51èŠ‚ç‚¹å¤§ï¼Œæ‰€ä»¥ä»41å‘ä¸‹ åœ¨ç¬¬0å±‚ï¼Œ51èŠ‚ç‚¹ä¸ºè¦æŸ¥æ‰¾çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹è¢«æ‰¾åˆ°ï¼Œå…±æŸ¥æ‰¾4æ¬¡ã€‚ ä»æ­¤å¯ä»¥çœ‹å‡ºè·³è·ƒè¡¨æ¯”æœ‰åºé“¾è¡¨æ•ˆç‡è¦é«˜ å››ã€Redisé…ç½®æ–‡ä»¶ä»‹ç»è‡ªå®šä¹‰ç›®å½•ï¼š/myredis/redis.conf 4.1 Unitså•ä½é…ç½®å¤§å°å•ä½,å¼€å¤´å®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„åº¦é‡å•ä½ï¼Œåªæ”¯æŒbytesï¼Œä¸æ”¯æŒbit å¤§å°å†™ä¸æ•æ„Ÿ 4.2 INCLUDESåŒ…å« ç±»ä¼¼jspä¸­çš„includeï¼Œå¤šå®ä¾‹çš„æƒ…å†µå¯ä»¥æŠŠå…¬ç”¨çš„é…ç½®æ–‡ä»¶æå–å‡ºæ¥ 4.3 ç½‘ç»œç›¸å…³é…ç½®4.3.1 bindé»˜è®¤æƒ…å†µbind=127.0.0.1åªèƒ½æ¥å—æœ¬æœºçš„è®¿é—®è¯·æ±‚ ä¸å†™çš„æƒ…å†µä¸‹ï¼Œæ— é™åˆ¶æ¥å—ä»»ä½•ipåœ°å€çš„è®¿é—® ç”Ÿäº§ç¯å¢ƒè‚¯å®šè¦å†™ä½ åº”ç”¨æœåŠ¡å™¨çš„åœ°å€ï¼›æœåŠ¡å™¨æ˜¯éœ€è¦è¿œç¨‹è®¿é—®çš„ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ³¨é‡Šæ‰ å¦‚æœå¼€å¯äº†protected-modeï¼Œé‚£ä¹ˆåœ¨æ²¡æœ‰è®¾å®šbind ipä¸”æ²¡æœ‰è®¾å¯†ç çš„æƒ…å†µä¸‹ï¼ŒRedisåªå…è®¸æ¥å—æœ¬æœºçš„å“åº” ä¿å­˜é…ç½®ï¼Œåœæ­¢æœåŠ¡ï¼Œé‡å¯å¯åŠ¨æŸ¥çœ‹è¿›ç¨‹ï¼Œä¸å†æ˜¯æœ¬æœºè®¿é—®äº†ã€‚ 4.3.2 protected-modeå°†æœ¬æœºè®¿é—®ä¿æŠ¤æ¨¡å¼è®¾ç½®no 4.3.3 Portç«¯å£å·ï¼Œé»˜è®¤ 6379 4.3.4 tcp-backlogè®¾ç½®tcpçš„backlogï¼Œbacklogå…¶å®æ˜¯ä¸€ä¸ªè¿æ¥é˜Ÿåˆ—ï¼Œbacklogé˜Ÿåˆ—æ€»å’Œ=æœªå®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ— + å·²ç»å®Œæˆä¸‰æ¬¡æ¡æ‰‹é˜Ÿåˆ—ã€‚ åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ä½ éœ€è¦ä¸€ä¸ªé«˜backlogå€¼æ¥é¿å…æ…¢å®¢æˆ·ç«¯è¿æ¥é—®é¢˜ã€‚ æ³¨æ„Linuxå†…æ ¸ä¼šå°†è¿™ä¸ªå€¼å‡å°åˆ°/proc/sys/net/core/somaxconnçš„å€¼ï¼ˆ128ï¼‰ï¼Œæ‰€ä»¥éœ€è¦ç¡®è®¤å¢å¤§/proc/sys/net/core/somaxconnå’Œ/proc/sys/net/ipv4/tcp_max_syn_backlogï¼ˆ128ï¼‰ä¸¤ä¸ªå€¼æ¥è¾¾åˆ°æƒ³è¦çš„æ•ˆæœ 4.3.5 timeoutä¸€ä¸ªç©ºé—²çš„å®¢æˆ·ç«¯ç»´æŒå¤šå°‘ç§’ä¼šå…³é—­ï¼Œ0è¡¨ç¤ºå…³é—­è¯¥åŠŸèƒ½ã€‚å³æ°¸ä¸å…³é—­ã€‚ 4.3.6 tcp-keepaliveå¯¹è®¿é—®å®¢æˆ·ç«¯çš„ä¸€ç§å¿ƒè·³æ£€æµ‹ï¼Œæ¯ä¸ªnç§’æ£€æµ‹ä¸€æ¬¡ã€‚ å•ä½ä¸ºç§’ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œåˆ™ä¸ä¼šè¿›è¡ŒKeepaliveæ£€æµ‹ï¼Œå»ºè®®è®¾ç½®æˆ60 4.4 GENERALé€šç”¨4.4.1 daemonizeæ˜¯å¦ä¸ºåå°è¿›ç¨‹ï¼Œè®¾ç½®ä¸ºyes å®ˆæŠ¤è¿›ç¨‹ï¼Œåå°å¯åŠ¨ 4.4.2 pidfileå­˜æ”¾pidæ–‡ä»¶çš„ä½ç½®ï¼Œæ¯ä¸ªå®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒçš„pidæ–‡ä»¶ 4.4.3 loglevelæŒ‡å®šæ—¥å¿—è®°å½•çº§åˆ«ï¼ŒRedisæ€»å…±æ”¯æŒå››ä¸ªçº§åˆ«ï¼šdebugã€verboseã€noticeã€warningï¼Œé»˜è®¤ä¸ºnotice å››ä¸ªçº§åˆ«æ ¹æ®ä½¿ç”¨é˜¶æ®µæ¥é€‰æ‹©ï¼Œç”Ÿäº§ç¯å¢ƒé€‰æ‹©notice æˆ–è€…warning 4.4.4 logfileæ—¥å¿—æ–‡ä»¶åç§° 4.4.5 databases 16è®¾å®šåº“çš„æ•°é‡ é»˜è®¤16ï¼Œé»˜è®¤æ•°æ®åº“ä¸º0ï¼Œå¯ä»¥ä½¿ç”¨SELECT å‘½ä»¤åœ¨è¿æ¥ä¸ŠæŒ‡å®šæ•°æ®åº“id 4.5 SECURITYå®‰å…¨4.5.1 è®¾ç½®å¯†ç  è®¿é—®å¯†ç çš„æŸ¥çœ‹ã€è®¾ç½®å’Œå–æ¶ˆ åœ¨å‘½ä»¤ä¸­è®¾ç½®å¯†ç ï¼Œåªæ˜¯ä¸´æ—¶çš„ã€‚é‡å¯redisæœåŠ¡å™¨ï¼Œå¯†ç å°±è¿˜åŸäº†ã€‚ æ°¸ä¹…è®¾ç½®ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ã€‚ 4.6 LIMITSé™åˆ¶4.6.1 maxclientsÃ˜ è®¾ç½®redisåŒæ—¶å¯ä»¥ä¸å¤šå°‘ä¸ªå®¢æˆ·ç«¯è¿›è¡Œè¿æ¥ã€‚ Ã˜ é»˜è®¤æƒ…å†µä¸‹ä¸º10000ä¸ªå®¢æˆ·ç«¯ã€‚ Ã˜ å¦‚æœè¾¾åˆ°äº†æ­¤é™åˆ¶ï¼Œredisåˆ™ä¼šæ‹’ç»æ–°çš„è¿æ¥è¯·æ±‚ï¼Œå¹¶ä¸”å‘è¿™äº›è¿æ¥è¯·æ±‚æ–¹å‘å‡ºâ€œmax number of clients reachedâ€ä»¥ä½œå›åº”ã€‚ 4.6.2 maxmemoryÃ˜ å»ºè®®å¿…é¡»è®¾ç½®ï¼Œå¦åˆ™ï¼Œå°†å†…å­˜å æ»¡ï¼Œé€ æˆæœåŠ¡å™¨å®•æœº Ã˜ è®¾ç½®rediså¯ä»¥ä½¿ç”¨çš„å†…å­˜é‡ã€‚ä¸€æ—¦åˆ°è¾¾å†…å­˜ä½¿ç”¨ä¸Šé™ï¼Œrediså°†ä¼šè¯•å›¾ç§»é™¤å†…éƒ¨æ•°æ®ï¼Œç§»é™¤è§„åˆ™å¯ä»¥é€šè¿‡maxmemory-policyæ¥æŒ‡å®šã€‚ Ã˜ å¦‚æœredisæ— æ³•æ ¹æ®ç§»é™¤è§„åˆ™æ¥ç§»é™¤å†…å­˜ä¸­çš„æ•°æ®ï¼Œæˆ–è€…è®¾ç½®äº†â€œä¸å…è®¸ç§»é™¤â€ï¼Œé‚£ä¹ˆredisåˆ™ä¼šé’ˆå¯¹é‚£äº›éœ€è¦ç”³è¯·å†…å­˜çš„æŒ‡ä»¤è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œæ¯”å¦‚SETã€LPUSHç­‰ã€‚ Ã˜ ä½†æ˜¯å¯¹äºæ— å†…å­˜ç”³è¯·çš„æŒ‡ä»¤ï¼Œä»ç„¶ä¼šæ­£å¸¸å“åº”ï¼Œæ¯”å¦‚GETç­‰ã€‚å¦‚æœä½ çš„redisæ˜¯ä¸»redisï¼ˆè¯´æ˜ä½ çš„redisæœ‰ä»redisï¼‰ï¼Œé‚£ä¹ˆåœ¨è®¾ç½®å†…å­˜ä½¿ç”¨ä¸Šé™æ—¶ï¼Œéœ€è¦åœ¨ç³»ç»Ÿä¸­ç•™å‡ºä¸€äº›å†…å­˜ç©ºé—´ç»™åŒæ­¥é˜Ÿåˆ—ç¼“å­˜ï¼Œåªæœ‰åœ¨ä½ è®¾ç½®çš„æ˜¯â€œä¸ç§»é™¤â€çš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç”¨è€ƒè™‘è¿™ä¸ªå› ç´ ã€‚ 4.6.3 maxmemory-policyÃ˜ volatile-lruï¼šä½¿ç”¨LRUç®—æ³•ç§»é™¤keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼›ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ Ã˜ allkeys-lruï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤key Ã˜ volatile-randomï¼šåœ¨è¿‡æœŸé›†åˆä¸­ç§»é™¤éšæœºçš„keyï¼Œåªå¯¹è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”® Ã˜ allkeys-randomï¼šåœ¨æ‰€æœ‰é›†åˆkeyä¸­ï¼Œç§»é™¤éšæœºçš„key Ã˜ volatile-ttlï¼šç§»é™¤é‚£äº›TTLå€¼æœ€å°çš„keyï¼Œå³é‚£äº›æœ€è¿‘è¦è¿‡æœŸçš„key Ã˜ noevictionï¼šä¸è¿›è¡Œç§»é™¤ã€‚é’ˆå¯¹å†™æ“ä½œï¼Œåªæ˜¯è¿”å›é”™è¯¯ä¿¡æ¯ 4.6.4 maxmemory-samplesÃ˜ è®¾ç½®æ ·æœ¬æ•°é‡ï¼ŒLRUç®—æ³•å’Œæœ€å°TTLç®—æ³•éƒ½å¹¶éæ˜¯ç²¾ç¡®çš„ç®—æ³•ï¼Œè€Œæ˜¯ä¼°ç®—å€¼ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¾ç½®æ ·æœ¬çš„å¤§å°ï¼Œredisé»˜è®¤ä¼šæ£€æŸ¥è¿™ä¹ˆå¤šä¸ªkeyå¹¶é€‰æ‹©å…¶ä¸­LRUçš„é‚£ä¸ªã€‚ Ã˜ ä¸€èˆ¬è®¾ç½®3åˆ°7çš„æ•°å­—ï¼Œæ•°å€¼è¶Šå°æ ·æœ¬è¶Šä¸å‡†ç¡®ï¼Œä½†æ€§èƒ½æ¶ˆè€—è¶Šå°ã€‚ äº”ã€Redisçš„å‘å¸ƒå’Œè®¢é˜…5.1 ä»€ä¹ˆæ˜¯å‘å¸ƒå’Œè®¢é˜…Redis å‘å¸ƒè®¢é˜… (pub/sub) æ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼šå‘é€è€… (pub) å‘é€æ¶ˆæ¯ï¼Œè®¢é˜…è€… (sub) æ¥æ”¶æ¶ˆæ¯ã€‚ Redis å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…ä»»æ„æ•°é‡çš„é¢‘é“ã€‚ 5.2 Redisçš„å‘å¸ƒå’Œè®¢é˜…1ã€å®¢æˆ·ç«¯å¯ä»¥è®¢é˜…é¢‘é“å¦‚ä¸‹å›¾ 2ã€å½“ç»™è¿™ä¸ªé¢‘é“å‘å¸ƒæ¶ˆæ¯åï¼Œæ¶ˆæ¯å°±ä¼šå‘é€ç»™è®¢é˜…çš„å®¢æˆ·ç«¯ 5.3 å‘å¸ƒè®¢é˜…å‘½ä»¤è¡Œå®ç°1ã€ æ‰“å¼€ä¸€ä¸ªå®¢æˆ·ç«¯è®¢é˜…channel1 SUBSCRIBE channel1 2ã€æ‰“å¼€å¦ä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œç»™channel1å‘å¸ƒæ¶ˆæ¯hello publish channel1 hello è¿”å›çš„1æ˜¯è®¢é˜…è€…æ•°é‡ 3ã€æ‰“å¼€ç¬¬ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥çœ‹åˆ°å‘é€çš„æ¶ˆæ¯ æ³¨ï¼šå‘å¸ƒçš„æ¶ˆæ¯æ²¡æœ‰æŒä¹…åŒ–ï¼Œå¦‚æœåœ¨è®¢é˜…çš„å®¢æˆ·ç«¯æ”¶ä¸åˆ°helloï¼Œåªèƒ½æ”¶åˆ°è®¢é˜…åå‘å¸ƒçš„æ¶ˆæ¯ å…­ã€Redisæ–°æ•°æ®ç±»å‹6.1 Bitmaps6.1.1 ç®€ä»‹ç°ä»£è®¡ç®—æœºç”¨äºŒè¿›åˆ¶ï¼ˆä½ï¼‰ ä½œä¸ºä¿¡æ¯çš„åŸºç¡€å•ä½ï¼Œ 1ä¸ªå­—èŠ‚ç­‰äº8ä½ï¼Œ ä¾‹å¦‚â€œabcâ€å­—ç¬¦ä¸²æ˜¯ç”±3ä¸ªå­—èŠ‚ç»„æˆï¼Œ ä½†å®é™…åœ¨è®¡ç®—æœºå­˜å‚¨æ—¶å°†å…¶ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œ â€œabcâ€åˆ†åˆ«å¯¹åº”çš„ASCIIç åˆ†åˆ«æ˜¯97ã€ 98ã€ 99ï¼Œ å¯¹åº”çš„äºŒè¿›åˆ¶åˆ†åˆ«æ˜¯01100001ã€ 01100010å’Œ01100011ï¼Œå¦‚ä¸‹å›¾ åˆç†åœ°ä½¿ç”¨æ“ä½œä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚ Redisæä¾›äº†Bitmapsè¿™ä¸ªâ€œæ•°æ®ç±»å‹â€å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œï¼š ï¼ˆ1ï¼‰ Bitmapsæœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œ å®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼ˆkey-valueï¼‰ ï¼Œ ä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚ ï¼ˆ2ï¼‰ Bitmapså•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œ æ‰€ä»¥åœ¨Redisä¸­ä½¿ç”¨Bitmapså’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚ å¯ä»¥æŠŠBitmapsæƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œ æ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨0å’Œ1ï¼Œ æ•°ç»„çš„ä¸‹æ ‡åœ¨Bitmapsä¸­å«åšåç§»é‡ã€‚ 6.1.2 å‘½ä»¤1ã€setbit ï¼ˆ1ï¼‰æ ¼å¼ setbitè®¾ç½®Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ï¼ˆ0æˆ–1ï¼‰ *offset:åç§»é‡ä»0å¼€å§‹ ï¼ˆ2ï¼‰å®ä¾‹ æ¯ä¸ªç‹¬ç«‹ç”¨æˆ·æ˜¯å¦è®¿é—®è¿‡ç½‘ç«™å­˜æ”¾åœ¨Bitmapsä¸­ï¼Œ å°†è®¿é—®çš„ç”¨æˆ·è®°åš1ï¼Œ æ²¡æœ‰è®¿é—®çš„ç”¨æˆ·è®°åš0ï¼Œ ç”¨åç§»é‡ä½œä¸ºç”¨æˆ·çš„idã€‚ è®¾ç½®é”®çš„ç¬¬offsetä¸ªä½çš„å€¼ï¼ˆä»0ç®—èµ·ï¼‰ ï¼Œ å‡è®¾ç°åœ¨æœ‰20ä¸ªç”¨æˆ·ï¼Œuserid=1ï¼Œ 6ï¼Œ 11ï¼Œ 15ï¼Œ 19çš„ç”¨æˆ·å¯¹ç½‘ç«™è¿›è¡Œäº†è®¿é—®ï¼Œ é‚£ä¹ˆå½“å‰Bitmapsåˆå§‹åŒ–ç»“æœå¦‚å›¾ unique:users:20201106ä»£è¡¨2020-11-06è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·çš„Bitmaps æ³¨ï¼š å¾ˆå¤šåº”ç”¨çš„ç”¨æˆ·idä»¥ä¸€ä¸ªæŒ‡å®šæ•°å­—ï¼ˆä¾‹å¦‚10000ï¼‰ å¼€å¤´ï¼Œ ç›´æ¥å°†ç”¨æˆ·idå’ŒBitmapsçš„åç§»é‡å¯¹åº”åŠ¿å¿…ä¼šé€ æˆä¸€å®šçš„æµªè´¹ï¼Œ é€šå¸¸çš„åšæ³•æ˜¯æ¯æ¬¡åšsetbitæ“ä½œæ—¶å°†ç”¨æˆ·idå‡å»è¿™ä¸ªæŒ‡å®šæ•°å­—ã€‚ åœ¨ç¬¬ä¸€æ¬¡åˆå§‹åŒ–Bitmapsæ—¶ï¼Œ å‡å¦‚åç§»é‡éå¸¸å¤§ï¼Œ é‚£ä¹ˆæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œä¼šæ¯”è¾ƒæ…¢ï¼Œ å¯èƒ½ä¼šé€ æˆRedisçš„é˜»å¡ã€‚ 2ã€getbit ï¼ˆ1ï¼‰æ ¼å¼ getbitè·å–Bitmapsä¸­æŸä¸ªåç§»é‡çš„å€¼ è·å–é”®çš„ç¬¬offsetä½çš„å€¼ï¼ˆä»0å¼€å§‹ç®—ï¼‰ ï¼ˆ2ï¼‰å®ä¾‹ è·å–id=8çš„ç”¨æˆ·æ˜¯å¦åœ¨2020-11-06è¿™å¤©è®¿é—®è¿‡ï¼Œ è¿”å›0è¯´æ˜æ²¡æœ‰è®¿é—®è¿‡ï¼š æ³¨ï¼šå› ä¸º100æ ¹æœ¬ä¸å­˜åœ¨ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯è¿”å›0 3ã€bitcount ç»Ÿè®¡å­—ç¬¦ä¸²è¢«è®¾ç½®ä¸º1çš„bitæ•°ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œç»™å®šçš„æ•´ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šè¢«è¿›è¡Œè®¡æ•°ï¼Œé€šè¿‡æŒ‡å®šé¢å¤–çš„ start æˆ– end å‚æ•°ï¼Œå¯ä»¥è®©è®¡æ•°åªåœ¨ç‰¹å®šçš„ä½ä¸Šè¿›è¡Œã€‚start å’Œ end å‚æ•°çš„è®¾ç½®ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è´Ÿæ•°å€¼ï¼šæ¯”å¦‚ -1 è¡¨ç¤ºæœ€åä¸€ä¸ªä½ï¼Œè€Œ -2 è¡¨ç¤ºå€’æ•°ç¬¬äºŒä¸ªä½ï¼Œstartã€end æ˜¯æŒ‡bitç»„çš„å­—èŠ‚çš„ä¸‹æ ‡æ•°ï¼ŒäºŒè€…çš†åŒ…å«ã€‚ ï¼ˆ1ï¼‰æ ¼å¼ bitcount[start end] ç»Ÿè®¡å­—ç¬¦ä¸²ä»startå­—èŠ‚åˆ°endå­—èŠ‚æ¯”ç‰¹å€¼ä¸º1çš„æ•°é‡ ï¼ˆ2ï¼‰å®ä¾‹ è®¡ç®—2022-11-06è¿™å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°é‡ startå’Œendä»£è¡¨èµ·å§‹å’Œç»“æŸå­—èŠ‚æ•°ï¼Œ ä¸‹é¢æ“ä½œè®¡ç®—ç”¨æˆ·idåœ¨ç¬¬1ä¸ªå­—èŠ‚åˆ°ç¬¬3ä¸ªå­—èŠ‚ä¹‹é—´çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·æ•°ï¼Œ å¯¹åº”çš„ç”¨æˆ·idæ˜¯11ï¼Œ 15ï¼Œ 19ã€‚ ä¸¾ä¾‹ï¼š K1 ã€01000001 01000000 00000000 00100001ã€‘ï¼Œå¯¹åº”ã€0ï¼Œ1ï¼Œ2ï¼Œ3ã€‘ bitcount K1 1 2 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit=1çš„ä¸ªæ•°ï¼Œå³01000000 00000000 â€“ã€‹bitcount K1 1 2 â€“ã€‹1 bitcount K1 1 3 ï¼š ç»Ÿè®¡ä¸‹æ ‡1ã€2å­—èŠ‚ç»„ä¸­bit=1çš„ä¸ªæ•°ï¼Œå³01000000 00000000 00100001 â€“ã€‹bitcount K1 1 3 â€“ã€‹3 bitcount K1 0 -2 ï¼š ç»Ÿè®¡ä¸‹æ ‡0åˆ°ä¸‹æ ‡å€’æ•°ç¬¬2ï¼Œå­—èŠ‚ç»„ä¸­bit=1çš„ä¸ªæ•°ï¼Œå³01000001 01000000 00000000 â€“ã€‹bitcount K1 0 -2 â€“ã€‹3 æ³¨æ„ï¼šredisçš„setbitè®¾ç½®æˆ–æ¸…é™¤çš„æ˜¯bitä½ç½®ï¼Œè€Œbitcountè®¡ç®—çš„æ˜¯byteä½ç½®ã€‚ 4ã€bitop (1)æ ¼å¼ bitop and(or/not/xor) [keyâ€¦] bitopæ˜¯ä¸€ä¸ªå¤åˆæ“ä½œï¼Œ å®ƒå¯ä»¥åšå¤šä¸ªBitmapsçš„andï¼ˆäº¤é›†ï¼‰ ã€ orï¼ˆå¹¶é›†ï¼‰ ã€ notï¼ˆéï¼‰ ã€ xorï¼ˆå¼‚æˆ–ï¼‰ æ“ä½œå¹¶å°†ç»“æœä¿å­˜åœ¨destkeyä¸­ã€‚ (2)å®ä¾‹ 2020-11-04 æ—¥è®¿é—®ç½‘ç«™çš„userid=1,2,5,9ã€‚ setbit unique:users:20201104 1 1 setbit unique:users:20201104 2 1 setbit unique:users:20201104 5 1 setbit unique:users:20201104 9 1 2020-11-03 æ—¥è®¿é—®ç½‘ç«™çš„userid=0,1,4,9ã€‚ setbit unique:users:20201103 0 1 setbit unique:users:20201103 1 1 setbit unique:users:20201103 4 1 setbit unique:users:20201103 9 1 è®¡ç®—å‡ºä¸¤å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ bitop and unique:users:and:20201104_03 unique:users:20201103unique:users:20201104 è®¡ç®—å‡ºä»»æ„ä¸€å¤©éƒ½è®¿é—®è¿‡ç½‘ç«™çš„ç”¨æˆ·æ•°é‡ï¼ˆä¾‹å¦‚æœˆæ´»è·ƒå°±æ˜¯ç±»ä¼¼è¿™ç§ï¼‰ ï¼Œ å¯ä»¥ä½¿ç”¨oræ±‚å¹¶é›† 6.1.3 Bitmapsä¸setå¯¹æ¯”å‡è®¾ç½‘ç«™æœ‰1äº¿ç”¨æˆ·ï¼Œ æ¯å¤©ç‹¬ç«‹è®¿é—®çš„ç”¨æˆ·æœ‰5åƒä¸‡ï¼Œ å¦‚æœæ¯å¤©ç”¨é›†åˆç±»å‹å’ŒBitmapsåˆ†åˆ«å­˜å‚¨æ´»è·ƒç”¨æˆ·å¯ä»¥å¾—åˆ°è¡¨ setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯” æ•°æ®ç±»å‹ æ¯ä¸ªç”¨æˆ·idå ç”¨ç©ºé—´ éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡ å…¨éƒ¨å†…å­˜é‡ é›†åˆç±»å‹ 64ä½ 50000000 64ä½*50000000 = 400MB Bitmaps 1ä½ 100000000 1ä½*100000000 = 12.5MB å¾ˆæ˜æ˜¾ï¼Œ è¿™ç§æƒ…å†µä¸‹ä½¿ç”¨Bitmapsèƒ½èŠ‚çœå¾ˆå¤šçš„å†…å­˜ç©ºé—´ï¼Œ å°¤å…¶æ˜¯éšç€æ—¶é—´æ¨ç§»èŠ‚çœçš„å†…å­˜è¿˜æ˜¯éå¸¸å¯è§‚çš„ setå’ŒBitmapså­˜å‚¨ç‹¬ç«‹ç”¨æˆ·ç©ºé—´å¯¹æ¯” æ•°æ®ç±»å‹ ä¸€å¤© ä¸€ä¸ªæœˆ ä¸€å¹´ é›†åˆç±»å‹ 400MB 12GB 144GB Bitmaps 12.5MB 375MB 4.5GB ä½†Bitmapså¹¶ä¸æ˜¯ä¸‡é‡‘æ²¹ï¼Œ å‡å¦‚è¯¥ç½‘ç«™æ¯å¤©çš„ç‹¬ç«‹è®¿é—®ç”¨æˆ·å¾ˆå°‘ï¼Œ ä¾‹å¦‚åªæœ‰10ä¸‡ï¼ˆå¤§é‡çš„åƒµå°¸ç”¨æˆ·ï¼‰ ï¼Œ é‚£ä¹ˆä¸¤è€…çš„å¯¹æ¯”å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œ å¾ˆæ˜¾ç„¶ï¼Œ è¿™æ—¶å€™ä½¿ç”¨Bitmapså°±ä¸å¤ªåˆé€‚äº†ï¼Œ å› ä¸ºåŸºæœ¬ä¸Šå¤§éƒ¨åˆ†ä½éƒ½æ˜¯0ã€‚ setå’ŒBitmapså­˜å‚¨ä¸€å¤©æ´»è·ƒç”¨æˆ·å¯¹æ¯”ï¼ˆç‹¬ç«‹ç”¨æˆ·æ¯”è¾ƒå°‘ï¼‰ æ•°æ®ç±»å‹ æ¯ä¸ªuseridå ç”¨ç©ºé—´ éœ€è¦å­˜å‚¨çš„ç”¨æˆ·é‡ å…¨éƒ¨å†…å­˜é‡ é›†åˆç±»å‹ 64ä½ 100000 64ä½*100000 = 800KB Bitmaps 1ä½ 100000000 1ä½*100000000 = 12.5MB 6.2 HyperLogLog6.2.1 ç®€ä»‹åœ¨å·¥ä½œå½“ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸ç»Ÿè®¡ç›¸å…³çš„åŠŸèƒ½éœ€æ±‚ï¼Œæ¯”å¦‚ç»Ÿè®¡ç½‘ç«™PVï¼ˆPageViewé¡µé¢è®¿é—®é‡ï¼‰,å¯ä»¥ä½¿ç”¨Redisçš„incrã€incrbyè½»æ¾å®ç°ã€‚ ä½†åƒUVï¼ˆUniqueVisitorï¼Œç‹¬ç«‹è®¿å®¢ï¼‰ã€ç‹¬ç«‹IPæ•°ã€æœç´¢è®°å½•æ•°ç­‰éœ€è¦å»é‡å’Œè®¡æ•°çš„é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿè¿™ç§æ±‚é›†åˆä¸­ä¸é‡å¤å…ƒç´ ä¸ªæ•°çš„é—®é¢˜ç§°ä¸ºåŸºæ•°é—®é¢˜ã€‚ è§£å†³åŸºæ•°é—®é¢˜æœ‰å¾ˆå¤šç§æ–¹æ¡ˆï¼š ï¼ˆ1ï¼‰æ•°æ®å­˜å‚¨åœ¨MySQLè¡¨ä¸­ï¼Œä½¿ç”¨distinct countè®¡ç®—ä¸é‡å¤ä¸ªæ•° ï¼ˆ2ï¼‰ä½¿ç”¨Redisæä¾›çš„hashã€setã€bitmapsç­‰æ•°æ®ç»“æ„æ¥å¤„ç† ä»¥ä¸Šçš„æ–¹æ¡ˆç»“æœç²¾ç¡®ï¼Œä½†éšç€æ•°æ®ä¸æ–­å¢åŠ ï¼Œå¯¼è‡´å ç”¨ç©ºé—´è¶Šæ¥è¶Šå¤§ï¼Œå¯¹äºéå¸¸å¤§çš„æ•°æ®é›†æ˜¯ä¸åˆ‡å®é™…çš„ã€‚ èƒ½å¦èƒ½å¤Ÿé™ä½ä¸€å®šçš„ç²¾åº¦æ¥å¹³è¡¡å­˜å‚¨ç©ºé—´ï¼ŸRedisæ¨å‡ºäº†HyperLogLog Redis HyperLogLog æ˜¯ç”¨æ¥åšåŸºæ•°ç»Ÿè®¡çš„ç®—æ³•ï¼ŒHyperLogLog çš„ä¼˜ç‚¹æ˜¯ï¼Œåœ¨è¾“å…¥å…ƒç´ çš„æ•°é‡æˆ–è€…ä½“ç§¯éå¸¸éå¸¸å¤§æ—¶ï¼Œè®¡ç®—åŸºæ•°æ‰€éœ€çš„ç©ºé—´æ€»æ˜¯å›ºå®šçš„ã€å¹¶ä¸”æ˜¯å¾ˆå°çš„ã€‚ åœ¨ Redis é‡Œé¢ï¼Œæ¯ä¸ª HyperLogLog é”®åªéœ€è¦èŠ±è´¹ 12 KB å†…å­˜ï¼Œå°±å¯ä»¥è®¡ç®—æ¥è¿‘ 2^64 ä¸ªä¸åŒå…ƒç´ çš„åŸºæ•°ã€‚è¿™å’Œè®¡ç®—åŸºæ•°æ—¶ï¼Œå…ƒç´ è¶Šå¤šè€—è´¹å†…å­˜å°±è¶Šå¤šçš„é›†åˆå½¢æˆé²œæ˜å¯¹æ¯”ã€‚ ä½†æ˜¯ï¼Œå› ä¸º HyperLogLog åªä¼šæ ¹æ®è¾“å…¥å…ƒç´ æ¥è®¡ç®—åŸºæ•°ï¼Œè€Œä¸ä¼šå‚¨å­˜è¾“å…¥å…ƒç´ æœ¬èº«ï¼Œæ‰€ä»¥ HyperLogLog ä¸èƒ½åƒé›†åˆé‚£æ ·ï¼Œè¿”å›è¾“å…¥çš„å„ä¸ªå…ƒç´ ã€‚ ä»€ä¹ˆæ˜¯åŸºæ•°? æ¯”å¦‚æ•°æ®é›† {1, 3, 5, 7, 5, 7, 8}ï¼Œ é‚£ä¹ˆè¿™ä¸ªæ•°æ®é›†çš„åŸºæ•°é›†ä¸º {1, 3, 5 ,7, 8}, åŸºæ•°(ä¸é‡å¤å…ƒç´ )ä¸º5ã€‚ åŸºæ•°ä¼°è®¡å°±æ˜¯åœ¨è¯¯å·®å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå¿«é€Ÿè®¡ç®—åŸºæ•°ã€‚ 6.2.2 å‘½ä»¤1ã€pfadd ï¼ˆ1ï¼‰æ ¼å¼ pfadd &lt; element&gt; [element â€¦] æ·»åŠ æŒ‡å®šå…ƒç´ åˆ° HyperLogLog ä¸­ ï¼ˆ2ï¼‰å®ä¾‹ å°†æ‰€æœ‰å…ƒç´ æ·»åŠ åˆ°æŒ‡å®šHyperLogLogæ•°æ®ç»“æ„ä¸­ã€‚å¦‚æœæ‰§è¡Œå‘½ä»¤åHLLä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°å‘ç”Ÿå˜åŒ–ï¼Œåˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚ 2ã€pfcount ï¼ˆ1ï¼‰æ ¼å¼ pfcount [key â€¦] è®¡ç®—HLLçš„è¿‘ä¼¼åŸºæ•°ï¼Œå¯ä»¥è®¡ç®—å¤šä¸ªHLLï¼Œæ¯”å¦‚ç”¨HLLå­˜å‚¨æ¯å¤©çš„UVï¼Œè®¡ç®—ä¸€å‘¨çš„UVå¯ä»¥ä½¿ç”¨7å¤©çš„UVåˆå¹¶è®¡ç®—å³å¯ ï¼ˆ2ï¼‰å®ä¾‹ 3ã€pfmerge ï¼ˆ1ï¼‰æ ¼å¼ pfmerge [sourcekey â€¦] å°†ä¸€ä¸ªæˆ–å¤šä¸ªHLLåˆå¹¶åçš„ç»“æœå­˜å‚¨åœ¨å¦ä¸€ä¸ªHLLä¸­ï¼Œæ¯”å¦‚æ¯æœˆæ´»è·ƒç”¨æˆ·å¯ä»¥ä½¿ç”¨æ¯å¤©çš„æ´»è·ƒç”¨æˆ·æ¥åˆå¹¶è®¡ç®—å¯å¾— ï¼ˆ2ï¼‰å®ä¾‹ 6.3 Geospatial6.3.1 ç®€ä»‹Redis 3.2 ä¸­å¢åŠ äº†å¯¹GEOç±»å‹çš„æ”¯æŒã€‚GEOï¼ŒGeographicï¼Œåœ°ç†ä¿¡æ¯çš„ç¼©å†™ã€‚è¯¥ç±»å‹ï¼Œå°±æ˜¯å…ƒç´ çš„2ç»´åæ ‡ï¼Œåœ¨åœ°å›¾ä¸Šå°±æ˜¯ç»çº¬åº¦ã€‚redisåŸºäºè¯¥ç±»å‹ï¼Œæä¾›äº†ç»çº¬åº¦è®¾ç½®ï¼ŒæŸ¥è¯¢ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œè·ç¦»æŸ¥è¯¢ï¼Œç»çº¬åº¦Hashç­‰å¸¸è§æ“ä½œã€‚ 6.3.2 å‘½ä»¤1ã€geoadd ï¼ˆ1ï¼‰æ ¼å¼ geoadd&lt; longitude&gt; [longitude latitude memberâ€¦] æ·»åŠ åœ°ç†ä½ç½®ï¼ˆç»åº¦ï¼Œçº¬åº¦ï¼Œåç§°ï¼‰ ï¼ˆ2ï¼‰å®ä¾‹ geoadd china:city 121.47 31.23 shanghai geoadd china:city 106.50 29.53 chongqing 114.05 22.52 shenzhen 116.38 39.90 beijing ä¸¤ææ— æ³•ç›´æ¥æ·»åŠ ï¼Œä¸€èˆ¬ä¼šä¸‹è½½åŸå¸‚æ•°æ®ï¼Œç›´æ¥é€šè¿‡ Java ç¨‹åºä¸€æ¬¡æ€§å¯¼å…¥ã€‚ æœ‰æ•ˆçš„ç»åº¦ä» -180 åº¦åˆ° 180 åº¦ã€‚æœ‰æ•ˆçš„çº¬åº¦ä» -85.05112878 åº¦åˆ° 85.05112878 åº¦ã€‚ å½“åæ ‡ä½ç½®è¶…å‡ºæŒ‡å®šèŒƒå›´æ—¶ï¼Œè¯¥å‘½ä»¤å°†ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ å·²ç»æ·»åŠ çš„æ•°æ®ï¼Œæ˜¯æ— æ³•å†æ¬¡å¾€é‡Œé¢æ·»åŠ çš„ã€‚ 2ã€geopos ï¼ˆ1ï¼‰æ ¼å¼ geopos [memberâ€¦] è·å¾—æŒ‡å®šåœ°åŒºçš„åæ ‡å€¼ ï¼ˆ2ï¼‰å®ä¾‹ 3ã€geodist ï¼ˆ1ï¼‰æ ¼å¼ geodist [m|km|ft|mi ] è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦» ï¼ˆ2ï¼‰å®ä¾‹ è·å–ä¸¤ä¸ªä½ç½®ä¹‹é—´çš„ç›´çº¿è·ç¦» å•ä½ï¼š m è¡¨ç¤ºå•ä½ä¸ºç±³[é»˜è®¤å€¼]ã€‚ km è¡¨ç¤ºå•ä½ä¸ºåƒç±³ã€‚ mi è¡¨ç¤ºå•ä½ä¸ºè‹±é‡Œã€‚ ft è¡¨ç¤ºå•ä½ä¸ºè‹±å°ºã€‚ å¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼åœ°æŒ‡å®šå•ä½å‚æ•°ï¼Œ é‚£ä¹ˆ GEODIST é»˜è®¤ä½¿ç”¨ç±³ä½œä¸ºå•ä½ 4ã€georadius ï¼ˆ1ï¼‰æ ¼å¼ georadius&lt; longitude&gt;radius m|km|ft|mi ä»¥ç»™å®šçš„ç»çº¬åº¦ä¸ºä¸­å¿ƒï¼Œæ‰¾å‡ºæŸä¸€åŠå¾„å†…çš„å…ƒç´  ç»åº¦ çº¬åº¦ è·ç¦» å•ä½ ï¼ˆ2ï¼‰å®ä¾‹ ä¸ƒã€Redis_Jedis_æµ‹è¯•7.1 Jedisæ‰€éœ€è¦çš„jaråŒ… &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;3.2.0&lt;/version&gt; 7.2 è¿æ¥Redisæ³¨æ„äº‹é¡¹ç¦ç”¨Linuxçš„é˜²ç«å¢™ï¼šLinux(CentOS7)é‡Œæ‰§è¡Œå‘½ä»¤ systemctl stop/disable firewalld.service redis.confä¸­æ³¨é‡Šæ‰bind 127.0.0.1 ,ç„¶å protected-mode no 7.3 Jediså¸¸ç”¨æ“ä½œ7.3.1 åˆ›å»ºåŠ¨æ€çš„å·¥ç¨‹7.3.2 åˆ›å»ºæµ‹è¯•ç¨‹åº package com.atguigu.jedis; import redis.clients.jedis.Jedis; public class Demo01 {public static void main(String[] args) { Jedis jedis = new Jedis(&quot;192.168.137.3&quot;,6379); String pong = jedis.ping(); System.out.println(&quot;è¿æ¥æˆåŠŸï¼š&quot;+pong); jedis.close(); &#125; } 7.4 æµ‹è¯•ç›¸å…³æ•°æ®ç±»å‹7.4.1 Jedis-API: Key1234567891011jedis.set(&quot;k1&quot;, &quot;v1&quot;);jedis.set(&quot;k2&quot;, &quot;v2&quot;);jedis.set(&quot;k3&quot;, &quot;v3&quot;);Set&lt;String&gt; keys = jedis.keys(&quot;*&quot;);System.out.println(keys.size());for (String key : keys) &#123; System.out.println(key);&#125;System.out.println(jedis.exists(&quot;k1&quot;));System.out.println(jedis.ttl(&quot;k1&quot;)); System.out.println(jedis.get(&quot;k1&quot;)); 7.4.2 Jedis-API: String12jedis.mset(&quot;str1&quot;,&quot;v1&quot;,&quot;str2&quot;,&quot;v2&quot;,&quot;str3&quot;,&quot;v3&quot;);System.out.println(jedis.mget(&quot;str1&quot;,&quot;str2&quot;,&quot;str3&quot;)); 7.4.3 Jedis-API: List1234List&lt;String&gt; list = jedis.lrange(&quot;mylist&quot;,0,-1);for (String element : list) &#123;System.out.println(element);&#125; 7.4.4 Jedis-API: set123456789jedis.sadd(&quot;orders&quot;, &quot;order01&quot;);jedis.sadd(&quot;orders&quot;, &quot;order02&quot;);jedis.sadd(&quot;orders&quot;, &quot;order03&quot;);jedis.sadd(&quot;orders&quot;, &quot;order04&quot;);Set&lt;String&gt; smembers = jedis.smembers(&quot;orders&quot;);for (String order : smembers) &#123;System.out.println(order);&#125;jedis.srem(&quot;orders&quot;, &quot;order02&quot;); 7.4.5 Jedis-API: hash1234567891011jedis.hset(&quot;hash1&quot;,&quot;userName&quot;,&quot;lisi&quot;);System.out.println(jedis.hget(&quot;hash1&quot;,&quot;userName&quot;));Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();map.put(&quot;telphone&quot;,&quot;13810169999&quot;);map.put(&quot;address&quot;,&quot;atguigu&quot;);map.put(&quot;email&quot;,&quot;abc@163.com&quot;);jedis.hmset(&quot;hash2&quot;,map);List&lt;String&gt; result = jedis.hmget(&quot;hash2&quot;, &quot;telphone&quot;,&quot;email&quot;);for (String element : result) &#123;System.out.println(element);&#125; 7.4.6 Jedis-API: zset123456789jedis.zadd(&quot;zset01&quot;, 100d, &quot;z3&quot;);jedis.zadd(&quot;zset01&quot;, 90d, &quot;l4&quot;);jedis.zadd(&quot;zset01&quot;, 80d, &quot;w5&quot;);jedis.zadd(&quot;zset01&quot;, 70d, &quot;z6&quot;); Set&lt;String&gt; zrange = jedis.zrange(&quot;zset01&quot;, 0, -1);for (String e : zrange) &#123;System.out.println(e);&#125; å…«ã€Redis_Jedis_å®ä¾‹8.1 å®Œæˆä¸€ä¸ªæ‰‹æœºéªŒè¯ç åŠŸèƒ½è¦æ±‚ï¼š 1ã€è¾“å…¥æ‰‹æœºå·ï¼Œç‚¹å‡»å‘é€åéšæœºç”Ÿæˆ6ä½æ•°å­—ç ï¼Œ2åˆ†é’Ÿæœ‰æ•ˆ 2ã€è¾“å…¥éªŒè¯ç ï¼Œç‚¹å‡»éªŒè¯ï¼Œè¿”å›æˆåŠŸæˆ–å¤±è´¥ 3ã€æ¯ä¸ªæ‰‹æœºå·æ¯å¤©åªèƒ½è¾“å…¥3æ¬¡ ä¹ã€Redisä¸Spring Bootæ•´åˆSpring Bootæ•´åˆRediséå¸¸ç®€å•ï¼Œåªéœ€è¦æŒ‰å¦‚ä¸‹æ­¥éª¤æ•´åˆå³å¯ 9.1 æ•´åˆæ­¥éª¤1ã€ åœ¨pom.xmlæ–‡ä»¶ä¸­å¼•å…¥redisç›¸å…³ä¾èµ– 123456789101112&lt;!-- redis --&gt;&lt;dependency&gt;&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;&lt;/dependency&gt;&lt;!-- spring2.Xé›†æˆredisæ‰€éœ€common-pool2--&gt;&lt;dependency&gt;&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;&lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;&lt;version&gt;2.6.0&lt;/version&gt;&lt;/dependency&gt; 2ã€ application.propertiesé…ç½®redisé…ç½® 12345678910111213141516#RedisæœåŠ¡å™¨åœ°å€spring.redis.host=192.168.140.136#RedisæœåŠ¡å™¨è¿æ¥ç«¯å£spring.redis.port=6379#Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰spring.redis.database= 0#è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰spring.redis.timeout=1800000#è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰spring.redis.lettuce.pool.max-active=20#æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´(è´Ÿæ•°è¡¨ç¤ºæ²¡é™åˆ¶)spring.redis.lettuce.pool.max-wait=-1#è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥spring.redis.lettuce.pool.max-idle=5#è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥spring.redis.lettuce.pool.min-idle=0 3ã€ æ·»åŠ redisé…ç½®ç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344@EnableCaching@Configurationpublic class RedisConfig extends CachingConfigurerSupport &#123; @Bean public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory factory) &#123; RedisTemplate&lt;String, Object&gt; template = new RedisTemplate&lt;&gt;(); RedisSerializer&lt;String&gt; redisSerializer = new StringRedisSerializer(); Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class); ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(om); template.setConnectionFactory(factory);//keyåºåˆ—åŒ–æ–¹å¼ template.setKeySerializer(redisSerializer);//valueåºåˆ—åŒ– template.setValueSerializer(jackson2JsonRedisSerializer);//value hashmapåºåˆ—åŒ– template.setHashValueSerializer(jackson2JsonRedisSerializer); return template; &#125; @Bean public CacheManager cacheManager(RedisConnectionFactory factory) &#123; RedisSerializer&lt;String&gt; redisSerializer = new StringRedisSerializer(); Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);//è§£å†³æŸ¥è¯¢ç¼“å­˜è½¬æ¢å¼‚å¸¸çš„é—®é¢˜ ObjectMapper om = new ObjectMapper(); om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY); om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); jackson2JsonRedisSerializer.setObjectMapper(om);// é…ç½®åºåˆ—åŒ–ï¼ˆè§£å†³ä¹±ç çš„é—®é¢˜ï¼‰,è¿‡æœŸæ—¶é—´600ç§’ RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig() .entryTtl(Duration.ofSeconds(600)) .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer)) .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer)) .disableCachingNullValues(); RedisCacheManager cacheManager = RedisCacheManager.builder(factory) .cacheDefaults(config) .build(); return cacheManager; &#125;&#125; 4ã€æµ‹è¯•ä¸€ä¸‹ RedisTestControllerä¸­æ·»åŠ æµ‹è¯•æ–¹æ³• 123456789101112131415@RestController@RequestMapping(&quot;/redisTest&quot;)public class RedisTestController &#123; @Autowired private RedisTemplate redisTemplate; @GetMapping public String testRedis() &#123; //è®¾ç½®å€¼åˆ°redis redisTemplate.opsForValue().set(&quot;name&quot;,&quot;lucy&quot;); //ä»redisè·å–å€¼ String name = (String)redisTemplate.opsForValue().get(&quot;name&quot;); return name; &#125;&#125; åã€Redis_äº‹åŠ¡_é”æœºåˆ¶_ç§’æ€10.1 Redisçš„äº‹åŠ¡å®šä¹‰ Redisäº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚ Redisäº‹åŠ¡çš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸²è”å¤šä¸ªå‘½ä»¤é˜²æ­¢åˆ«çš„å‘½ä»¤æ’é˜Ÿã€‚ 10.2 Multiã€Execã€discardä»è¾“å…¥Multiå‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œï¼Œç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚ ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡discardæ¥æ”¾å¼ƒç»„é˜Ÿã€‚ æ¡ˆä¾‹ï¼š ç»„é˜ŸæˆåŠŸï¼Œæäº¤æˆåŠŸ ç»„é˜Ÿé˜¶æ®µæŠ¥é”™ï¼Œæäº¤å¤±è´¥ ç»„é˜ŸæˆåŠŸï¼Œæäº¤æœ‰æˆåŠŸæœ‰å¤±è´¥æƒ…å†µ 10.3 äº‹åŠ¡çš„é”™è¯¯å¤„ç†ç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶æ•´ä¸ªçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½ä¼šè¢«å–æ¶ˆã€‚ å¦‚æœæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œï¼Œä¸ä¼šå›æ»šã€‚ 10.4 ä¸ºä»€ä¹ˆè¦åšæˆäº‹åŠ¡æƒ³æƒ³ä¸€ä¸ªåœºæ™¯ï¼šæœ‰å¾ˆå¤šäººæœ‰ä½ çš„è´¦æˆ·,åŒæ—¶å»å‚åŠ åŒåä¸€æŠ¢è´­ 10.5 äº‹åŠ¡å†²çªçš„é—®é¢˜10.5.1 ä¾‹å­ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡8000 ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡5000 ä¸€ä¸ªè¯·æ±‚æƒ³ç»™é‡‘é¢å‡1000 10.5.2 æ‚²è§‚é” æ‚²è§‚é”(Pessimistic Lock)ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆæ‚²è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚ 10.5.3 ä¹è§‚é” ä¹è§‚é”(Optimistic Lock)ï¼šé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å¾ˆä¹è§‚ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ã€‚Rediså°±æ˜¯åˆ©ç”¨è¿™ç§check-and-setæœºåˆ¶å®ç°äº‹åŠ¡çš„ã€‚ 10.5.4 WATCH key [key â€¦]åœ¨æ‰§è¡Œmultiä¹‹å‰ï¼Œå…ˆæ‰§è¡Œwatch key1 [key2],å¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­ã€‚ 10.5.6 unwatchå–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†ã€‚ å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ–DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡ŒUNWATCH äº†ã€‚ http://doc.redisfans.com/transaction/exec.html 10.6 Redisäº‹åŠ¡ä¸‰ç‰¹æ€§Ã˜ å•ç‹¬çš„éš”ç¦»æ“ä½œ n äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚ Ã˜ æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ n é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ Ã˜ ä¸ä¿è¯åŸå­æ€§ n äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š åä¸€ã€Redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹11.1 è§£å†³è®¡æ•°å™¨å’Œäººå‘˜è®°å½•çš„äº‹åŠ¡æ“ä½œ 11.2 Redisäº‹åŠ¡â€“ç§’æ€å¹¶å‘æ¨¡æ‹Ÿä½¿ç”¨å·¥å…·abæ¨¡æ‹Ÿæµ‹è¯• CentOS6 é»˜è®¤å®‰è£… CentOS7éœ€è¦æ‰‹åŠ¨å®‰è£… 11.2.1 è”ç½‘ï¼šyum install httpd-tools11.2.2 æ— ç½‘ç»œï¼ˆ1ï¼‰ è¿›å…¥cd /run/media/root/CentOS 7 x86_64/Packagesï¼ˆè·¯å¾„è·Ÿcentos6ä¸åŒï¼‰ ï¼ˆ2ï¼‰ é¡ºåºå®‰è£… apr-1.4.8-3.el7.x86_64.rpm apr-util-1.5.2-6.el7.x86_64.rpm httpd-tools-2.4.6-67.el7.centos.x86_64.rpm 11.2.3 æµ‹è¯•åŠç»“æœ é€šè¿‡abæµ‹è¯• vim postfile æ¨¡æ‹Ÿè¡¨å•æäº¤å‚æ•°,ä»¥&amp;ç¬¦å·ç»“å°¾;å­˜æ”¾å½“å‰ç›®å½•ã€‚ å†…å®¹ï¼šprodid=0101&amp; ab -n 2000 -c 200 -k -p ~/postfile -T application/x-www-form-urlencoded http://192.168.2.115:8081/Seckill/doseckill è¶…å– 11.3 è¶…å–é—®é¢˜ 11.4 åˆ©ç”¨ä¹è§‚é”æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940//å¢åŠ ä¹è§‚é”jedis.watch(qtkey); //3.åˆ¤æ–­åº“å­˜String qtkeystr = jedis.get(qtkey);if(qtkeystr==null || &quot;&quot;.equals(qtkeystr.trim())) &#123;System.out.println(&quot;æœªåˆå§‹åŒ–åº“å­˜&quot;);jedis.close();return false ;&#125; int qt = Integer.parseInt(qtkeystr);if(qt&lt;=0) &#123;System.err.println(&quot;å·²ç»ç§’å…‰&quot;);jedis.close();return false;&#125; //å¢åŠ äº‹åŠ¡Transaction multi = jedis.multi(); //4.å‡å°‘åº“å­˜//jedis.decr(qtkey);multi.decr(qtkey); //5.åŠ äºº//jedis.sadd(usrkey, uid);multi.sadd(usrkey, uid); //æ‰§è¡Œäº‹åŠ¡List&lt;Object&gt; list = multi.exec(); //åˆ¤æ–­äº‹åŠ¡æäº¤æ˜¯å¦å¤±è´¥if(list==null || list.size()==0) &#123;System.out.println(&quot;ç§’æ€å¤±è´¥&quot;);jedis.close();return false;&#125;System.err.println(&quot;ç§’æ€æˆåŠŸ&quot;);jedis.close(); 11.5 ç»§ç»­å¢åŠ å¹¶å‘æµ‹è¯•11.5.1 è¿æ¥æœ‰é™åˆ¶ab -n 2000 -c 200 -k -p postfile -T â€˜application/x-www-form-urlencodedâ€™ http://192.168.140.1:8080/seckill/doseckill å¢åŠ -rå‚æ•°ï¼Œ-r Donâ€™t exit on socket receive errors. ab -n 2000 -c 100 -r -p postfile -T â€˜application/x-www-form-urlencodedâ€™ http://192.168.140.1:8080/seckill/doseckill 11.5.2 å·²ç»ç§’å…‰ï¼Œå¯æ˜¯è¿˜æœ‰åº“å­˜ab -n 2000 -c 100 -p postfile -T â€˜application/x-www-form-urlencodedâ€™ http://192.168.137.1:8080/seckill/doseckill å·²ç»ç§’å…‰ï¼Œå¯æ˜¯è¿˜æœ‰åº“å­˜ã€‚åŸå› ï¼Œå°±æ˜¯ä¹è§‚é”å¯¼è‡´å¾ˆå¤šè¯·æ±‚éƒ½å¤±è´¥ã€‚å…ˆç‚¹çš„æ²¡ç§’åˆ°ï¼Œåç‚¹çš„å¯èƒ½ç§’åˆ°äº†ã€‚ 11.5.3 è¿æ¥è¶…æ—¶ï¼Œé€šè¿‡è¿æ¥æ± è§£å†³ 11.5.4 è¿æ¥æ± èŠ‚çœæ¯æ¬¡è¿æ¥redisæœåŠ¡å¸¦æ¥çš„æ¶ˆè€—ï¼ŒæŠŠè¿æ¥å¥½çš„å®ä¾‹åå¤åˆ©ç”¨ã€‚ é€šè¿‡å‚æ•°ç®¡ç†è¿æ¥çš„è¡Œä¸º ä»£ç è§é¡¹ç›®ä¸­ é“¾æ¥æ± å‚æ•° MaxTotalï¼šæ§åˆ¶ä¸€ä¸ªpoolå¯åˆ†é…å¤šå°‘ä¸ªjediså®ä¾‹ï¼Œé€šè¿‡pool.getResource()æ¥è·å–ï¼›å¦‚æœèµ‹å€¼ä¸º-1ï¼Œåˆ™è¡¨ç¤ºä¸é™åˆ¶ï¼›å¦‚æœpoolå·²ç»åˆ†é…äº†MaxTotalä¸ªjediså®ä¾‹ï¼Œåˆ™æ­¤æ—¶poolçš„çŠ¶æ€ä¸ºexhaustedã€‚ maxIdleï¼šæ§åˆ¶ä¸€ä¸ªpoolæœ€å¤šæœ‰å¤šå°‘ä¸ªçŠ¶æ€ä¸ºidle(ç©ºé—²)çš„jediså®ä¾‹ï¼› MaxWaitMillisï¼šè¡¨ç¤ºå½“borrowä¸€ä¸ªjediså®ä¾‹æ—¶ï¼Œæœ€å¤§çš„ç­‰å¾…æ¯«ç§’æ•°ï¼Œå¦‚æœè¶…è¿‡ç­‰å¾…æ—¶é—´ï¼Œåˆ™ç›´æ¥æŠ›JedisConnectionExceptionï¼› testOnBorrowï¼šè·å¾—ä¸€ä¸ªjediså®ä¾‹çš„æ—¶å€™æ˜¯å¦æ£€æŸ¥è¿æ¥å¯ç”¨æ€§ï¼ˆping()ï¼‰ï¼›å¦‚æœä¸ºtrueï¼Œåˆ™å¾—åˆ°çš„jediså®ä¾‹å‡æ˜¯å¯ç”¨çš„ï¼› 11.6 è§£å†³åº“å­˜é—ç•™é—®é¢˜11.6.1 LUAè„šæœ¬ Lua æ˜¯ä¸€ä¸ªå°å·§çš„è„šæœ¬è¯­è¨€ï¼ŒLuaè„šæœ¬å¯ä»¥å¾ˆå®¹æ˜“çš„è¢«C/C++ ä»£ç è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥åè¿‡æ¥è°ƒç”¨C/C++çš„å‡½æ•°ï¼ŒLuaå¹¶æ²¡æœ‰æä¾›å¼ºå¤§çš„åº“ï¼Œä¸€ä¸ªå®Œæ•´çš„Luaè§£é‡Šå™¨ä¸è¿‡200kï¼Œæ‰€ä»¥Luaä¸é€‚åˆä½œä¸ºå¼€å‘ç‹¬ç«‹åº”ç”¨ç¨‹åºçš„è¯­è¨€ï¼Œè€Œæ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬è¯­è¨€ã€‚ å¾ˆå¤šåº”ç”¨ç¨‹åºã€æ¸¸æˆä½¿ç”¨LUAä½œä¸ºè‡ªå·±çš„åµŒå…¥å¼è„šæœ¬è¯­è¨€ï¼Œä»¥æ­¤æ¥å®ç°å¯é…ç½®æ€§ã€å¯æ‰©å±•æ€§ã€‚ è¿™å…¶ä¸­åŒ…æ‹¬é­”å…½äº‰éœ¸åœ°å›¾ã€é­”å…½ä¸–ç•Œã€åšå¾·ä¹‹é—¨ã€æ„¤æ€’çš„å°é¸Ÿç­‰ä¼—å¤šæ¸¸æˆæ’ä»¶æˆ–å¤–æŒ‚ã€‚ https://www.w3cschool.cn/lua/ 11.6.2 LUAè„šæœ¬åœ¨Redisä¸­çš„ä¼˜åŠ¿å°†å¤æ‚çš„æˆ–è€…å¤šæ­¥çš„redisæ“ä½œï¼Œå†™ä¸ºä¸€ä¸ªè„šæœ¬ï¼Œä¸€æ¬¡æäº¤ç»™redisæ‰§è¡Œï¼Œå‡å°‘åå¤è¿æ¥redisçš„æ¬¡æ•°ã€‚æå‡æ€§èƒ½ã€‚ LUAè„šæœ¬æ˜¯ç±»ä¼¼redisäº‹åŠ¡ï¼Œæœ‰ä¸€å®šçš„åŸå­æ€§ï¼Œä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ’é˜Ÿï¼Œå¯ä»¥å®Œæˆä¸€äº›redisäº‹åŠ¡æ€§çš„æ“ä½œã€‚ ä½†æ˜¯æ³¨æ„redisçš„luaè„šæœ¬åŠŸèƒ½ï¼Œåªæœ‰åœ¨Redis 2.6ä»¥ä¸Šçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨ã€‚ åˆ©ç”¨luaè„šæœ¬æ·˜æ±°ç”¨æˆ·ï¼Œè§£å†³è¶…å–é—®é¢˜ã€‚ redis 2.6ç‰ˆæœ¬ä»¥åï¼Œé€šè¿‡luaè„šæœ¬è§£å†³äº‰æŠ¢é—®é¢˜ï¼Œå®é™…ä¸Šæ˜¯redis åˆ©ç”¨å…¶å•çº¿ç¨‹çš„ç‰¹æ€§ï¼Œç”¨ä»»åŠ¡é˜Ÿåˆ—çš„æ–¹å¼è§£å†³å¤šä»»åŠ¡å¹¶å‘é—®é¢˜ã€‚ 11.7 Redis_äº‹åŠ¡_ç§’æ€æ¡ˆä¾‹_ä»£ç 11.7.1 é¡¹ç›®ç»“æ„ 11.7.2 ç¬¬ä¸€ç‰ˆï¼šç®€å•ç‰ˆè€å¸ˆç‚¹10æ¬¡ï¼Œæ­£å¸¸ç§’æ€ åŒå­¦ä¸€èµ·ç‚¹è¯•ä¸€è¯•ï¼Œç§’æ€ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚è¿™æ˜¯å› ä¸ºè¿˜è¾¾ä¸åˆ°å¹¶å‘çš„æ•ˆæœã€‚ ä½¿ç”¨å·¥å…·abæ¨¡æ‹Ÿå¹¶å‘æµ‹è¯•ï¼Œä¼šå‡ºç°è¶…å–æƒ…å†µã€‚æŸ¥çœ‹åº“å­˜ä¼šå‡ºç°è´Ÿæ•°ã€‚ 11.7.3 ç¬¬äºŒç‰ˆï¼šåŠ äº‹åŠ¡-ä¹è§‚é”(è§£å†³è¶…å–),ä½†å‡ºç°é—ç•™åº“å­˜å’Œè¿æ¥è¶…æ—¶11.7.4 ç¬¬ä¸‰ç‰ˆï¼šè¿æ¥æ± è§£å†³è¶…æ—¶é—®é¢˜11.7.5 ç¬¬å››ç‰ˆï¼šè§£å†³åº“å­˜ä¾èµ–é—®é¢˜ï¼ŒLUAè„šæœ¬12345678910111213141516local userid=KEYS[1]; local prodid=KEYS[2];local qtkey=&quot;sk:&quot;..prodid..&quot;:qt&quot;;local usersKey=&quot;sk:&quot;..prodid.&quot;:usr&#x27;; local userExists=redis.call(&quot;sismember&quot;,usersKey,userid);if tonumber(userExists)==1 then return 2;endlocal num= redis.call(&quot;get&quot; ,qtkey);if tonumber(num)&lt;=0 then return 0; else redis.call(&quot;decr&quot;,qtkey); redis.call(&quot;sadd&quot;,usersKey,userid);endreturn 1; åäºŒã€RedisæŒä¹…åŒ–ä¹‹RDB12.1 æ€»ä½“ä»‹ç»å®˜ç½‘ä»‹ç»ï¼šhttp://www.redis.io Redis æä¾›äº†2ä¸ªä¸åŒå½¢å¼çš„æŒä¹…åŒ–æ–¹å¼ã€‚ RDBï¼ˆRedis DataBaseï¼‰ AOFï¼ˆAppend Of Fileï¼‰ 12.2 RDBï¼ˆRedis DataBaseï¼‰12.2.1 å®˜ç½‘ä»‹ç» 12.2.2 æ˜¯ä»€ä¹ˆåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å°†å†…å­˜ä¸­çš„æ•°æ®é›†å¿«ç…§å†™å…¥ç£ç›˜ï¼Œ ä¹Ÿå°±æ˜¯è¡Œè¯è®²çš„Snapshotå¿«ç…§ï¼Œå®ƒæ¢å¤æ—¶æ˜¯å°†å¿«ç…§æ–‡ä»¶ç›´æ¥è¯»åˆ°å†…å­˜é‡Œ 12.2.3 å¤‡ä»½æ˜¯å¦‚ä½•æ‰§è¡Œçš„Redisä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ° ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚ æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹æ˜¯ä¸è¿›è¡Œä»»ä½•IOæ“ä½œçš„ï¼Œè¿™å°±ç¡®ä¿äº†æé«˜çš„æ€§èƒ½ å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£RDBæ–¹å¼è¦æ¯”AOFæ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚RDBçš„ç¼ºç‚¹æ˜¯æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚ 12.2.4 Fork Forkçš„ä½œç”¨æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å½“å‰è¿›ç¨‹ä¸€æ ·çš„è¿›ç¨‹ã€‚æ–°è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ˆå˜é‡ã€ç¯å¢ƒå˜é‡ã€ç¨‹åºè®¡æ•°å™¨ç­‰ï¼‰ æ•°å€¼éƒ½å’ŒåŸè¿›ç¨‹ä¸€è‡´ï¼Œä½†æ˜¯æ˜¯ä¸€ä¸ªå…¨æ–°çš„è¿›ç¨‹ï¼Œå¹¶ä½œä¸ºåŸè¿›ç¨‹çš„å­è¿›ç¨‹ åœ¨Linuxç¨‹åºä¸­ï¼Œfork()ä¼šäº§ç”Ÿä¸€ä¸ªå’Œçˆ¶è¿›ç¨‹å®Œå…¨ç›¸åŒçš„å­è¿›ç¨‹ï¼Œä½†å­è¿›ç¨‹åœ¨æ­¤åå¤šä¼šexecç³»ç»Ÿè°ƒç”¨ï¼Œå‡ºäºæ•ˆç‡è€ƒè™‘ï¼ŒLinuxä¸­å¼•å…¥äº†â€œå†™æ—¶å¤åˆ¶æŠ€æœ¯â€ ä¸€èˆ¬æƒ…å†µçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¼šå…±ç”¨åŒä¸€æ®µç‰©ç†å†…å­˜ï¼Œåªæœ‰è¿›ç¨‹ç©ºé—´çš„å„æ®µçš„å†…å®¹è¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰ä¼šå°†çˆ¶è¿›ç¨‹çš„å†…å®¹å¤åˆ¶ä¸€ä»½ç»™å­è¿›ç¨‹ã€‚ 12.2.5 RDBæŒä¹…åŒ–æµç¨‹ 12.2.6 dump.rdbæ–‡ä»¶åœ¨redis.confä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸ºdump.rdb 12.2.7 é…ç½®ä½ç½®rdbæ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚é»˜è®¤ä¸ºRediså¯åŠ¨æ—¶å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•ä¸‹ dir â€œ/myredis/â€œ 12.2.8 å¦‚ä½•è§¦å‘RDBå¿«ç…§ï¼›ä¿æŒç­–ç•¥ é…ç½®æ–‡ä»¶ä¸­é»˜è®¤çš„å¿«ç…§é…ç½® å‘½ä»¤save VS bgsave save ï¼šsaveæ—¶åªç®¡ä¿å­˜ï¼Œå…¶å®ƒä¸ç®¡ï¼Œå…¨éƒ¨é˜»å¡ã€‚æ‰‹åŠ¨ä¿å­˜ã€‚ä¸å»ºè®®ã€‚ bgsaveï¼šRedisä¼šåœ¨åå°å¼‚æ­¥è¿›è¡Œå¿«ç…§æ“ä½œï¼Œ å¿«ç…§åŒæ—¶è¿˜å¯ä»¥å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚ å¯ä»¥é€šè¿‡lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡æˆåŠŸæ‰§è¡Œå¿«ç…§çš„æ—¶é—´ flushallå‘½ä»¤ æ‰§è¡Œflushallå‘½ä»¤ï¼Œä¹Ÿä¼šäº§ç”Ÿdump.rdbæ–‡ä»¶ï¼Œä½†é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ— æ„ä¹‰ SNAPSHOTTINGå¿«ç…§ Save æ ¼å¼ï¼šsave ç§’é’Ÿ å†™æ“ä½œæ¬¡æ•° RDBæ˜¯æ•´ä¸ªå†…å­˜çš„å‹ç¼©è¿‡çš„Snapshotï¼ŒRDBçš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥é…ç½®å¤åˆçš„å¿«ç…§è§¦å‘æ¡ä»¶ï¼Œ é»˜è®¤æ˜¯1åˆ†é’Ÿå†…æ”¹äº†1ä¸‡æ¬¡ï¼Œæˆ–5åˆ†é’Ÿå†…æ”¹äº†10æ¬¡ï¼Œæˆ–15åˆ†é’Ÿå†…æ”¹äº†1æ¬¡ã€‚ ç¦ç”¨ ä¸è®¾ç½®saveæŒ‡ä»¤ï¼Œæˆ–è€…ç»™saveä¼ å…¥ç©ºå­—ç¬¦ä¸² stop-writes-on-bgsave-error å½“Redisæ— æ³•å†™å…¥ç£ç›˜çš„è¯ï¼Œç›´æ¥å…³æ‰Redisçš„å†™æ“ä½œã€‚æ¨èyes. rdbcompression å‹ç¼©æ–‡ä»¶ å¯¹äºå­˜å‚¨åˆ°ç£ç›˜ä¸­çš„å¿«ç…§ï¼Œå¯ä»¥è®¾ç½®æ˜¯å¦è¿›è¡Œå‹ç¼©å­˜å‚¨ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œredisä¼šé‡‡ç”¨LZFç®—æ³•è¿›è¡Œå‹ç¼©ã€‚ å¦‚æœä½ ä¸æƒ³æ¶ˆè€—CPUæ¥è¿›è¡Œå‹ç¼©çš„è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºå…³é—­æ­¤åŠŸèƒ½ã€‚æ¨èyes. rdbchecksum æ£€æŸ¥å®Œæ•´æ€§ åœ¨å­˜å‚¨å¿«ç…§åï¼Œè¿˜å¯ä»¥è®©redisä½¿ç”¨CRC64ç®—æ³•æ¥è¿›è¡Œæ•°æ®æ ¡éªŒï¼Œ ä½†æ˜¯è¿™æ ·åšä¼šå¢åŠ å¤§çº¦10%çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¦‚æœå¸Œæœ›è·å–åˆ°æœ€å¤§çš„æ€§èƒ½æå‡ï¼Œå¯ä»¥å…³é—­æ­¤åŠŸèƒ½ æ¨èyes. rdbçš„å¤‡ä»½ å…ˆé€šè¿‡config get dir æŸ¥è¯¢rdbæ–‡ä»¶çš„ç›®å½• å°†*.rdbçš„æ–‡ä»¶æ‹·è´åˆ°åˆ«çš„åœ°æ–¹ rdbçš„æ¢å¤ å…³é—­Redis å…ˆæŠŠå¤‡ä»½çš„æ–‡ä»¶æ‹·è´åˆ°å·¥ä½œç›®å½•ä¸‹ cp dump2.rdb dump.rdb å¯åŠ¨Redis, å¤‡ä»½æ•°æ®ä¼šç›´æ¥åŠ è½½ 12.2.9 ä¼˜åŠ¿ é€‚åˆå¤§è§„æ¨¡çš„æ•°æ®æ¢å¤ å¯¹æ•°æ®å®Œæ•´æ€§å’Œä¸€è‡´æ€§è¦æ±‚ä¸é«˜æ›´é€‚åˆä½¿ç”¨ èŠ‚çœç£ç›˜ç©ºé—´ æ¢å¤é€Ÿåº¦å¿« 12.2.10 åŠ£åŠ¿l Forkçš„æ—¶å€™ï¼Œå†…å­˜ä¸­çš„æ•°æ®è¢«å…‹éš†äº†ä¸€ä»½ï¼Œå¤§è‡´2å€çš„è†¨èƒ€æ€§éœ€è¦è€ƒè™‘ l è™½ç„¶Redisåœ¨forkæ—¶ä½¿ç”¨äº†å†™æ—¶æ‹·è´æŠ€æœ¯,ä½†æ˜¯å¦‚æœæ•°æ®åºå¤§æ—¶è¿˜æ˜¯æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚ l åœ¨å¤‡ä»½å‘¨æœŸåœ¨ä¸€å®šé—´éš”æ—¶é—´åšä¸€æ¬¡å¤‡ä»½ï¼Œæ‰€ä»¥å¦‚æœRedisæ„å¤–downæ‰çš„è¯ï¼Œå°±ä¼šä¸¢å¤±æœ€åä¸€æ¬¡å¿«ç…§åçš„æ‰€æœ‰ä¿®æ”¹ã€‚ 12.2.11 å¦‚ä½•åœæ­¢åŠ¨æ€åœæ­¢RDBï¼šredis-cli config set save â€œâ€#saveåç»™ç©ºå€¼ï¼Œè¡¨ç¤ºç¦ç”¨ä¿å­˜ç­–ç•¥ 12.2.12 å°æ€»ç»“ åä¸‰ã€RedisæŒä¹…åŒ–ä¹‹AOF13.1 AOFï¼ˆAppend Only Fileï¼‰13.1.1 æ˜¯ä»€ä¹ˆä»¥æ—¥å¿—çš„å½¢å¼æ¥è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆå¢é‡ä¿å­˜ï¼‰ï¼Œå°†Redisæ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥(è¯»æ“ä½œä¸è®°å½•)ï¼Œ åªè®¸è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨ä¹‹åˆä¼šè¯»å–è¯¥æ–‡ä»¶é‡æ–°æ„å»ºæ•°æ®ï¼Œæ¢è¨€ä¹‹ï¼Œredis é‡å¯çš„è¯å°±æ ¹æ®æ—¥å¿—æ–‡ä»¶çš„å†…å®¹å°†å†™æŒ‡ä»¤ä»å‰åˆ°åæ‰§è¡Œä¸€æ¬¡ä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œ 13.1.2 AOFæŒä¹…åŒ–æµç¨‹ï¼ˆ1ï¼‰å®¢æˆ·ç«¯çš„è¯·æ±‚å†™å‘½ä»¤ä¼šè¢«appendè¿½åŠ åˆ°AOFç¼“å†²åŒºå†…ï¼› ï¼ˆ2ï¼‰AOFç¼“å†²åŒºæ ¹æ®AOFæŒä¹…åŒ–ç­–ç•¥[always,everysec,no]å°†æ“ä½œsyncåŒæ­¥åˆ°ç£ç›˜çš„AOFæ–‡ä»¶ä¸­ï¼› ï¼ˆ3ï¼‰AOFæ–‡ä»¶å¤§å°è¶…è¿‡é‡å†™ç­–ç•¥æˆ–æ‰‹åŠ¨é‡å†™æ—¶ï¼Œä¼šå¯¹AOFæ–‡ä»¶rewriteé‡å†™ï¼Œå‹ç¼©AOFæ–‡ä»¶å®¹é‡ï¼› ï¼ˆ4ï¼‰RedisæœåŠ¡é‡å¯æ—¶ï¼Œä¼šé‡æ–°loadåŠ è½½AOFæ–‡ä»¶ä¸­çš„å†™æ“ä½œè¾¾åˆ°æ•°æ®æ¢å¤çš„ç›®çš„ï¼› 13.1.3 AOFé»˜è®¤ä¸å¼€å¯å¯ä»¥åœ¨redis.confä¸­é…ç½®æ–‡ä»¶åç§°ï¼Œé»˜è®¤ä¸º appendonly.aof AOFæ–‡ä»¶çš„ä¿å­˜è·¯å¾„ï¼ŒåŒRDBçš„è·¯å¾„ä¸€è‡´ã€‚ 13.1.4 AOFå’ŒRDBåŒæ—¶å¼€å¯ï¼Œrediså¬è°çš„ï¼ŸAOFå’ŒRDBåŒæ—¶å¼€å¯ï¼Œç³»ç»Ÿé»˜è®¤å–AOFçš„æ•°æ®ï¼ˆæ•°æ®ä¸ä¼šå­˜åœ¨ä¸¢å¤±ï¼‰ 13.1.5 AOFå¯åŠ¨/ä¿®å¤/æ¢å¤ AOFçš„å¤‡ä»½æœºåˆ¶å’Œæ€§èƒ½è™½ç„¶å’ŒRDBä¸åŒ, ä½†æ˜¯å¤‡ä»½å’Œæ¢å¤çš„æ“ä½œåŒRDBä¸€æ ·ï¼Œéƒ½æ˜¯æ‹·è´å¤‡ä»½æ–‡ä»¶ï¼Œéœ€è¦æ¢å¤æ—¶å†æ‹·è´åˆ°Rediså·¥ä½œç›®å½•ä¸‹ï¼Œå¯åŠ¨ç³»ç»Ÿå³åŠ è½½ã€‚ æ­£å¸¸æ¢å¤ ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes å°†æœ‰æ•°æ®çš„aofæ–‡ä»¶å¤åˆ¶ä¸€ä»½ä¿å­˜åˆ°å¯¹åº”ç›®å½•(æŸ¥çœ‹ç›®å½•ï¼šconfig get dir) æ¢å¤ï¼šé‡å¯redisç„¶åé‡æ–°åŠ è½½ å¼‚å¸¸æ¢å¤ ä¿®æ”¹é»˜è®¤çš„appendonly noï¼Œæ”¹ä¸ºyes å¦‚é‡åˆ°AOFæ–‡ä»¶æŸåï¼Œé€šè¿‡/usr/local/bin/redis-check-aofâ€“fix appendonly.aofè¿›è¡Œæ¢å¤ å¤‡ä»½è¢«å†™åçš„AOFæ–‡ä»¶ æ¢å¤ï¼šé‡å¯redisï¼Œç„¶åé‡æ–°åŠ è½½ 13.1.6 AOFåŒæ­¥é¢‘ç‡è®¾ç½®appendfsync always å§‹ç»ˆåŒæ­¥ï¼Œæ¯æ¬¡Redisçš„å†™å…¥éƒ½ä¼šç«‹åˆ»è®°å…¥æ—¥å¿—ï¼›æ€§èƒ½è¾ƒå·®ä½†æ•°æ®å®Œæ•´æ€§æ¯”è¾ƒå¥½ appendfsync everysec æ¯ç§’åŒæ­¥ï¼Œæ¯ç§’è®°å…¥æ—¥å¿—ä¸€æ¬¡ï¼Œå¦‚æœå®•æœºï¼Œæœ¬ç§’çš„æ•°æ®å¯èƒ½ä¸¢å¤±ã€‚ appendfsync no redisä¸ä¸»åŠ¨è¿›è¡ŒåŒæ­¥ï¼ŒæŠŠåŒæ­¥æ—¶æœºäº¤ç»™æ“ä½œç³»ç»Ÿã€‚ 13.1.7 Rewriteå‹ç¼© æ˜¯ä»€ä¹ˆï¼š AOFé‡‡ç”¨æ–‡ä»¶è¿½åŠ æ–¹å¼ï¼Œæ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ä¸ºé¿å…å‡ºç°æ­¤ç§æƒ…å†µï¼Œæ–°å¢äº†é‡å†™æœºåˆ¶, å½“AOFæ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼ŒRediså°±ä¼šå¯åŠ¨AOFæ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œ åªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†.å¯ä»¥ä½¿ç”¨å‘½ä»¤bgrewriteaof é‡å†™åŸç†ï¼Œå¦‚ä½•å®ç°é‡å†™ AOFæ–‡ä»¶æŒç»­å¢é•¿è€Œè¿‡å¤§æ—¶ï¼Œä¼šforkå‡ºä¸€æ¡æ–°è¿›ç¨‹æ¥å°†æ–‡ä»¶é‡å†™(ä¹Ÿæ˜¯å…ˆå†™ä¸´æ—¶æ–‡ä»¶æœ€åå†rename)ï¼Œredis4.0ç‰ˆæœ¬åçš„é‡å†™ï¼Œæ˜¯æŒ‡ä¸Šå°±æ˜¯æŠŠrdb çš„å¿«ç…§ï¼Œä»¥äºŒçº§åˆ¶çš„å½¢å¼é™„åœ¨æ–°çš„aofå¤´éƒ¨ï¼Œä½œä¸ºå·²æœ‰çš„å†å²æ•°æ®ï¼Œæ›¿æ¢æ‰åŸæ¥çš„æµæ°´è´¦æ“ä½œã€‚ no-appendfsync-on-rewriteï¼š å¦‚æœ no-appendfsync-on-rewrite=yes ,ä¸å†™å…¥aofæ–‡ä»¶åªå†™å…¥ç¼“å­˜ï¼Œç”¨æˆ·è¯·æ±‚ä¸ä¼šé˜»å¡ï¼Œä½†æ˜¯åœ¨è¿™æ®µæ—¶é—´å¦‚æœå®•æœºä¼šä¸¢å¤±è¿™æ®µæ—¶é—´çš„ç¼“å­˜æ•°æ®ã€‚ï¼ˆé™ä½æ•°æ®å®‰å…¨æ€§ï¼Œæé«˜æ€§èƒ½ï¼‰ å¦‚æœ no-appendfsync-on-rewrite=no, è¿˜æ˜¯ä¼šæŠŠæ•°æ®å¾€ç£ç›˜é‡Œåˆ·ï¼Œä½†æ˜¯é‡åˆ°é‡å†™æ“ä½œï¼Œå¯èƒ½ä¼šå‘ç”Ÿé˜»å¡ã€‚ï¼ˆæ•°æ®å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½é™ä½ï¼‰ è§¦å‘æœºåˆ¶ï¼Œä½•æ—¶é‡å†™ Redisä¼šè®°å½•ä¸Šæ¬¡é‡å†™æ—¶çš„AOFå¤§å°ï¼Œé»˜è®¤é…ç½®æ˜¯å½“AOFæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡rewriteåå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘ é‡å†™è™½ç„¶å¯ä»¥èŠ‚çº¦å¤§é‡ç£ç›˜ç©ºé—´ï¼Œå‡å°‘æ¢å¤æ—¶é—´ã€‚ä½†æ˜¯æ¯æ¬¡é‡å†™è¿˜æ˜¯æœ‰ä¸€å®šçš„è´Ÿæ‹…çš„ï¼Œå› æ­¤è®¾å®šRedisè¦æ»¡è¶³ä¸€å®šæ¡ä»¶æ‰ä¼šè¿›è¡Œé‡å†™ã€‚ auto-aof-rewrite-percentageï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæ–‡ä»¶è¾¾åˆ°100%æ—¶å¼€å§‹é‡å†™ï¼ˆæ–‡ä»¶æ˜¯åŸæ¥é‡å†™åæ–‡ä»¶çš„2å€æ—¶è§¦å‘ï¼‰ auto-aof-rewrite-min-sizeï¼šè®¾ç½®é‡å†™çš„åŸºå‡†å€¼ï¼Œæœ€å°æ–‡ä»¶64MBã€‚è¾¾åˆ°è¿™ä¸ªå€¼å¼€å§‹é‡å†™ã€‚ ä¾‹å¦‚ï¼šæ–‡ä»¶è¾¾åˆ°70MBå¼€å§‹é‡å†™ï¼Œé™åˆ°50MBï¼Œä¸‹æ¬¡ä»€ä¹ˆæ—¶å€™å¼€å§‹é‡å†™ï¼Ÿ100MB ç³»ç»Ÿè½½å…¥æ—¶æˆ–è€…ä¸Šæ¬¡é‡å†™å®Œæ¯•æ—¶ï¼ŒRedisä¼šè®°å½•æ­¤æ—¶AOFå¤§å°ï¼Œè®¾ä¸ºbase_size, å¦‚æœRedisçš„AOFå½“å‰å¤§å°&gt;= base_size +base_size*100% (é»˜è®¤)ä¸”å½“å‰å¤§å°&gt;=64mb(é»˜è®¤)çš„æƒ…å†µä¸‹ï¼ŒRedisä¼šå¯¹AOFè¿›è¡Œé‡å†™ã€‚ 3ã€é‡å†™æµç¨‹ ï¼ˆ1ï¼‰bgrewriteaofè§¦å‘é‡å†™ï¼Œåˆ¤æ–­æ˜¯å¦å½“å‰æœ‰bgsaveæˆ–bgrewriteaofåœ¨è¿è¡Œï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç­‰å¾…è¯¥å‘½ä»¤ç»“æŸåå†ç»§ç»­æ‰§è¡Œã€‚ ï¼ˆ2ï¼‰ä¸»è¿›ç¨‹forkå‡ºå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œä¿è¯ä¸»è¿›ç¨‹ä¸ä¼šé˜»å¡ã€‚ ï¼ˆ3ï¼‰å­è¿›ç¨‹éå†rediså†…å­˜ä¸­æ•°æ®åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯çš„å†™è¯·æ±‚åŒæ—¶å†™å…¥aof_bufç¼“å†²åŒºå’Œaof_rewrite_bufé‡å†™ç¼“å†²åŒºä¿è¯åŸAOFæ–‡ä»¶å®Œæ•´ä»¥åŠæ–°AOFæ–‡ä»¶ç”ŸæˆæœŸé—´çš„æ–°çš„æ•°æ®ä¿®æ”¹åŠ¨ä½œä¸ä¼šä¸¢å¤±ã€‚ ï¼ˆ4ï¼‰1).å­è¿›ç¨‹å†™å®Œæ–°çš„AOFæ–‡ä»¶åï¼Œå‘ä¸»è¿›ç¨‹å‘ä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ã€‚2).ä¸»è¿›ç¨‹æŠŠaof_rewrite_bufä¸­çš„æ•°æ®å†™å…¥åˆ°æ–°çš„AOFæ–‡ä»¶ã€‚ ï¼ˆ5ï¼‰ä½¿ç”¨æ–°çš„AOFæ–‡ä»¶è¦†ç›–æ—§çš„AOFæ–‡ä»¶ï¼Œå®ŒæˆAOFé‡å†™ã€‚ 13.1.8 ä¼˜åŠ¿ å¤‡ä»½æœºåˆ¶æ›´ç¨³å¥ï¼Œä¸¢å¤±æ•°æ®æ¦‚ç‡æ›´ä½ã€‚ å¯è¯»çš„æ—¥å¿—æ–‡æœ¬ï¼Œé€šè¿‡æ“ä½œAOFç¨³å¥ï¼Œå¯ä»¥å¤„ç†è¯¯æ“ä½œã€‚ 13.1.9 åŠ£åŠ¿ æ¯”èµ·RDBå ç”¨æ›´å¤šçš„ç£ç›˜ç©ºé—´ã€‚ æ¢å¤å¤‡ä»½é€Ÿåº¦è¦æ…¢ã€‚ æ¯æ¬¡è¯»å†™éƒ½åŒæ­¥çš„è¯ï¼Œæœ‰ä¸€å®šçš„æ€§èƒ½å‹åŠ›ã€‚ å­˜åœ¨ä¸ªåˆ«Bugï¼Œé€ æˆæ¢å¤ä¸èƒ½ã€‚ 13.1.10 å°æ€»ç»“ 13.2 æ€»ç»“(Which one)13.2.1 ç”¨å“ªä¸ªå¥½å®˜æ–¹æ¨èä¸¤ä¸ªéƒ½å¯ç”¨ã€‚ å¦‚æœå¯¹æ•°æ®ä¸æ•æ„Ÿï¼Œå¯ä»¥é€‰å•ç‹¬ç”¨RDBã€‚ ä¸å»ºè®®å•ç‹¬ç”¨ AOFï¼Œå› ä¸ºå¯èƒ½ä¼šå‡ºç°Bugã€‚ å¦‚æœåªæ˜¯åšçº¯å†…å­˜ç¼“å­˜ï¼Œå¯ä»¥éƒ½ä¸ç”¨ã€‚ 13.2.2 å®˜ç½‘å»ºè®® RDBæŒä¹…åŒ–æ–¹å¼èƒ½å¤Ÿåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”èƒ½å¯¹ä½ çš„æ•°æ®è¿›è¡Œå¿«ç…§å­˜å‚¨ AOFæŒä¹…åŒ–æ–¹å¼è®°å½•æ¯æ¬¡å¯¹æœåŠ¡å™¨å†™çš„æ“ä½œ,å½“æœåŠ¡å™¨é‡å¯çš„æ—¶å€™ä¼šé‡æ–°æ‰§è¡Œè¿™äº›å‘½ä»¤æ¥æ¢å¤åŸå§‹çš„æ•°æ®,AOFå‘½ä»¤ä»¥redisåè®®è¿½åŠ ä¿å­˜æ¯æ¬¡å†™çš„æ“ä½œåˆ°æ–‡ä»¶æœ«å°¾. Redisè¿˜èƒ½å¯¹AOFæ–‡ä»¶è¿›è¡Œåå°é‡å†™,ä½¿å¾—AOFæ–‡ä»¶çš„ä½“ç§¯ä¸è‡³äºè¿‡å¤§ åªåšç¼“å­˜ï¼šå¦‚æœä½ åªå¸Œæœ›ä½ çš„æ•°æ®åœ¨æœåŠ¡å™¨è¿è¡Œçš„æ—¶å€™å­˜åœ¨,ä½ ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨ä»»ä½•æŒä¹…åŒ–æ–¹å¼. åŒæ—¶å¼€å¯ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ åœ¨è¿™ç§æƒ…å†µä¸‹,å½“redisé‡å¯çš„æ—¶å€™ä¼šä¼˜å…ˆè½½å…¥AOFæ–‡ä»¶æ¥æ¢å¤åŸå§‹çš„æ•°æ®, å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹AOFæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦æ¯”RDBæ–‡ä»¶ä¿å­˜çš„æ•°æ®é›†è¦å®Œæ•´. RDBçš„æ•°æ®ä¸å®æ—¶ï¼ŒåŒæ—¶ä½¿ç”¨ä¸¤è€…æ—¶æœåŠ¡å™¨é‡å¯ä¹Ÿåªä¼šæ‰¾AOFæ–‡ä»¶ã€‚é‚£è¦ä¸è¦åªä½¿ç”¨AOFå‘¢ï¼Ÿ å»ºè®®ä¸è¦ï¼Œå› ä¸ºRDBæ›´é€‚åˆç”¨äºå¤‡ä»½æ•°æ®åº“(AOFåœ¨ä¸æ–­å˜åŒ–ä¸å¥½å¤‡ä»½)ï¼Œ å¿«é€Ÿé‡å¯ï¼Œè€Œä¸”ä¸ä¼šæœ‰AOFå¯èƒ½æ½œåœ¨çš„bugï¼Œç•™ç€ä½œä¸ºä¸€ä¸ªä¸‡ä¸€çš„æ‰‹æ®µã€‚ æ€§èƒ½å»ºè®® 123456å› ä¸ºRDBæ–‡ä»¶åªç”¨ä½œåå¤‡ç”¨é€”ï¼Œå»ºè®®åªåœ¨Slaveä¸ŠæŒä¹…åŒ–RDBæ–‡ä»¶ï¼Œè€Œä¸”åªè¦15åˆ†é’Ÿå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ï¼Œåªä¿ç•™save 900 1è¿™æ¡è§„åˆ™ã€‚ å¦‚æœä½¿ç”¨AOFï¼Œå¥½å¤„æ˜¯åœ¨æœ€æ¶åŠ£æƒ…å†µä¸‹ä¹Ÿåªä¼šä¸¢å¤±ä¸è¶…è¿‡ä¸¤ç§’æ•°æ®ï¼Œå¯åŠ¨è„šæœ¬è¾ƒç®€å•åªloadè‡ªå·±çš„AOFæ–‡ä»¶å°±å¯ä»¥äº†ã€‚ä»£ä»·,ä¸€æ˜¯å¸¦æ¥äº†æŒç»­çš„IOï¼ŒäºŒæ˜¯AOF rewriteçš„æœ€åå°†rewriteè¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ–°æ•°æ®å†™åˆ°æ–°æ–‡ä»¶é€ æˆçš„é˜»å¡å‡ ä¹æ˜¯ä¸å¯é¿å…çš„ã€‚åªè¦ç¡¬ç›˜è®¸å¯ï¼Œåº”è¯¥å°½é‡å‡å°‘AOF rewriteçš„é¢‘ç‡ï¼ŒAOFé‡å†™çš„åŸºç¡€å¤§å°é»˜è®¤å€¼64Må¤ªå°äº†ï¼Œå¯ä»¥è®¾åˆ°5Gä»¥ä¸Šã€‚é»˜è®¤è¶…è¿‡åŸå¤§å°100%å¤§å°æ—¶é‡å†™å¯ä»¥æ”¹åˆ°é€‚å½“çš„æ•°å€¼ã€‚ åå››ã€Redis_ä¸»ä»å¤åˆ¶14.1 æ˜¯ä»€ä¹ˆä¸»æœºæ•°æ®æ›´æ–°åæ ¹æ®é…ç½®å’Œç­–ç•¥ï¼Œ è‡ªåŠ¨åŒæ­¥åˆ°å¤‡æœºçš„master/slaveræœºåˆ¶ï¼ŒMasterä»¥å†™ä¸ºä¸»ï¼ŒSlaveä»¥è¯»ä¸ºä¸» 14.2 èƒ½å¹²å˜› è¯»å†™åˆ†ç¦»ï¼Œæ€§èƒ½æ‰©å±• å®¹ç¾å¿«é€Ÿæ¢å¤ 14.3 æ€ä¹ˆç©ï¼šä¸»ä»å¤åˆ¶æ‹·è´å¤šä¸ªredis.confæ–‡ä»¶include(å†™ç»å¯¹è·¯å¾„) å¼€å¯daemonize yes Pidæ–‡ä»¶åå­—pidfile æŒ‡å®šç«¯å£port Logæ–‡ä»¶åå­— dump.rdbåå­—dbfilename Appendonly å…³æ‰æˆ–è€…æ¢åå­— 14.3.1 æ–°å»ºredis6379.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹include /myredis/redis.conf pidfile /var/run/redis_6379.pid port 6379 dbfilename dump6379.rdb 14.3.2 æ–°å»ºredis6380.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹ 14.3.3 æ–°å»ºredis6381.confï¼Œå¡«å†™ä»¥ä¸‹å†…å®¹ slave-priority 10 è®¾ç½®ä»æœºçš„ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œç”¨äºé€‰ä¸¾ä¸»æœºæ—¶ä½¿ç”¨ã€‚é»˜è®¤100 14.3.4 å¯åŠ¨ä¸‰å°redisæœåŠ¡å™¨ 14.3.5 æŸ¥çœ‹ç³»ç»Ÿè¿›ç¨‹ï¼Œçœ‹çœ‹ä¸‰å°æœåŠ¡å™¨æ˜¯å¦å¯åŠ¨ 14.3.6 æŸ¥çœ‹ä¸‰å°ä¸»æœºè¿è¡Œæƒ…å†µinfo replication æ‰“å°ä¸»ä»å¤åˆ¶çš„ç›¸å…³ä¿¡æ¯ 14.3.7 é…ä»(åº“)ä¸é…ä¸»(åº“)slaveof æˆä¸ºæŸä¸ªå®ä¾‹çš„ä»æœåŠ¡å™¨ 1ã€åœ¨6380å’Œ6381ä¸Šæ‰§è¡Œ: slaveof 127.0.0.1 6379 2ã€åœ¨ä¸»æœºä¸Šå†™ï¼Œåœ¨ä»æœºä¸Šå¯ä»¥è¯»å–æ•°æ® åœ¨ä»æœºä¸Šå†™æ•°æ®æŠ¥é”™ 3ã€ä¸»æœºæŒ‚æ‰ï¼Œé‡å¯å°±è¡Œï¼Œä¸€åˆ‡å¦‚åˆ 4ã€ä»æœºé‡å¯éœ€é‡è®¾ï¼šslaveof 127.0.0.1 6379 å¯ä»¥å°†é…ç½®å¢åŠ åˆ°æ–‡ä»¶ä¸­ã€‚æ°¸ä¹…ç”Ÿæ•ˆã€‚ 14.4 å¸¸ç”¨3æ‹›14.4.1 ä¸€ä¸»äºŒä»†åˆ‡å…¥ç‚¹é—®é¢˜ï¼Ÿslave1ã€slave2æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶è¿˜æ˜¯ä»åˆ‡å…¥ç‚¹å¼€å§‹å¤åˆ¶?æ¯”å¦‚ä»k4è¿›æ¥ï¼Œé‚£ä¹‹å‰çš„k1,k2,k3æ˜¯å¦ä¹Ÿå¯ä»¥å¤åˆ¶ï¼Ÿ ä»æœºæ˜¯å¦å¯ä»¥å†™ï¼Ÿsetå¯å¦ï¼Ÿ ä¸»æœºshutdownåæƒ…å†µå¦‚ä½•ï¼Ÿä»æœºæ˜¯ä¸Šä½è¿˜æ˜¯åŸåœ°å¾…å‘½ï¼Ÿ ä¸»æœºåˆå›æ¥äº†åï¼Œä¸»æœºæ–°å¢è®°å½•ï¼Œä»æœºè¿˜èƒ½å¦é¡ºåˆ©å¤åˆ¶ï¼Ÿ å…¶ä¸­ä¸€å°ä»æœºdownåæƒ…å†µå¦‚ä½•ï¼Ÿä¾ç…§åŸæœ‰å®ƒèƒ½è·Ÿä¸Šå¤§éƒ¨é˜Ÿå—ï¼Ÿ 14.4.2 è–ªç«ç›¸ä¼ ä¸Šä¸€ä¸ªSlaveå¯ä»¥æ˜¯ä¸‹ä¸€ä¸ªslaveçš„Masterï¼ŒSlaveåŒæ ·å¯ä»¥æ¥æ”¶å…¶ä»– slavesçš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œé‚£ä¹ˆè¯¥slaveä½œä¸ºäº†é“¾æ¡ä¸­ä¸‹ä¸€ä¸ªçš„master, å¯ä»¥æœ‰æ•ˆå‡è½»masterçš„å†™å‹åŠ›,å»ä¸­å¿ƒåŒ–é™ä½é£é™©ã€‚ ç”¨ slaveof ä¸­é€”å˜æ›´è½¬å‘:ä¼šæ¸…é™¤ä¹‹å‰çš„æ•°æ®ï¼Œé‡æ–°å»ºç«‹æ‹·è´æœ€æ–°çš„ é£é™©æ˜¯ä¸€æ—¦æŸä¸ªslaveå®•æœºï¼Œåé¢çš„slaveéƒ½æ²¡æ³•å¤‡ä»½ ä¸»æœºæŒ‚äº†ï¼Œä»æœºè¿˜æ˜¯ä»æœºï¼Œæ— æ³•å†™æ•°æ®äº† 14.4.3 åå®¢ä¸ºä¸»å½“ä¸€ä¸ªmasterå®•æœºåï¼Œåé¢çš„slaveå¯ä»¥ç«‹åˆ»å‡ä¸ºmasterï¼Œå…¶åé¢çš„slaveä¸ç”¨åšä»»ä½•ä¿®æ”¹ã€‚ ç”¨ slaveof no one å°†ä»æœºå˜ä¸ºä¸»æœºã€‚ 14.5 å¤åˆ¶åŸç† Slaveå¯åŠ¨æˆåŠŸè¿æ¥åˆ°masteråä¼šå‘é€ä¸€ä¸ªsyncå‘½ä»¤ Masteræ¥åˆ°å‘½ä»¤å¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œ åœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œmasterå°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ°slave,ä»¥å®Œæˆä¸€æ¬¡å®Œå…¨åŒæ­¥ å…¨é‡å¤åˆ¶ï¼šè€ŒslaveæœåŠ¡åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ å¢é‡å¤åˆ¶ï¼šMasterç»§ç»­å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™slave,å®ŒæˆåŒæ­¥ ä½†æ˜¯åªè¦æ˜¯é‡æ–°è¿æ¥master,ä¸€æ¬¡å®Œå…¨åŒæ­¥ï¼ˆå…¨é‡å¤åˆ¶)å°†è¢«è‡ªåŠ¨æ‰§è¡Œ 14.6 å“¨å…µæ¨¡å¼(sentinel)14.6.1 æ˜¯ä»€ä¹ˆåå®¢ä¸ºä¸»çš„è‡ªåŠ¨ç‰ˆï¼Œèƒ½å¤Ÿåå°ç›‘æ§ä¸»æœºæ˜¯å¦æ•…éšœï¼Œå¦‚æœæ•…éšœäº†æ ¹æ®æŠ•ç¥¨æ•°è‡ªåŠ¨å°†ä»åº“è½¬æ¢ä¸ºä¸»åº“ 14.6.2 æ€ä¹ˆç©(ä½¿ç”¨æ­¥éª¤) è°ƒæ•´ä¸ºä¸€ä¸»äºŒä»†æ¨¡å¼ï¼Œ6379å¸¦ç€6380ã€6381 è‡ªå®šä¹‰çš„/myredisç›®å½•ä¸‹æ–°å»ºsentinel.confæ–‡ä»¶ï¼Œåå­—ç»ä¸èƒ½é”™ é…ç½®å“¨å…µ,å¡«å†™å†…å®¹ sentinel monitor mymaster 127.0.0.1 6379 1 å…¶ä¸­mymasterä¸ºç›‘æ§å¯¹è±¡èµ·çš„æœåŠ¡å™¨åç§°ï¼Œ 1 ä¸ºè‡³å°‘æœ‰å¤šå°‘ä¸ªå“¨å…µåŒæ„è¿ç§»çš„æ•°é‡ã€‚ å¯åŠ¨å“¨å…µ /usr/local/bin redisåšå‹æµ‹å¯ä»¥ç”¨è‡ªå¸¦çš„redis-benchmarkå·¥å…· æ‰§è¡Œredis-sentinel /myredis/sentinel.conf å½“ä¸»æœºæŒ‚æ‰ï¼Œä»æœºé€‰ä¸¾ä¸­äº§ç”Ÿæ–°çš„ä¸»æœº (å¤§æ¦‚10ç§’å·¦å³å¯ä»¥çœ‹åˆ°å“¨å…µçª—å£æ—¥å¿—ï¼Œåˆ‡æ¢äº†æ–°çš„ä¸»æœº) å“ªä¸ªä»æœºä¼šè¢«é€‰ä¸¾ä¸ºä¸»æœºå‘¢ï¼Ÿæ ¹æ®ä¼˜å…ˆçº§åˆ«ï¼šslave-priority åŸä¸»æœºé‡å¯åä¼šå˜ä¸ºä»æœºã€‚ å¤åˆ¶å»¶æ—¶ ç”±äºæ‰€æœ‰çš„å†™æ“ä½œéƒ½æ˜¯å…ˆåœ¨Masterä¸Šæ“ä½œï¼Œç„¶ååŒæ­¥æ›´æ–°åˆ°Slaveä¸Šï¼Œæ‰€ä»¥ä»MasteråŒæ­¥åˆ°Slaveæœºå™¨æœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œå½“ç³»ç»Ÿå¾ˆç¹å¿™çš„æ—¶å€™ï¼Œå»¶è¿Ÿé—®é¢˜ä¼šæ›´åŠ ä¸¥é‡ï¼ŒSlaveæœºå™¨æ•°é‡çš„å¢åŠ ä¹Ÿä¼šä½¿è¿™ä¸ªé—®é¢˜æ›´åŠ ä¸¥é‡ã€‚ 14.6.3 æ•…éšœæ¢å¤ ä¼˜å…ˆçº§åœ¨redis.confä¸­é»˜è®¤ï¼šslave-priority 100ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ åç§»é‡æ˜¯æŒ‡è·å¾—åŸä¸»æœºæ•°æ®æœ€å…¨çš„ æ¯ä¸ªrediså®ä¾‹å¯åŠ¨åéƒ½ä¼šéšæœºç”Ÿæˆä¸€ä¸ª40ä½çš„runid 14.6.4 ä¸»ä»å¤åˆ¶123456789101112131415161718192021private static JedisSentinelPool jedisSentinelPool=null;public static Jedis getJedisFromSentinel()&#123;if(jedisSentinelPool==null)&#123; Set&lt;String&gt; sentinelSet=new HashSet&lt;&gt;(); sentinelSet.add(&quot;192.168.11.103:26379&quot;); JedisPoolConfig jedisPoolConfig =new JedisPoolConfig(); jedisPoolConfig.setMaxTotal(10); //æœ€å¤§å¯ç”¨è¿æ¥æ•°jedisPoolConfig.setMaxIdle(5); //æœ€å¤§é—²ç½®è¿æ¥æ•°jedisPoolConfig.setMinIdle(5); //æœ€å°é—²ç½®è¿æ¥æ•°jedisPoolConfig.setBlockWhenExhausted(true); //è¿æ¥è€—å°½æ˜¯å¦ç­‰å¾…jedisPoolConfig.setMaxWaitMillis(2000); //ç­‰å¾…æ—¶é—´jedisPoolConfig.setTestOnBorrow(true); //å–è¿æ¥çš„æ—¶å€™è¿›è¡Œä¸€ä¸‹æµ‹è¯• ping pongjedisSentinelPool=new JedisSentinelPool(&quot;mymaster&quot;,sentinelSet,jedisPoolConfig);return jedisSentinelPool.getResource(); &#125;else&#123;return jedisSentinelPool.getResource(); &#125;&#125; åäº”ã€Redisé›†ç¾¤15.1 é—®é¢˜å®¹é‡ä¸å¤Ÿï¼Œrediså¦‚ä½•è¿›è¡Œæ‰©å®¹ï¼Ÿ å¹¶å‘å†™æ“ä½œï¼Œ rediså¦‚ä½•åˆ†æ‘Šï¼Ÿ å¦å¤–ï¼Œä¸»ä»æ¨¡å¼ï¼Œè–ªç«ç›¸ä¼ æ¨¡å¼ï¼Œä¸»æœºå®•æœºï¼Œå¯¼è‡´ipåœ°å€å‘ç”Ÿå˜åŒ–ï¼Œåº”ç”¨ç¨‹åºä¸­é…ç½®éœ€è¦ä¿®æ”¹å¯¹åº”çš„ä¸»æœºåœ°å€ã€ç«¯å£ç­‰ä¿¡æ¯ã€‚ ä¹‹å‰é€šè¿‡ä»£ç†ä¸»æœºæ¥è§£å†³ï¼Œä½†æ˜¯redis3.0ä¸­æä¾›äº†è§£å†³æ–¹æ¡ˆã€‚å°±æ˜¯æ— ä¸­å¿ƒåŒ–é›†ç¾¤é…ç½®ã€‚ 15.2 ä»€ä¹ˆæ˜¯é›†ç¾¤Redis é›†ç¾¤å®ç°äº†å¯¹Redisçš„æ°´å¹³æ‰©å®¹ï¼Œå³å¯åŠ¨Nä¸ªredisèŠ‚ç‚¹ï¼Œå°†æ•´ä¸ªæ•°æ®åº“åˆ†å¸ƒå­˜å‚¨åœ¨è¿™Nä¸ªèŠ‚ç‚¹ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨æ€»æ•°æ®çš„1/Nã€‚ Redis é›†ç¾¤é€šè¿‡åˆ†åŒºï¼ˆpartitionï¼‰æ¥æä¾›ä¸€å®šç¨‹åº¦çš„å¯ç”¨æ€§ï¼ˆavailabilityï¼‰ï¼š å³ä½¿é›†ç¾¤ä¸­æœ‰ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¤±æ•ˆæˆ–è€…æ— æ³•è¿›è¡Œé€šè®¯ï¼Œ é›†ç¾¤ä¹Ÿå¯ä»¥ç»§ç»­å¤„ç†å‘½ä»¤è¯·æ±‚ã€‚ 15.3 åˆ é™¤æŒä¹…åŒ–æ•°æ®å°†rdb,aofæ–‡ä»¶éƒ½åˆ é™¤æ‰ã€‚ 15.4 åˆ¶ä½œ6ä¸ªå®ä¾‹ï¼Œ6379,6380,6381,6389,6390,639115.4.1 é…ç½®åŸºæœ¬ä¿¡æ¯å¼€å¯daemonize yes Pidæ–‡ä»¶åå­— æŒ‡å®šç«¯å£ Logæ–‡ä»¶åå­— Dump.rdbåå­— Appendonly å…³æ‰æˆ–è€…æ¢åå­— 15.4.2 redis clusteré…ç½®ä¿®æ”¹cluster-enabled yes æ‰“å¼€é›†ç¾¤æ¨¡å¼ cluster-config-file nodes-6379.conf è®¾å®šèŠ‚ç‚¹é…ç½®æ–‡ä»¶å cluster-node-timeout 15000 è®¾å®šèŠ‚ç‚¹å¤±è”æ—¶é—´ï¼Œè¶…è¿‡è¯¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œé›†ç¾¤è‡ªåŠ¨è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚ 123456789include /home/bigdata/redis.confport 6379pidfile &quot;/var/run/redis_6379.pid&quot;dbfilename &quot;dump6379.rdb&quot;dir &quot;/home/bigdata/redis_cluster&quot;logfile &quot;/home/bigdata/redis_cluster/redis_err_6379.log&quot;cluster-enabled yescluster-config-file nodes-6379.confcluster-node-timeout 15000 15.4.3 ä¿®æ”¹å¥½redis6379.confæ–‡ä»¶ï¼Œæ‹·è´å¤šä¸ªredis.confæ–‡ä»¶ 15.4.4 ä½¿ç”¨æŸ¥æ‰¾æ›¿æ¢ä¿®æ”¹å¦å¤–5ä¸ªæ–‡ä»¶ä¾‹å¦‚ï¼š:%s/6379/6380 15.4.5 å¯åŠ¨6ä¸ªredisæœåŠ¡ 15.5 å°†å…­ä¸ªèŠ‚ç‚¹åˆæˆä¸€ä¸ªé›†ç¾¤ç»„åˆä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€æœ‰rediså®ä¾‹å¯åŠ¨åï¼Œnodes-xxxx.confæ–‡ä»¶éƒ½ç”Ÿæˆæ­£å¸¸ã€‚ åˆä½“ï¼š cd /opt/redis-6.2.1/src 1redis-cli --cluster create --cluster-replicas 1 192.168.11.101:6379 192.168.11.101:6380 192.168.11.101:6381 192.168.11.101:6389 192.168.11.101:6390 192.168.11.101:6391 æ­¤å¤„ä¸è¦ç”¨127.0.0.1ï¼Œ è¯·ç”¨çœŸå®IPåœ°å€ â€“replicas 1 é‡‡ç”¨æœ€ç®€å•çš„æ–¹å¼é…ç½®é›†ç¾¤ï¼Œä¸€å°ä¸»æœºï¼Œä¸€å°ä»æœºï¼Œæ­£å¥½ä¸‰ç»„ã€‚ æ™®é€šæ–¹å¼ç™»å½• å¯èƒ½ç›´æ¥è¿›å…¥è¯»ä¸»æœºï¼Œå­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šå‡ºç°MOVEDé‡å®šå‘æ“ä½œã€‚æ‰€ä»¥ï¼Œåº”è¯¥ä»¥é›†ç¾¤æ–¹å¼ç™»å½•ã€‚ 15.6 -c é‡‡ç”¨é›†ç¾¤ç­–ç•¥è¿æ¥ï¼Œè®¾ç½®æ•°æ®ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°ç›¸åº”çš„å†™ä¸»æœº 15.7 é€šè¿‡ cluster nodes å‘½ä»¤æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ 15.8 redis cluster å¦‚ä½•åˆ†é…è¿™å…­ä¸ªèŠ‚ç‚¹?ä¸€ä¸ªé›†ç¾¤è‡³å°‘è¦æœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹ã€‚ é€‰é¡¹ â€“cluster-replicas 1 è¡¨ç¤ºæˆ‘ä»¬å¸Œæœ›ä¸ºé›†ç¾¤ä¸­çš„æ¯ä¸ªä¸»èŠ‚ç‚¹åˆ›å»ºä¸€ä¸ªä»èŠ‚ç‚¹ã€‚ åˆ†é…åŸåˆ™å°½é‡ä¿è¯æ¯ä¸ªä¸»æ•°æ®åº“è¿è¡Œåœ¨ä¸åŒçš„IPåœ°å€ï¼Œæ¯ä¸ªä»åº“å’Œä¸»åº“ä¸åœ¨ä¸€ä¸ªIPåœ°å€ä¸Šã€‚ 15.9 ä»€ä¹ˆæ˜¯slots[OK] All nodes agree about slots configuration. Check for open slotsâ€¦ Check slots coverageâ€¦ [OK] All 16384 slots covered. ä¸€ä¸ª Redis é›†ç¾¤åŒ…å« 16384 ä¸ªæ’æ§½ï¼ˆhash slotï¼‰ï¼Œ æ•°æ®åº“ä¸­çš„æ¯ä¸ªé”®éƒ½å±äºè¿™ 16384 ä¸ªæ’æ§½çš„å…¶ä¸­ä¸€ä¸ªï¼Œ é›†ç¾¤ä½¿ç”¨å…¬å¼ CRC16(key) % 16384 æ¥è®¡ç®—é”® key å±äºå“ªä¸ªæ§½ï¼Œ å…¶ä¸­ CRC16(key) è¯­å¥ç”¨äºè®¡ç®—é”® key çš„ CRC16 æ ¡éªŒå’Œ ã€‚ é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å¤„ç†ä¸€éƒ¨åˆ†æ’æ§½ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœä¸€ä¸ªé›†ç¾¤å¯ä»¥æœ‰ä¸»èŠ‚ç‚¹ï¼Œ å…¶ä¸­ï¼š èŠ‚ç‚¹ A è´Ÿè´£å¤„ç† 0 å·è‡³ 5460 å·æ’æ§½ã€‚ èŠ‚ç‚¹ B è´Ÿè´£å¤„ç† 5461 å·è‡³ 10922 å·æ’æ§½ã€‚ èŠ‚ç‚¹ C è´Ÿè´£å¤„ç† 10923 å·è‡³ 16383 å·æ’æ§½ã€‚ 15.10 åœ¨é›†ç¾¤ä¸­å½•å…¥å€¼åœ¨redis-cliæ¯æ¬¡å½•å…¥ã€æŸ¥è¯¢é”®å€¼ï¼Œrediséƒ½ä¼šè®¡ç®—å‡ºè¯¥keyåº”è¯¥é€å¾€çš„æ’æ§½ï¼Œå¦‚æœä¸æ˜¯è¯¥å®¢æˆ·ç«¯å¯¹åº”æœåŠ¡å™¨çš„æ’æ§½ï¼Œredisä¼šæŠ¥é”™ï¼Œå¹¶å‘ŠçŸ¥åº”å‰å¾€çš„rediså®ä¾‹åœ°å€å’Œç«¯å£ã€‚ redis-cliå®¢æˆ·ç«¯æä¾›äº† â€“c å‚æ•°å®ç°è‡ªåŠ¨é‡å®šå‘ã€‚ å¦‚ redis-cli -c â€“p 6379 ç™»å…¥åï¼Œå†å½•å…¥ã€æŸ¥è¯¢é”®å€¼å¯¹å¯ä»¥è‡ªåŠ¨é‡å®šå‘ã€‚ ä¸åœ¨ä¸€ä¸ªslotä¸‹çš„é”®å€¼ï¼Œæ˜¯ä¸èƒ½ä½¿ç”¨mget,msetç­‰å¤šé”®æ“ä½œã€‚ å¯ä»¥é€šè¿‡{}æ¥å®šä¹‰ç»„çš„æ¦‚å¿µï¼Œä»è€Œä½¿keyä¸­{}å†…ç›¸åŒå†…å®¹çš„é”®å€¼å¯¹æ”¾åˆ°ä¸€ä¸ªslotä¸­å»ã€‚ 15.11 æŸ¥è¯¢é›†ç¾¤ä¸­çš„å€¼CLUSTER GETKEYSINSLOT è¿”å› count ä¸ª slot æ§½ä¸­çš„é”®ã€‚ 15.12 æ•…éšœæ¢å¤å¦‚æœä¸»èŠ‚ç‚¹ä¸‹çº¿ï¼Ÿä»èŠ‚ç‚¹èƒ½å¦è‡ªåŠ¨å‡ä¸ºä¸»èŠ‚ç‚¹ï¼Ÿæ³¨æ„ï¼š15ç§’è¶…æ—¶ ä¸»èŠ‚ç‚¹æ¢å¤åï¼Œä¸»ä»å…³ç³»ä¼šå¦‚ä½•ï¼Ÿä¸»èŠ‚ç‚¹å›æ¥å˜æˆä»æœºã€‚ å¦‚æœæ‰€æœ‰æŸä¸€æ®µæ’æ§½çš„ä¸»ä»èŠ‚ç‚¹éƒ½å®•æ‰ï¼ŒredisæœåŠ¡æ˜¯å¦è¿˜èƒ½ç»§ç»­? å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œcluster-require-full-coverage ä¸ºyes ï¼Œé‚£ä¹ˆ ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½æŒ‚æ‰ å¦‚æœæŸä¸€æ®µæ’æ§½çš„ä¸»ä»éƒ½æŒ‚æ‰ï¼Œè€Œcluster-require-full-coverage ä¸ºno ï¼Œé‚£ä¹ˆï¼Œè¯¥æ’æ§½æ•°æ®å…¨éƒ½ä¸èƒ½ä½¿ç”¨ï¼Œä¹Ÿæ— æ³•å­˜å‚¨ã€‚ redis.confä¸­çš„å‚æ•° cluster-require-full-coverage 15.13 é›†ç¾¤çš„Jediså¼€å‘å³ä½¿è¿æ¥çš„ä¸æ˜¯ä¸»æœºï¼Œé›†ç¾¤ä¼šè‡ªåŠ¨åˆ‡æ¢ä¸»æœºå­˜å‚¨ã€‚ä¸»æœºå†™ï¼Œä»æœºè¯»ã€‚ æ— ä¸­å¿ƒåŒ–ä¸»ä»é›†ç¾¤ã€‚æ— è®ºä»å“ªå°ä¸»æœºå†™çš„æ•°æ®ï¼Œå…¶ä»–ä¸»æœºä¸Šéƒ½èƒ½è¯»åˆ°æ•°æ®ã€‚ 123456789public class JedisClusterTest &#123; public static void main(String[] args) &#123; Set&lt;HostAndPort&gt;set =new HashSet&lt;HostAndPort&gt;(); set.add(new HostAndPort(&quot;192.168.31.211&quot;,6379)); JedisCluster jedisCluster=new JedisCluster(set); jedisCluster.set(&quot;k1&quot;, &quot;v1&quot;); System.out.println(jedisCluster.get(&quot;k1&quot;)); &#125;&#125; 15.14 Redis é›†ç¾¤æä¾›äº†ä»¥ä¸‹å¥½å¤„å®ç°æ‰©å®¹ åˆ†æ‘Šå‹åŠ› æ— ä¸­å¿ƒé…ç½®ç›¸å¯¹ç®€å• 15.15 Redis é›†ç¾¤çš„ä¸è¶³å¤šé”®æ“ä½œæ˜¯ä¸è¢«æ”¯æŒçš„ å¤šé”®çš„Redisäº‹åŠ¡æ˜¯ä¸è¢«æ”¯æŒçš„ã€‚luaè„šæœ¬ä¸è¢«æ”¯æŒ ç”±äºé›†ç¾¤æ–¹æ¡ˆå‡ºç°è¾ƒæ™šï¼Œå¾ˆå¤šå…¬å¸å·²ç»é‡‡ç”¨äº†å…¶ä»–çš„é›†ç¾¤æ–¹æ¡ˆï¼Œè€Œä»£ç†æˆ–è€…å®¢æˆ·ç«¯åˆ†ç‰‡çš„æ–¹æ¡ˆæƒ³è¦è¿ç§»è‡³redis clusterï¼Œéœ€è¦æ•´ä½“è¿ç§»è€Œä¸æ˜¯é€æ­¥è¿‡æ¸¡ï¼Œå¤æ‚åº¦è¾ƒå¤§ã€‚ åå…­ã€Redisåº”ç”¨é—®é¢˜è§£å†³16.1 ç¼“å­˜ç©¿é€16.1.1 é—®é¢˜æè¿°keyå¯¹åº”çš„æ•°æ®åœ¨æ•°æ®æºå¹¶ä¸å­˜åœ¨ï¼Œæ¯æ¬¡é’ˆå¯¹æ­¤keyçš„è¯·æ±‚ä»ç¼“å­˜è·å–ä¸åˆ°ï¼Œè¯·æ±‚éƒ½ä¼šå‹åˆ°æ•°æ®æºï¼Œä»è€Œå¯èƒ½å‹å®æ•°æ®æºã€‚æ¯”å¦‚ç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„ç”¨æˆ·idè·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä¸è®ºç¼“å­˜è¿˜æ˜¯æ•°æ®åº“éƒ½æ²¡æœ‰ï¼Œè‹¥é»‘å®¢åˆ©ç”¨æ­¤æ¼æ´è¿›è¡Œæ”»å‡»å¯èƒ½å‹å®æ•°æ®åº“ã€‚ 16.1.2 è§£å†³æ–¹æ¡ˆä¸€ä¸ªä¸€å®šä¸å­˜åœ¨ç¼“å­˜åŠæŸ¥è¯¢ä¸åˆ°çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚ è§£å†³æ–¹æ¡ˆï¼š ï¼ˆ1ï¼‰ å¯¹ç©ºå€¼ç¼“å­˜ï¼šå¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®æ˜¯å¦ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœï¼ˆnullï¼‰è¿›è¡Œç¼“å­˜ï¼Œè®¾ç½®ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿ ï¼ˆ2ï¼‰ è®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰ï¼š ä½¿ç”¨bitmapsç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå•idä½œä¸ºbitmapsçš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œbitmapé‡Œé¢çš„idè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè®¿é—®idä¸åœ¨bitmapsé‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚ ï¼ˆ3ï¼‰ é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼š(å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡(ä½å›¾)å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ã€‚ å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚) å°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„bitmapsä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢« è¿™ä¸ªbitmapsæ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚ ï¼ˆ4ï¼‰ è¿›è¡Œå®æ—¶ç›‘æ§ï¼šå½“å‘ç°Redisçš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ç½®é»‘åå•é™åˆ¶æœåŠ¡ 16.2 ç¼“å­˜å‡»ç©¿16.2.1 é—®é¢˜æè¿°keyå¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨redisä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚ 16.2.2 è§£å†³æ–¹æ¡ˆkeyå¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸â€œçƒ­ç‚¹â€çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜è¢«â€œå‡»ç©¿â€çš„é—®é¢˜ã€‚ è§£å†³é—®é¢˜ï¼š ï¼ˆ1ï¼‰é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®ï¼šåœ¨redisé«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ°redisé‡Œé¢ï¼ŒåŠ å¤§è¿™äº›çƒ­é—¨æ•°æ®keyçš„æ—¶é•¿ ï¼ˆ2ï¼‰å®æ—¶è°ƒæ•´ï¼šç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´keyçš„è¿‡æœŸæ—¶é•¿ ï¼ˆ3ï¼‰ä½¿ç”¨é”ï¼š ï¼ˆ1ï¼‰ å°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbã€‚ ï¼ˆ2ï¼‰ å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚Redisçš„SETNXï¼‰å»setä¸€ä¸ªmutex key ï¼ˆ3ï¼‰ å½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œload dbçš„æ“ä½œï¼Œå¹¶å›è®¾ç¼“å­˜,æœ€ååˆ é™¤mutex keyï¼› ï¼ˆ4ï¼‰ å½“æ“ä½œè¿”å›å¤±è´¥ï¼Œè¯æ˜æœ‰çº¿ç¨‹åœ¨load dbï¼Œå½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´å†é‡è¯•æ•´ä¸ªgetç¼“å­˜çš„æ–¹æ³•ã€‚ 16.3 ç¼“å­˜é›ªå´©16.3.1 é—®é¢˜æè¿°keyå¯¹åº”çš„æ•°æ®å­˜åœ¨ï¼Œä½†åœ¨redisä¸­è¿‡æœŸï¼Œæ­¤æ—¶è‹¥æœ‰å¤§é‡å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯DBåŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯DBå‹å®ã€‚ ç¼“å­˜é›ªå´©ä¸ç¼“å­˜å‡»ç©¿çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹å¾ˆå¤škeyç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯æŸä¸€ä¸ªkey æ­£å¸¸è®¿é—® ç¼“å­˜å¤±æ•ˆç¬é—´ 16.3.2 è§£å†³æ–¹æ¡ˆç¼“å­˜å¤±æ•ˆæ—¶çš„é›ªå´©æ•ˆåº”å¯¹åº•å±‚ç³»ç»Ÿçš„å†²å‡»éå¸¸å¯æ€•ï¼ è§£å†³æ–¹æ¡ˆï¼š ï¼ˆ1ï¼‰ æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼šnginxç¼“å­˜ + redisç¼“å­˜ +å…¶ä»–ç¼“å­˜ï¼ˆehcacheç­‰ï¼‰ ï¼ˆ2ï¼‰ ä½¿ç”¨é”æˆ–é˜Ÿåˆ—ï¼š ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚ç”¨é«˜å¹¶å‘æƒ…å†µ ï¼ˆ3ï¼‰ è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜ï¼š è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™…keyçš„ç¼“å­˜ã€‚ ï¼ˆ4ï¼‰ å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼š æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚ 16.4 åˆ†å¸ƒå¼é”16.4.1 é—®é¢˜æè¿°éšç€ä¸šåŠ¡å‘å±•çš„éœ€è¦ï¼ŒåŸå•ä½“å•æœºéƒ¨ç½²çš„ç³»ç»Ÿè¢«æ¼”åŒ–æˆåˆ†å¸ƒå¼é›†ç¾¤ç³»ç»Ÿåï¼Œç”±äºåˆ†å¸ƒå¼ç³»ç»Ÿå¤šçº¿ç¨‹ã€å¤šè¿›ç¨‹å¹¶ä¸”åˆ†å¸ƒåœ¨ä¸åŒæœºå™¨ä¸Šï¼Œè¿™å°†ä½¿åŸå•æœºéƒ¨ç½²æƒ…å†µä¸‹çš„å¹¶å‘æ§åˆ¶é”ç­–ç•¥å¤±æ•ˆï¼Œå•çº¯çš„Java APIå¹¶ä¸èƒ½æä¾›åˆ†å¸ƒå¼é”çš„èƒ½åŠ›ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±éœ€è¦ä¸€ç§è·¨JVMçš„äº’æ–¥æœºåˆ¶æ¥æ§åˆ¶å…±äº«èµ„æºçš„è®¿é—®ï¼Œè¿™å°±æ˜¯åˆ†å¸ƒå¼é”è¦è§£å†³çš„é—®é¢˜ï¼ åˆ†å¸ƒå¼é”ä¸»æµçš„å®ç°æ–¹æ¡ˆï¼š åŸºäºæ•°æ®åº“å®ç°åˆ†å¸ƒå¼é” åŸºäºç¼“å­˜ï¼ˆRedisç­‰ï¼‰ åŸºäºZookeeper æ¯ä¸€ç§åˆ†å¸ƒå¼é”è§£å†³æ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š æ€§èƒ½ï¼šredisæœ€é«˜ å¯é æ€§ï¼šzookeeperæœ€é«˜ è¿™é‡Œï¼Œæˆ‘ä»¬å°±åŸºäºrediså®ç°åˆ†å¸ƒå¼é”ã€‚ 16.4.2 è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨rediså®ç°åˆ†å¸ƒå¼é”redis:å‘½ä»¤ # set sku:1:info â€œOKâ€ NX PX 10000 EX second ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º second ç§’ã€‚ SET key value EX second æ•ˆæœç­‰åŒäº SETEX key second value ã€‚ PX millisecond ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º millisecond æ¯«ç§’ã€‚ SET key value PX millisecond æ•ˆæœç­‰åŒäº PSETEX key millisecond value ã€‚ NX ï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ SET key value NX æ•ˆæœç­‰åŒäº SETNX key value ã€‚ XX ï¼šåªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶è·å–é”ï¼ˆsetnxï¼‰ è·å–æˆåŠŸï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘{ä»dbè·å–æ•°æ®ï¼Œæ”¾å…¥ç¼“å­˜}ï¼Œæ‰§è¡Œå®Œæˆé‡Šæ”¾é”ï¼ˆdelï¼‰ å…¶ä»–å®¢æˆ·ç«¯ç­‰å¾…é‡è¯• ç¼–å†™ä»£ç  Redis: set num 0 12345678910111213141516171819202122232425262728@GetMapping(&quot;testLock&quot;)public void testLock()&#123; //1è·å–é”ï¼Œsetne Boolean lock = redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;, &quot;111&quot;); //2è·å–é”æˆåŠŸã€æŸ¥è¯¢numçš„å€¼ if(lock)&#123; Object value = redisTemplate.opsForValue().get(&quot;num&quot;); //2.1åˆ¤æ–­numä¸ºç©ºreturn if(StringUtils.isEmpty(value))&#123; return; &#125; //2.2æœ‰å€¼å°±è½¬æˆæˆint int num = Integer.parseInt(value+&quot;&quot;); //2.3æŠŠredisçš„numåŠ 1 redisTemplate.opsForValue().set(&quot;num&quot;, ++num); //2.4é‡Šæ”¾é”ï¼Œdel redisTemplate.delete(&quot;lock&quot;); &#125;else&#123; //3è·å–é”å¤±è´¥ã€æ¯éš”0.1ç§’å†è·å– try &#123; Thread.sleep(100); testLock(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; é‡å¯ï¼ŒæœåŠ¡é›†ç¾¤ï¼Œé€šè¿‡ç½‘å…³å‹åŠ›æµ‹è¯•ï¼š ab -n 1000 -c 100 http://192.168.140.1:8080/test/testLock æŸ¥çœ‹redisä¸­numçš„å€¼ï¼š åŸºæœ¬å®ç°ã€‚ é—®é¢˜ï¼šsetnxåˆšå¥½è·å–åˆ°é”ï¼Œä¸šåŠ¡é€»è¾‘å‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´é”æ— æ³•é‡Šæ”¾ è§£å†³ï¼šè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨é‡Šæ”¾é”ã€‚ 16.4.4 ä¼˜åŒ–ä¹‹è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´è®¾ç½®è¿‡æœŸæ—¶é—´æœ‰ä¸¤ç§æ–¹å¼ï¼š é¦–å…ˆæƒ³åˆ°é€šè¿‡expireè®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆç¼ºä¹åŸå­æ€§ï¼šå¦‚æœåœ¨setnxå’Œexpireä¹‹é—´å‡ºç°å¼‚å¸¸ï¼Œé”ä¹Ÿæ— æ³•é‡Šæ”¾ï¼‰ åœ¨setæ—¶æŒ‡å®šè¿‡æœŸæ—¶é—´ï¼ˆæ¨èï¼‰ è®¾ç½®è¿‡æœŸæ—¶é—´ï¼š å‹åŠ›æµ‹è¯•è‚¯å®šä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚è‡ªè¡Œæµ‹è¯• é—®é¢˜ï¼šå¯èƒ½ä¼šé‡Šæ”¾å…¶ä»–æœåŠ¡å™¨çš„é”ã€‚ åœºæ™¯ï¼šå¦‚æœä¸šåŠ¡é€»è¾‘çš„æ‰§è¡Œæ—¶é—´æ˜¯7sã€‚æ‰§è¡Œæµç¨‹å¦‚ä¸‹ index1ä¸šåŠ¡é€»è¾‘æ²¡æ‰§è¡Œå®Œï¼Œ3ç§’åé”è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ index2è·å–åˆ°é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œ3ç§’åé”è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚ index3è·å–åˆ°é”ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘ index1ä¸šåŠ¡é€»è¾‘æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹è°ƒç”¨delé‡Šæ”¾é”ï¼Œè¿™æ—¶é‡Šæ”¾çš„æ˜¯index3çš„é”ï¼Œå¯¼è‡´index3çš„ä¸šåŠ¡åªæ‰§è¡Œ1så°±è¢«åˆ«äººé‡Šæ”¾ã€‚ æœ€ç»ˆç­‰äºæ²¡é”çš„æƒ…å†µã€‚ è§£å†³ï¼šsetnxè·å–é”æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªæŒ‡å®šçš„å”¯ä¸€å€¼ï¼ˆä¾‹å¦‚ï¼šuuidï¼‰ï¼›é‡Šæ”¾å‰è·å–è¿™ä¸ªå€¼ï¼Œåˆ¤æ–­æ˜¯å¦è‡ªå·±çš„é” 16.4.5 ä¼˜åŒ–ä¹‹UUIDé˜²è¯¯åˆ  é—®é¢˜ï¼šåˆ é™¤æ“ä½œç¼ºä¹åŸå­æ€§ã€‚ åœºæ™¯ï¼š index1æ‰§è¡Œåˆ é™¤æ—¶ï¼ŒæŸ¥è¯¢åˆ°çš„lockå€¼ç¡®å®å’Œuuidç›¸ç­‰ uuid=v1 set(lock,uuid)ï¼› index1æ‰§è¡Œåˆ é™¤å‰ï¼Œlockåˆšå¥½è¿‡æœŸæ—¶é—´å·²åˆ°ï¼Œè¢«redisè‡ªåŠ¨é‡Šæ”¾ åœ¨redisä¸­æ²¡æœ‰äº†lockï¼Œæ²¡æœ‰äº†é”ã€‚ index2è·å–äº†lock index2çº¿ç¨‹è·å–åˆ°äº†cpuçš„èµ„æºï¼Œå¼€å§‹æ‰§è¡Œæ–¹æ³• uuid=v2 set(lock,uuid)ï¼› index1æ‰§è¡Œåˆ é™¤ï¼Œæ­¤æ—¶ä¼šæŠŠindex2çš„lockåˆ é™¤ index1 å› ä¸ºå·²ç»åœ¨æ–¹æ³•ä¸­äº†ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡æ–°ä¸Šé”ã€‚index1æœ‰æ‰§è¡Œçš„æƒé™ã€‚index1å·²ç»æ¯”è¾ƒå®Œæˆäº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¼€å§‹æ‰§è¡Œ åˆ é™¤çš„index2çš„é”ï¼ 16.4.6 ä¼˜åŒ–ä¹‹LUAè„šæœ¬ä¿è¯åˆ é™¤çš„åŸå­æ€§1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950@GetMapping(&quot;testLockLua&quot;)public void testLockLua() &#123; //1 å£°æ˜ä¸€ä¸ªuuid ,å°†åšä¸ºä¸€ä¸ªvalue æ”¾å…¥æˆ‘ä»¬çš„keyæ‰€å¯¹åº”çš„å€¼ä¸­ String uuid = UUID.randomUUID().toString(); //2 å®šä¹‰ä¸€ä¸ªé”ï¼šlua è„šæœ¬å¯ä»¥ä½¿ç”¨åŒä¸€æŠŠé”ï¼Œæ¥å®ç°åˆ é™¤ï¼ String skuId = &quot;25&quot;; // è®¿é—®skuId ä¸º25å·çš„å•†å“ 100008348542 String locKey = &quot;lock:&quot; + skuId; // é”ä½çš„æ˜¯æ¯ä¸ªå•†å“çš„æ•°æ® // 3 è·å–é” Boolean lock = redisTemplate.opsForValue().setIfAbsent(locKey, uuid, 3, TimeUnit.SECONDS); // ç¬¬ä¸€ç§ï¼š lock ä¸è¿‡æœŸæ—¶é—´ä¸­é—´ä¸å†™ä»»ä½•çš„ä»£ç ã€‚ // redisTemplate.expire(&quot;lock&quot;,10, TimeUnit.SECONDS);//è®¾ç½®è¿‡æœŸæ—¶é—´ // å¦‚æœtrue if (lock) &#123; // æ‰§è¡Œçš„ä¸šåŠ¡é€»è¾‘å¼€å§‹ // è·å–ç¼“å­˜ä¸­çš„num æ•°æ® Object value = redisTemplate.opsForValue().get(&quot;num&quot;); // å¦‚æœæ˜¯ç©ºç›´æ¥è¿”å› if (StringUtils.isEmpty(value)) &#123; return; &#125; // ä¸æ˜¯ç©º å¦‚æœè¯´åœ¨è¿™å‡ºç°äº†å¼‚å¸¸ï¼ é‚£ä¹ˆdelete å°±åˆ é™¤å¤±è´¥ï¼ ä¹Ÿå°±æ˜¯è¯´é”æ°¸è¿œå­˜åœ¨ï¼ int num = Integer.parseInt(value + &quot;&quot;); // ä½¿num æ¯æ¬¡+1 æ”¾å…¥ç¼“å­˜ redisTemplate.opsForValue().set(&quot;num&quot;, String.valueOf(++num)); /*ä½¿ç”¨luaè„šæœ¬æ¥é”*/ // å®šä¹‰lua è„šæœ¬ String script = &quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;; // ä½¿ç”¨redisæ‰§è¡Œluaæ‰§è¡Œ DefaultRedisScript&lt;Long&gt; redisScript = new DefaultRedisScript&lt;&gt;(); redisScript.setScriptText(script); // è®¾ç½®ä¸€ä¸‹è¿”å›å€¼ç±»å‹ ä¸ºLong // å› ä¸ºåˆ é™¤åˆ¤æ–­çš„æ—¶å€™ï¼Œè¿”å›çš„0,ç»™å…¶å°è£…ä¸ºæ•°æ®ç±»å‹ã€‚å¦‚æœä¸å°è£…é‚£ä¹ˆé»˜è®¤è¿”å›String ç±»å‹ï¼Œ // é‚£ä¹ˆè¿”å›å­—ç¬¦ä¸²ä¸0 ä¼šæœ‰å‘ç”Ÿé”™è¯¯ã€‚ redisScript.setResultType(Long.class); // ç¬¬ä¸€ä¸ªè¦æ˜¯script è„šæœ¬ ï¼Œç¬¬äºŒä¸ªéœ€è¦åˆ¤æ–­çš„keyï¼Œç¬¬ä¸‰ä¸ªå°±æ˜¯keyæ‰€å¯¹åº”çš„å€¼ã€‚ redisTemplate.execute(redisScript, Arrays.asList(locKey), uuid); &#125; else &#123; // å…¶ä»–çº¿ç¨‹ç­‰å¾… try &#123; // ç¡çœ  Thread.sleep(1000); // ç¡é†’äº†ä¹‹åï¼Œè°ƒç”¨æ–¹æ³•ã€‚ testLockLua(); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; Lua è„šæœ¬è¯¦è§£ï¼š é¡¹ç›®ä¸­æ­£ç¡®ä½¿ç”¨ï¼š 1231. å®šä¹‰keyï¼Œkeyåº”è¯¥æ˜¯ä¸ºæ¯ä¸ªskuå®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªskuæœ‰ä¸€æŠŠé”ã€‚String locKey =&quot;lock:&quot;+skuId; // é”ä½çš„æ˜¯æ¯ä¸ªå•†å“çš„æ•°æ®Boolean lock = redisTemplate.opsForValue().setIfAbsent(locKey, uuid,3,TimeUnit.SECONDS); æ€»ç»“ 1ã€åŠ é” 1234// 1. ä»redisä¸­è·å–é”,set k1 v1 px 20000 nxString uuid = UUID.randomUUID().toString();Boolean lock = this.redisTemplate.opsForValue() .setIfAbsent(&quot;lock&quot;, uuid, 2, TimeUnit.SECONDS); 2ã€ä½¿ç”¨luaé‡Šæ”¾é” 12345678// 2. é‡Šæ”¾é” delString script = &quot;if redis.call(&#x27;get&#x27;, KEYS[1]) == ARGV[1] then return redis.call(&#x27;del&#x27;, KEYS[1]) else return 0 end&quot;;// è®¾ç½®luaè„šæœ¬è¿”å›çš„æ•°æ®ç±»å‹DefaultRedisScript&lt;Long&gt; redisScript = new DefaultRedisScript&lt;&gt;();// è®¾ç½®luaè„šæœ¬è¿”å›ç±»å‹ä¸ºLongredisScript.setResultType(Long.class);redisScript.setScriptText(script);redisTemplate.execute(redisScript, Arrays.asList(&quot;lock&quot;),uuid); 3ã€é‡è¯• 12Thread.sleep(500);testLock(); ä¸ºäº†ç¡®ä¿åˆ†å¸ƒå¼é”å¯ç”¨ï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¡®ä¿é”çš„å®ç°åŒæ—¶æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š - äº’æ–¥æ€§ã€‚åœ¨ä»»æ„æ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯èƒ½æŒæœ‰é”ã€‚ - ä¸ä¼šå‘ç”Ÿæ­»é”ã€‚å³ä½¿æœ‰ä¸€ä¸ªå®¢æˆ·ç«¯åœ¨æŒæœ‰é”çš„æœŸé—´å´©æºƒè€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­å…¶ä»–å®¢æˆ·ç«¯èƒ½åŠ é”ã€‚ - è§£é“ƒè¿˜é¡»ç³»é“ƒäººã€‚åŠ é”å’Œè§£é”å¿…é¡»æ˜¯åŒä¸€ä¸ªå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯è‡ªå·±ä¸èƒ½æŠŠåˆ«äººåŠ çš„é”ç»™è§£äº†ã€‚ - åŠ é”å’Œè§£é”å¿…é¡»å…·æœ‰åŸå­æ€§ã€‚ åä¸ƒã€ Redis6.0æ–°åŠŸèƒ½17.1 ACL17.1.1 ç®€ä»‹Redis ACLæ˜¯Access Control Listï¼ˆè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰çš„ç¼©å†™ï¼Œè¯¥åŠŸèƒ½å…è®¸æ ¹æ®å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤å’Œå¯ä»¥è®¿é—®çš„é”®æ¥é™åˆ¶æŸäº›è¿æ¥ã€‚ åœ¨Redis 5ç‰ˆæœ¬ä¹‹å‰ï¼ŒRedis å®‰å…¨è§„åˆ™åªæœ‰å¯†ç æ§åˆ¶ è¿˜æœ‰é€šè¿‡rename æ¥è°ƒæ•´é«˜å±å‘½ä»¤æ¯”å¦‚ flushdb ï¼Œ KEYS* ï¼Œ shutdown ç­‰ã€‚Redis 6 åˆ™æä¾›ACLçš„åŠŸèƒ½å¯¹ç”¨æˆ·è¿›è¡Œæ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ ï¼š ï¼ˆ1ï¼‰æ¥å…¥æƒé™:ç”¨æˆ·åå’Œå¯†ç  ï¼ˆ2ï¼‰å¯ä»¥æ‰§è¡Œçš„å‘½ä»¤ ï¼ˆ3ï¼‰å¯ä»¥æ“ä½œçš„ KEY å‚è€ƒå®˜ç½‘ï¼šhttps://redis.io/topics/acl 17.1.2 å‘½ä»¤1ã€ä½¿ç”¨acl listå‘½ä»¤å±•ç°ç”¨æˆ·æƒé™åˆ—è¡¨ ï¼ˆ1ï¼‰æ•°æ®è¯´æ˜ 2ã€ä½¿ç”¨acl catå‘½ä»¤ ï¼ˆ1ï¼‰æŸ¥çœ‹æ·»åŠ æƒé™æŒ‡ä»¤ç±»åˆ« ï¼ˆ2ï¼‰åŠ å‚æ•°ç±»å‹åå¯ä»¥æŸ¥çœ‹ç±»å‹ä¸‹å…·ä½“å‘½ä»¤ 3ã€ä½¿ç”¨acl whoamiå‘½ä»¤æŸ¥çœ‹å½“å‰ç”¨æˆ· 4ã€ä½¿ç”¨aclsetuserå‘½ä»¤åˆ›å»ºå’Œç¼–è¾‘ç”¨æˆ·ACL ï¼ˆ1ï¼‰ACLè§„åˆ™ ä¸‹é¢æ˜¯æœ‰æ•ˆACLè§„åˆ™çš„åˆ—è¡¨ã€‚æŸäº›è§„åˆ™åªæ˜¯ç”¨äºæ¿€æ´»æˆ–åˆ é™¤æ ‡å¿—ï¼Œæˆ–å¯¹ç”¨æˆ·ACLæ‰§è¡Œç»™å®šæ›´æ”¹çš„å•ä¸ªå•è¯ã€‚å…¶ä»–è§„åˆ™æ˜¯å­—ç¬¦å‰ç¼€ï¼Œå®ƒä»¬ä¸å‘½ä»¤æˆ–ç±»åˆ«åç§°ã€é”®æ¨¡å¼ç­‰è¿æ¥åœ¨ä¸€èµ·ã€‚ ACLè§„åˆ™ ç±»å‹ å‚æ•° è¯´æ˜ å¯åŠ¨å’Œç¦ç”¨ç”¨æˆ· on æ¿€æ´»æŸç”¨æˆ·è´¦å· off ç¦ç”¨æŸç”¨æˆ·è´¦å·ã€‚æ³¨æ„ï¼Œå·²éªŒè¯çš„è¿æ¥ä»ç„¶å¯ä»¥å·¥ä½œã€‚å¦‚æœé»˜è®¤ç”¨æˆ·è¢«æ ‡è®°ä¸ºoffï¼Œåˆ™æ–°è¿æ¥å°†åœ¨æœªè¿›è¡Œèº«ä»½éªŒè¯çš„æƒ…å†µä¸‹å¯åŠ¨ï¼Œå¹¶è¦æ±‚ç”¨æˆ·ä½¿ç”¨AUTHé€‰é¡¹å‘é€AUTHæˆ–HELLOï¼Œä»¥ä¾¿ä»¥æŸç§æ–¹å¼è¿›è¡Œèº«ä»½éªŒè¯ã€‚ æƒé™çš„æ·»åŠ åˆ é™¤ + å°†æŒ‡ä»¤æ·»åŠ åˆ°ç”¨æˆ·å¯ä»¥è°ƒç”¨çš„æŒ‡ä»¤åˆ—è¡¨ä¸­ - ä»ç”¨æˆ·å¯æ‰§è¡ŒæŒ‡ä»¤åˆ—è¡¨ç§»é™¤æŒ‡ä»¤ +@ æ·»åŠ è¯¥ç±»åˆ«ä¸­ç”¨æˆ·è¦è°ƒç”¨çš„æ‰€æœ‰æŒ‡ä»¤ï¼Œæœ‰æ•ˆç±»åˆ«ä¸º@adminã€@setã€@sortedsetâ€¦ç­‰ï¼Œé€šè¿‡è°ƒç”¨ACL CATå‘½ä»¤æŸ¥çœ‹å®Œæ•´åˆ—è¡¨ã€‚ç‰¹æ®Šç±»åˆ«@allè¡¨ç¤ºæ‰€æœ‰å‘½ä»¤ï¼ŒåŒ…æ‹¬å½“å‰å­˜åœ¨äºæœåŠ¡å™¨ä¸­çš„å‘½ä»¤ï¼Œä»¥åŠå°†æ¥å°†é€šè¿‡æ¨¡å—åŠ è½½çš„å‘½ä»¤ã€‚ -@ ä»ç”¨æˆ·å¯è°ƒç”¨æŒ‡ä»¤ä¸­ç§»é™¤ç±»åˆ« allcommands +@allçš„åˆ«å nocommand -@allçš„åˆ«å å¯æ“ä½œé”®çš„æ·»åŠ æˆ–åˆ é™¤ ~ æ·»åŠ å¯ä½œä¸ºç”¨æˆ·å¯æ“ä½œçš„é”®çš„æ¨¡å¼ã€‚ä¾‹å¦‚~*å…è®¸æ‰€æœ‰çš„é”® ï¼ˆ2ï¼‰é€šè¿‡å‘½ä»¤åˆ›å»ºæ–°ç”¨æˆ·é»˜è®¤æƒé™ acl setuser user1 åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘æ ¹æœ¬æ²¡æœ‰æŒ‡å®šä»»ä½•è§„åˆ™ã€‚å¦‚æœç”¨æˆ·ä¸å­˜åœ¨ï¼Œè¿™å°†ä½¿ç”¨just createdçš„é»˜è®¤å±æ€§æ¥åˆ›å»ºç”¨æˆ·ã€‚å¦‚æœç”¨æˆ·å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤å°†ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ ï¼ˆ3ï¼‰è®¾ç½®æœ‰ç”¨æˆ·åã€å¯†ç ã€ACLæƒé™ã€å¹¶å¯ç”¨çš„ç”¨æˆ· acl setuser user2 on &gt;password ~cached:* +get (4)åˆ‡æ¢ç”¨æˆ·ï¼ŒéªŒè¯æƒé™ 17.2 IOå¤šçº¿ç¨‹17.2.1 ç®€ä»‹Redis6ç»ˆäºæ”¯æ’‘å¤šçº¿ç¨‹äº†ï¼Œå‘Šåˆ«å•çº¿ç¨‹äº†å—ï¼Ÿ IOå¤šçº¿ç¨‹å…¶å®æŒ‡å®¢æˆ·ç«¯äº¤äº’éƒ¨åˆ†çš„ç½‘ç»œIOäº¤äº’å¤„ç†æ¨¡å—å¤šçº¿ç¨‹ï¼Œè€Œéæ‰§è¡Œå‘½ä»¤å¤šçº¿ç¨‹ã€‚Redis6æ‰§è¡Œå‘½ä»¤ä¾ç„¶æ˜¯å•çº¿ç¨‹ã€‚ 17.2.2 åŸç†æ¶æ„Redis 6 åŠ å…¥å¤šçº¿ç¨‹,ä½†è·Ÿ Memcached è¿™ç§ä» IOå¤„ç†åˆ°æ•°æ®è®¿é—®å¤šçº¿ç¨‹çš„å®ç°æ¨¡å¼æœ‰äº›å·®å¼‚ã€‚Redis çš„å¤šçº¿ç¨‹éƒ¨åˆ†åªæ˜¯ç”¨æ¥å¤„ç†ç½‘ç»œæ•°æ®çš„è¯»å†™å’Œåè®®è§£æï¼Œæ‰§è¡Œå‘½ä»¤ä»ç„¶æ˜¯å•çº¿ç¨‹ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡æ˜¯ä¸æƒ³å› ä¸ºå¤šçº¿ç¨‹è€Œå˜å¾—å¤æ‚ï¼Œéœ€è¦å»æ§åˆ¶ keyã€luaã€äº‹åŠ¡ï¼ŒLPUSH/LPOP ç­‰ç­‰çš„å¹¶å‘é—®é¢˜ã€‚æ•´ä½“çš„è®¾è®¡å¤§ä½“å¦‚ä¸‹: å¦å¤–ï¼Œå¤šçº¿ç¨‹IOé»˜è®¤ä¹Ÿæ˜¯ä¸å¼€å¯çš„ï¼Œéœ€è¦å†é…ç½®æ–‡ä»¶ä¸­é…ç½® io-threads-do-reads yes io-threads 4 17.3 å·¥å…·æ”¯æŒ Clusterä¹‹å‰è€ç‰ˆRedisæƒ³è¦æ­é›†ç¾¤éœ€è¦å•ç‹¬å®‰è£…rubyç¯å¢ƒï¼ŒRedis 5 å°† redis-trib.rb çš„åŠŸèƒ½é›†æˆåˆ° redis-cli ã€‚å¦å¤–å®˜æ–¹ redis-benchmark å·¥å…·å¼€å§‹æ”¯æŒ cluster æ¨¡å¼äº†ï¼Œé€šè¿‡å¤šçº¿ç¨‹çš„æ–¹å¼å¯¹å¤šä¸ªåˆ†ç‰‡è¿›è¡Œå‹æµ‹ã€‚ 17.4 Redisæ–°åŠŸèƒ½æŒç»­å…³æ³¨Redis6æ–°åŠŸèƒ½è¿˜æœ‰ï¼š 1ã€RESP3æ–°çš„ Redis é€šä¿¡åè®®ï¼šä¼˜åŒ–æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡ 2ã€Client side cachingå®¢æˆ·ç«¯ç¼“å­˜ï¼šåŸºäº RESP3 åè®®å®ç°çš„å®¢æˆ·ç«¯ç¼“å­˜åŠŸèƒ½ã€‚ä¸ºäº†è¿›ä¸€æ­¥æå‡ç¼“å­˜çš„æ€§èƒ½ï¼Œå°†å®¢æˆ·ç«¯ç»å¸¸è®¿é—®çš„æ•°æ®cacheåˆ°å®¢æˆ·ç«¯ã€‚å‡å°‘TCPç½‘ç»œäº¤äº’ã€‚ 3ã€Proxyé›†ç¾¤ä»£ç†æ¨¡å¼ï¼šProxy åŠŸèƒ½ï¼Œè®© Cluster æ‹¥æœ‰åƒå•å®ä¾‹ä¸€æ ·çš„æ¥å…¥æ–¹å¼ï¼Œé™ä½å¤§å®¶ä½¿ç”¨clusterçš„é—¨æ§›ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ä»£ç†ä¸æ”¹å˜ Cluster çš„åŠŸèƒ½é™åˆ¶ï¼Œä¸æ”¯æŒçš„å‘½ä»¤è¿˜æ˜¯ä¸ä¼šæ”¯æŒï¼Œæ¯”å¦‚è·¨ slot çš„å¤šKeyæ“ä½œã€‚ 4ã€Modules API Redis 6ä¸­æ¨¡å—APIå¼€å‘è¿›å±•éå¸¸å¤§ï¼Œå› ä¸ºRedis Labsä¸ºäº†å¼€å‘å¤æ‚çš„åŠŸèƒ½ï¼Œä»ä¸€å¼€å§‹å°±ç”¨ä¸ŠRedisæ¨¡å—ã€‚Rediså¯ä»¥å˜æˆä¸€ä¸ªæ¡†æ¶ï¼Œåˆ©ç”¨Modulesæ¥æ„å»ºä¸åŒç³»ç»Ÿï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€å§‹å†™ç„¶åè¿˜è¦BSDè®¸å¯ã€‚Redisä¸€å¼€å§‹å°±æ˜¯ä¸€ä¸ªå‘ç¼–å†™å„ç§ç³»ç»Ÿå¼€æ”¾çš„å¹³å°ã€‚ åŸè§†é¢‘åœ°å€ åŸæ–‡ç« åœ°å€","categories":[{"name":"Redis","slug":"Redis","permalink":"https://lwy0518.github.io/categories/Redis/"}],"tags":[{"name":"Redis","slug":"Redis","permalink":"https://lwy0518.github.io/tags/Redis/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://lwy0518.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://lwy0518.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"}],"author":"lwy"},{"title":"ååºä»‹ç»","slug":"ååºä»‹ç»","date":"2021-12-27T13:21:29.000Z","updated":"2022-01-18T03:16:08.716Z","comments":true,"path":"2021/12/27/ååºä»‹ç»/","link":"","permalink":"https://lwy0518.github.io/2021/12/27/%E5%81%8F%E5%BA%8F%E4%BB%8B%E7%BB%8D/","excerpt":"ååºä»‹ç» ååº å…¨åº ååºä¸å…¨åºåŒºåˆ« Latticeï¼ˆæ ¼ï¼‰ Latticeï¼ˆæ ¼ï¼‰ Semilatticeï¼ˆåŠæ ¼ï¼‰ Complete Latticeï¼ˆå…¨æ ¼ï¼‰ Product Latticeï¼ˆä¹˜ç§¯æ ¼ï¼‰ ä¸Šç•Œä¸ä¸‹ç•Œ","text":"ååºä»‹ç» ååº å…¨åº ååºä¸å…¨åºåŒºåˆ« Latticeï¼ˆæ ¼ï¼‰ Latticeï¼ˆæ ¼ï¼‰ Semilatticeï¼ˆåŠæ ¼ï¼‰ Complete Latticeï¼ˆå…¨æ ¼ï¼‰ Product Latticeï¼ˆä¹˜ç§¯æ ¼ï¼‰ ä¸Šç•Œä¸ä¸‹ç•Œ ååº å‚è€ƒé“¾æ¥ å…¨åºä¸ååº ååº å®šä¹‰ Partiallyordered setï¼Œç®€å†™poset è®¾Ræ˜¯é›†åˆAä¸Šçš„ä¸€ä¸ªäºŒå…ƒå…³ç³»ï¼Œè‹¥Ræ»¡è¶³ï¼š â…  è‡ªåæ€§ï¼šå¯¹ä»»æ„xâˆˆAï¼Œæœ‰xRxï¼› â…¡ åå¯¹ç§°æ€§ï¼ˆå³åå¯¹ç§°å…³ç³»ï¼‰ï¼šå¯¹ä»»æ„x,yâˆˆAï¼Œè‹¥xRyï¼Œä¸”yRxï¼Œåˆ™x=yï¼› â…¢ ä¼ é€’æ€§ï¼šå¯¹ä»»æ„x, y,zâˆˆAï¼Œè‹¥xRyï¼Œä¸”yRzï¼Œåˆ™xRzã€‚ åˆ™ç§°Rä¸ºAä¸Šçš„ååºå…³ç³»ï¼Œé€šå¸¸è®°ä½œâ‰¼ã€‚æ³¨æ„è¿™é‡Œçš„â‰¼ä¸å¿…æ˜¯æŒ‡ä¸€èˆ¬æ„ä¹‰ä¸Šçš„â€œå°äºæˆ–ç­‰äºâ€ã€‚ è‹¥ç„¶æœ‰xâ‰¼yï¼Œæˆ‘ä»¬ä¹Ÿè¯´xæ’åœ¨yå‰é¢ï¼ˆx precedes yï¼‰ã€‚ åˆ†ç±» ä¸¥æ ¼ååºï¼Œåè‡ªåååº ç»™å®šé›†åˆSï¼Œâ€œ&lt;â€æ˜¯Sä¸Šçš„äºŒå…ƒå…³ç³»ï¼Œè‹¥â€œ&lt;â€æ»¡è¶³ï¼š åè‡ªåæ€§ï¼šâˆ€aâˆˆSï¼Œæœ‰aâ‰®aï¼› éå¯¹ç§°æ€§ï¼šâˆ€aï¼ŒbâˆˆSï¼Œa&lt;b â‡’ bâ‰®aï¼› ä¼ é€’æ€§ï¼šâˆ€aï¼Œbï¼ŒcâˆˆSï¼Œa&lt;bä¸”b&lt;cï¼Œåˆ™a&lt;cï¼› åˆ™ç§°â€œ&lt;â€æ˜¯Sä¸Šçš„ä¸¥æ ¼ååºæˆ–åè‡ªåååº ä¸¥æ ¼ååºä¸æœ‰å‘æ— ç¯å›¾ï¼ˆdagï¼‰æœ‰ç›´æ¥çš„å¯¹åº”å…³ç³»ã€‚ä¸€ä¸ªé›†åˆä¸Šçš„ä¸¥æ ¼ååºçš„å…³ç³»å›¾å°±æ˜¯ä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ã€‚å…¶ä¼ é€’é—­åŒ…æ˜¯å®ƒè‡ªå·± éä¸¥æ ¼ååºï¼Œè‡ªåååº ç»™å®šé›†åˆSï¼Œâ€œâ‰¤â€æ˜¯Sä¸Šçš„äºŒå…ƒå…³ç³»ï¼Œè‹¥â€œâ‰¤â€æ»¡è¶³ï¼š è‡ªåæ€§ï¼šâˆ€aâˆˆSï¼Œæœ‰aâ‰¤aï¼› åå¯¹ç§°æ€§ï¼šâˆ€aï¼ŒbâˆˆSï¼Œaâ‰¤bä¸”bâ‰¤aï¼Œåˆ™a=bï¼› ä¼ é€’æ€§ï¼šâˆ€aï¼Œbï¼ŒcâˆˆSï¼Œaâ‰¤bä¸”bâ‰¤cï¼Œåˆ™aâ‰¤cï¼› åˆ™ç§°â€œâ‰¤â€æ˜¯Sä¸Šçš„éä¸¥æ ¼ååºæˆ–è‡ªåååºã€‚ ä¾‹å­ å‡è®¾æœ‰ A={1,2,3,4}ï¼Œå‡è®¾Ræ˜¯é›†åˆAä¸Šçš„å…³ç³»ï¼š{&lt;1,1&gt;,&lt;2,2&gt;,&lt;3,3&gt;,&lt;4,4&gt;,&lt;1,2&gt;,&lt;1,4&gt;,&lt;2,4&gt;,&lt;3,4&gt;}ï¼Œé‚£ä¹ˆï¼š è‡ªåæ€§ï¼šå¯ä»¥çœ‹åˆ° &lt;1,1&gt;,&lt;2,2&gt;,&lt;3,3&gt;,&lt;4,4&gt; éƒ½åœ¨Rä¸­ï¼Œæ»¡è¶³ã€‚ åå¯¹ç§°æ€§ï¼šç”±äº &lt;1,1&gt;,&lt;2,2&gt;,&lt;3,3&gt;,&lt;4,4&gt; ä¸å±äº x !=y ï¼Œæ‰€ä»¥ä¸è€ƒè™‘è¿™4ç§ï¼Œå¯¹äº &lt;1,2&gt;ï¼Œæœ‰ &lt;2,1&gt; ä¸åœ¨Rä¸­ï¼›å¯¹äº&lt;2,4&gt; æœ‰&lt;4,2&gt;ä¸åœ¨Rä¸­ï¼›å¯¹äº&lt;3,4&gt; æœ‰&lt;4,3&gt; ä¸åœ¨ Rä¸­ï¼Œæ»¡è¶³ã€‚ ä¼ é€’æ€§ï¼š&lt;1,1&gt;&lt;1,2&gt;åœ¨Rä¸­ï¼Œå¹¶ä¸”&lt;1,2&gt;åœ¨Rä¸­ï¼›&lt;1,1&gt;&lt;1,4&gt;åœ¨Rä¸­ï¼Œå¹¶ä¸”&lt;1,4&gt;åœ¨Rä¸­ï¼›&lt;2,2&gt;&lt;2,4&gt;åœ¨Rä¸­ï¼Œå¹¶ä¸”&lt;2,4&gt;åœ¨Rä¸­ï¼›&lt;3,3&gt;&lt;3,4&gt;åœ¨Rä¸­ï¼Œå¹¶ä¸”&lt;3,4&gt;åœ¨Rä¸­ï¼›ç­‰ç­‰å…¶ä»–ï¼Œæ»¡è¶³ã€‚ æ‰€ä»¥è¯´Ræ˜¯ååºå…³ç³»ã€‚ å…¨åº å®šä¹‰ å¦‚æœRæ˜¯Aä¸Šçš„ååºå…³ç³»ï¼Œé‚£ä¹ˆå¯¹äºä»»æ„çš„Aé›†åˆä¸Šçš„ x,yï¼Œéƒ½æœ‰ x &lt;= yï¼Œæˆ–è€… y &lt;= xï¼ŒäºŒè€…å¿…å±…å…¶ä¸€ï¼Œé‚£ä¹ˆåˆ™ç§°Ræ˜¯Aä¸Šçš„å…¨åºå…³ç³» è®¾é›†åˆXä¸Šæœ‰ä¸€å…¨åºå…³ç³»ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™ç§å…³ç³»ç”¨ â‰¤ è¡¨è¿°ï¼Œåˆ™ä¸‹åˆ—é™ˆè¿°å¯¹äº X ä¸­çš„æ‰€æœ‰ a, b å’Œ c æˆç«‹ï¼š å¦‚æœ a â‰¤ b ä¸” b â‰¤ a åˆ™ a = b (åå¯¹ç§°æ€§) å¦‚æœ a â‰¤ b ä¸” b â‰¤ c åˆ™ a â‰¤ c (ä¼ é€’æ€§) a â‰¤ b æˆ– b â‰¤ a (å®Œå…¨æ€§) ä¾‹å­ å‡è®¾æœ‰ A={a,b,c}ï¼Œå‡è®¾Ræ˜¯é›†åˆAä¸Šçš„å…³ç³»ï¼š{&lt;a,a&gt;,&lt;b,b&gt;,&lt;c,c&gt;,&lt;a,b&gt;,&lt;a,c&gt;,&lt;b,c&gt;}å’Œä¸Šè¿°ä¸€æ ·ï¼Œå¯ä»¥è¯æ˜å…·æœ‰è‡ªåæ€§ï¼Œåå¯¹ç§°æ€§ï¼Œä¼ é€’æ€§ï¼Œæ‰€ä»¥æ˜¯ååºçš„ï¼Œæœ‰å› ä¸ºæœ‰ &lt;a,b&gt;,&lt;a,c&gt;,&lt;b,c&gt;ï¼Œ ä¹Ÿå°±æ˜¯è¯´ä¸¤ä¸¤å…³ç³»éƒ½æœ‰äº†ï¼Œæ‰€ä»¥æ»¡è¶³å¯¹äºä»»æ„çš„Aé›†åˆä¸Šçš„ x,yï¼Œéƒ½æœ‰ x &lt;= yï¼Œæˆ–è€… y &lt;= xï¼ŒäºŒè€…å¿…å±…å…¶ä¸€ï¼Œæ‰€ä»¥è¯´æ˜¯å…¨åºå…³ç³» åŒºåˆ« ååºé›†åˆï¼šé…å¤‡äº†ååºå…³ç³»çš„é›†åˆã€‚ ååºï¼šåªå¯¹éƒ¨åˆ†è¦å…ƒç´ æˆç«‹å…³ç³»ï¼ˆéƒ¨åˆ†å¯æ¯”ï¼‰ é›†åˆå†…åªæœ‰éƒ¨åˆ†å…ƒç´ ä¹‹é—´åœ¨è¿™ä¸ªå…³ç³»ä¸‹æ˜¯å¯ä»¥æ¯”è¾ƒçš„ã€‚ æ¯”å¦‚ï¼šæ¯”å¦‚å¤æ•°é›†ä¸­å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°éƒ½å¯ä»¥æ¯”è¾ƒå¤§å°ï¼Œé‚£ä¹ˆâ€œå¤§å°â€å°±æ˜¯å¤æ•°é›†çš„ä¸€ä¸ªååºå…³ç³» å…¨åºé›†åˆï¼šé…å¤‡äº†å…¨åºå…³ç³»çš„é›†åˆã€‚ å…¨åºï¼šå¯¹é›†åˆä¸­ä»»æ„ä¸¤ä¸ªå…ƒç´ éƒ½æœ‰å…³ç³» é›†åˆå†…ä»»ä½•ä¸€å¯¹å…ƒç´ åœ¨åœ¨è¿™ä¸ªå…³ç³»ä¸‹éƒ½æ˜¯ç›¸äº’å¯æ¯”è¾ƒçš„ã€‚ æ¯”å¦‚ï¼šæœ‰é™é•¿åº¦çš„åºåˆ—æŒ‰å­—å…¸åºæ˜¯å…¨åºçš„ã€‚æœ€å¸¸è§çš„æ˜¯å•è¯åœ¨å­—å…¸ä¸­æ˜¯å…¨åºçš„ ä¾‹å­ é›†åˆçš„åŒ…å«å…³ç³»æ˜¯ä¸€ç§ååºã€‚ åœ¨æ­£æ•´æ•°é›†ä¸­å®šä¹‰ååºï¼šè‹¥aèƒ½æ•´é™¤bï¼Œæˆ‘ä»¬å°±è®°ä¸ºaâ‰ºb æ˜¾ç„¶å®ƒæ»¡è¶³åºå…¬ç†ã€‚ä½†æ•´æ•°é›†ä¸­ï¼Œä¸æ˜¯ä»»ä½•ä¸¤ä¸ªæ•°éƒ½å­˜åœ¨æ•´é™¤å…³ç³»ï¼Œè¿™ä¸ªå…³ç³»æ˜¯å±€éƒ¨çš„ï¼ˆpartialï¼‰ï¼Œå¤ªâ€œåé¢‡â€ï¼Œäºæ˜¯è¢«ç§°ä¸ºååº Lattice å‚è€ƒé“¾æ¥ æ ¼ Latticeï¼ˆæ ¼ï¼‰ å®šä¹‰ å¦‚æœä¸€ä¸ªååºé›†çš„ä»»æ„ä¸¤ä¸ªå…ƒç´ éƒ½æœ‰æœ€å°ä¸Šç•Œå’Œæœ€å¤§ä¸‹ç•Œï¼Œé‚£ä¹ˆè¿™ä¸€ååºé›†æ˜¯ä¸€ä¸ªæ ¼ Semilatticeï¼ˆåŠæ ¼ï¼‰ å®šä¹‰ æœ€å°ä¸Šç•Œå’Œæœ€å¤§ä¸‹ç•Œåªå­˜åœ¨ä¸€ä¸ªçš„ååºé›†ç§°åŠæ ¼ï¼Œåªå­˜åœ¨æœ€å°ä¸Šç•Œç§°ä¸ºâ€œjoin semilatticeâ€ï¼Œåªå­˜åœ¨æœ€å¤§ä¸‹ç•Œç§°ä¸ºâ€œmeet semilatticeâ€ Complete Latticeï¼ˆå…¨æ ¼ï¼‰ å®šä¹‰ ä¸€ä¸ªååºé›†çš„ä»»æ„å­é›†å‡å­˜åœ¨æœ€å°ä¸Šç•Œå’Œæœ€å¤§ä¸‹ç•Œï¼Œé‚£ä¹ˆè¿™ä¸ªååºé›†æˆä¸ºå…¨æ ¼ ç‰¹ç‚¹ æ¯ä¸ªå…¨æ ¼éƒ½å­˜åœ¨ä¸€ä¸ªæœ€å¤§å…ƒç´  topï¼ˆâŠ¤=âŠ”Pï¼‰å’Œæœ€å°å…ƒç´ bottomï¼ˆâŠ¥=âŠ“Pï¼‰ æ‰€æœ‰å…ƒç´ æœ‰é™çš„æ ¼ï¼ˆfinite latticeï¼‰å‡æ˜¯å…¨æ ¼ã€‚ï¼ˆåä¹‹ä¸æˆç«‹ï¼‰ Product Latticeï¼ˆä¹˜ç§¯æ ¼ï¼‰ ç»™å®šnä¸ªlatticeï¼ŒL1 = (P1, âŠ‘1), L2 = (P2, âŠ‘2), â€¦, Ln = (Pn, âŠ‘n)ï¼Œå¦‚æœæ¯ä¸ªlatticeéƒ½æœ‰å¯¹åº”çš„âŠ”i(æœ€å°ä¸Šç•Œ)å’ŒâŠ“i(æœ€å¤§ä¸‹ç•Œ)ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªProduct Lattice Ln = (P, âŠ‘)å¹¶æœ‰ä»¥ä¸‹å››ä¸ªå®šä¹‰ï¼š 1.P = P1 Ã— â€¦ Ã— Pn 2.(x1, â€¦, xn) âŠ‘ (y1, â€¦, yn) âŸº (x1 âŠ‘ y1) âˆ§ â€¦ âˆ§ (xn âŠ‘ yn) 3.(x1, â€¦, xn) âŠ” (y1, â€¦, yn) = (x1 âŠ”1 y1, â€¦, xn âŠ”n yn) 4.(x1, â€¦, xn) âŠ“ (y1, â€¦, yn) = (x1 âŠ“1 y1, â€¦, xn âŠ“n yn) Product Latticeä»æ˜¯Latticeï¼Œè‹¥æ¯ä¸ªå­æ ¼ä¸ºå…¨æ ¼ï¼Œé‚£ä¹ˆä¹˜ç§¯ä¹Ÿæ˜¯å…¨æ ¼ ä¸Šç•Œä¸ä¸‹ç•Œ å‰æ ç»™å®šååºé›†(P, âŠ‘)åŠå…¶å­é›†Sï¼Œæ»¡è¶³S âŠ† Pï¼Œåˆ™æœ‰ï¼š ä¸Šç•Œï¼ˆä¸å”¯ä¸€ï¼‰ è‹¥âˆ€x âˆˆ S, x âŠ‘ u,é‚£ä¹ˆu âˆˆ Pæ˜¯å­é›†Sçš„ä¸Šç•Œ ä¸‹ç•Œï¼ˆä¸å”¯ä¸€ï¼‰ è‹¥âˆ€x âˆˆ S, l âŠ‘ x,é‚£ä¹ˆl âˆˆ Pæ˜¯å­é›†Sçš„ä¸‹ç•Œ æœ€å°ä¸Šç•ŒâŠ”S(lub) æœ€å¤§ä¸‹ç•ŒâŠ“S(glb) ç‰¹ç‚¹ ä¸æ˜¯æ¯ä¸ªååºéƒ½æœ‰lubå’Œglb ä½†æ˜¯å¦‚æœä¸€ä¸ªååºæœ‰lubå’Œglbï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯å”¯ä¸€çš„","categories":[{"name":"ååº","slug":"ååº","permalink":"https://lwy0518.github.io/categories/%E5%81%8F%E5%BA%8F/"}],"tags":[{"name":"ååº","slug":"ååº","permalink":"https://lwy0518.github.io/tags/%E5%81%8F%E5%BA%8F/"},{"name":"Lattice","slug":"Lattice","permalink":"https://lwy0518.github.io/tags/Lattice/"}],"author":"lwy"},{"title":"gccä¸­çš„SSAåŒ–ç®—æ³•","slug":"gccä¸­çš„SSAç®—æ³•","date":"2021-12-26T07:44:24.000Z","updated":"2021-12-27T02:35:49.633Z","comments":true,"path":"2021/12/26/gccä¸­çš„SSAç®—æ³•/","link":"","permalink":"https://lwy0518.github.io/2021/12/26/gcc%E4%B8%AD%E7%9A%84SSA%E7%AE%97%E6%B3%95/","excerpt":"SSAåŒ–ç®—æ³•è¿‡ç¨‹ gccä¸­SSAåŒ–çš„ç®—æ³•æè¿° è®¡ç®—å½“å‰å‡½æ•°çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œ éå†å¹¶è®°å½•å‡½æ•°æ¯æ¡æŒ‡ä»¤ä¸­å‡ºç°çš„å˜é‡çš„defs/usesä¿¡æ¯ ä¸ºæ¯ä¸ªå˜é‡è®¡ç®—phiå‡½æ•°çš„æ’å…¥ç‚¹ æŒ‰ç…§æ”¯é…æ ‘çš„DFSéå†é‡å†™æ¯ä¸ªbbçš„æ¯æ¡æŒ‡ä»¤å¹¶å°†æ•´ä¸ªå‡½æ•°SSAåŒ– gccä¸­ssaåŒ–çš„æ•´ä½“æµç¨‹ pass_build_ssa å‡½æ•°æŒ‡ä»¤åºåˆ—çš„def/useåˆ†æ ä¸ºæ¯ä¸ªå˜é‡æ’å…¥phiå‡½æ•° æŒ‡ä»¤é‡å†™(SSAåŒ–)","text":"SSAåŒ–ç®—æ³•è¿‡ç¨‹ gccä¸­SSAåŒ–çš„ç®—æ³•æè¿° è®¡ç®—å½“å‰å‡½æ•°çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œ éå†å¹¶è®°å½•å‡½æ•°æ¯æ¡æŒ‡ä»¤ä¸­å‡ºç°çš„å˜é‡çš„defs/usesä¿¡æ¯ ä¸ºæ¯ä¸ªå˜é‡è®¡ç®—phiå‡½æ•°çš„æ’å…¥ç‚¹ æŒ‰ç…§æ”¯é…æ ‘çš„DFSéå†é‡å†™æ¯ä¸ªbbçš„æ¯æ¡æŒ‡ä»¤å¹¶å°†æ•´ä¸ªå‡½æ•°SSAåŒ– gccä¸­ssaåŒ–çš„æ•´ä½“æµç¨‹ pass_build_ssa å‡½æ•°æŒ‡ä»¤åºåˆ—çš„def/useåˆ†æ ä¸ºæ¯ä¸ªå˜é‡æ’å…¥phiå‡½æ•° æŒ‡ä»¤é‡å†™(SSAåŒ–) SSAåŒ–ç®—æ³•è¿‡ç¨‹gccä¸­SSAåŒ–çš„ç®—æ³•æè¿°SSAåŒ–çš„æµç¨‹å¯ä»¥ç®€åŒ–ä¸º: (1)å¯¹æ‰€æœ‰å˜é‡æ’å…¥å¿…è¦çš„phiå‡½æ•° (2)ä¾æ¬¡é‡å†™å„ä¸ªå˜é‡çš„å®šå€¼/ä½¿ç”¨(è½¬åŒ–ä¸ºSSAæ ¼å¼) è€Œå…·ä½“åˆ°gccä¸­åˆ™å¤§ä½“åˆ†ä¸º4ä¸ªæ­¥éª¤: è®¡ç®—å½“å‰å‡½æ•°çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œâ€‹ æŒ‰ç…§è¿­ä»£çš„å¿…ç»ç»“ç‚¹è¾¹ç•Œç®—æ³•, è¦æƒ³ç¡®å®šphiå‡½æ•°æ’å…¥çš„ä½ç½®,å¿…é¡»è¦å…ˆæ ¹æ®å‡½æ•°çš„CFGç¡®å®šå‡½æ•°çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œ(æ”¯é…ç»“ç‚¹è¾¹ç•Œçš„å®šä¹‰å’Œç®—æ³•è§[2]), åœ¨gccä¸­åˆ™æ˜¯ 1) å…ˆé€šè¿‡calculate_dominance_infoè®¡ç®—å½“å‰å‡½æ•°çš„æ”¯é…ç»“ç‚¹ä¿¡æ¯ 2) å†é€šè¿‡compute_dominance_frontiersè®¡ç®—å½“å‰å‡½æ•°çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯ éå†å¹¶è®°å½•å‡½æ•°æ¯æ¡æŒ‡ä»¤ä¸­å‡ºç°çš„å˜é‡çš„defs/usesä¿¡æ¯â€‹ æ­¤æ­¥ä¸»è¦æ˜¯æ”¶é›†å‡½æ•°æ¯æ¡æŒ‡ä»¤ä¸­å‡ºç°çš„å˜é‡çš„defs/usesä¿¡æ¯,è¿™äº›ä¿¡æ¯ä¿å­˜åœ¨æ ‡é‡çš„bitmapä¸­, æ•…å¯ä»¥æŒ‰ç…§ä»»æ„çš„é¡ºåºéå†æŒ‡ä»¤,è€Œåœ¨gccä¸­åˆ™æ˜¯é‡‡ç”¨åŸºäºæ”¯é…æ ‘çš„æ·±åº¦ä¼˜å…ˆéå†(DFS)é¡ºåºéå†å„ä¸ªåŸºæœ¬å—(bb)ä¸­çš„ä¸€æ¡æ¡æŒ‡ä»¤ ä¸ºæ¯ä¸ªå˜é‡è®¡ç®—phiå‡½æ•°çš„æ’å…¥ç‚¹â€‹ 1)ä¸­å·²ç»è®¡ç®—å‡ºäº†æ¯ä¸ªbbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯ï¼›2)ä¸­è®¡ç®—å‡ºäº†æ¯ä¸ªå˜é‡çš„defs/usesä¿¡æ¯, æŒ‰ç…§è¿­ä»£çš„å¿…ç»ç»“ç‚¹è¾¹ç•Œç®—æ³•, æ­¤å˜é‡æ¯ä¸€ä¸ªdefå‡ºç°çš„ç»“ç‚¹çš„å¿…ç»ç»“ç‚¹è¾¹ç•Œç»“ç‚¹å‡éœ€è¦æ’å…¥ä¸€ä¸ªphiå‡½æ•°, æ’å…¥åçš„phiå‡½æ•°ä½œä¸ºæ­¤å˜é‡çš„ä¸€ä¸ªæ–°å®šå€¼(def)ç‚¹å‚ä¸è¿­ä»£è®¡ç®—. 1é’ˆå¯¹å½“å‰å‡½æ•°ä¸­çš„æ¯ä¸ªå˜é‡å‡éœ€è¦é€šè¿‡æ­¤ç®—æ³•è®¡ç®—å‡ºå…¶éœ€è¦æ’å…¥phiå‡½æ•°çš„ç»“ç‚¹ä¿¡æ¯,å¹¶åœ¨å¯¹åº”ç»“ç‚¹ä¸ºæ¯ä¸ªå˜é‡åˆ†åˆ«æ’å…¥phiå‡½æ•° æŒ‰ç…§æ”¯é…æ ‘çš„DFSéå†é‡å†™æ¯ä¸ªbbçš„æ¯æ¡æŒ‡ä»¤å¹¶å°†æ•´ä¸ªå‡½æ•°SSAåŒ–â€‹ è¿™é‡Œå’Œæ­¥éª¤2)ä¸åŒ, SSAåŒ–çš„è¿‡ç¨‹å¿…é¡»æŒ‰ç…§æ”¯é…æ ‘çš„æ·±åº¦ä¼˜å…ˆç®—æ³•éå†ç»“ç‚¹, 123456789(1)å¯¹äºæ¯ä¸ªç»“ç‚¹é¡ºåºéœ€éå†æ‰€æœ‰è¯­å¥,å¯¹äºæ¯æ¡è¯­å¥: A.è‹¥å‘ç°ä¸€ä¸ªæ“ä½œæ•°ä¸­æ¶‰åŠå˜é‡ä½¿ç”¨(use)æ—¶,éœ€è¦å°†æ­¤æ“ä½œæ•°æ”¹ä¸ºå¯¹æ­¤å˜é‡åœ¨DFSä¸Šæœ€æ–°å®šä¹‰(SSA_NAME)çš„ä½¿ç”¨ B.è‹¥å‘ç°ä¸€ä¸ªæ“ä½œæ•°ä¸­æ¶‰åŠå˜é‡å®šå€¼(def)æ—¶,éœ€è¦ä¸ºæ­¤å˜é‡æ–°åˆ›å»ºä¸€ä¸ªSSA_NAMEä½œä¸ºæ­¤å˜é‡çš„æœ€æ–°å®šä¹‰, å¹¶å°†æ­¤æ­¤æ“ä½œæ•°æ”¹ä¸ºæ–°åˆ›å»ºçš„SSA_NAME (2) è¯­å¥å¤„ç†å®Œæ¯•åç»­ä¸ºæ­¤ç»“ç‚¹çš„æ¯ä¸ªåç»§ç»“ç‚¹çš„æ‰€æœ‰phiå‡½æ•°ç¡®å®šä¸€ä¸ªå‚æ•°(phiå‡½æ•°çš„ç¬¬xä¸ªå‚æ•°æ¥è‡ªå…¶ç¬¬xä¸ªå‰é©±ç»“ç‚¹) phiå‡½æ•°å¯¹åº”åŸå§‹å˜é‡åœ¨4.4)-1)-2)ä¸­çš„æœ€æ–°å®šå€¼(def)åˆ™ä¸ºphiå‡½æ•°çš„ç¬¬xä¸ªå‚æ•°,ä»£è¡¨è¿è¡Œæ—¶æ¥è‹¥æ§åˆ¶æµæ¥è‡ªç¬¬xä¸ªå‰é©±,åˆ™å½“å‰å‚æ•°xçš„å®šå€¼åº”æ¥è‡ªå“ªä¸ªSSA_NAME gccä¸­ssaåŒ–çš„æ•´ä½“æµç¨‹pass_build_ssaâ€‹ åœ¨gccä¸­ pass_build_ssa è´Ÿè´£å¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡Œé¦–æ¬¡ssaè½¬åŒ–,è€Œ update_ssaåˆ™è´Ÿè´£å¯¹è½¬åŒ–åçš„ssaçš„æ›´æ–°, pass_build_ssaå¤§ä½“æµç¨‹å¦‚ä¸‹: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/* pass_build_ssaè´Ÿè´£å¯¹å‡½æ•°cfunçš„SSAåŒ–,æ•´ä¸ªSSAåŒ–å¯ä»¥åˆ†ä¸º4æ­¥: 1.è®¡ç®—å½“å‰å‡½æ•°çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯ //compute_dominance_frontiers (dfs); 2.ä»¥æ”¯é…æ ‘çš„DFSéå†ä¸ºé¡ºåº, æ ‡è®°æ¯æ¡æŒ‡ä»¤ä¸­çš„def/useä¿¡æ¯åˆ°å„ä¸ªå…¨å±€å˜é‡ //mark_def_dom_walker (CDI_DOMINATORS).walk (fun-&gt;cfg-&gt;x_entry_block_ptr); 3.æ ¹æ®1ä¸­çš„æ”¯é…èŠ‚ç‚¹è¾¹ç•Œä¿¡æ¯å’Œ2ä¸­ç»Ÿè®¡çš„æ¯ä¸ªå˜é‡çš„def/useä¿¡æ¯, ç¡®è®¤æ¯ä¸ª å˜é‡éœ€è¦åœ¨å“ªäº›bbä¸­æ’å…¥phiå‡½æ•°,å¹¶ä¸ºæ¯ä¸ªå˜é‡æ’å…¥å¯¹åº”ä¸ªæ•°çš„phiå‡½æ•° //insert_phi_nodes (dfs); 4.ä»¥æ”¯é…æ ‘çš„DFSéå†ä¸ºé¡ºåº,éå†æ‰€æœ‰bbå¹¶é‡å†™æ¯æ¡æŒ‡ä»¤ä¸­çš„æ‰€æœ‰use/defæ“ä½œæ•°(SSAåŒ–) //rewrite_blocks 1) åœ¨éå†åˆ°æ¯ä¸ªbbæ—¶æ‰§è¡Œ: 1) å°†bbä¸­æ‰€æœ‰phiå‡½æ•°çš„è¿”å›å€¼,å†™å…¥åˆ°å…¶å¯¹åº”å˜é‡çš„å½“å‰å®šä¹‰ä¸­(currdef) 2) éå†bbä¸­æ‰€æœ‰æŒ‡ä»¤åºåˆ—,å¹¶é‡å†™å…¶ä¸­çš„å˜é‡: 1) å½“å‘ç°ä¸€ä¸ªå˜é‡çš„useæ—¶,ç”¨å…¶currdefè¿™ä¸ªSSA_NAMEæ›¿æ¢æŒ‡ä»¤ä¸­åŸæœ‰çš„useæ“ä½œæ•° 2) å½“å‘ç°ä¸€ä¸ªå˜é‡çš„defæ—¶,ä¸ºå…¶æ–°åˆ›å»ºä¸€ä¸ªSSA_NAMEæ›¿æ¢æŒ‡ä»¤ä¸­åŸæœ‰çš„defæ“ä½œæ•°,å¹¶å°†æ­¤SSA_NAMEè®°å½•åˆ°æ­¤å˜é‡çš„currdefä¸­,ä»¥åŠå…¥æ ˆ 3) é‡å†™æ­¤bbæ‰€æœ‰åç»­bbä¸­æ¯ä¸ªphiå‡½æ•°çš„ç¬¬iä¸ªå‚æ•°,iä¸ºå½“å‰bbåœ¨å…¶åç»­bbçš„å‰é©±bbsä¸­çš„ç¼–å·,phiå‡½æ•°çš„ç¬¬iä¸ªå‚æ•°è¢«ä¿®æ”¹ä¸ºå…¶å¯¹åº”å˜é‡varåœ¨å½“å‰bbä¸­æœ€åçš„def(currdef) 2) åœ¨æ¯ä¸ªbbçš„æ‰€æœ‰sub bbéƒ½éå†ç»“æŸå: 1) å°†4-1-2-2)ä¸­æ ˆä¸­ä¿å­˜çš„æ‰€æœ‰deféƒ½æ¢å¤åˆ°å…¶å¯¹åº”å˜é‡çš„currdefä¸­, ä»¥ä¿è¯å½“å‰bbåˆ†æå®Œæ¯•å…¶çˆ¶bbä¸­çš„å˜é‡å®šä¹‰ä¸å˜,ç»§ç»­renameå…¶å…„å¼Ÿbbæ—¶æ‰èƒ½ä¿è¯æ­£ç¡®*/unsigned int pass_build_ssa::execute (function *fun)&#123; bitmap_head *dfs; basic_block bb; init_ssa_operands (fun); /* æ­¤å‡½æ•°ä¸»è¦ä¸ºå½“å‰å‡½æ•°åˆ†é…äº†virtual use/defæ“ä½œçš„è™šæ‹Ÿæ“ä½œæ•°vop */ init_ssa_renamer (); /* æ ‡è®°å½“å‰å‡½æ•°å°šæœªå¤„äºSSAæ ¼å¼, åˆå§‹åŒ–è®°å½•æ­¤å‡½æ•°ä¸­æ¯ä¸ªå˜é‡def/useçš„ var_infos æ•°ç»„ */ /* æ ¹æ®æ­¤å‡½æ•°åŸºæœ¬å—çš„æ•°ç›®åˆ†é…ä¸€ä¸ªä¸€ç»´çš„bitmapå¹¶åˆå§‹åŒ–, åç»­use/defåˆ†æä¸­ä¼šåœ¨æ­¤bitmapä¸­æ ‡è®°å‡ºç°äº†use/defçš„bb(å¤§éƒ¨åˆ†éƒ½ä¼šå‡ºç°) */ interesting_blocks = sbitmap_alloc (last_basic_block_for_fn (fun)); bitmap_clear (interesting_blocks); /* æ ¹æ®æ­¤å‡½æ•°åŸºæœ¬å—æ•°ç›®,åˆ†é…å¹¶åˆå§‹åŒ–ä¸€ä¸ªäºŒç»´çš„bitmapçŸ©é˜µ(dfs[x][x]),åç»­æ­¤bitmapç”¨æ¥è®°å½•æ­¤å‡½æ•°ä¸­æ¯ä¸ªbbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯ */ dfs = XNEWVEC (bitmap_head, last_basic_block_for_fn (fun)); FOR_EACH_BB_FN (bb, fun) bitmap_initialize (&amp;dfs[bb-&gt;index], &amp;bitmap_default_obstack); /* step1:æ ¹æ®æ­¤å‡½æ•°(cfun)çš„CFGå¯„å­˜å™¨æ”¯é…æ ‘å’Œæ¯ä¸ªbbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œ[2], æ”¯é…èŠ‚ç‚¹è¾¹ç•Œæ˜¯åˆ¤æ–­æ˜¯å¦éœ€è¦æ’å…¥phiå‡½æ•°çš„å…³é”®,æœ€ç»ˆdfsä¸­: * dfs[x]è®°å½•bb xçš„æ”¯é…èŠ‚ç‚¹è¾¹ç•Œ * dfs[x][y] = true; ä»£è¡¨yæ˜¯xèŠ‚ç‚¹çš„ä¸€ä¸ªæ”¯é…èŠ‚ç‚¹è¾¹ç•ŒèŠ‚ç‚¹ */ calculate_dominance_info (CDI_DOMINATORS); /* è¿™é‡Œå…ˆæ ¹æ®CFGè®¡ç®—æ­¤å‡½æ•°çš„æ”¯é…æ ‘,æ”¯é…æ ‘ä»¥ä¸€ä¸ªä¸ªæ”¯é…ç»“ç‚¹ç»“æ„ä½“ä¿å­˜åœ¨å„ä¸ª bb-&gt;doms[0]ä¸­ */ compute_dominance_frontiers (dfs); /* æ ¹æ®æ”¯é…æ ‘ä¿¡æ¯(bbs-&gt;doms), è®¡ç®—æ‰€æœ‰bbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯å¹¶è®°å½•åˆ°äºŒç»´bitmap dfsä¸­ */ /* step2:æŒ‰ç…§DFSç®—æ³•éå†æ­¤å‡½æ•°çš„æ”¯é…æ ‘ä¸­æ¯ä¸ªç»“ç‚¹(bbs-&gt;doms),å¯¹äºæ¯ä¸ªç»“ç‚¹éƒ½è¦éå†å…¶æ•´ä¸ªæŒ‡ä»¤åºåˆ—(bb-&gt;gimple_df-&gt;seqs)ä¸­çš„ æ¯ä¸€æ¡è¯­å¥(stmt),å¹¶å°†æ¯æ¡è¯­å¥çš„def/useä¿¡æ¯æ›´æ–°åˆ° stmt-&gt;vuse/vdef/use_opsçš„åŒæ—¶,ä¹Ÿæ›´æ–°åˆ°å…¨å±€çš„var_infos/interest_blocks (é’ˆå¯¹æ•´ä¸ªå‡½æ•°),ä»¥åŠm_kills(é’ˆå¯¹å½“å‰bb)ä¸­ */ mark_def_dom_walker (CDI_DOMINATORS).walk (fun-&gt;cfg-&gt;x_entry_block_ptr); /* step3: æ ¹æ®æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯å’Œæ¯ä¸ªå˜é‡çš„def/useä¿¡æ¯,ä¸ºæ¯ä¸ªå˜é‡åœ¨å¿…è¦çš„bbä¸­æ’å…¥æ­¤å˜é‡çš„phiå‡½æ•°, ä¸€ä¸ªbbä¸­æ‰€æœ‰æ’å…¥çš„phiå‡½æ•°å‡è®°å½•åœ¨å…¶bb-&gt;gimple_df-&gt;phi_nodesé“¾è¡¨ä¸­, æŒ‰ç…§ç®—æ³•, æŸä¸ªå˜é‡varè‹¥åœ¨æŸä¸ªbbä¸­å‡ºç°äº†def,åˆ™æ­¤bbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¸­æ‰€æœ‰çš„bbséƒ½è¦æ’å…¥varçš„phiå‡½æ•° éœ€è¦æ³¨æ„çš„æ˜¯:æ­¤æ—¶æ’å…¥çš„phiå‡½æ•°åªæœ‰è¿”å›å€¼ç»“ç‚¹(ä¸ºvaræ–°ç”Ÿæˆçš„SSA_NAME),å…¶å‚æ•°åˆ—è¡¨ä¸ºç©º,åªæœ‰åœ¨å…¶å‰é©±ç»“ç‚¹é‡å†™åphiå‡½æ•°çš„å‚æ•°æ‰èƒ½å¾—ä»¥å¡«å…… */ insert_phi_nodes (dfs); /* step4: æŒ‰ç…§DFSç®—æ³•å†æ¬¡éå†å‡½æ•°çš„æ”¯é…æ ‘,å¹¶é‡å†™æ¯ä¸ªbbä¸­çš„æ¯æ¡æŒ‡ä»¤stmt(ä¹Ÿå°±æ˜¯SSAåŒ–), stmtä¸­çš„æ¯ä¸ªuseè¦æ”¹ä¸ºå¯¹é½currdef(SSA_NAME)çš„use, æ¯ä¸ªdeféƒ½è¦æ–°å»ºä¸€ä¸ªæ–°çš„SSA_NAME; å¯¹äºä¸€ä¸ªbbçš„SSAåŒ–åˆåˆ†ä¸ºä¸‰æ­¥: 1. å°†æ­¤bbä¸­æ‰€æœ‰phiå‡½æ•°çš„è¿”å›å€¼è®¾ç½®ä¸ºå…¶å¯¹åº”å˜é‡çš„currdef 2. éå†æ­¤bbä¸­æ‰€æœ‰stmt, å°†å…¶ä¸­æ‰€æœ‰useçš„æ“ä½œæ•°æ”¹ä¸ºå…¶currdef; è‹¥ç¢°åˆ°defåˆ™ä¸ºå…¶åŸå§‹å˜é‡varç”Ÿæˆä¸€ä¸ªæ–°çš„SSA_NAME,å°†defçš„æ“ä½œæ•°å’Œcurrdefæ›¿æ¢ä¸ºæ–°çš„SSA_NAME 3. éå†æ­¤bbåœ¨å‡½æ•°CFGä¸­æ‰€æœ‰çš„åç»§bb, å¡«å……åç»§bbä¸­æ‰€æœ‰phiæŒ‡ä»¤çš„ä¸€ä¸ªå‚æ•°(ç¬¬xä¸ªå‚æ•°,xä¸ºæ­¤bbåœ¨å…¶åç»§bbçš„æ‰€æœ‰å‰é©±ç»“ç‚¹ä¸­çš„ç¼–å·) */ rewrite_blocks (ENTRY_BLOCK_PTR_FOR_FN (fun), REWRITE_ALL); ...... return 0;&#125; å‡½æ•°æŒ‡ä»¤åºåˆ—çš„def/useåˆ†æâ€‹ è¦åˆ†æå½“å‰å‡½æ•°ä¸­æ‰€æœ‰å˜é‡çš„def/useä¿¡æ¯,è¿™æ˜¯é€šè¿‡å‡½æ•°mark_def_dom_walker::walk()å®ç°çš„: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768class mark_def_dom_walker : public dom_walker /* æ²¡æœ‰å•ç‹¬å®ç° walkå‡½æ•°,ç»§æ‰¿çˆ¶ç±»walkå‡½æ•° */&#123;public: mark_def_dom_walker (cdi_direction direction); ~mark_def_dom_walker (); virtual edge before_dom_children (basic_block);private: bitmap m_kills; /* æ­¤bitmapå¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªä»¥å˜é‡UIDä¸ºä¸‹æ ‡çš„ä¸€ç»´æ•°ç»„, m_kills[x] = 1;åˆ™ä»£è¡¨UIDä¸ºxçš„å˜é‡åœ¨å½“å‰åˆ†æçš„bbä¸­å‡ºç°äº†kill def */&#125;; class dom_walker&#123; ...... void walk (basic_block); ......&#125; /* åœ¨æ­¤å‡½æ•°æ‰§è¡Œå‰,bbæ‰€åœ¨çš„å‡½æ•°å¿…é¡»å·²ç»è®¡ç®—è¿‡äº†æ”¯é…æ ‘(calculate_dominance_info),æ­¤æ—¶è®¡ç®—ç»“æœå·²ç»ä¿å­˜åˆ°å„ä¸ªbb-&gt;domsä¸­äº†, è€Œæ­¤å‡½æ•°åˆ™é€šè¿‡æ·±åº¦ä¼˜å…ˆéå†ç®—æ³•(DFS)éå†ä»bbå¼€å§‹çš„æ•´ä¸ªæ”¯é…æ ‘çš„æ‰€æœ‰ç»“ç‚¹,ä¸”: * åœ¨åˆšéå†åˆ°æŸä¸ªç»“ç‚¹æ—¶,ä¸ºå½“å‰ç»“ç‚¹è°ƒç”¨before_dom_children(basic_block);å›è°ƒ - è‹¥æ­¤å›è°ƒè¿”å›STOP,åˆ™å…¶æ‰€æœ‰å­èŠ‚ç‚¹ä¸å¿…å†éå† - è‹¥æ­¤å›è°ƒè¿”å›éSTOP,åˆ™æŒ‰ç…§DFSç»§ç»­éå†å…¶å­ç»“ç‚¹ * åœ¨æŸä¸ªç»“ç‚¹(åŠå…¶å­èŠ‚ç‚¹)éå†å®Œæ¯•å, ä¸ºå½“å‰ç»“ç‚¹è°ƒç”¨after_dom_children(basic_block);å›è°ƒ*/void dom_walker::walk (basic_block bb)&#123; int sp = 0; basic_block dest; basic_block *worklist = XNEWVEC (basic_block, n_basic_blocks_for_fn (cfun) * 2); /* ä¸ºåç»­é€’å½’éå†åˆ†é…ä¸´æ—¶çš„ç»“ç‚¹æ ˆ */ ...... while (true) &#123; /* åªéå†æœ‰å‰é©±çš„bbæˆ–å‡½æ•°å‡ºå…¥å£bb */ if (EDGE_COUNT (bb-&gt;preds) &gt; 0 || bb == ENTRY_BLOCK_PTR_FOR_FN (cfun) || bb == EXIT_BLOCK_PTR_FOR_FN (cfun)) &#123; edge taken_edge = NULL; taken_edge = before_dom_children (bb); /* åœ¨éå†åˆ°ä¸€ä¸ªç»“ç‚¹æ—¶,å…ˆè°ƒç”¨ before_dom_children å›è°ƒ */ worklist[sp++] = bb; /* å°†å½“å‰èŠ‚ç‚¹æ”¾åˆ°worklistä¸­,ä½œä¸ºæ ˆå¸§æ ‡è®°(NULLä¸ºåˆ†éš”ç¬¦),åç»­ä¼šå…ˆé€’å½’å¤„ç†å…¶å­èŠ‚ç‚¹ */ worklist[sp++] = NULL; if (taken_edge != STOP) /* è‹¥å›è°ƒè¿”å›çš„é STOP(-1) */ &#123; int saved_sp = sp; /* éå†ç»“ç‚¹bbåœ¨æ”¯é…æ ‘ä¸­çš„æ‰€æœ‰å­èŠ‚ç‚¹,æ”¯é…æ ‘ä¿¡æ¯åœ¨walkä¹‹å‰åº”è¯¥å·²ç»è®¡ç®—å‡º(calculate_dominance_info),å¹¶è®°å½•åœ¨å„ä¸ªbb-&gt;domsä¸­ */ for (dest = first_dom_son (m_dom_direction, bb); dest; dest = next_dom_son (m_dom_direction, dest)) worklist[sp++] = dest; /* åœ¨æ ˆä¸­è®°å½•å½“å‰bbçš„æ‰€æœ‰è¦éå†çš„æ”¯é…æ ‘ä¸­çš„å­ç»“ç‚¹ */ if (sp - saved_sp &gt; 1 &amp;&amp; m_dom_direction == CDI_DOMINATORS &amp;&amp; m_bb_to_rpo) /* è‹¥å¯¹æ”¯é…æ ‘çš„ DFSéå†æœ‰é¡ºåºè¦æ±‚,åˆ™å°†bbçš„å­èŠ‚ç‚¹æ’åºä»¥ç¡®ä¿åç»­çš„éå†é¡ºåº */ sort_bbs_postorder (&amp;worklist[saved_sp], sp - saved_sp); &#125; &#125; while (sp &gt; 0 &amp;&amp; !worklist[sp - 1]) /* è‹¥å½“å‰bbæ²¡æœ‰å­ç»“ç‚¹,æˆ–æ‰€æœ‰å­èŠ‚ç‚¹éƒ½å¤„ç†å®Œæ¯•,åˆ™ä¸ºå½“å‰ç»“ç‚¹è°ƒç”¨å¤„ç†å®Œæ¯•åçš„å›è°ƒ, whileå¾ªç¯è´Ÿè´£å¤„ç†å¤šçº§ç»“ç‚¹è¿”å› */ &#123; --sp; /* å¿½ç•¥å‰é¢æ ‡è®°çš„NULLåˆ†éš”ç¬¦ */ bb = worklist[--sp]; /* å¤„ç†ä¸Šä¸€å±‚çš„ä¸‹ä¸€ä¸ªbb */ ...... after_dom_children (bb); /* å½“å‰ç»“ç‚¹åŠå…¶å­èŠ‚ç‚¹éå†å®Œæ¯•çš„å›è°ƒå‡½æ•° */ &#125; if (sp) bb = worklist[--sp]; /* é€’å½’éå†worklistä¸­ä¸‹ä¸€ä¸ªç»“ç‚¹ */ else break; /* æ•´ä¸ªæ”¯é…æ ‘ç»“ç‚¹çš„DFSéå†å®Œæ¯•, é€€å‡ºå¾ªç¯ */ &#125; free (worklist);&#125; â€‹ ç”±ä¸Šå¯çŸ¥, mark_def_dom_walker (CDI_DOMINATORS).walk (fun-&gt;cfg-&gt;x_entry_block_ptr); å®é™…ä¸Šæ˜¯é€šè¿‡å…¶çˆ¶ç±»çš„walkå‡½æ•°ä»å½“å‰å‡½æ•°çš„å…¥å£bbå¼€å§‹æ ¹æ®DFSç®—æ³•éå†äº†æ­¤å‡½æ•°çš„æ”¯é…æ ‘,å¹¶å¯¹æ¯ä¸ªbbè°ƒç”¨äº†å›è°ƒå‡½æ•°mark_def_dom_walker::before_dom_children,æ­¤å‡½æ•°å®šä¹‰å¦‚ä¸‹: 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950edge mark_def_dom_walker::before_dom_children (basic_block bb)&#123; gimple_stmt_iterator gsi; bitmap_clear (m_kills); /* é‡æ–°æ¸…ç©ºè®°å½•å½“å‰bbä¸­kill defsçš„æ•°ç»„ */ for (gsi = gsi_start_bb (bb); !gsi_end_p (gsi); gsi_next (&amp;gsi)) /* éå†å½“å‰bbä¸­æ‰€æœ‰gimpleè¯­å¥ */ /* åˆ†ææ¯æ¡è¯­å¥ä¸­çš„def/useä¿¡æ¯,ç»“æœæ›´æ–°åˆ°stmt-&gt;vuse/vdef/use_opsçš„åŒæ—¶ä¹Ÿ å°†ç»Ÿè®¡ä¿¡æ¯æ›´æ–°åˆ°å…¨å±€å˜é‡var_infos,interesting_blocks,ä»¥åŠå‚æ•°m_killsä¸­ */ mark_def_sites (bb, gsi_stmt (gsi), m_kills); return NULL;&#125; static void mark_def_sites (basic_block bb, gimple *stmt, bitmap kills)&#123; tree def; use_operand_p use_p; ssa_op_iter iter; update_stmt (stmt); /* åˆ†æstmtä¸­çš„ virutal use/def, real useä¿¡æ¯,å¹¶å°†å…¶æ›´æ–°åˆ°å½“å‰è¯­å¥ stmt-&gt;vuse/vdef/use_opsä¸­ */ ...... set_register_defs (stmt, false); /* é»˜è®¤æ ‡è®°å½“å‰stmtä¸­ä¸å­˜åœ¨æ“ä½œæ•°çš„def/useæ“ä½œ */ set_rewrite_uses (stmt, false); ...... FOR_EACH_SSA_USE_OPERAND (use_p, stmt, iter, SSA_OP_ALL_USES) /* éå†æ­¤stmtä¸­çš„æ‰€æœ‰usesçš„æ“ä½œæ•° */ &#123; tree sym = USE_FROM_PTR (use_p); /* è·å–å½“å‰å¤„ç†çš„æ“ä½œæ•°ä¸­çš„å˜é‡æ ‘èŠ‚ç‚¹ä¿¡æ¯ */ ...... /* åœ¨å½“å‰bbçš„æ¯æ¡è¯­å¥åˆ†æè¿‡ç¨‹ä¸­(è§ä¸‹é¢çš„å¾ªç¯)å¦‚æœå‘ç°äº†æŸå˜é‡çš„def,é‚£ä¹ˆæ­¤defå¯¹äºå½“å‰bbæ¥è¯´å°±æ˜¯ä¸ªkill def, è€Œå¦‚æœåˆ†æåˆ°ä¸€ä¸ªå˜é‡çš„useå‰è¿˜æ²¡æœ‰åœ¨å½“å‰bbä¸­å‘ç°å…¶kill def,åˆ™è¯´æ˜æ­¤å˜é‡çš„å€¼æ¥è‡ªå…¶å‰é©±bb, é‚£ä¹ˆæ­¤æ—¶å°±è¦ æ ‡è®°æ­¤å˜é‡åœ¨å½“å‰bbä¸­å‡ºç°äº†ä¼ æ’­ä½¿ç”¨(set_livein_block) */ if (!bitmap_bit_p (kills, DECL_UID (sym))) /* è‹¥æ­¤å˜é‡åœ¨å½“å‰bbä¸­æœªå‡ºç°kill def */ set_livein_block (sym, bb); /* åœ¨å˜é‡çš„å…¨å±€var_info-&gt;def_blocks-&gt;livein_blocksä¸­æ ‡è®°,å˜é‡symåœ¨åŸºæœ¬å—bbä¸­ä¸ºä¼ æ’­ä½¿ç”¨ */ set_rewrite_uses (stmt, true); /* æ ‡è®°å½“å‰è¯­å¥stmtä¸­æœ‰éœ€è¦è¢«é‡å†™çš„useæ“ä½œæ•° */ &#125; FOR_EACH_SSA_TREE_OPERAND (def, stmt, iter, SSA_OP_ALL_DEFS) /* åŠ¨æ€åˆ†æå½“å‰stmtçš„æ‰€æœ‰defs, å¹¶éå†æ‰€æœ‰è¢«defçš„å˜é‡ */ &#123; ...... set_def_block (def, bb, false); /* åœ¨å½“å‰å˜é‡çš„ var_info-&gt;def_blocks-&gt;def_blocks ä¸­æ ‡è®°åœ¨åŸºæœ¬å—bbä¸­å‡ºç°äº†æ­¤å˜é‡çš„def */ bitmap_set_bit (kills, DECL_UID (def)); /* åœ¨per bbçš„killsæ•°ç»„ä¸­æ ‡è®°å½“å‰bbä¸­å‡ºç°äº†å˜é‡defçš„ kill def */ set_register_defs (stmt, true); /* åœ¨å½“å‰è¯­å¥stmtä¸­æ ‡è®°å…¶ä¸­å‡ºç°äº†æŸæ“ä½œæ•°çš„defæ“ä½œ */ &#125; /* å½“å½“å‰åˆ†æçš„bbä¸­ä»»ä½•ä¸€æ¡è¯­å¥(stmt)ä¸­å‡ºç°äº†æ“ä½œæ•°çš„use/defæ“ä½œ,å½“å‰bbå°±è¦è¢«æ ‡è®°ä¸ºinteresting. é™¤äº†ç‰¹åˆ«ç®€å•çš„bb,åŸºæœ¬ä¸Šå¤§éƒ¨åˆ†bbéƒ½ä¼šæ ‡è®°åˆ°interesting_blocksä¸­ */ if (rewrite_uses_p (stmt) || register_defs_p (stmt)) bitmap_set_bit (interesting_blocks, bb-&gt;index);&#125; ä¸ºæ¯ä¸ªå˜é‡æ’å…¥phiå‡½æ•°â€‹ åˆ†æå®Œdef/useä¿¡æ¯å,åˆ™éœ€è¦ä¸ºå½“å‰å‡½æ•°çš„æ¯ä¸ªå˜é‡åœ¨éœ€è¦çš„ä½ç½®(bb)å¤„æ’å…¥phiå‡½æ•°,æ­¤è¿‡ç¨‹æ˜¯åœ¨å‡½æ•° insert_phi_nodesä¸­å®ç°çš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118/* æ­¤å‡½æ•°è´Ÿè´£ä¸ºå½“å‰å‡½æ•°ä¸­æ‰€æœ‰å˜é‡åœ¨éœ€è¦æ’å…¥phiå‡½æ•°çš„bbä¸­æ’å…¥phiå‡½æ•°ï¼Œ phiå‡½æ•°å…¨éƒ¨è®°å½•åœ¨æ¯ä¸ªbb-&gt;gimple_df-&gt;phi_nodesä¸­ éœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ—¶phiå‡½æ•°çš„å‚æ•°å°šæœªå¡«å……,åªæœ‰è¿”å›å€¼å¡«å……äº†(å…¶å¯¹åº”å˜é‡æ´¾ç”Ÿçš„SSA_NAME)*/static void insert_phi_nodes (bitmap_head *dfs)&#123; var_info *info; ...... /* var_infos[]ä¸­è®°å½•äº†å½“å‰å‡½æ•°æ‰€æœ‰å˜é‡(local_decls)åœ¨æ•´ä¸ªå‡½æ•°ä¸­çš„def/useä¿¡æ¯, è€Œåœ¨def/useåˆ†æä¸­ç®€å•çš„æ’é™¤äº†ä¸€äº›ä¸éœ€è¦æ’å…¥phiå‡½æ•°çš„å˜é‡(need_phi_state = NEED_PHI_STATE_NOçš„å˜é‡, è¿™æ ·çš„å˜é‡åœ¨æ•´ä¸ªå‡½æ•°ä¸­åªå­˜åœ¨ä¸€ä¸ªdef,ä¸”å…¶æ‰€æœ‰useç‚¹æ‰€åœ¨çš„bbéƒ½è¢«defæ‰€åœ¨çš„bbæ”¯é…),è€Œvarsæ•°ç»„ä¸­æœ€ç»ˆåªè®°å½•äº†é‚£äº›å¯èƒ½éœ€è¦æ’å…¥phiå‡½æ•°çš„å˜é‡åšäºŒæ¬¡åˆ†æå’Œå¤„ç† */ auto_vec&lt;var_info *&gt; vars (var_infos-&gt;elements ()); FOR_EACH_HASH_TABLE_ELEMENT (*var_infos, info, var_info_p, hi) if (info-&gt;info.need_phi_state != NEED_PHI_STATE_NO) vars.quick_push (info); vars.qsort (insert_phi_nodes_compare_var_infos); /* æ ¹æ®å˜é‡çš„UIDæ’åº */ FOR_EACH_VEC_ELT (vars, i, info) /* éå†å½“å‰å‡½æ•°ä¸­æ¯ä¸ªå¯èƒ½è¦æ’å…¥phiç»“ç‚¹çš„å˜é‡(infoä¸ºè¿­ä»£å™¨) */ &#123; /* * info-&gt;info.def_blocks.def_blocks è®°å½•info-&gt;varè¿™ä¸ªå˜é‡åœ¨å„ä¸ªbbä¸­çš„defä¿¡æ¯(bitmap) * dtfè®°å½•æ•´ä¸ªå‡½æ•°æ‰€æœ‰bbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯ æ­¤å‡½æ•°æ ¹æ®äºŒè€…è®¡ç®—å‡ºéœ€è¦ä¸ºå½“å‰å˜é‡varæ’å…¥phiå‡½æ•°çš„æ‰€æœ‰bbçš„ä¿¡æ¯,è¿”å›çš„idfåŒæ ·æ˜¯ä¸€ä¸ªbitmap,è‹¥idf[i]-1,åˆ™ä»£è¡¨åœ¨ç¼–å·ä¸ºiçš„bbä¸­éœ€è¦ä¸ºå˜é‡info-&gt;varæ’å…¥phiå‡½æ•° */ bitmap idf = compute_idf (info-&gt;info.def_blocks.def_blocks, dfs); /* æ ¹æ®idfè¿™ä¸ªbitmap, å‘å…¶å¯¹åº”çš„bbä¸­ä¸ºå˜é‡info-&gt;varåˆ›å»ºä¸€ä¸ªgphiæŒ‡ä»¤,å¹¶å°†æ­¤æŒ‡ä»¤æ·»åŠ åˆ° bb-&gt;gimple_df-&gt;phi_nodesä¸­, ifdæ˜¯æ ‡å‡†ç®—æ³•ç®—å‡ºçš„phiå‡½æ•°æ’å…¥ç‚¹,è€Œæ­¤å‡½æ•°åœ¨åˆ›å»ºå‰è¿˜ä¼šå†æ¬¡è£å‰ª idf bitmap(å¯¹äºå˜é‡kill defä¸”ä¸å­˜åœ¨livein useçš„bb,æ— éœ€æ’å…¥phiå‡½æ•°) */ insert_phi_nodes_for (info-&gt;var, idf, false); BITMAP_FREE (idf); &#125;&#125; /* æ­¤å‡½æ•°è´Ÿè´£æ ¹æ®å˜é‡varçš„defä¿¡æ¯(def_blocks)å’Œæ•´ä¸ªå‡½æ•°æ‰€æœ‰bbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯,(dfs) è®¡ç®—å‡ºéœ€è¦ä¸ºæ­¤å‡½æ•°æ’å…¥phiå‡½æ•°çš„bbä¿¡æ¯(bitmap phi_insertion_points)å¹¶è¿”å›æ­¤bitmap phiå‡½æ•°çš„ç®—æ³•æ˜¯: 1) å½“å‰å˜é‡xæ‰€æœ‰çš„defç‚¹(bb)çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¸­æ‰€æœ‰ç»“ç‚¹éƒ½éœ€è¦æ’å…¥phiå‡½æ•° 2) æ’å…¥çš„phiå‡½æ•°ç›¸å½“äºå¯¹å˜é‡xçš„éšå¼def,æ•…æ’å…¥äº†phiå‡½æ•°çš„ç»“ç‚¹(bb)çš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¸­æ‰€æœ‰ç»“ç‚¹ä¹Ÿéƒ½è¦æ’å…¥phiå‡½æ•° 3) é’ˆå¯¹ä¸€ä¸ªå˜é‡x, ä»»ä½•ä¸€ä¸ªbbä¸­åªéœ€è¦ä¸ºå…¶æ’å…¥ä¸€ä¸ªphiå‡½æ•°å³å¯,æ— éœ€é‡å¤æ’å…¥,å› ä¸ºphiå‡½æ•°å‚æ•°æ¥è‡ªäºæ‰€æœ‰å‰é©±,ä¸€ä¸ªphiå‡½æ•°å°±ä»£è¡¨äº†æ‰€æœ‰å¯èƒ½çš„éšå¼def;*/bitmap compute_idf (bitmap def_blocks, bitmap_head *dfs)&#123; bitmap_iterator bi; unsigned bb_index, i; bitmap phi_insertion_points; auto_vec&lt;int&gt; work_stack (2 * n_basic_blocks_for_fn (cfun)); /* æ­¤bitmapä¸ºå‡½æ•°çš„è¿”å›å€¼, å…¶æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„,ä¸‹æ ‡ä¸ºbbåœ¨å½“å‰å‡½æ•°çš„ç´¢å¼•å·ï¼Œ phi_insertion_points[i] = 1;åˆ™ä»£è¡¨å½“å‰bbä¸­éœ€è¦ä¸ºå˜é‡xæ’å…¥phiå‡½æ•° */ phi_insertion_points = BITMAP_ALLOC (NULL); /* æŒ‰ç…§ç®—æ³•, phiå‡½æ•°éœ€è¦æ’å…¥åˆ°å˜é‡ xæ‰€æœ‰defç‚¹æ‰€åœ¨bbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œç»“ç‚¹ä¸­, è¿™é‡Œé¦–å…ˆå°†æ‰€æœ‰å‡ºç°å˜é‡x defç‚¹çš„bbåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ */ EXECUTE_IF_SET_IN_BITMAP (def_blocks, 0, bb_index, bi) work_stack.quick_push (bb_index); while (work_stack.length () &gt; 0) &#123; bb_index = work_stack.pop (); /* è·å–ä¸‹ä¸€ä¸ªå­˜åœ¨å˜é‡x defçš„bbçš„ç¼–å· */ /* &amp;dfs[bb_index] è®°å½•ç´¢å¼•å·ä¸ºbb_indexçš„bbçš„æ”¯é…ç»“ç‚¹è¾¹ç•Œä¿¡æ¯(ä¸‹æ ‡ä¸ºbbç´¢å¼•å·, dfs[bb_index][i] = 1; åˆ™ä»£è¡¨ç¼–å·ä¸ºiçš„bbä¸ºç¼–å·ä¸º bb_indexçš„bbçš„æ”¯é…ç»“ç‚¹) æ­¤å®å±•å¼€åä¼šä¾æ¬¡æ¯”è¾ƒ dfs[bb_index] å’Œphi_insertion_points ä¸­çš„æ¯ä¸€ä¸ªbit,è‹¥ dfs[bb_index][i] = 1; è€Œphi_insertion_points[i] = 0; åˆ™ä»£è¡¨å‘ç°äº† æ–°çš„éœ€è¦æ’å…¥phiå‡½æ•°çš„bb(ç¼–å·ä¸ºi),æ­¤æ—¶ä¼šå°†i pushåˆ°work_stackä¸­,ä¸‹ä¸€æ¬¡å¾ªç¯åä¼šé€’å½’éå†æ­¤bb; */ EXECUTE_IF_AND_COMPL_IN_BITMAP (&amp;dfs[bb_index], phi_insertion_points, 0, i, bi) &#123; work_stack.quick_push (i); /* ç»“ç‚¹iå› æ’å…¥äº†Ï†å‡½æ•°,å…¶æ”¯é…ç»“ç‚¹è¾¹ç•Œç»“ç‚¹ä¹Ÿè¦åŠ å…¥åˆ° phi_insertion_pointsä¸­ */ bitmap_set_bit (phi_insertion_points, i); /* æ ‡è®°ç»“ç‚¹iä¸­éœ€è¦æ’å…¥Ï†å‡½æ•° */ &#125; &#125; return phi_insertion_points;&#125; /* æ­¤å‡½æ•°ä¸ºå˜é‡varåœ¨éœ€è¦æ’å…¥phiå‡½æ•°çš„bbä¸­æ’å…¥gphiæŒ‡ä»¤(åŒ…æ‹¬åˆ›å»º,æ´¾ç”Ÿvarçš„ä¸€ä¸ªSSA_NAMEä½œä¸ºgphiè¿”å›å€¼,å¹¶å°†gphiæ’å…¥åˆ°bb-&gt;gimple_df-&gt;phi_nodesæŒ‡ä»¤åºåˆ—ä¸­) åœ¨æ’å…¥å‰ä¼šå°è¯•åˆ é™¤ä¸€äº›ä¸éœ€è¦æ’å…¥phiå‡½æ•°çš„ç‚¹(å¦‚æœå˜é‡varåœ¨æŸä¸ªbbä¸­ä¸å­˜åœ¨liven_use,ä¸”å­˜åœ¨kill_def,åˆ™æ­¤bbæ— éœ€æ’å…¥phiå‡½æ•°)*/static void insert_phi_nodes_for (tree var, bitmap phi_insertion_points, bool update_p)&#123; unsigned bb_index; edge e; gphi *phi; basic_block bb; bitmap_iterator bi; def_blocks *def_map = find_def_blocks_for (var); /* æ­¤ç»“æ„ä½“ä¸­å­˜ç€å˜é‡varçš„å¤šä¸ªbitmap,åŒ…æ‹¬ kill def/livein use */ ...... /* def_blockså’Œ livein_blockséƒ½æ˜¯åœ¨ å„ä¸ªbbçš„mark_def_sitesä¸­åˆ†æå‡ºçš„: * def_blocks[i] = 1;ä»£è¡¨å˜é‡varåœ¨ç¼–å·ä¸ºiçš„bbä¸­å‡ºç°äº†kill def; * livein_blocks[i] = 1; ä»£è¡¨å˜é‡varåœ¨ç¼–å·ä¸ºiçš„bbä¸­å‡ºç°äº†ä¼ æ’­ä½¿ç”¨(ä¹Ÿå°±æ˜¯ç¬¬ä¸€æ¬¡è®¿é—®æ˜¯use,è€Œä¸æ˜¯def) è€Œåœ¨ä¸€ä¸ªbbä¸­,å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰å‡ºç°livein,ä¸”å­˜åœ¨kill def,é‚£ä¹ˆè¿™ä¸ªbbä¸­æ˜¯ä¸éœ€è¦æ’å…¥phiå‡½æ•°çš„,ç®€å•è¯´å°±æ˜¯:åœ¨ä¸€ä¸ªbbçš„é¡ºåºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­, ä¸€ä¸ªå˜é‡å…ˆè¢«èµ‹å€¼ç„¶åæ‰è¢«ä½¿ç”¨,é‚£ä¹ˆåœ¨SSAåŒ–æ—¶å…¶å‰é©±bbå¯¹æ­¤å˜é‡çš„defå°±ä¸å¿…è€ƒè™‘äº†(å› ä¸ºæ²¡æœ‰äººç”¨), ä½†å¦‚æœå˜é‡åœ¨æ­¤bbä¸­æ²¡æœ‰defåˆ™å¿…é¡»æ’å…¥phiå‡½æ•°, å¦åˆ™ä¼šå½±å“åˆ°æ­¤bbåç»­bbä¸­varçš„å®šå€¼. è¿™é‡Œå°±æ˜¯ä»phi_insertion_pointsä¸­å»é™¤äº†livein_use,ä¸”æœ‰kill defçš„bb,è¿™äº›bbæ— éœ€æ’å…¥phiå‡½æ•° */ prune_unused_phi_nodes (phi_insertion_points, def_map-&gt;def_blocks, def_map-&gt;livein_blocks); /* phi_insertion_points ä¸­å‰©ä½™çš„ç»“ç‚¹å‡éœ€è¦ä¸ºå˜é‡varæ’å…¥phiå‡½æ•°,è¿™é‡Œéå†å…¶ä¸­æ¯ä¸ªbb */ EXECUTE_IF_SET_IN_BITMAP (phi_insertion_points, 0, bb_index, bi) &#123; bb = BASIC_BLOCK_FOR_FN (cfun, bb_index); /* æ ¹æ®bb_indexè·å–bbçš„basic_blockç»“æ„ä½“ */ if (update_p) mark_block_for_update (bb); if (TREE_CODE (var) == SSA_NAME) &#123; /* SSA_NAME æ˜¯åœ¨ update_ssaä¸­ç”¨åˆ°çš„,å…ˆpass */ ...... &#125; else &#123; /* æ­£å¸¸å˜é‡æ˜¯èµ°è¿™é‡Œ */ /* åˆ›å»ºä¸€ä¸ªgphiæŒ‡ä»¤,ä¸ºå˜é‡varç”Ÿæˆä¸€ä¸ªæ–°çš„SSA_NAMEè®¾ç½®ä¸ºæ­¤gphiçš„è¿”å›å€¼ç»“ç‚¹(æ‰€ä»¥phiå‡½æ•°çš„è¿”å›å€¼SSA_NAMEçš„versionç¼–å·éƒ½è¾ƒå°), gphiæŒ‡ä»¤çš„æ‰€æœ‰å‚æ•°éƒ½æš‚ä¸å¡«å……(å› ä¸ºæ‰€æœ‰çš„æŒ‡ä»¤å°šæœªSSAåŒ–,æ— æ³•å¡«å……), å¹¶å°†æ–°ç”Ÿæˆçš„gphiæŒ‡ä»¤é“¾æ¥åˆ°å½“å‰bb-&gt;gimple_df-&gt;phi_nodesæŒ‡ä»¤åºåˆ—çš„æœ«å°¾ */ phi = create_phi_node (var, bb); ...... &#125; set_register_defs (phi, true); /* æ ‡è®°å½“å‰gphiè¯­å¥ä¸­å­˜åœ¨defæ“ä½œ(å› ä¸ºå…¶è¿”å›å€¼ç»“ç‚¹è¢«defäº†) */ mark_phi_for_rewrite (bb, phi); &#125;&#125; æŒ‡ä»¤é‡å†™(SSAåŒ–)â€‹ phiå‡½æ•°æ’å…¥å®Œæ¯•å,éœ€è¦å¯¹æ•´ä¸ªå‡½æ•°æ‰€æœ‰bbä¸­çš„æ‰€æœ‰æŒ‡ä»¤åºåˆ—ä¸­æ‰€æœ‰çš„def/useå˜é‡è¿›è¡Œé‡å†™,æ­¤è¿‡ç¨‹æ˜¯åœ¨å‡½æ•°rewrite_blocks ä¸­å®Œæˆçš„ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174static void rewrite_blocks (basic_block entry, enum rewrite_mode what)&#123; ...... if (what == REWRITE_ALL) /* æŒ‰ç…§DFSéå†å½“å‰å‡½æ•°çš„æ”¯é…æ ‘,å¹¶åœ¨: * éå†åˆ°æŸä¸ªbbæ—¶æ‰§è¡Œå›è°ƒ rewrite_dom_walker::before_dom_children * éå†å®ŒæˆæŸä¸ªbb(åŠå…¶æ‰€æœ‰sub bb)åæ‰§è¡Œå›è°ƒ rewrite_dom_walker::after_dom_children */ rewrite_dom_walker (CDI_DOMINATORS).walk (entry); /* pass_build_ssaæ—¶èµ°è¿™é‡Œ */ else if (what == REWRITE_UPDATE) rewrite_update_dom_walker (CDI_DOMINATORS).walk (entry); else gcc_unreachable (); ......&#125; struct def_blocks&#123; bitmap def_blocks; /* è®°å½•å½“å‰å˜é‡åœ¨å“ªäº›bbä¸­å‡ºç°äº†kill def */ bitmap phi_blocks; bitmap livein_blocks; /* è®°å½•å½“å‰å˜é‡åœ¨å“ªäº›bbä¸­å‡ºç°äº†livein use */&#125;; struct common_info&#123; ENUM_BITFIELD (need_phi_state) need_phi_state : 2; /* è®°å½•def/useåˆ†æä¸­ç®€å•çš„åˆ¤æ–­ç»“æœ,å³å½“å‰å˜é‡æ˜¯å¦ä¸éœ€è¦æ’å…¥phiå‡½æ•° */ tree current_def; /* è®°å½•æ­¤å˜é‡åœ¨rewrite_stmtä¸­å½“å‰çš„å®šä¹‰(é€šå¸¸æ˜¯å…¶ä¸€ä¸ªSSA_NAME) */ struct def_blocks def_blocks; /* è®°å½•æ­¤å˜é‡åœ¨æ‰€æœ‰bbä¸­çš„kill def/livein use ä¿¡æ¯ */&#125;; struct var_info&#123; tree var; /* æ­¤var_infoä¸­è®°å½•äº†å“ªä¸ªå˜é‡çš„ä¿¡æ¯ */ common_info info; /* è®°å½•æ­¤å˜é‡çš„def/use,currdefç­‰ç›¸å…³ä¿¡æ¯ */ &#125;; /* æ­¤å‡½æ•°è´Ÿè´£åœ¨DFSéå†åˆ°æ”¯é…æ ‘ä¸­æ¯ä¸ªç»“ç‚¹bbæ—¶,å°†å…¶ä¸­çš„æ‰€æœ‰stmt SSAåŒ–, SSAåŒ–çš„æµç¨‹åˆ†ä¸ºä¸‰æ­¥: 1. å°†æ­¤bbä¸­æ‰€æœ‰phiå‡½æ•°çš„è¿”å›å€¼è®¾ç½®ä¸ºå…¶å¯¹åº”å˜é‡çš„currdef 2. éå†æ­¤bbä¸­æ‰€æœ‰stmt, å°†å…¶ä¸­æ‰€æœ‰useçš„æ“ä½œæ•°æ”¹ä¸ºå…¶currdef; è‹¥ç¢°åˆ°defåˆ™ä¸ºå…¶åŸå§‹å˜é‡varç”Ÿæˆä¸€ä¸ªæ–°çš„SSA_NAME,å°†defçš„æ“ä½œæ•°å’Œcurrdefæ›¿æ¢ä¸ºæ–°çš„SSA_NAME 3. éå†æ­¤bbåœ¨å‡½æ•°CFGä¸­æ‰€æœ‰çš„åç»§bb, å¡«å……åç»§bbä¸­æ‰€æœ‰phiæŒ‡ä»¤çš„ä¸€ä¸ªå‚æ•°(ç¬¬xä¸ªå‚æ•°,xä¸ºæ­¤bbåœ¨å…¶åç»§bbçš„æ‰€æœ‰å‰é©±ç»“ç‚¹ä¸­çš„ç¼–å·)*/edge rewrite_dom_walker::before_dom_children (basic_block bb)&#123; ...... block_defs_stack.safe_push (NULL_TREE); /* åœ¨stackä¸­åšä¸€ä¸ªæ ‡è®°,ä»£è¡¨å½“å‰å¼€å§‹å¤„ç†ä¸€ä¸ªæ–°çš„bb */ /* å¯¹äºä¸€ä¸ªå˜é‡xæ¥è¯´,å…¶phiå‡½æ•°çš„ä½œç”¨å°±æ˜¯åœ¨SSAåŒ–çš„è¿‡ç¨‹ä¸­ä¸ºphiå‡½æ•°æ‰€åœ¨bbæ•´åˆæ­¤å˜é‡åœ¨å…¶å„ä¸ªå‰é©±bbä¸­çš„å®šä¹‰, æ•…åœ¨SSAåŒ–çš„é‡å†™é˜¶æ®µ,è‹¥ä¸€ä¸ªå˜é‡åœ¨æŸä¸ªbbä¸­æœ‰phiå‡½æ•°,é‚£ä¹ˆphiå‡½æ•°çš„è¿”å›å€¼(xçš„ä¸€ä¸ªSSA_NAME,è§insert_phi_nodes)ä¼šä½œä¸ºåˆ†ææ­¤bbæ—¶xçš„æœ€æ–°å®šä¹‰. è¿™é‡Œæ˜¯å°†å½“å‰bbçš„æ‰€æœ‰phiå‡½æ•°çš„è¿”å›å€¼,è®¾ç½®ä¸ºå…¶å¯¹åº”å˜é‡çš„æœ€æ–°å®šä¹‰(å˜é‡çš„var_info.currdef) */ for (gphi_iterator gsi = gsi_start_phis (bb); !gsi_end_p (gsi); gsi_next (&amp;gsi)) &#123; /* è·å–gphiæŒ‡ä»¤çš„è¿”å›å€¼ç»“ç‚¹,å…¶å¿…ä¸ºä¸€ä¸ªSSA_NAMEç»“ç‚¹,è§phiå‡½æ•°çš„åˆ›å»ºè¿‡ç¨‹ pass_build_ssa =&gt; insert_phi_nodes =&gt; insert_phi_nodes_for =&gt; create_phi_node */ tree result = gimple_phi_result (gsi_stmt (gsi)); /* è·å–æ­¤phiå‡½æ•°è¿”å›å€¼ç»“ç‚¹ */ /* å°†è¿”å›å€¼ç»“ç‚¹è®¾ç½®ä¸ºå…¶åŸå§‹å˜é‡çš„currdef, å¦‚: è‹¥å½“result ä¸ºSSA_NAME x_1, åˆ™ SSA_NAME_VAR (result)ä¸ºå˜é‡x,è¿™é‡Œè®¾ç½® xçš„var_info.curredef = (tree)x_1; */ register_new_def (result, SSA_NAME_VAR (result)); &#125; if (bitmap_bit_p (interesting_blocks, bb-&gt;index)) /* è‹¥å½“å‰bbåœ¨å‰é¢def/useåˆ†æä¸­å‘ç°å…¶ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ªdef/use */ /* éå†å½“å‰bbä¸­çš„æ¯ä¸€æ¡è¯­å¥,å¹¶ä¿®æ”¹æ¯æ¡è¯­å¥ä¸­éœ€è¦è¢«é‡å†™çš„æ“ä½œæ•°ï¼Œæ³¨æ„è¿™é‡Œéå†çš„æ˜¯bb-&gt;gimple_df-&gt;seqs, è€Œä¸æ˜¯phi_nodes */ for (gimple_stmt_iterator gsi = gsi_start_bb (bb); !gsi_end_p (gsi); gsi_next (&amp;gsi)) rewrite_stmt (&amp;gsi); /* æ­¤å‡½æ•°è´Ÿè´£å¯¹ä¸€æ¡æŒ‡ä»¤(stmt)è¿›è¡Œé‡å†™ */ /* å½“å‰bbé‡å†™å®Œæ¯•(SSAåŒ–å®Œæ¯•),åˆ™æ‰€æœ‰çš„å˜é‡éƒ½å·²ç»å˜ä¸ºå…¶SSAå½¢å¼äº†,æ­¤æ—¶éœ€è¦ä¸ºå…¶æ‰€æœ‰åç»§ç»“ç‚¹å¡«å……æ‰€æœ‰phiå‡½æ•°çš„ç¬¬iä¸ªå‚æ•°, iä¸ºæ­¤bbåœ¨å…¶åç»§çš„å‰é©±ç»“ç‚¹ä¸­çš„ç¼–å· */ rewrite_add_phi_arguments (bb); return NULL;&#125; /* æ­¤å‡½æ•°è´Ÿè´£é‡å†™si-&gt;ptrè¿™æ¡è¯­å¥(stmt)ä¸­çš„æ‰€æœ‰def/use,å°†æ­¤stmt SSAåŒ–, å…¶å¤„ç†é¡ºåºæ˜¯å…ˆå¤„ç†useåå¤„ç†def,è¿™ä¹Ÿç¬¦åˆæ­£å¸¸ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œçš„é€»è¾‘,stmtä¸­: * å‘ç°æ‰€æœ‰å¯¹åŸå§‹å˜é‡varçš„useçš„æ“ä½œæ•°æŒ‡é’ˆ,éƒ½ä¼šè¢«æ”¹ä¸º(æŒ‡å‘)å¯¹å…¶currdefè¿™ä¸ªSSA_NAMEç»“ç‚¹ * å‘ç°æ‰€æœ‰å¯¹åŸå§‹å˜é‡varçš„def,éƒ½ä¼šå…ˆä¸ºå˜é‡varæ–°ç”Ÿæˆä¸€ä¸ªSSA_NAME,å¹¶å°†defæ“ä½œæ•°çš„æŒ‡é’ˆæ”¹ä¸º(æŒ‡å‘)æ–°SSA_NAMEç»“ç‚¹,å¹¶å°†æ–°çš„SSA_NAMEæ›´æ–°åˆ°å˜é‡varçš„currdef*/static void rewrite_stmt (gimple_stmt_iterator *si)&#123; gimple *stmt = gsi_stmt (*si); /* è‹¥å½“å‰è¯­å¥ä¸­æ²¡æœ‰éœ€è¦è¢«é‡å†™çš„use/def,åˆ™ç›´æ¥è¿”å› */ if (!rewrite_uses_p (stmt) &amp;&amp; !register_defs_p (stmt)) return; if (rewrite_uses_p (stmt)) /* 1.è‹¥å½“å‰è¯­å¥ä¸­å­˜åœ¨éœ€è¦è¢«é‡å†™çš„use operands,åˆ™å…ˆé‡å†™usesæ‰€æœ‰çš„usesæ“ä½œæ•° */ &#123; ...... /* éå†å½“å‰stmtçš„real useé“¾è¡¨(stmt-&gt;use_ops),å…¶ä¸­è®°å½•äº†å½“å‰stmt SSAåŒ–æ—¶éœ€è¦è¢«ä¿®æ”¹çš„USEæ“ä½œæ•°, å¹¶å°†å…¶ä¿®æ”¹ä¸ºå¯¹åº”å˜é‡çš„å½“å‰SSA_NAMEå®šä¹‰ å¦‚ y = x; è‹¥æ­¤æŒ‡ä»¤è§£æå‰xçš„å½“å‰å®šä¹‰ä¸ºx_1,åˆ™è¿™é‡Œå°†æŒ‡ä»¤ä¿®æ”¹ä¸º y = x_1; */ FOR_EACH_SSA_USE_OPERAND (use_p, stmt, iter, SSA_OP_ALL_USES) &#123; /* use_p-&gt;use æŒ‡å‘æ­¤stmtçš„ä¸€ä¸ªæ“ä½œæ•°çš„å†…å­˜,è¿™é‡Œå…ˆè·å–å…¶åŸå§‹æ“ä½œæ•°var(å³ var = *use_p-&gt;use) */ tree var = USE_FROM_PTR (use_p); ...... /* ä¿®æ”¹æ­¤æ“ä½œæ•°ä¸ºå˜é‡varçš„å½“å‰å®šä¹‰(currdef), å³ *use_p-&gt;use = var_1; (è‹¥currdefä¸ºvar_1) */ SET_USE (use_p, get_reaching_def (var)); &#125; &#125; if (register_defs_p (stmt)) /* 2. è‹¥å½“å‰è¯­å¥ä¸­å­˜åœ¨éœ€è¦è¢«é‡å†™çš„def operands(è§mark_def_sites),åˆ™é‡å†™æ‰€æœ‰çš„defsæ“ä½œæ•° */ FOR_EACH_SSA_DEF_OPERAND (def_p, stmt, iter, SSA_OP_ALL_DEFS) &#123; tree var = DEF_FROM_PTR (def_p); /* ä»stmtä¸­çš„defæ“ä½œæ•°ä¸­è¯»å–å½“å‰è¢«defçš„å˜é‡çš„æ ‘èŠ‚ç‚¹ */ tree name; ...... if (TREE_CODE (var) == SSA_NAME) continue; /* å¿½ç•¥SSA_NAME */ gcc_checking_assert (DECL_P (var)); ...... name = make_ssa_name (var, stmt); /* ä¸ºå˜é‡varæ–°çš„defç‚¹é‡æ–°åˆ†é…ä¸€ä¸ªvarçš„SSA_NAME */ SET_DEF (def_p, name); /* å°†stmtæŸæ“ä½œæ•°ä¸­çš„å˜é‡varä¿®æ”¹ä¸ºå…¶SSA_NAME,å°†å®šä¹‰è½¬åŒ–ä¸ºé™æ€å•èµ‹å€¼å½¢å¼ */ /* åœ¨æ”¯é…æ ‘çš„DFSéå†ä¸­, å˜é‡varçš„å½“å‰å®šä¹‰æ­¤æ—¶å·²ç»å˜ä¸ºäº†æ–°ç”Ÿæˆçš„SSA_NAME name, å°†å…¶æ›´æ–°åˆ°å˜é‡varçš„currdefä¸­,åç»­å†å‡ºç°çš„useåˆ™ä½¿ç”¨æ­¤æ–°çš„def, éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œ,è¿™é‡Œä¼šåœ¨å…¨å±€block_defs_stackä¸­ä¿å­˜æ‰€æœ‰æ—§çš„def,åœ¨rewrite_dom_walker::after_dom_childrenä¼šæ¢å¤å·²æœ‰ä¿®æ”¹, å› ä¸º åœ¨æ”¯é…æ ‘çš„DFSéå†ä¸­è‹¥æœ‰ A=&gt;B, A=&gt;C; é‚£ä¹ˆåˆ†æBæ—¶äº§ç”Ÿçš„defåªä½œç”¨äºBä»¥åŠå…¶æ‰€æœ‰sub bb, è€Œå½“å›åˆ°Aé‡æ–°éå†Cæ—¶è¦é‡æ–°ä½¿ç”¨Aä¸­çš„defç»§ç»­åˆ†æ, æ‰€ä»¥è¿™é‡Œä¼šæœ‰ä¸€ä¸ªå…¥æ ˆæ“ä½œ.after_dom_childrenä¸­å®Œæˆå‡ºæ ˆæ“ä½œ */ register_new_def (DEF_FROM_PTR (def_p), var); ...... &#125;&#125; /* åœ¨ä¸€ä¸ªbbåŠå…¶æ‰€æœ‰sub bbå¤„ç†å®Œæˆå,è¦æ¢å¤æ­¤bbä¸­çš„æ‰€æœ‰currdef,æ¢å¤åæ‰å¯ä»¥ç»§ç»­éå†æ­¤bbçš„å…„å¼Ÿbb,æ­¤å‡½æ•°åˆ™å®Œæˆcurrdefçš„æ¢å¤æ“ä½œ */void rewrite_dom_walker::after_dom_children (basic_block bb ATTRIBUTE_UNUSED)&#123; while (block_defs_stack.length () &gt; 0) /* éå†defæ ˆä¸­çš„æ‰€æœ‰å†…å®¹, å…¶æ’å…¥ç‚¹æ˜¯ä¸Šé¢çš„register_new_defå‡½æ•° */ &#123; tree tmp = block_defs_stack.pop (); /* è·å–stackä¸­ä¸€ä¸ªè¦æ¢å¤çš„SSA_NAME */ tree saved_def, var; if (tmp == NULL_TREE) break; /* éå†å½“NULL_TREEä»£è¡¨å½“å‰bbä¹‹å‰çš„æ‰€æœ‰å…¥æ ˆå¤„ç†å®Œæ¯•,NULL_TREEåœ¨æ ˆä¸­ä½œä¸ºåˆ†éš”ç¬¦åˆ†éš”å„ä¸ªbbçš„æ ˆä¿¡æ¯ */ if (TREE_CODE (tmp) == SSA_NAME) &#123; /* å¤§å¤šæ•°æƒ…å†µä¸‹ä¹‹å‰pushè¿›æ¥çš„ç»“ç‚¹ä¸ºæŸä¸ªå˜é‡çš„SSA_NAMEç»“ç‚¹ */ saved_def = tmp; /* å½“å‰éœ€è¦æ¢å¤çš„SSA_NAME */ var = SSA_NAME_VAR (saved_def); /* è·å–SSA_NAMEçš„åŸå§‹å˜é‡ */ ...... &#125; else &#123; /* éSSA_NAMEåˆ™è¯´æ˜pushåˆ°åŸå§‹å˜é‡äº†,è¯´æ˜åœ¨å½“å‰bbçš„çˆ¶èŠ‚ç‚¹ä¹‹å‰æ²¡æœ‰å˜é‡varçš„defå‡ºç° */ saved_def = NULL; /* æ²¡æœ‰defå‡ºç°æ—¶æ ‡è®°saved_defä¸ºç©º */ var = tmp; /* tmoå³ä¸ºåŸå§‹å˜é‡ */ &#125; /* varä¸ºåŸå§‹å˜é‡,å…ˆæ‰¾åˆ°å…¶var_infoç»“æ„ä½“,ç„¶åæ¢å¤å…¶ä¹‹å‰å®šä¹‰ä¸º saved_def */ get_common_info (var)-&gt;current_def = saved_def; &#125;&#125; /* æ­¤å‡½æ•°è´Ÿè´£éå†å½“å‰bbåœ¨å‡½æ•°CFGä¸­çš„æ‰€æœ‰åç»§bb, éå†æ¯ä¸ªåç»§bbä¸­çš„æ¯ä¸€æ¡phiæŒ‡ä»¤,å…¶ç›®çš„æ˜¯ä¸ºäº†å¡«å……æ‰€æœ‰bbä¸­æ‰€æœ‰phiå‡½æ•°çš„ä¸€ä¸ªå‚æ•°, åç»§bbä¸­æ‰€æœ‰phiå‡½æ•°çš„å‚æ•°éƒ½æ¥è‡ªå…¶å‰é©±bb,åœ¨å…¶å‰é©±bb SSAåŒ–åè¦ç«‹å³ä¸ºå…¶æ‰€æœ‰åç»­bbæ·»åŠ SSAåŒ–åçš„å‚æ•°*/static void rewrite_add_phi_arguments (basic_block bb)&#123; edge e; edge_iterator ei; FOR_EACH_EDGE (e, ei, bb-&gt;succs) /* éå†å½“å‰bbçš„æ‰€æœ‰ç›´æ¥åç»§bb,è¿™é‡Œéå†çš„æ˜¯è¾¹ */ &#123; gphi *phi; gphi_iterator gsi; for (gsi = gsi_start_phis (e-&gt;dest); !gsi_end_p (gsi); gsi_next (&amp;gsi)) /* éå†æ¯ä¸ªåç»§bbä¸­çš„æ‰€æœ‰phiè¯­å¥ */ &#123; phi = gsi.phi (); res = gimple_phi_result (phi); /* è·å–phiå‡½æ•°çš„è¿”å›å€¼èŠ‚ç‚¹, ä¹Ÿå°±æ˜¯æ­¤gphiè¯­å¥ä¸­æœ€ç»ˆdefçš„é‚£ä¸ª SSA_NAME */ /* SSA_NAME_VAR (res))è·å–ssa name å¯¹åº”çš„varèŠ‚ç‚¹, è€Œget_reaching_def åˆ™è·å–varå˜é‡å½“å‰æœ€æ–°çš„defæ˜¯å“ªä¸ªå˜é‡, å¦‚reså¯èƒ½æ˜¯var_1 = Ï†(,...) ä¸­çš„var_1(SSA_NAME),è€Œè¿”å›çš„currdefæ˜¯varçš„æœ€æ–°å®šä¹‰(å¯èƒ½æ˜¯var_3,ä¹Ÿæ˜¯ä¸ªSSA_NAME) */ currdef = get_reaching_def (SSA_NAME_VAR (res)); ...... /* å°†currdefè®°å½•åˆ° phiå‡½æ•°çš„ç¬¬xä¸ªå‚æ•°ä¸­(phi.arg[x].def),å¹¶å¢åŠ currdefè¿™ä¸ªSSA_NAMEçš„useé“¾è¡¨(å°†phi.arg[x].imm_use é“¾æ¥åˆ°currdef.imm_useä½¿ç”¨é“¾ä¸­),è¿™é‡Œçš„xæ˜¯ eè¿™æ¡è¾¹åœ¨e-&gt;destç»“ç‚¹ä¸­çš„å‰é©±è¾¹ç¼–å·(å½“å‰bbåœ¨å…¶æŸåç»§ç»“ç‚¹ä¸­çš„å‰é©±ç»“ç‚¹ç¼–å·) */ add_phi_arg (phi, currdef, e, loc); &#125; &#125;&#125; SSAåŸºæœ¬æ¦‚å¿µåŠåŸç†å‚è€ƒæ–‡ç«  ç¨‹åºåˆ†æä¹‹ä¸­é—´è¡¨ç¤º gccä¸­çš„æ”¯é…æ ‘ åŸæ–‡é“¾æ¥","categories":[{"name":"SSA","slug":"SSA","permalink":"https://lwy0518.github.io/categories/SSA/"}],"tags":[{"name":"SSA","slug":"SSA","permalink":"https://lwy0518.github.io/tags/SSA/"},{"name":"gcc","slug":"gcc","permalink":"https://lwy0518.github.io/tags/gcc/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://lwy0518.github.io/tags/%E7%AE%97%E6%B3%95/"},{"name":"ç¼–è¯‘åŸç†","slug":"ç¼–è¯‘åŸç†","permalink":"https://lwy0518.github.io/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"}],"author":"lwy"},{"title":"Hexo NexT ä¸»é¢˜æ›´æ–°","slug":"Hexo-NexT-ä¸»é¢˜æ›´æ–°","date":"2021-12-22T02:32:43.000Z","updated":"2021-12-22T02:59:01.322Z","comments":true,"path":"2021/12/22/Hexo-NexT-ä¸»é¢˜æ›´æ–°/","link":"","permalink":"https://lwy0518.github.io/2021/12/22/Hexo-NexT-%E4%B8%BB%E9%A2%98%E6%9B%B4%E6%96%B0/","excerpt":"æ›´æ–°Nextä¸»é¢˜12$ rm -rf ./themes/next$ cnpm install hexo-theme-next å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶æ¨¡å—å®‰è£…1$ cnpm install @next-theme/plugins é…ç½®1$ vim _config.next.yml å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°_config.next.yml 12vendors: plugins: local","text":"æ›´æ–°Nextä¸»é¢˜12$ rm -rf ./themes/next$ cnpm install hexo-theme-next å®‰è£…ç¬¬ä¸‰æ–¹æ’ä»¶æ¨¡å—å®‰è£…1$ cnpm install @next-theme/plugins é…ç½®1$ vim _config.next.yml å¤åˆ¶ä»¥ä¸‹ä»£ç åˆ°_config.next.yml 12vendors: plugins: local","categories":[{"name":"hexo","slug":"hexo","permalink":"https://lwy0518.github.io/categories/hexo/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://lwy0518.github.io/tags/hexo/"},{"name":"Blog","slug":"Blog","permalink":"https://lwy0518.github.io/tags/Blog/"}],"author":"lwy"},{"title":"Typoraå¿«æ·é”®","slug":"Typoraå¿«æ·é”®","date":"2021-12-21T07:46:50.000Z","updated":"2021-12-22T03:24:17.737Z","comments":true,"path":"2021/12/21/Typoraå¿«æ·é”®/","link":"","permalink":"https://lwy0518.github.io/2021/12/21/Typora%E5%BF%AB%E6%8D%B7%E9%94%AE/","excerpt":"Typoraå¿«æ·é”®","text":"Typoraå¿«æ·é”® åŸæ–‡é“¾æ¥ æºç æ¨¡å¼1ctrl+/ ç”Ÿæˆç›®å½•1[TOC]æŒ‰å›è½¦ ä»£ç å—1ctrl+alt+f ä»£ç 1ctrl+shift+` æ ‡é¢˜1ctrl+æ•°å­— è¡¨æ ¼1ctrl+t é€‰ä¸­ä¸€è¡Œ1ctrl+l é€‰ä¸­å•è¯1ctrl+d é€‰ä¸­ç›¸åŒæ ¼å¼çš„æ–‡å­—1ctrl+e è·³è½¬åˆ°æ–‡ç« å¼€å¤´1ctrl+home è·³è½¬åˆ°æ–‡ç« ç»“å°¾1ctrl+end æœç´¢1ctrl+f æ›¿æ¢1ctrl+h ä¸‹åˆ’çº¿1ctrl+u åˆ é™¤çº¿1alt+shift+5 æ’å…¥å›¾ç‰‡1ç›´æ¥æ‹–åŠ¨åˆ°æŒ‡å®šä½ç½®å³å¯æˆ–è€…ctrl+shift+i æ’å…¥é“¾æ¥1ctrl + k å¼•ç”¨1&gt; åŠ ç²—1ctrl + b å€¾æ–œ1ctrl + i æ·»åŠ å‚è€ƒæ–‡çŒ®1[^1] # ^ åé¢æ·»åŠ æ•°å­—","categories":[{"name":"Markdown","slug":"Markdown","permalink":"https://lwy0518.github.io/categories/Markdown/"}],"tags":[{"name":"Typora","slug":"Typora","permalink":"https://lwy0518.github.io/tags/Typora/"},{"name":"Markdown","slug":"Markdown","permalink":"https://lwy0518.github.io/tags/Markdown/"}],"author":"lwy"},{"title":"æ±¡ç‚¹åˆ†æ","slug":"æ±¡ç‚¹åˆ†æ","date":"2021-12-21T07:22:46.029Z","updated":"2021-12-22T02:58:43.530Z","comments":true,"path":"2021/12/21/æ±¡ç‚¹åˆ†æ/","link":"","permalink":"https://lwy0518.github.io/2021/12/21/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/","excerpt":"æ±¡ç‚¹åˆ†ææŠ€æœ¯ åŸºæœ¬åŸç† æ±¡ç‚¹åˆ†æå®šä¹‰ è¯†åˆ«æ±¡ç‚¹æºå’Œæ±‡èšç‚¹ æ±¡ç‚¹ä¼ æ’­åˆ†æ æ˜¾ç¤ºæµåˆ†æ éšå¼æµåˆ†æ æ— å®³å¤„ç† æ±¡ç‚¹ä¼ æ’­åˆ†æçš„å…³é”®æŠ€æœ¯ æ±¡ç‚¹ä¼ æ’­ä¸­çš„æ˜¾ç¤ºæµåˆ†æ é™æ€åˆ†ææŠ€æœ¯ åŠ¨æ€åˆ†ææŠ€æœ¯ ç¡¬ä»¶ åŸºäºè½¯ä»¶ æ··åˆå‹ æ±¡ç‚¹ä¼ æ’­ä¸­çš„éšå¼æµåˆ†æ é™æ€åˆ†ææŠ€æœ¯ åŠ¨æ€åˆ†ææŠ€æœ¯","text":"æ±¡ç‚¹åˆ†ææŠ€æœ¯ åŸºæœ¬åŸç† æ±¡ç‚¹åˆ†æå®šä¹‰ è¯†åˆ«æ±¡ç‚¹æºå’Œæ±‡èšç‚¹ æ±¡ç‚¹ä¼ æ’­åˆ†æ æ˜¾ç¤ºæµåˆ†æ éšå¼æµåˆ†æ æ— å®³å¤„ç† æ±¡ç‚¹ä¼ æ’­åˆ†æçš„å…³é”®æŠ€æœ¯ æ±¡ç‚¹ä¼ æ’­ä¸­çš„æ˜¾ç¤ºæµåˆ†æ é™æ€åˆ†ææŠ€æœ¯ åŠ¨æ€åˆ†ææŠ€æœ¯ ç¡¬ä»¶ åŸºäºè½¯ä»¶ æ··åˆå‹ æ±¡ç‚¹ä¼ æ’­ä¸­çš„éšå¼æµåˆ†æ é™æ€åˆ†ææŠ€æœ¯ åŠ¨æ€åˆ†ææŠ€æœ¯ æ±¡ç‚¹åˆ†ææ–¹æ³•å®ç°å®ä¾‹åˆ†æ é™æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯ åŸºäºæ•°æ®æµçš„æ±¡ç‚¹åˆ†æ åŸºäºä¾èµ–å…³ç³»çš„æ±¡ç‚¹åˆ†æ é™æ€æ±¡ç‚¹åˆ†æå®ä¾‹åˆ†æ åŠ¨æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯ åŠ¨æ€æ±¡ç‚¹åˆ†æçš„æ–¹æ³•å®ç° æ±¡ç‚¹æ•°æ®æ ‡è®° æ±¡ç‚¹åŠ¨æ€è·Ÿè¸ª æ±¡ç‚¹è¯¯ç”¨æ£€æŸ¥ å®ä¾‹åˆ†æ æ±¡ç‚¹åˆ†æåœ¨å®é™…åº”ç”¨ä¸­çš„å…³é”®æŠ€æœ¯ æ£€æµ‹æ™ºèƒ½æ‰‹æœºéšç§æ³„éœ² é™æ€æ±¡ç‚¹åˆ†æ ç»„ä»¶å†…æ±¡ç‚¹ä¼ æ’­åˆ†æ ç»„ä»¶é—´æ±¡ç‚¹ä¼ æ’­åˆ†æ ç»„ä»¶ä¸åº“å‡½æ•°ä¹‹é—´çš„æ±¡ç‚¹ä¼ æ’­åˆ†æ åŠ¨æ€æ±¡ç‚¹åˆ†æ ç»„ä»¶å†…æ±¡ç‚¹ä¼ æ’­åˆ†æ ç»„ä»¶é—´æ±¡ç‚¹ä¼ æ’­åˆ†æ ç»„ä»¶ä¸æœ¬åœ°åº“å‡½æ•°é—´çš„æ±¡ç‚¹ä¼ æ’­ æ€»ç»“ å‚è€ƒæ–‡çŒ® æ±¡ç‚¹åˆ†ææŠ€æœ¯åŸºæœ¬åŸç†æ±¡ç‚¹åˆ†æå®šä¹‰æ±¡ç‚¹åˆ†æå¯ä»¥æŠ½è±¡æˆä¸€ä¸ª**ä¸‰å…ƒç»„&lt;sources,sinks,sanitizers&gt;**çš„å½¢å¼ï¼Œå…¶ä¸­ï¼Œsource å³æ±¡ç‚¹æºï¼Œä»£è¡¨ç›´æ¥å¼•å…¥ä¸å—ä¿¡ä»»çš„æ•°æ®æˆ–è€…æœºå¯†æ•°æ®åˆ°ç³»ç»Ÿä¸­ï¼›sink å³æ±¡ç‚¹æ±‡èšç‚¹ï¼Œä»£è¡¨ç›´æ¥äº§ç”Ÿå®‰å…¨æ•æ„Ÿæ“ä½œ(è¿åæ•°æ®å®Œæ•´æ€§)æˆ–è€…æ³„éœ²éšç§æ•°æ®åˆ°å¤–ç•Œ(è¿åæ•°æ®ä¿å¯†æ€§)ï¼›sanitizer å³æ— å®³å¤„ç†ï¼Œä»£è¡¨é€šè¿‡æ•°æ®åŠ å¯†æˆ–è€…ç§»é™¤å±å®³æ“ä½œç­‰æ‰‹æ®µä½¿æ•°æ®ä¼ æ’­ä¸å†å¯¹è½¯ä»¶ç³»ç»Ÿçš„ä¿¡æ¯å®‰å…¨äº§ç”Ÿå±å®³ã€‚ æ±¡ç‚¹åˆ†æå°±æ˜¯åˆ†æç¨‹åºä¸­ç”±æ±¡ç‚¹æºå¼•å…¥çš„æ•°æ®æ˜¯å¦èƒ½å¤Ÿä¸ç»æ— å®³å¤„ç†ï¼Œè€Œç›´æ¥ä¼ æ’­åˆ°æ±¡ç‚¹æ±‡èšç‚¹ã€‚å¦‚æœä¸èƒ½ï¼Œè¯´æ˜ç³»ç»Ÿæ˜¯ä¿¡æ¯æµå®‰å…¨çš„ï¼›å¦åˆ™ï¼Œè¯´æ˜ç³»ç»Ÿäº§ç”Ÿäº†éšç§æ•°æ®æ³„éœ²æˆ–å±é™©æ•°æ®æ“ä½œç­‰å®‰å…¨é—®é¢˜ã€‚ åœ¨æ¼æ´åˆ†æä¸­ï¼Œä½¿ç”¨æ±¡ç‚¹åˆ†ææŠ€æœ¯å°†æ‰€æ„Ÿå…´è¶£çš„æ•°æ®(é€šå¸¸æ¥è‡ªç¨‹åºçš„å¤–éƒ¨è¾“å…¥ï¼Œå‡å®šæ‰€æœ‰è¾“å…¥éƒ½æ˜¯å±é™©çš„)æ ‡è®°ä¸ºæ±¡ç‚¹æ•°æ®ï¼Œç„¶åé€šè¿‡è·Ÿè¸ªå’Œæ±¡ç‚¹æ•°æ®ç›¸å…³çš„ä¿¡æ¯çš„æµå‘ï¼Œå¯ä»¥çŸ¥é“å®ƒä»¬æ˜¯å¦ä¼šå½±å“æŸäº›å…³é”®çš„ç¨‹åºæ“ä½œï¼Œè¿›è€ŒæŒ–æ˜ç¨‹åºæ¼æ´ã€‚å³å°†ç¨‹åºæ˜¯å¦å­˜åœ¨æŸç§æ¼æ´çš„é—®é¢˜è½¬åŒ–ä¸ºæ±¡ç‚¹ä¿¡æ¯æ˜¯å¦ä¼šè¢« Sink ç‚¹ä¸Šçš„æ“ä½œæ‰€ä½¿ç”¨çš„é—®é¢˜ã€‚ æ±¡ç‚¹åˆ†æå¸¸å¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†(å¦‚å›¾ 2 æ‰€ç¤º)ï¼š è¯†åˆ«æ±¡ç‚¹ä¿¡æ¯åœ¨ç¨‹åºä¸­çš„äº§ç”Ÿç‚¹ï¼ˆSourceç‚¹ï¼‰å¹¶å¯¹æ±¡ç‚¹ä¿¡æ¯è¿›è¡Œæ ‡è®°(æ ¹æ®æ‰€åˆ†æçš„ç³»ç»Ÿçš„ä¸åŒä½¿ç”¨å®šåˆ¶çš„è¯†åˆ«ç­–ç•¥) æ±¡ç‚¹ä¼ æ’­åˆ†æ(åˆ©ç”¨ç‰¹å®šçš„è§„åˆ™è·Ÿè¸ªåˆ†ææ±¡ç‚¹ä¿¡æ¯åœ¨ç¨‹åºä¸­çš„ä¼ æ’­è¿‡ç¨‹) æ¼æ´æ£€æµ‹ã€æ— å®³å¤„ç†(åœ¨ä¸€äº›å…³é”®çš„ç¨‹åºç‚¹ï¼ˆSinkç‚¹ï¼‰æ£€æµ‹å…³é”®çš„æ“ä½œæ˜¯å¦ä¼šå—åˆ°æ±¡ç‚¹ä¿¡æ¯çš„å½±å“) è¯†åˆ«æ±¡ç‚¹æºå’Œæ±‡èšç‚¹è¯†åˆ«æ±¡ç‚¹æºå’Œæ±¡ç‚¹æ±‡èšç‚¹æ˜¯æ±¡ç‚¹åˆ†æçš„å‰æã€‚ç›®å‰ï¼Œåœ¨ä¸åŒçš„åº”ç”¨ç¨‹åºä¸­è¯†åˆ«æ±¡ç‚¹æºå’Œæ±‡èšç‚¹çš„æ–¹æ³•å„ä¸ç›¸åŒã€‚ç¼ºä¹é€šç”¨æ–¹æ³•çš„åŸå› ä¸€æ–¹é¢æ¥è‡ªç³»ç»Ÿæ¨¡å‹ã€ç¼–ç¨‹è¯­è¨€ä¹‹é—´çš„å·®å¼‚ã€‚å¦ä¸€æ–¹é¢ï¼Œæ±¡ç‚¹åˆ†æå…³æ³¨çš„å®‰å…¨æ¼æ´ç±»å‹ä¸åŒï¼Œä¹Ÿä¼šå¯¼è‡´å¯¹æ±¡ç‚¹æºå’Œæ±¡ç‚¹æ±‡èšç‚¹çš„æ”¶é›†æ–¹æ³•è¿¥å¼‚ã€‚è¡¨ 1 æ‰€ç¤ºä¸ºåœ¨ Web åº”ç”¨ç¨‹åºæ¼æ´æ£€æµ‹ä¸­çš„æ±¡ç‚¹æºç¤ºä¾‹[^1]ï¼Œå®ƒä»¬æ˜¯ Web æ¡†æ¶ä¸­å…³é”®å¯¹è±¡çš„å±æ€§ã€‚ ç°æœ‰çš„è¯†åˆ«æ±¡ç‚¹æºå’Œæ±‡èšç‚¹çš„æ–¹æ³•å¯ä»¥å¤§è‡´åˆ†æˆ 3 ç±»: ä½¿ç”¨å¯å‘å¼çš„ç­–ç•¥è¿›è¡Œæ ‡è®°,ä¾‹å¦‚æŠŠæ¥è‡ªç¨‹åºå¤–éƒ¨è¾“å…¥çš„æ•°æ®ç»Ÿç§°ä¸ºâ€œæ±¡ç‚¹â€æ•°æ®,ä¿å®ˆåœ°è®¤ä¸ºè¿™äº›æ•°æ®æœ‰å¯èƒ½åŒ…å«æ¶æ„çš„æ”»å‡»æ•°æ®(å¦‚ PHP Aspis)ï¼› æ ¹æ®å…·ä½“åº”ç”¨ç¨‹åºè°ƒç”¨çš„ API æˆ–è€…é‡è¦çš„æ•°æ®ç±»å‹,æ‰‹å·¥æ ‡è®°æºå’Œæ±‡èšç‚¹(å¦‚ DroidSafe[^2])ï¼› ä½¿ç”¨ç»Ÿè®¡æˆ–æœºå™¨å­¦ä¹ æŠ€æœ¯è‡ªåŠ¨åœ°è¯†åˆ«å’Œæ ‡è®°æ±¡ç‚¹æºåŠæ±‡èšç‚¹[^3]ã€‚ æ±¡ç‚¹ä¼ æ’­åˆ†ææ±¡ç‚¹ä¼ æ’­åˆ†æå°±æ˜¯åˆ†ææ±¡ç‚¹æ ‡è®°æ•°æ®åœ¨ç¨‹åºä¸­çš„ä¼ æ’­é€”å¾„.æŒ‰ç…§åˆ†æè¿‡ç¨‹ä¸­å…³æ³¨çš„ç¨‹åºä¾èµ–å…³ç³»çš„ä¸åŒ, å¯ä»¥å°†æ±¡ç‚¹ä¼ æ’­åˆ†æåˆ†ä¸ºæ˜¾å¼æµåˆ†æå’Œéšå¼æµåˆ†æã€‚ æ˜¾ç¤ºæµåˆ†ææ±¡ç‚¹ä¼ æ’­åˆ†æä¸­çš„æ˜¾å¼æµåˆ†æå°±æ˜¯åˆ†ææ±¡ç‚¹æ ‡è®°å¦‚ä½•éšç¨‹åºä¸­å˜é‡ä¹‹é—´çš„æ•°æ®ä¾èµ–å…³ç³»ä¼ æ’­ ä»¥å›¾ 3 æ‰€ ç¤ºçš„ç¨‹åºä¸ºä¾‹,å˜é‡ a å’Œ b è¢«é¢„å®šä¹‰çš„æ±¡ç‚¹æºå‡½æ•° source æ ‡è®°ä¸ºæ±¡ç‚¹æº.å‡è®¾ a å’Œ b è¢«èµ‹äºˆçš„æ±¡ç‚¹æ ‡è®°åˆ†åˆ«ä¸ºtaint_a å’Œ taint_b.ç”±äºç¬¬ 5 è¡Œçš„å˜é‡ x ç›´æ¥æ•°æ®ä¾èµ–äºå˜é‡ a,ç¬¬ 6 è¡Œçš„å˜é‡ y ç›´æ¥æ•°æ®ä¾èµ–äºå˜é‡ b,æ˜¾å¼æµåˆ†æä¼šåˆ†åˆ«å°†æ±¡ç‚¹æ ‡è®° taint_a å’Œ taint_b ä¼ æ’­ç»™ç¬¬ 5 è¡Œçš„å˜é‡ x å’Œç¬¬ 6 è¡Œçš„å˜é‡ y.åˆç”±äº x å’Œ y åˆ†åˆ«å¯ä»¥åˆ°è¾¾ç¬¬ 7 è¡Œå’Œç¬¬ 8 è¡Œçš„æ±¡ç‚¹æ±‡èšç‚¹(ç”¨é¢„å®šä¹‰çš„æ±¡ç‚¹æ±‡èšç‚¹å‡½æ•° sink æ ‡è¯†),å›¾ 3 æ‰€ç¤ºçš„ä»£ç å­˜åœ¨ä¿¡æ¯æ³„æ¼çš„é—®é¢˜.æˆ‘ä»¬å°†åœ¨åé¢å…·ä½“ä»‹ç»ç›®å‰æ±¡ç‚¹ä¼ æ’­åˆ†æä¸­æ˜¾å¼æµåˆ†æé¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜å’Œè§£å†³æ–¹æ³•ã€‚ éšå¼æµåˆ†ææ±¡ç‚¹ä¼ æ’­åˆ†æä¸­çš„éšå¼æµåˆ†ææ˜¯åˆ†ææ±¡ç‚¹æ ‡è®°å¦‚ä½•éšç¨‹åºä¸­å˜é‡ä¹‹é—´çš„**æ§åˆ¶ä¾èµ–å…³ç³»ä¼ æ’­,**ä¹Ÿå°±æ˜¯åˆ†ææ±¡ç‚¹æ ‡è®°å¦‚ä½•ä»æ¡ä»¶æŒ‡ä»¤ä¼ æ’­åˆ°å…¶æ‰€æ§åˆ¶çš„è¯­å¥ã€‚ åœ¨å›¾ 4 æ‰€ç¤ºçš„ç¨‹åºä¸­,å˜é‡ X æ˜¯è¢«æ±¡ç‚¹æ ‡è®°çš„å­—ç¬¦ä¸²ç±»å‹å˜é‡,å˜é‡ Y å’Œå˜é‡ X ä¹‹é—´å¹¶æ²¡æœ‰ç›´æ¥æˆ–é—´æ¥çš„æ•°æ®ä¾èµ–å…³ç³»(æ˜¾å¼æµå…³ç³»),ä½† X ä¸Šçš„æ±¡ç‚¹æ ‡è®°å¯ä»¥ç»è¿‡æ§åˆ¶ä¾èµ–éšå¼åœ°ä¼ æ’­åˆ° Yã€‚ å…·ä½“æ¥è¯´,ç”±ç¬¬ 4 è¡Œçš„å¾ªç¯æ¡ä»¶æ§åˆ¶çš„å¤–å±‚å¾ªç¯é¡ºåºåœ°å–å‡º X ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦,è½¬åŒ–æˆæ•´å‹åèµ‹ç»™å˜é‡ x,å†ç”±ç¬¬ 7 è¡Œçš„å¾ªç¯æ¡ä»¶æ§åˆ¶çš„å†…å±‚å¾ªç¯ä»¥ç´¯åŠ çš„æ–¹å¼å°† x çš„å€¼èµ‹ç»™ y,æœ€åç”±å¤–å±‚å¾ªç¯å°† y é€ä¸€ä¼ ç»™ Y.æœ€ç»ˆ,ç¬¬ 12 è¡Œçš„ Y å€¼å’Œ X å€¼ç›¸åŒ,ç¨‹åºå­˜åœ¨ä¿¡æ¯æ³„æ¼é—®é¢˜.ä½†æ˜¯,å¦‚æœä¸è¿›è¡Œéšå¼æµæ±¡ç‚¹ä¼ æ’­åˆ†æ,ç¬¬ 12 è¡Œ çš„å˜é‡ Y å°†ä¸ä¼šè¢«èµ‹äºˆæ±¡ç‚¹æ ‡è®°,ç¨‹åºçš„ä¿¡æ¯æ³„æ¼é—®é¢˜è¢«æ©ç›–. éšå¼æµæ±¡ç‚¹ä¼ æ’­ä¸€ç›´ä»¥æ¥éƒ½æ˜¯ä¸€ä¸ªé‡è¦çš„é—®é¢˜,å’Œæ˜¾å¼æµä¸€æ ·,å¦‚æœä¸è¢«æ­£ç¡®å¤„ç†,ä¼šä½¿æ±¡ç‚¹åˆ†æçš„ç»“æœä¸ç²¾ç¡®.ç”±äºå¯¹éšå¼æµæ±¡ç‚¹ä¼ æ’­å¤„ç†ä¸å½“å¯¼è‡´æœ¬åº”è¢«æ ‡è®°çš„å˜é‡æ²¡æœ‰è¢«æ ‡è®°çš„é—®é¢˜ç§°ä¸ºæ¬ æ±¡æŸ“(under-taint)é—®é¢˜.ç›¸ååœ°,ç”±äºæ±¡ç‚¹æ ‡è®°çš„æ•°é‡è¿‡å¤šè€Œå¯¼è‡´æ±¡ç‚¹å˜é‡å¤§é‡æ‰©æ•£çš„é—®é¢˜ç§°ä¸ºè¿‡æ±¡æŸ“(over-taint)é—®é¢˜.ç›®å‰,é’ˆå¯¹éšå¼æµé—®é¢˜çš„ç ”ç©¶é‡ç‚¹æ˜¯å°½é‡å‡å°‘æ¬ æ±¡æŸ“å’Œè¿‡æ±¡æŸ“çš„æƒ…å†µ.æˆ‘ä»¬å°†åœ¨åé¢å…·ä½“ä»‹ç»ç°æœ‰æŠ€æœ¯æ˜¯å¦‚ä½•è§£å†³ä¸Šè¿°é—®é¢˜çš„ã€‚ æ— å®³å¤„ç†æ±¡ç‚¹æ•°æ®åœ¨ä¼ æ’­çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šç»è¿‡æ— å®³å¤„ç†æ¨¡å—,æ— å®³å¤„ç†æ¨¡å—æ˜¯æŒ‡æ±¡ç‚¹æ•°æ®ç»è¿‡è¯¥æ¨¡å—çš„å¤„ç†å,æ•°æ®æœ¬èº«ä¸å†æºå¸¦æ•æ„Ÿä¿¡æ¯æˆ–è€…é’ˆå¯¹è¯¥æ•°æ®çš„æ“ä½œä¸ä¼šå†å¯¹ç³»ç»Ÿäº§ç”Ÿå±å®³.æ¢è¨€ä¹‹,å¸¦æ±¡ç‚¹æ ‡è®°çš„æ•°æ®åœ¨ç»è¿‡æ— å®³å¤„ç†æ¨¡å—å,æ±¡ç‚¹æ ‡è®°å¯ä»¥è¢«ç§»é™¤.æ­£ç¡®åœ°ä½¿ç”¨æ— å®³å¤„ç†å¯ä»¥é™ä½ç³»ç»Ÿä¸­æ±¡ç‚¹æ ‡è®°çš„æ•°é‡,æé«˜æ±¡ç‚¹åˆ†æçš„æ•ˆç‡,å¹¶ä¸”é¿å…ç”±äºæ±¡ç‚¹æ‰©æ•£å¯¼è‡´çš„åˆ†æç»“æœä¸ç²¾ç¡®çš„é—®é¢˜ åœ¨åº”ç”¨è¿‡ç¨‹ä¸­,ä¸ºäº†é˜²æ­¢æ•æ„Ÿæ•°æ®è¢«æ³„éœ²(ä¿æŠ¤ä¿å¯†æ€§),é€šå¸¸ä¼šå¯¹æ•æ„Ÿæ•°æ®è¿›è¡ŒåŠ å¯†å¤„ç†.æ­¤æ—¶,åŠ å¯†åº“å‡½æ•°åº”è¯¥è¢«è¯†åˆ«æˆæ— å®³å¤„ç†æ¨¡å—.è¿™ä¸€æ–¹é¢æ˜¯ç”±äºåº“å‡½æ•°ä¸­ä½¿ç”¨äº†å¤§é‡çš„åŠ å¯†ç®—æ³•,å¯¼è‡´æ”»å‡»è€…å¾ˆéš¾æœ‰æ•ˆåœ°è®¡ç®—å‡ºå¯†ç çš„å¯èƒ½èŒƒå›´;å¦ä¸€æ–¹é¢æ˜¯åŠ å¯†åçš„æ•°æ®ä¸å†å…·æœ‰å¨èƒæ€§,ç»§ç»­ä¼ æ’­æ±¡ç‚¹æ ‡è®°æ²¡æœ‰æ„ä¹‰ã€‚ æ­¤å¤–,ä¸ºäº†é˜²æ­¢å¤–ç•Œæ•°æ®å› ä¸ºæºå¸¦å±é™©æ“ä½œè€Œå¯¹ç³»ç»Ÿå…³é”®åŒºåŸŸäº§ç”Ÿå±å®³(ä¿æŠ¤å®Œæ•´æ€§),é€šå¸¸ä¼šå¯¹è¾“å…¥çš„æ•°æ®è¿›è¡ŒéªŒè¯ã€‚ ç»¼ä¸Š,ç›®å‰å¯¹æ±¡ç‚¹æºã€æ±¡ç‚¹æ±‡èšç‚¹ä»¥åŠæ— å®³å¤„ç†æ¨¡å—çš„è¯†åˆ«é€šå¸¸æ ¹æ®ç³»ç»Ÿæˆ–æ¼æ´ç±»å‹ä½¿ç”¨å®šåˆ¶çš„æ–¹æ³•.ç”±äºè¿™äº›æ–¹æ³•éƒ½æ¯”è¾ƒç›´æ¥,æœ¬æ–‡å°†ä¸å†è¿›è¡Œæ›´æ·±å…¥çš„æ¢è®¨.ä¸‹ä¸€èŠ‚å°†é‡ç‚¹ä»‹ç»æ±¡ç‚¹ä¼ æ’­ä¸­çš„å…³é”®æŠ€æœ¯ã€‚ æ€»ç»“ï¼Œä½¿ç”¨æ±¡ç‚¹åˆ†ææ£€æµ‹ç¨‹åºæ¼æ´çš„å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åŸºäºæ•°æ®æµçš„æ±¡ç‚¹åˆ†æã€‚åœ¨ä¸è€ƒè™‘éšå¼ä¿¡æ¯æµçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°†æ±¡ç‚¹åˆ†æçœ‹åšé’ˆå¯¹æ±¡ç‚¹æ•°æ®çš„æ•°æ®æµåˆ†æã€‚æ ¹æ®æ±¡ç‚¹ä¼ æ’­è§„åˆ™è·Ÿè¸ªæ±¡ç‚¹ä¿¡æ¯æˆ–è€…æ ‡è®°è·¯å¾„ä¸Šçš„å˜é‡æ±¡æŸ“æƒ…å†µï¼Œè¿›è€Œæ£€æŸ¥æ±¡ç‚¹ä¿¡æ¯æ˜¯å¦å½±å“æ•æ„Ÿæ“ä½œã€‚ åŸºäºä¾èµ–å…³ç³»çš„æ±¡ç‚¹åˆ†æã€‚è€ƒè™‘éšå¼ä¿¡æ¯æµï¼Œåœ¨åˆ†æè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®ç¨‹åºä¸­çš„è¯­å¥æˆ–è€…æŒ‡ä»¤ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ£€æŸ¥ Sink ç‚¹å¤„æ•æ„Ÿæ“ä½œæ˜¯å¦ä¾èµ–äº Source ç‚¹å¤„æ¥æ”¶æ±¡ç‚¹ä¿¡æ¯çš„æ“ä½œã€‚ æ±¡ç‚¹ä¼ æ’­åˆ†æçš„å…³é”®æŠ€æœ¯æ±¡ç‚¹ä¼ æ’­åˆ†ææ˜¯å½“å‰æ±¡ç‚¹åˆ†æé¢†åŸŸçš„ç ”ç©¶é‡ç‚¹.ä¸ç¨‹åºåˆ†ææŠ€æœ¯ç›¸ç»“åˆ,å¯ä»¥è·å¾—æ›´åŠ é«˜æ•ˆã€ç²¾ç¡®çš„æ±¡ç‚¹åˆ†æç»“æœ.æ ¹æ®åˆ†æè¿‡ç¨‹ä¸­æ˜¯å¦éœ€è¦è¿è¡Œç¨‹åº,å¯ä»¥å°†æ±¡ç‚¹ä¼ æ’­åˆ†æåˆ†ä¸ºé™æ€æ±¡ç‚¹åˆ†æå’ŒåŠ¨æ€æ±¡ç‚¹åˆ†æ.æœ¬èŠ‚ä¸»è¦ä»‹ç»å¦‚ä½•ä½¿ç”¨åŠ¨/é™æ€ç¨‹åºåˆ†ææŠ€æœ¯æ¥è§£å†³æ±¡ç‚¹ä¼ æ’­ä¸­çš„æ˜¾å¼æµåˆ†æå’Œéšå¼æµåˆ†æé—®é¢˜ æ˜¾å¼æµåˆ†æå’Œéšå¼æµåˆ†ææ˜¯ä»ä¸¤ç§ä¸åŒçš„è§’åº¦(æ•°æ®æµå’Œæ§åˆ¶æµ)æ¥è§‚å¯Ÿæ±¡ç‚¹ä¼ æ’­ æ±¡ç‚¹ä¼ æ’­ä¸­çš„æ˜¾å¼æµåˆ†æé™æ€åˆ†ææŠ€æœ¯é™æ€æ±¡ç‚¹ä¼ æ’­åˆ†æ(ç®€ç§°é™æ€æ±¡ç‚¹åˆ†æ)æ˜¯æŒ‡åœ¨ä¸è¿è¡Œä¸”ä¸ä¿®æ”¹ä»£ç çš„å‰æä¸‹,é€šè¿‡åˆ†æç¨‹åºå˜é‡é—´çš„æ•°æ®ä¾èµ–å…³ç³»æ¥æ£€æµ‹æ•°æ®èƒ½å¦ä»æ±¡ç‚¹æºä¼ æ’­åˆ°æ±¡ç‚¹æ±‡èšç‚¹. é™æ€æ±¡ç‚¹åˆ†æçš„å¯¹è±¡ä¸€èˆ¬æ˜¯ç¨‹åºçš„æºç æˆ–ä¸­é—´è¡¨ç¤º.å¯ä»¥å°†å¯¹æ±¡ç‚¹ä¼ æ’­ä¸­æ˜¾å¼æµçš„é™æ€åˆ†æé—®é¢˜è½¬åŒ–ä¸ºå¯¹ç¨‹åºä¸­é™æ€æ•°æ®ä¾èµ–çš„åˆ†æ: é¦–å…ˆ,æ ¹æ®ç¨‹åºä¸­çš„å‡½æ•°è°ƒç”¨å…³ç³»æ„å»ºè°ƒç”¨å›¾(call graph,ç®€ç§°CG); ç„¶å,åœ¨å‡½æ•°å†…æˆ–è€…å‡½æ•°é—´æ ¹æ®ä¸åŒçš„ç¨‹åºç‰¹æ€§è¿›è¡Œå…·ä½“çš„æ•°æ®æµä¼ æ’­åˆ†æ.å¸¸è§çš„æ˜¾å¼æµæ±¡ç‚¹ä¼ æ’­æ–¹å¼åŒ…æ‹¬ç›´æ¥èµ‹å€¼ä¼ æ’­ã€é€šè¿‡å‡½æ•°(è¿‡ç¨‹)è°ƒç”¨ä¼ æ’­ä»¥åŠé€šè¿‡åˆ«å(æŒ‡é’ˆ)ä¼ æ’­ ä»¥å›¾ 5 æ‰€ç¤ºçš„ Java ç¨‹åºä¸ºä¾‹: ç¬¬ 3 è¡Œçš„å˜é‡ b ä¸ºåˆå§‹çš„æ±¡ç‚¹æ ‡è®°å˜é‡,ç¨‹åºç¬¬ 4 è¡Œå°†ä¸€ä¸ªåŒ…å«å˜é‡ b çš„ç®—æœ¯è¡¨è¾¾å¼çš„è®¡ç®—ç»“æœç›´æ¥èµ‹ç»™å˜é‡ c.ç”±äºå˜é‡ c å’Œå˜é‡ b ä¹‹é—´å…·æœ‰ç›´æ¥çš„èµ‹å€¼å…³ç³»,æ±¡ç‚¹æ ‡è®°å¯ç›´æ¥ä»èµ‹å€¼è¯­å¥å³éƒ¨çš„å˜é‡ä¼ æ’­åˆ°å·¦éƒ¨,ä¹Ÿå°±æ˜¯ä¸Šè¿° 3ç§æ˜¾å¼æµæ±¡ç‚¹ä¼ æ’­æ–¹å¼ä¸­çš„ç›´æ¥èµ‹å€¼ä¼ æ’­ æ¥ä¸‹æ¥,å˜é‡ c è¢«ä½œä¸ºå®å‚ä¼ é€’ç»™ç¨‹åºç¬¬ 5 è¡Œçš„å‡½æ•° foo,c ä¸Šçš„æ±¡ç‚¹æ ‡è®°ä¹Ÿé€šè¿‡å‡½æ•°è°ƒç”¨ä¼ æ’­åˆ° foo çš„å½¢å‚ z,z çš„æ±¡ç‚¹æ ‡è®°åˆé€šè¿‡ç›´æ¥èµ‹å€¼ä¼ æ’­åˆ°ç¨‹åºç¬¬ 8 è¡Œçš„ x.f.ç”±äº foo çš„å¦å¤–ä¸¤ä¸ªå‚æ•°å¯¹è±¡ x å’Œ y éƒ½æ˜¯å¯¹å¯¹è±¡ a çš„å¼•ç”¨,äºŒè€…ä¹‹é—´å­˜åœ¨åˆ«å,å› æ­¤,x.fçš„æ±¡ç‚¹æ ‡è®°å¯ä»¥é€šè¿‡åˆ«åä¼ æ’­åˆ°ç¬¬ 9 è¡Œçš„æ±¡ç‚¹æ±‡èšç‚¹,ç¨‹åºå­˜åœ¨æ³„æ¼é—®é¢˜. ç›®å‰,åˆ©ç”¨æ•°æ®æµåˆ†æè§£å†³æ˜¾å¼æ±¡ç‚¹ä¼ æ’­åˆ†æä¸­çš„ç›´æ¥èµ‹å€¼ä¼ æ’­å’Œå‡½æ•°è°ƒç”¨ä¼ æ’­å·²ç»ç›¸å½“æˆç†Ÿ,ç ”ç©¶çš„é‡ç‚¹æ˜¯å¦‚ä½•ä¸ºåˆ«åä¼ æ’­çš„åˆ†ææä¾›æ›´ç²¾ç¡®ã€é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆ.ç”±äºç²¾ç¡®åº¦è¶Šé«˜(ä¸Šä¸‹æ–‡æ•æ„Ÿã€æµæ•æ„Ÿã€åŸŸæ•æ„Ÿã€å¯¹è±¡æ•æ„Ÿç­‰)çš„ç¨‹åºé™æ€åˆ†ææŠ€æœ¯å¾€å¾€ä¼´éšç€è¶Šå¤§çš„æ—¶ç©ºå¼€é”€,è¿½æ±‚å…¨æ•æ„Ÿä¸”é«˜æ•ˆçš„åˆ«ååˆ†æéš¾åº¦è¾ƒå¤§.åˆç”±äºé™æ€æ±¡ç‚¹ä¼ æ’­åˆ†æå…³æ³¨çš„æ˜¯ä»æ±¡ç‚¹æºåˆ°æ±¡ç‚¹æ±‡èšç‚¹ä¹‹é—´çš„æ•°æ®æµå…³ç³»,åˆ†æå¯¹è±¡å¹¶éå®Œæ•´çš„ç¨‹åº,è€Œæ˜¯ç¡®å®šçš„å…¥å£å’Œå‡ºå£ä¹‹é—´çš„ç¨‹åºç‰‡æ®µ.è¿™å°±æ„å‘³ç€å¯ä»¥å°è¯•é‡‡ç”¨æŒ‰éœ€(on-demand)å®šåˆ¶çš„åˆ«ååˆ†ææ–¹æ³•æ¥è§£å†³æ˜¾å¼æµæ€æ±¡ç‚¹åˆ†æä¸­çš„åˆ«åä¼ æ’­é—®é¢˜ åŠ¨æ€åˆ†ææŠ€æœ¯åŠ¨æ€æ±¡ç‚¹ä¼ æ’­åˆ†æ(ç®€ç§°åŠ¨æ€æ±¡ç‚¹åˆ†æ)æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­,é€šè¿‡å®æ—¶ç›‘æ§ç¨‹åºçš„æ±¡ç‚¹æ•°æ®åœ¨ç³»ç»Ÿç¨‹åºä¸­çš„ä¼ æ’­æ¥æ£€æµ‹æ•°æ®èƒ½å¦ä»æ±¡ç‚¹æºä¼ æ’­åˆ°æ±¡ç‚¹æ±‡èšç‚¹.åŠ¨æ€æ±¡ç‚¹ä¼ æ’­åˆ†æé¦–å…ˆéœ€è¦ä¸ºæ±¡ç‚¹æ•°æ®æ‰©å±•ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°(tainted tag)çš„æ ‡ç­¾å¹¶å°†å…¶å­˜å‚¨åœ¨å­˜å‚¨å•å…ƒ(å†…å­˜ã€å¯„å­˜å™¨ã€ç¼“å­˜ç­‰)ä¸­,ç„¶åæ ¹æ®æŒ‡ä»¤ç±»å‹å’ŒæŒ‡ä»¤æ“ä½œæ•°è®¾è®¡ç›¸åº”çš„ä¼ æ’­é€»è¾‘ä¼ æ’­æ±¡ç‚¹æ ‡è®° åŠ¨æ€æ±¡ç‚¹ä¼ æ’­åˆ†ææŒ‰ç…§å®ç°å±‚æ¬¡è¢«åˆ†ä¸ºåŸºäºç¡¬ä»¶ã€åŸºäºè½¯ä»¶ä»¥åŠæ··åˆå‹çš„æ±¡ç‚¹ä¼ æ’­åˆ†æè¿™3ç±» 1.ç¡¬ä»¶åŸºäºç¡¬ä»¶çš„æ±¡ç‚¹ä¼ æ’­åˆ†æéœ€è¦å®šåˆ¶çš„ç¡¬ä»¶æ”¯æŒ,ä¸€èˆ¬éœ€è¦åœ¨åŸæœ‰ä½“ç³»ç»“æ„ä¸Šä¸ºå¯„å­˜å™¨æˆ–è€…å†…å­˜æ‰©å±•ä¸€ä¸ªæ ‡è®°ä½,ç”¨æ¥å­˜å‚¨æ±¡ç‚¹æ ‡è®° 2.åŸºäºè½¯ä»¶åŸºäºè½¯ä»¶çš„æ±¡ç‚¹ä¼ æ’­åˆ†æé€šè¿‡ä¿®æ”¹ç¨‹åºçš„äºŒè¿›åˆ¶ä»£ç æ¥è¿›è¡Œæ±¡ç‚¹æ ‡è®°ä½çš„å­˜å‚¨ä¸ä¼ æ’­ åŸºäºè½¯ä»¶çš„æ±¡ç‚¹ä¼ æ’­çš„ä¼˜ç‚¹åœ¨äºä¸å¿…æ›´æ”¹å¤„ç†å™¨ç­‰åº•å±‚çš„ç¡¬ä»¶,å¹¶ä¸”å¯ä»¥æ”¯æŒæ›´é«˜çš„è¯­ä¹‰é€»è¾‘çš„å®‰å…¨ç­–ç•¥(åˆ©ç”¨å…¶æ›´è´´è¿‘æºç¨‹åºå±‚æ¬¡çš„ç‰¹ç‚¹),ä½†ç¼ºç‚¹æ˜¯ä½¿ç”¨æ’æ¡©(instrumentation åœ¨ä¿è¯è¢«æµ‹ç¨‹åºåŸæœ‰é€»è¾‘å®Œæ•´æ€§çš„åŸºç¡€ä¸Šåœ¨ç¨‹åºä¸­æ’å…¥ä¸€äº›æ¢é’ˆ)æˆ–ä»£ç é‡å†™(code rewriting)ä¿®æ”¹ç¨‹åºå¾€å¾€ä¼šç»™åˆ†æç³»ç»Ÿå¸¦æ¥å·¨å¤§çš„å¼€é”€.ç›¸ååœ°,åŸºäºç¡¬ä»¶çš„æ±¡ç‚¹ä¼ æ’­åˆ†æè™½ç„¶å¯ä»¥åˆ©ç”¨å®šåˆ¶ç¡¬ä»¶é™ä½å¼€é”€,ä½†é€šå¸¸ä¸èƒ½æ”¯æŒæ›´é«˜çš„è¯­ä¹‰é€»è¾‘çš„å®‰å…¨ç­–ç•¥,å¹¶ä¸”éœ€è¦å¯¹å¤„ç†å™¨ç»“æ„è¿›è¡Œé‡æ–°è®¾è®¡ 3.æ··åˆå‹æ··åˆå‹çš„æ±¡ç‚¹åˆ†ææ˜¯å¯¹ä¸Šè¿°ä¸¤ç±»æ–¹æ³•çš„æŠ˜ä¸­,å³,é€šè¿‡å°½å¯èƒ½å°‘çš„ç¡¬ä»¶ç»“æ„æ”¹åŠ¨ä»¥ä¿è¯æ›´é«˜çš„è¯­ä¹‰é€»è¾‘çš„å®‰å…¨ç­–ç•¥ ç›®å‰,é’ˆå¯¹åŠ¨æ€æ±¡ç‚¹ä¼ æ’­åˆ†æçš„ç ”ç©¶å·¥ä½œå…³æ³¨çš„é¦–è¦é—®é¢˜æ˜¯å¦‚ä½•è®¾è®¡æœ‰æ•ˆçš„æ±¡ç‚¹ä¼ æ’­é€»è¾‘,ä»¥ç¡®ä¿ç²¾ç¡®çš„æ±¡ç‚¹ä¼ æ’­åˆ†æ æ±¡ç‚¹ä¼ æ’­ä¸­çš„éšå¼æµåˆ†ææ±¡ç‚¹ä¼ æ’­åˆ†æä¸­çš„éšå¼æµåˆ†æå°±æ˜¯åˆ†ææ±¡ç‚¹æ•°æ®å¦‚ä½•é€šè¿‡æ§åˆ¶ä¾èµ–è¿›è¡Œä¼ æ’­,å¦‚æœå¿½ç•¥äº†å¯¹éšå¼æµæ±¡ç‚¹ä¼ æ’­çš„åˆ†æ,åˆ™ä¼šå¯¼è‡´æ¬ æ±¡æŸ“çš„æƒ…å†µ;å¦‚æœå¯¹éšå¼æµåˆ†æä¸å½“,é‚£ä¹ˆé™¤äº†æ¬ æ±¡æŸ“ä¹‹å¤–,è¿˜å¯èƒ½å‡ºç°è¿‡æ±¡æŸ“çš„æƒ…å†µ.ä¸æ˜¾å¼æµåˆ†æç±»ä¼¼,éšå¼æµåˆ†ææŠ€æœ¯åŒæ ·ä¹Ÿå¯ä»¥åˆ†ä¸ºé™æ€åˆ†æå’ŒåŠ¨æ€åˆ†æä¸¤ç±» é™æ€åˆ†ææŠ€æœ¯é™æ€éšå¼æµåˆ†æé¢ä¸´çš„æ ¸å¿ƒé—®é¢˜æ˜¯ç²¾åº¦ä¸æ•ˆç‡ä¸å¯å…¼å¾—çš„é—®é¢˜.ç²¾ç¡®çš„éšå¼æµæ±¡ç‚¹ä¼ æ’­åˆ†æéœ€è¦åˆ†ææ¯ä¸€ä¸ªåˆ†æ”¯æ§åˆ¶æ¡ä»¶æ˜¯å¦éœ€è¦ä¼ æ’­æ±¡ç‚¹æ ‡è®°.è·¯å¾„æ•æ„Ÿçš„æ•°æ®æµåˆ†æå¾€å¾€ä¼šäº§ç”Ÿè·¯å¾„çˆ†ç‚¸é—®é¢˜,å¯¼è‡´å¼€é”€éš¾ä»¥æ¥å—.ä¸ºäº†é™ä½å¼€é”€,ä¸€ç§ç®€å•çš„é™æ€ä¼ æ’­(æ ‡è®°)åˆ†æ”¯è¯­å¥çš„æ±¡ç‚¹æ ‡è®°æ–¹æ³•æ˜¯å°†æ§åˆ¶ä¾èµ–äºå®ƒçš„è¯­å¥å…¨éƒ¨è¿›è¡Œæ±¡ç‚¹æ ‡è®°,ä½†è¯¥æ–¹æ³•ä¼šå¯¼è‡´ä¸€äº›å¹¶ä¸æºå¸¦éšç§æ•°æ®çš„å˜é‡è¢«æ ‡è®°,å¯¼è‡´è¿‡æ±¡æŸ“æƒ…å†µçš„å‘ç”Ÿ.è¿‡æ±¡æŸ“ä¼šå¼•èµ·æ±¡ç‚¹çš„å¤§é‡æ‰©æ•£,æœ€ç»ˆå¯¼è‡´ç”¨æˆ·å¾—åˆ°çš„æŠ¥å‘Šä¸­ä¿¡æ¯è¿‡å¤š,éš¾ä»¥ä½¿ç”¨ åŠ¨æ€åˆ†ææŠ€æœ¯åŠ¨æ€éšå¼æµåˆ†æå…³æ³¨çš„é¦–è¦é—®é¢˜æ˜¯å¦‚ä½•ç¡®å®šæ±¡ç‚¹æ§åˆ¶æ¡ä»¶ä¸‹éœ€è¦æ ‡è®°çš„è¯­å¥çš„èŒƒå›´.ç”±äºåŠ¨æ€æ‰§è¡Œè½¨è¿¹å¹¶ä¸èƒ½åæ˜ å‡ºè¢«æ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´çš„æ§åˆ¶ä¾èµ–å…³ç³»,ç›®å‰çš„ç ”ç©¶å¤šé‡‡ç”¨ç¦»çº¿çš„é™æ€åˆ†æè¾…åŠ©åˆ¤æ–­åŠ¨æ€æ±¡ç‚¹ä¼ æ’­ä¸­çš„éšå¼æµæ ‡è®°èŒƒå›´.Clauseç­‰äººæå‡º,åˆ©ç”¨ç¦»çº¿é™æ€åˆ†æå¾—åˆ°çš„æ§åˆ¶æµå›¾èŠ‚ç‚¹é—´çš„åæ”¯é…(post-dominate)å…³ç³»æ¥è§£å†³åŠ¨æ€æ±¡ç‚¹ä¼ æ’­ä¸­çš„éšå¼æµæ ‡è®°é—®é¢˜ ä¾‹å¦‚,å¦‚å›¾ 6(a)æ‰€ç¤º,ç¨‹åºç¬¬ 3 è¡Œçš„åˆ†æ”¯è¯­å¥è¢«æ ‡è®°ä¸ºæ±¡ç‚¹æº,å½“document.cookie çš„å€¼ä¸º abc æ—¶,ä¼šå‘ç”Ÿæ±¡ç‚¹æ•°æ®æ³„éœ².æ ¹æ®åŸºäºåæ”¯é…å…³ç³»çš„æ ‡è®°ç®—æ³•,ä¼šå¯¹è¯¥ç¤ºä¾‹ç¬¬ 4 è¡Œè¯­å¥çš„æŒ‡ä»¤ç›®çš„åœ°,å³ x çš„å€¼è¿›è¡Œæ±¡ç‚¹æ ‡è®°.(ps:å› ä¸ºæ ¹æ®è¯¥åˆ†æ”¯æ§åˆ¶ä¸‹çš„è¯­å¥çš„æ‰§è¡Œç»“æœå¯ä»¥åˆ¤å®šæ±¡æŸ“æºdocument.cookieçš„å€¼,é€ æˆæ±¡ç‚¹æ•°æ®æ³„éœ²) åŠ¨æ€åˆ†æé¢ä¸´çš„ç¬¬ 2 ä¸ªé—®é¢˜æ˜¯ç”±äºéƒ¨åˆ†æ³„æ¼(partially leaked)å¯¼è‡´çš„æ¼æŠ¥.éƒ¨åˆ†æ³„æ¼æ˜¯æŒ‡æ±¡ç‚¹ä¿¡æ¯é€šè¿‡åŠ¨æ€æœªæ‰§è¡Œéƒ¨åˆ†è¿›è¡Œä¼ æ’­å¹¶æ³„æ¼.Vogtç­‰äººå‘ç°,åªåŠ¨æ€åœ°æ ‡è®°åˆ†æ”¯æ¡ä»¶ä¸‹çš„è¯­å¥ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µ ä»ä»¥å›¾ 6(a)ä¸­çš„ç¨‹åºä¸ºä¾‹:å½“ç¬¬ 3 è¡Œçš„æ§åˆ¶æ¡ä»¶è¢«æ‰§è¡Œæ—¶,å¯¹åº”çš„ x ä¼šè¢«æ ‡è®°.æ­¤æ—¶,x çš„å€¼ä¸º true,è€Œ y å€¼æ²¡æœ‰å˜åŒ–,ä»ç„¶ä¸º false.åœ¨åç»­æ‰§è¡Œè¿‡ç¨‹ä¸­,ç”±äºç¬¬ 9è¡Œçš„æ±¡ç‚¹æ±‡èšç‚¹ä¸å¯è¾¾,è€Œç¬¬ 12 è¡Œçš„æ±‡èšç‚¹å¯è¾¾,åŠ¨æ€åˆ†ææ²¡æœ‰æ£€æµ‹åˆ°æ±¡ç‚¹æ•°æ®æ³„æ¼.ä½†æ”»å‡»è€…ç”±ç¬¬ 11 è¡Œ y ç­‰äº false çš„æ¡ä»¶èƒ½å¤Ÿåæ¨å‡ºç¨‹åºæ‰§è¡Œäº†ç¬¬ 3 è¡Œçš„åˆ†æ”¯æ¡ä»¶,ç¨‹åºå®é™…ä¸Šå­˜åœ¨ä¿¡æ¯æ³„æ¼çš„é—®é¢˜.è¿™ä¸ªä¿¡æ¯æ³„éœ²æ˜¯ç”±ç¬¬ 6 è¡Œæœªè¢«æ‰§è¡Œåˆ°çš„ y çš„èµ‹å€¼è¯­å¥æ‰€è§¦å‘çš„.å› æ­¤,y åº”è¯¥è¢«åŠ¨æ€æ±¡ç‚¹ä¼ æ’­åˆ†ææ‰€æ ‡è®°.ä¸ºäº†è§£å†³éƒ¨åˆ†æ³„æ¼é—®é¢˜,Vogtç­‰äººåœ¨ä¼ ç»Ÿçš„åŠ¨æ€æ±¡ç‚¹åˆ†æåŸºç¡€ä¸Šå¢åŠ äº†ç¦»çº¿çš„é™æ€åˆ†æ,ä»¥è·Ÿè¸ªåŠ¨æ€æ‰§è¡Œè¿‡ç¨‹ä¸­çš„æ§åˆ¶ä¾èµ–å…³ç³»,å¯¹æ±¡ç‚¹åˆ†æ”¯æ§åˆ¶èŒƒå›´å†…çš„æ‰€æœ‰èµ‹å€¼è¯­å¥ä¸­çš„å˜é‡éƒ½è¿›è¡Œæ ‡è®°.å…·ä½“åˆ°å›¾ 6(a)æ‰€ç¤ºçš„ä¾‹å­,å°±æ˜¯ç¬¬ 4 è¡Œå’Œç¬¬ 6 è¡Œä¸­çš„å˜é‡å‡ä¼šè¢«æ±¡ç‚¹æ ‡è®°.ä½†æ˜¯,Vogt ç­‰äººçš„æ–¹æ³•ä»ç„¶ä¼šäº§ç”Ÿè¿‡æ±¡æŸ“çš„æƒ…å†µ. åŠ¨æ€åˆ†æéœ€è¦è§£å†³çš„ç¬¬ 3 ä¸ªé—®é¢˜æ˜¯å¦‚ä½•é€‰æ‹©åˆé€‚çš„æ±¡ç‚¹æ ‡è®°åˆ†æ”¯è¿›è¡Œæ±¡ç‚¹ä¼ æ’­.é‰´äºå•çº¯åœ°å°†æ‰€æœ‰åŒ…å«æ±¡ç‚¹æ ‡è®°çš„åˆ†æ”¯è¿›è¡Œä¼ æ’­ä¼šå¯¼è‡´è¿‡æ±¡æŸ“çš„æƒ…å†µ,å¯ä»¥æ ¹æ®ä¿¡æ¯æ³„æ¼èŒƒå›´çš„ä¸åŒ,å®šé‡åœ°è®¾è®¡æ±¡ç‚¹æ ‡è®°åˆ†æ”¯çš„é€‰æ‹©ç­–ç•¥. ä»¥å›¾ 6(b)æ‰€ç¤ºçš„ç¨‹åºä¸ºä¾‹,ç¬¬ 2 è¡Œçš„å˜é‡ a ä¸ºåˆå§‹çš„æ±¡ç‚¹æ ‡è®°å˜é‡.ç¬¬ 5 è¡Œã€ç¬¬ 7 è¡Œã€ç¬¬ 9 è¡Œå‡ä¸ºä»¥ aä½œä¸ºæºæ“ä½œæ•°çš„æ±¡ç‚¹æ ‡è®°çš„åˆ†æ”¯.å¦‚æœä¼ æ’­ç­–ç•¥ä¸ºåªè¦åˆ†æ”¯æŒ‡ä»¤ä¸­åŒ…å«æ±¡ç‚¹æ ‡è®°å°±å¯¹å…¶è¿›è¡Œä¼ æ’­,é‚£ä¹ˆç¬¬ 5 è¡Œã€ç¬¬ 7 è¡Œã€ç¬¬ 9 è¡Œå°†åˆ†åˆ«è¢«ä¼ æ’­ç»™ç¬¬ 6 è¡Œã€ç¬¬ 8 è¡Œã€ç¬¬ 10 è¡Œ,å¹¶æœ€ç»ˆä¼ æ’­åˆ°ç¬¬ 12 è¡Œçš„æ±¡ç‚¹æ±‡èšç‚¹.å¦‚æœå¯¹è¿™æ®µç¨‹åºè¿›è¡Œæ·±å…¥åˆ†æä¼šå‘ç°,3ä¸ªåˆ†æ”¯æ¡ä»¶æ‰€æä¾›çš„ä¿¡æ¯å€¼(æ‰€èƒ½æ³„éœ²çš„ä¿¡æ¯èŒƒå›´)å¹¶ä¸ç›¸åŒ,åˆ†åˆ«æ˜¯ a ç­‰äº 10ã€aå¤§äº 10 ä¸”å°äºæˆ–ç­‰äº 13(å°† w å€¼ä»£å…¥è®¡ç®—)ä»¥åŠ a å°äº 10.å¯¹äº a ç­‰äº 10 çš„æƒ…å†µ,æ”»å‡»è€…å¯ä»¥æ ¹æ®ç¬¬ 12 è¡Œæ³„æ¼çš„ x çš„å€¼ç›´æ¥è¿˜åŸå‡ºæ±¡ç‚¹æºå¤„ a çš„å€¼(è¿™ç±»åˆ†æ”¯ä¹Ÿè¢«ç§°ä¸ºèƒ½å¤Ÿä¿å­˜å®Œæ•´ä¿¡æ¯çš„åˆ†æ”¯);å¯¹äº a å¤§äº 10 ä¸”å°äºæˆ–ç­‰äº 13 çš„æƒ…å†µ,æ”»å‡»è€…ä¹Ÿåªéœ€è¦å°è¯• 3 æ¬¡å°±å¯ä»¥è¿˜åŸä¿¡æ¯;è€Œå¯¹äº a å°äº 10 çš„æƒ…å†µ,æ”»å‡»è€…æ‰€è·å¾—çš„ä¸ç¡®å®šæ€§è¾ƒå¤§,æˆåŠŸè¿˜åŸä¿¡æ¯çš„å‡ ç‡æ˜¾è‘—ä½äºå‰ä¸¤ç§,å¯¹è¯¥åˆ†æ”¯è¿›è¡Œæ±¡ç‚¹ä¼ æ’­çš„å®é™…æ„ä¹‰ä¸å¤§. Baoç­‰äººåªå°†ä¸¥æ ¼æ§åˆ¶ä¾èµ–(strict control dependence)è¯†åˆ«æˆéœ€è¦æ±¡ç‚¹ä¼ æ’­çš„åˆ†æ”¯,å…¶ä¸­,ä¸¥æ ¼æ§åˆ¶ä¾èµ–å³åˆ†æ”¯æ¡ä»¶è¡¨è¾¾å¼çš„ä¸¤ç«¯å…·æœ‰å¸¸æ•°å·®å¼‚çš„åˆ†æ”¯.ä½†æ˜¯,Bao çš„æ–¹æ³•åªé€‚ç”¨äºèƒ½å¤Ÿåœ¨ç¼–è¯‘é˜¶æ®µè®¡ç®—å‡ºå¸¸æ•°å·®å¼‚çš„åˆ†æ”¯. æ±¡ç‚¹åˆ†ææ–¹æ³•å®ç°é™æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯é™æ€æ±¡ç‚¹åˆ†æç³»ç»Ÿé¦–å…ˆå¯¹ç¨‹åºä»£ç è¿›è¡Œè§£æï¼Œè·å¾—ç¨‹åºä»£ç çš„ä¸­é—´è¡¨ç¤ºï¼Œç„¶ååœ¨ä¸­é—´è¡¨ç¤ºçš„åŸºç¡€ä¸Šå¯¹ç¨‹åºä»£ç è¿›è¡Œæ§åˆ¶æµåˆ†æç­‰è¾…åŠ©åˆ†æï¼Œä»¥è·å¾—éœ€è¦çš„æ§åˆ¶æµå›¾ã€è°ƒç”¨å›¾ç­‰ã€‚åœ¨è¾…åŠ©åˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨æ±¡ç‚¹åˆ†æè§„åˆ™åœ¨ä¸­é—´è¡¨ç¤ºä¸Šè¯†åˆ«ç¨‹åºä¸­çš„ Source ç‚¹å’Œ Sink ç‚¹ã€‚æœ€åæ£€æµ‹ç³»ç»Ÿæ ¹æ®æ±¡ç‚¹åˆ†æè§„åˆ™ï¼Œåˆ©ç”¨é™æ€æ±¡ç‚¹åˆ†ææ£€æŸ¥ç¨‹åºæ˜¯å¦å­˜åœ¨æ±¡ç‚¹ç±»å‹çš„æ¼æ´ã€‚ åŸºäºæ•°æ®æµçš„æ±¡ç‚¹åˆ†æåœ¨åŸºäºæ•°æ®æµçš„æ±¡ç‚¹åˆ†æä¸­ï¼Œå¸¸å¸¸éœ€è¦ä¸€äº›è¾…åŠ©åˆ†ææŠ€æœ¯ï¼Œä¾‹å¦‚åˆ«ååˆ†æã€å–å€¼åˆ†æç­‰ï¼Œæ¥æé«˜åˆ†æç²¾åº¦ã€‚è¾…åŠ©åˆ†æå’Œæ±¡ç‚¹åˆ†æäº¤æ›¿è¿›è¡Œï¼Œé€šå¸¸æ²¿ç€ç¨‹åºè·¯å¾„çš„æ–¹å‘åˆ†ææ±¡ç‚¹ä¿¡æ¯çš„æµå‘ï¼Œæ£€æŸ¥ Source ç‚¹å¤„ç¨‹åºæ¥æ”¶çš„æ±¡ç‚¹ä¿¡æ¯æ˜¯å¦ä¼šå½±å“åˆ° Sink ç‚¹å¤„çš„æ•æ„Ÿæ“ä½œã€‚ è¿‡ç¨‹å†…çš„åˆ†æä¸­ï¼ŒæŒ‰ç…§ä¸€å®šçš„é¡ºåºåˆ†æè¿‡ç¨‹å†…çš„æ¯ä¸€æ¡è¯­å¥æˆ–è€…æŒ‡ä»¤ï¼Œè¿›è€Œåˆ†ææ±¡ç‚¹ä¿¡æ¯çš„æµå‘ã€‚ è®°å½•æ±¡ç‚¹ä¿¡æ¯ã€‚åœ¨é™æ€åˆ†æå±‚é¢ï¼Œç¨‹åºå˜é‡çš„æ±¡æŸ“æƒ…å†µä¸ºä¸»è¦å…³æ³¨å¯¹è±¡ã€‚ä¸ºè®°å½•æ±¡æŸ“ä¿¡æ¯ï¼Œé€šå¸¸ä¸ºå˜é‡æ·»åŠ ä¸€ä¸ªæ±¡æŸ“æ ‡ç­¾ã€‚æœ€ç®€å•çš„å°±æ˜¯ä¸€ä¸ªå¸ƒå°”å‹å˜é‡ï¼Œè¡¨ç¤ºå˜é‡æ˜¯å¦è¢«æ±¡æŸ“ã€‚æ›´å¤æ‚çš„æ ‡ç­¾è¿˜å¯ä»¥è®°å½•å˜é‡çš„æ±¡æŸ“ä¿¡æ¯æ¥è‡ªå“ªäº› Source ç‚¹ï¼Œç”šè‡³ç²¾ç¡®åˆ° Source ç‚¹æ¥æ”¶æ•°æ®çš„å“ªä¸€éƒ¨åˆ†ã€‚å½“ç„¶ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨æ±¡æŸ“æ ‡ç­¾ï¼Œè¿™æ—¶æˆ‘ä»¬é€šè¿‡å¯¹å˜é‡è¿›è¡Œè·Ÿè¸ªçš„æ–¹å¼è¾¾åˆ°åˆ†ææ±¡ç‚¹ä¿¡æ¯æµå‘çš„ç›®çš„ã€‚ä¾‹å¦‚ä½¿ç”¨æ ˆæˆ–è€…é˜Ÿåˆ—æ¥è®°å½•è¢«æ±¡æŸ“çš„å˜é‡ã€‚ ç¨‹åºè¯­å¥çš„åˆ†æã€‚åœ¨ç¡®å®šå¦‚ä½•è®°å½•æ±¡æŸ“ä¿¡æ¯åï¼Œå°†å¯¹ç¨‹åºè¯­å¥è¿›è¡Œé™æ€åˆ†æã€‚é€šå¸¸æˆ‘ä»¬ä¸»è¦å…³æ³¨èµ‹å€¼è¯­å¥ã€æ§åˆ¶è½¬ç§»è¯­å¥ä»¥åŠè¿‡ç¨‹è°ƒç”¨è¯­å¥ä¸‰ç±»ã€‚ èµ‹å€¼è¯­å¥ã€‚ å¯¹äºç®€å•çš„èµ‹å€¼è¯­å¥ï¼Œå½¢å¦‚ a = b è¿™æ ·çš„ï¼Œè®°å½•è¯­å¥å·¦ç«¯çš„å˜é‡å’Œå³ç«¯çš„å˜é‡å…·æœ‰ç›¸åŒçš„æ±¡æŸ“çŠ¶æ€ã€‚ç¨‹åºä¸­çš„å¸¸é‡é€šå¸¸è®¤ä¸ºæ˜¯æœªæ±¡æŸ“çš„ï¼Œå¦‚æœä¸€ä¸ªå˜é‡è¢«èµ‹å€¼ä¸ºå¸¸é‡ï¼Œåœ¨ä¸è€ƒè™‘éšå¼ä¿¡æ¯æµçš„æƒ…å†µä¸‹ï¼Œè®¤ä¸ºå˜é‡çš„çŠ¶æ€åœ¨èµ‹å€¼åæ˜¯æœªæ±¡æŸ“çš„ã€‚ å¯¹äºå½¢å¦‚ a = b + c è¿™æ ·å¸¦æœ‰äºŒå…ƒæ“ä½œçš„èµ‹å€¼è¯­å¥ï¼Œé€šå¸¸è§„å®šå¦‚æœå³ç«¯çš„æ“ä½œæ•°åªè¦æœ‰ä¸€ä¸ªæ˜¯è¢«æ±¡æŸ“çš„ï¼Œåˆ™å·¦ç«¯çš„å˜é‡æ˜¯æ±¡æŸ“çš„ï¼ˆé™¤éå³ç«¯è®¡ç®—ç»“æœä¸ºå¸¸é‡ï¼‰ã€‚ å¯¹äºå’Œæ•°ç»„å…ƒç´ ç›¸å…³çš„èµ‹å€¼ï¼Œå¦‚æœå¯ä»¥é€šè¿‡é™æ€åˆ†æç¡®å®šæ•°ç»„ä¸‹æ ‡çš„å–å€¼æˆ–è€…å–å€¼èŒƒå›´ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç²¾ç¡®åœ°åˆ¤æ–­æ•°ç»„ä¸­å“ªä¸ªæˆ–å“ªäº›å…ƒç´ æ˜¯æ±¡æŸ“çš„ã€‚ä½†é€šå¸¸é™æ€åˆ†æä¸èƒ½ç¡®å®šä¸€ä¸ªå˜é‡æ˜¯æ±¡æŸ“çš„ï¼Œé‚£ä¹ˆå°±ç®€å•åœ°è®¤ä¸ºæ•´ä¸ªæ•°ç»„éƒ½æ˜¯æ±¡æŸ“çš„ã€‚ å¯¹äºåŒ…å«å­—æ®µæˆ–è€…åŒ…å«æŒ‡é’ˆæ“ä½œçš„èµ‹å€¼è¯­å¥ï¼Œå¸¸å¸¸éœ€è¦ç”¨åˆ°æŒ‡å‘åˆ†æçš„åˆ†æç»“æœã€‚ æ§åˆ¶è½¬ç§»è¯­å¥ã€‚ åœ¨åˆ†ææ¡ä»¶æ§åˆ¶è½¬ç§»è¯­å¥æ—¶ï¼Œé¦–å…ˆè€ƒè™‘è¯­å¥ä¸­çš„è·¯å¾„æ¡ä»¶å¯èƒ½æ˜¯åŒ…å«å¯¹æ±¡ç‚¹æ•°æ®çš„é™åˆ¶ï¼Œåœ¨å®é™…åˆ†æä¸­å¸¸å¸¸éœ€è¦è¯†åˆ«è¿™ç§é™åˆ¶æ±¡ç‚¹æ•°æ®çš„æ¡ä»¶ï¼Œä»¥åˆ¤æ–­è¿™äº›é™åˆ¶æ¡ä»¶æ˜¯å¦è¶³å¤ŸåŒ…å«ç¨‹åºä¸ä¼šå—åˆ°æ”»å‡»ã€‚å¦‚æœå¾—å‡ºè·¯å¾„æ¡ä»¶çš„é™åˆ¶æ˜¯è¶³å¤Ÿçš„ï¼Œé‚£ä¹ˆå¯ä»¥å°†ç›¸åº”çš„å˜é‡æ ‡è®°ä¸ºæœªæ±¡æŸ“çš„ã€‚ å¯¹äºå¾ªç¯è¯­å¥ï¼Œé€šå¸¸è§„å®šå¾ªç¯å˜é‡çš„å–å€¼èŒƒå›´ä¸èƒ½å—åˆ°è¾“å…¥çš„å½±å“ã€‚ä¾‹å¦‚åœ¨è¯­å¥ for (i = 1ï¼› i &lt; kï¼› i++)&#123;&#125; ä¸­ï¼Œå¯ä»¥è§„å®šå¾ªç¯çš„ä¸Šç•Œ k ä¸èƒ½æ˜¯æ±¡æŸ“çš„ã€‚ è¿‡ç¨‹è°ƒç”¨è¯­å¥ã€‚ å¯ä»¥ä½¿ç”¨è¿‡ç¨‹é—´çš„åˆ†ææˆ–è€…ç›´æ¥åº”ç”¨è¿‡ç¨‹æ‘˜è¦è¿›è¡Œåˆ†æã€‚æ±¡ç‚¹åˆ†ææ‰€ä½¿ç”¨çš„è¿‡ç¨‹æ‘˜è¦ä¸»è¦æè¿°æ€æ ·æ”¹å˜ä¸è¯¥è¿‡ç¨‹ç›¸å…³çš„å˜é‡çš„æ±¡æŸ“çŠ¶æ€ï¼Œä»¥åŠå¯¹å“ªäº›å˜é‡çš„æ±¡æŸ“çŠ¶æ€è¿›è¡Œæ£€æµ‹ã€‚è¿™äº›å˜é‡å¯ä»¥æ˜¯è¿‡ç¨‹ä½¿ç”¨çš„å‚æ•°ã€å‚æ•°çš„å­—æ®µæˆ–è€…è¿‡ç¨‹çš„è¿”å›å€¼ç­‰ã€‚ä¾‹å¦‚åœ¨è¯­å¥ flag = objã€‚method(str)ï¼› ä¸­ï¼Œstr æ˜¯æ±¡æŸ“çš„ï¼Œé‚£ä¹ˆé€šè¿‡è¿‡ç¨‹é—´çš„åˆ†æï¼Œå°†å˜é‡ obj çš„å­—æ®µ str æ ‡è®°ä¸ºæ±¡æŸ“çš„ï¼Œè€Œè®°å½•æ–¹æ³•çš„è¿”å›å€¼çš„å˜é‡ flag æ ‡è®°ä¸ºæœªæ±¡æŸ“çš„ã€‚ åœ¨å®é™…çš„è¿‡ç¨‹é—´åˆ†æä¸­ï¼Œå¯ä»¥å¯¹å·²ç»åˆ†æè¿‡çš„è¿‡ç¨‹æ„å»ºè¿‡ç¨‹æ‘˜è¦ã€‚ä¾‹å¦‚å‰é¢çš„è¯­å¥ï¼Œå…¶è¿‡ç¨‹æ‘˜è¦æè¿°ä¸ºï¼šæ–¹æ³• method çš„å‚æ•°æ±¡æŸ“çŠ¶æ€å†³å®šå…¶æ¥æ”¶å¯¹è±¡çš„å®ä¾‹åŸŸ str çš„æ±¡æŸ“çŠ¶æ€ï¼Œå¹¶ä¸”å®ƒçš„è¿”å›å€¼æ˜¯æœªå—æ±¡æŸ“çš„ã€‚é‚£ä¹ˆä¸‹ä¸€æ¬¡åˆ†æéœ€è¦æ—¶ï¼Œå°±å¯ä»¥ç›´æ¥åº”ç”¨æ‘˜è¦è¿›è¡Œåˆ†æã€‚ ä»£ç çš„éå†ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¸¸å¸¸ä½¿ç”¨æµæ•æ„Ÿçš„æ–¹å¼æˆ–è€…è·¯å¾„æ•æ„Ÿçš„æ–¹å¼è¿›è¡Œéå†ï¼Œå¹¶åˆ†æè¿‡ç¨‹ä¸­çš„ä»£ç ã€‚å¦‚æœä½¿ç”¨æµæ•æ„Ÿçš„æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡å¯¹ä¸åŒè·¯å¾„ä¸Šçš„åˆ†æç»“æœè¿›è¡Œæ±‡é›†ï¼Œä»¥å‘ç°ç¨‹åºä¸­çš„æ•°æ®å‡€åŒ–è§„åˆ™ã€‚å¦‚æœä½¿ç”¨è·¯å¾„æ•æ„Ÿçš„åˆ†ææ–¹å¼ï¼Œåˆ™éœ€è¦å…³æ³¨è·¯å¾„æ¡ä»¶ï¼Œå¦‚æœè·¯å¾„æ¡ä»¶ä¸­æ¶‰åŠå¯¹æ±¡æŸ“å˜é‡å–å€¼çš„é™åˆ¶ï¼Œå¯è®¤ä¸ºè·¯å¾„æ¡ä»¶å¯¹æ±¡æŸ“æ•°æ®è¿›è¡Œäº†å‡€åŒ–ï¼Œè¿˜å¯ä»¥å°†åˆ†æè·¯å¾„æ¡ä»¶å¯¹æ±¡æŸ“æ•°æ®çš„é™åˆ¶è¿›è¡Œè®°å½•ï¼Œå¦‚æœåœ¨ä¸€æ¡ç¨‹åºè·¯å¾„ä¸Šï¼Œè¿™äº›é™åˆ¶è¶³å¤Ÿä¿è¯æ•°æ®ä¸ä¼šè¢«æ”»å‡»è€…åˆ©ç”¨ï¼Œå°±å¯ä»¥å°†ç›¸åº”çš„å˜é‡æ ‡è®°ä¸ºæœªæ±¡æŸ“çš„ã€‚ è¿‡ç¨‹é—´çš„åˆ†æä¸æ•°æ®æµè¿‡ç¨‹é—´åˆ†æç±»ä¼¼ï¼Œä½¿ç”¨è‡ªåº•å‘ä¸Šçš„åˆ†ææ–¹æ³•ï¼Œåˆ†æè°ƒç”¨å›¾ä¸­çš„æ¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œè¿›è€Œå¯¹ç¨‹åºè¿›è¡Œæ•´ä½“çš„åˆ†æã€‚ åŸºäºä¾èµ–å…³ç³»çš„æ±¡ç‚¹åˆ†æåœ¨åŸºäºä¾èµ–å…³ç³»çš„æ±¡ç‚¹åˆ†æä¸­ï¼Œé¦–å…ˆåˆ©ç”¨ç¨‹åºçš„ä¸­é—´è¡¨ç¤ºã€æ§åˆ¶æµå›¾å’Œè¿‡ç¨‹è°ƒç”¨å›¾æ„é€ ç¨‹åºå®Œæ•´çš„æˆ–è€…å±€éƒ¨çš„ç¨‹åºçš„ä¾èµ–å…³ç³»ã€‚åœ¨åˆ†æç¨‹åºä¾èµ–å…³ç³»åï¼Œæ ¹æ®æ±¡ç‚¹åˆ†æè§„åˆ™ï¼Œæ£€æµ‹ Sink ç‚¹å¤„æ•æ„Ÿæ“ä½œæ˜¯å¦ä¾èµ–äº Source ç‚¹ã€‚ åˆ†æç¨‹åºä¾èµ–å…³ç³»çš„è¿‡ç¨‹å¯ä»¥çœ‹åšæ˜¯æ„å»ºç¨‹åºä¾èµ–å›¾çš„è¿‡ç¨‹ã€‚ç¨‹åºä¾èµ–å›¾æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ã€‚å®ƒçš„èŠ‚ç‚¹æ˜¯ç¨‹åºè¯­å¥ï¼Œå®ƒçš„æœ‰å‘è¾¹è¡¨ç¤ºç¨‹åºè¯­å¥ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ç¨‹åºä¾èµ–å›¾çš„æœ‰å‘è¾¹å¸¸å¸¸åŒ…æ‹¬æ•°æ®ä¾èµ–è¾¹å’Œæ§åˆ¶ä¾èµ–è¾¹ã€‚åœ¨æ„å»ºæœ‰ä¸€å®šè§„æ¨¡çš„ç¨‹åºçš„ä¾èµ–å›¾æ—¶ï¼Œéœ€è¦æŒ‰éœ€åœ°æ„å»ºç¨‹åºä¾èµ–å…³ç³»ï¼Œå¹¶ä¸”ä¼˜å…ˆè€ƒè™‘å’Œæ±¡ç‚¹ä¿¡æ¯ç›¸å…³çš„ç¨‹åºä»£ç ã€‚ é™æ€æ±¡ç‚¹åˆ†æå®ä¾‹åˆ†æåœ¨ä½¿ç”¨æ±¡ç‚¹åˆ†ææ–¹æ³•æ£€æµ‹ç¨‹åºæ¼æ´æ—¶ï¼Œæ±¡ç‚¹æ•°æ®ç›¸å…³çš„ç¨‹åºæ¼æ´æ˜¯ä¸»è¦å…³æ³¨å¯¹è±¡ï¼Œå¦‚ SQL æ³¨å…¥æ¼æ´ã€å‘½ä»¤æ³¨å…¥æ¼æ´å’Œè·¨ç«™è„šæœ¬æ¼æ´ç­‰ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ ASP ç¨‹åºçš„ä¾‹å­ï¼š 1234567891011121314&lt;% Set pwd = &quot;bar&quot; Set sql1 = &quot;SELECT companyname FROM &quot; &amp; Requestã€‚Cookies(&quot;hello&quot;) Set sql2 = Requestã€‚QueryString(&quot;foo&quot;) MySqlStuff pwdï¼Œ sql1ï¼Œ sql2 Sub MySqlStuff(passwordï¼Œ cmd1ï¼Œ cmd2) Set conn = Serverã€‚CreateObject(&quot;ADODBã€‚Connection&quot;) connã€‚Provider = &quot;Microsoftã€‚Jetã€‚OLEDBã€‚4ã€‚0&quot; connã€‚Open &quot;cï¼š/webdata/fooã€‚mdb&quot;ï¼Œ &quot;foo&quot;ï¼Œ password Set rs = connã€‚Execute(cmd2) Set rs = Serverã€‚CreateObject(&quot;ADODBã€‚recordset&quot;) rsã€‚Open cmd1ï¼Œ conn End Sub%&gt; é¦–å…ˆå¯¹è¿™æ®µä»£ç è¡¨ç¤ºä¸ºä¸€ç§ä¸‰åœ°å€ç çš„å½¢å¼ï¼Œä¾‹å¦‚ç¬¬ 3 è¡Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š 1234567a = &quot;SELECT companyname FROM &quot;b = &quot;hello&quot;param0 Requestparam1 bcallCookiesreturn csql1 = a &amp; c è§£æå®Œæ¯•åï¼Œéœ€è¦å¯¹ç¨‹åºä»£ç è¿›è¡Œæ§åˆ¶æµåˆ†æï¼Œè¿™é‡ŒåªåŒ…å«äº†ä¸€ä¸ªè°ƒç”¨å…³ç³»ï¼ˆç¬¬ 5 è¡Œï¼‰ã€‚ æ¥ä¸‹æ¥ï¼Œéœ€è¦è¯†åˆ«ç¨‹åºä¸­çš„ Source ç‚¹å’Œ Sink ç‚¹ä»¥åŠåˆå§‹çš„è¢«æ±¡æŸ“çš„æ•°æ®ã€‚ å…·ä½“çš„åˆ†æè¿‡ç¨‹å¦‚ä¸‹ï¼š è°ƒç”¨ Requestã€‚Cookies(â€œhelloâ€) çš„è¿”å›ç»“æœæ˜¯æ±¡æŸ“çš„ï¼Œæ‰€ä»¥å˜é‡ sql1 ä¹Ÿæ˜¯æ±¡æŸ“çš„ã€‚ è°ƒç”¨ Requestã€‚QueryString(â€œfooâ€) çš„è¿”å›ç»“æœ sql2 æ˜¯æ±¡æŸ“çš„ã€‚ å‡½æ•° MySqlStuff è¢«è°ƒç”¨ï¼Œå®ƒçš„å‚æ•° sql1ï¼Œsql2 éƒ½æ˜¯æ±¡æŸ“çš„ã€‚åˆ†äº†åˆ†æå‡½æ•°çš„å¤„ç†è¿‡ç¨‹ï¼Œæ ¹æ®ç¬¬ 6 è¡Œå‡½æ•°çš„å£°æ˜ï¼Œæ ‡è®°å…¶å‚æ•° cmd1ï¼Œcmd2 æ˜¯æ±¡æŸ“çš„ã€‚ ç¬¬ 10 è¡Œæ˜¯ç¨‹åºçš„ Sink ç‚¹ï¼Œå‡½æ•° connã€‚Execute æ‰§è¡Œ SQL æ“ä½œï¼Œå…¶å‚æ•° cmd2 æ˜¯æ±¡æŸ“çš„ï¼Œè¿›è€Œå‘ç°æ±¡æŸ“æ•°æ®ä» Source ç‚¹ä¼ æ’­åˆ° Sink ç‚¹ã€‚å› æ­¤ï¼Œè®¤ä¸ºç¨‹åºå­˜åœ¨ SQL æ³¨å…¥æ¼æ´ åŠ¨æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯åŠ¨æ€æ±¡ç‚¹åˆ†ææ˜¯åœ¨ç¨‹åºè¿è¡Œçš„åŸºç¡€ä¸Šï¼Œå¯¹æ•°æ®æµæˆ–æ§åˆ¶æµè¿›è¡Œç›‘æ§ï¼Œä»è€Œå®ç°å¯¹æ•°æ®åœ¨å†…å­˜ä¸­çš„æ˜¾å¼ä¼ æ’­ã€æ•°æ®è¯¯ç”¨ç­‰è¿›è¡Œè·Ÿè¸ªå’Œæ£€æµ‹ã€‚åŠ¨æ€æ±¡ç‚¹åˆ†æä¸é™æ€æ±¡ç‚¹åˆ†æçš„å”¯ä¸€åŒºåˆ«åœ¨äºé™æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯åœ¨æ£€æµ‹æ—¶å¹¶ä¸çœŸæ­£è¿è¡Œç¨‹åºï¼Œè€Œæ˜¯é€šè¿‡æ¨¡æ‹Ÿç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹æ¥ä¼ æ’­æ±¡ç‚¹æ ‡è®°ï¼Œè€ŒåŠ¨æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯éœ€è¦è¿è¡Œç¨‹åºï¼ŒåŒæ—¶å®æ—¶ä¼ æ’­å¹¶æ£€æµ‹æ±¡ç‚¹æ ‡è®°ã€‚ åŠ¨æ€æ±¡ç‚¹åˆ†ææŠ€æœ¯å¯åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š æ±¡ç‚¹æ•°æ®æ ‡è®°ï¼šç¨‹åºæ”»å‡»é¢æ˜¯ç¨‹åºæ¥å—è¾“å…¥æ•°æ®çš„æ¥å£é›†ï¼Œä¸€èˆ¬ç”±ç¨‹åºå…¥å£ç‚¹å’Œå¤–éƒ¨å‡½æ•°è°ƒç”¨ç»„æˆã€‚åœ¨æ±¡ç‚¹åˆ†æä¸­ï¼Œæ¥è‡ªå¤–éƒ¨çš„è¾“å…¥æ•°æ®ä¼šè¢«æ ‡è®°ä¸ºæ±¡ç‚¹æ•°æ®ã€‚æ ¹æ®è¾“å…¥æ•°æ®æ¥æºçš„ä¸åŒï¼Œå¯åˆ†ä¸ºä¸‰ç±»ï¼šç½‘ç»œè¾“å…¥ã€æ–‡ä»¶è¾“å…¥å’Œè¾“å…¥è®¾å¤‡è¾“å…¥ã€‚ æ±¡ç‚¹åŠ¨æ€è·Ÿè¸ªï¼šåœ¨æ±¡ç‚¹æ•°æ®æ ‡è®°çš„åŸºç¡€ä¸Šï¼Œå¯¹è¿›ç¨‹è¿›è¡ŒæŒ‡ä»¤ç²’åº¦çš„åŠ¨æ€è·Ÿè¸ªåˆ†æï¼Œåˆ†ææ¯ä¸€æ¡æŒ‡ä»¤çš„æ•ˆæœï¼Œç›´è‡³è¦†ç›–æ•´ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ï¼Œè·Ÿè¸ªæ•°æ®æµçš„ä¼ æ’­ã€‚ åŠ¨æ€æ±¡ç‚¹è·Ÿè¸ªé€šå¸¸åŸºäºä»¥ä¸‹ä¸‰ç§æœºåˆ¶ åŠ¨æ€ä»£ç æ’æ¡©ï¼šå¯ä»¥è·Ÿè¸ªå•ä¸ªè¿›ç¨‹çš„æ±¡ç‚¹æ•°æ®æµåŠ¨ï¼Œé€šè¿‡åœ¨è¢«åˆ†æç¨‹åºä¸­æ’å…¥åˆ†æä»£ç ï¼Œè·Ÿè¸ªæ±¡ç‚¹ä¿¡æ¯æµåœ¨è¿›ç¨‹ä¸­çš„æµåŠ¨æ–¹å‘ã€‚ å…¨ç³»ç»Ÿæ¨¡æ‹Ÿï¼šåˆ©ç”¨å…¨ç³»ç»Ÿæ¨¡æ‹ŸæŠ€æœ¯ï¼Œåˆ†ææ¨¡æ‹Ÿç³»ç»Ÿä¸­æ¯æ¡æŒ‡ä»¤çš„æ±¡ç‚¹ä¿¡æ¯æ‰©æ•£è·¯å¾„ï¼Œå¯ä»¥è·Ÿè¸ªæ±¡ç‚¹æ•°æ®åœ¨æ“ä½œç³»ç»Ÿå†…çš„æµåŠ¨ã€‚ è™šæ‹Ÿæœºç›‘è§†å™¨ï¼šé€šè¿‡åœ¨è™šæ‹Ÿæœºç›‘è§†å™¨ä¸­å¢åŠ åˆ†ææ±¡ç‚¹ä¿¡æ¯æµçš„åŠŸèƒ½ï¼Œè·Ÿè¸ªæ±¡ç‚¹æ•°æ®åœ¨æ•´ä¸ªå®¢æˆ·æœºä¸­å„ä¸ªè™šæ‹Ÿæœºä¹‹é—´çš„æµåŠ¨ã€‚ æ±¡ç‚¹åŠ¨æ€è·Ÿè¸ªé€šå¸¸éœ€è¦å½±å­å†…å­˜ï¼ˆshadow memoryï¼‰æ¥æ˜ å°„å®é™…å†…å­˜çš„æ±¡æŸ“æƒ…å†µï¼Œä»è€Œè®°å½•å†…å­˜åŒºåŸŸå’Œå¯„å­˜å™¨æ˜¯å¦æ˜¯è¢«æ±¡æŸ“çš„ã€‚å¯¹æ¯æ¡è¯­å¥è¿›è¡Œåˆ†æçš„è¿‡ç¨‹ä¸­ï¼Œæ±¡ç‚¹è·Ÿè¸ªæ”»å‡»æ ¹æ®å½±å­å†…å­˜åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ±¡ç‚¹ä¿¡æ¯çš„ä¼ æ’­ï¼Œä»è€Œå¯¹æ±¡ç‚¹ä¿¡æ¯è¿›è¡Œä¼ æ’­å¹¶å°†ä¼ æ’­ç»“æœä¿å­˜äºå½±å­å†…å­˜ä¸­ï¼Œè¿›è€Œè¿½è¸ªæ±¡ç‚¹æ•°æ®çš„æµå‘ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ•°æ®ç§»åŠ¨ç±»å’Œç®—æ•°ç±»æŒ‡ä»¤éƒ½å°†é€ æˆæ˜¾ç¤ºçš„ä¿¡æ¯æµä¼ æ’­ã€‚ä¸ºäº†è·Ÿè¸ªæ±¡ç‚¹æ•°æ®çš„æ˜¾ç¤ºä¼ æ’­ï¼Œéœ€è¦åœ¨æ¯ä¸ªæ•°æ®ç§»åŠ¨æŒ‡ä»¤å’Œç®—æ•°æŒ‡ä»¤æ‰§è¡Œå‰åšç›‘æ§ï¼Œå½“æŒ‡ä»¤çš„ç»“æœè¢«å…¶ä¸­ä¸€ä¸ªæ“ä½œæ•°æ±¡æŸ“åï¼ŒæŠŠç»“æœæ•°æ®å¯¹åº”çš„å½±å­å†…å­˜è®¾ç½®ä¸ºä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘æºæ±¡æŸ“ç‚¹æ“ä½œæ•°æŒ‡å‘çš„æ•°æ®ç»“æ„ã€‚ æ±¡ç‚¹è¯¯ç”¨æ£€æŸ¥ï¼šåœ¨æ­£ç¡®æ ‡è®°æ±¡ç‚¹æ•°æ®å¹¶å¯¹æ±¡ç‚¹æ•°æ®çš„ä¼ æ’­è¿›è¡Œå®æ—¶è·Ÿè¸ªåï¼Œå°±éœ€è¦å¯¹æ”»å‡»åšå‡ºæ­£ç¡®çš„æ£€æµ‹å³æ£€æµ‹æ±¡ç‚¹æ•°æ®æ˜¯å¦æœ‰éæ³•ä½¿ç”¨çš„æƒ…å†µã€‚ åŠ¨æ€æ±¡ç‚¹åˆ†æçš„ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šè¯¯æŠ¥ç‡è¾ƒä½ï¼Œæ£€æµ‹ç»“æœçš„å¯ä¿¡åº¦è¾ƒé«˜ã€‚ ç¼ºç‚¹ï¼š æ¼æŠ¥ç‡è¾ƒé«˜ï¼šç”±äºç¨‹åºåŠ¨æ€è¿è¡Œæ—¶çš„ä»£ç è¦†ç›–ç‡å†³å®šçš„ã€‚ å¹³å°ç›¸å…³æ€§è¾ƒé«˜ï¼šç‰¹å®šçš„åŠ¨æ€æ±¡ç‚¹åˆ†æå·¥å…·åªèƒ½å¤Ÿè§£å†³åœ¨ç‰¹å®šå¹³å°ä¸Šè¿è¡Œçš„ç¨‹åºã€‚ èµ„æºæ¶ˆè€—å¤§ï¼šåŒ…æ‹¬ç©ºé—´ä¸Šå’Œæ—¶é—´ä¸Šã€‚ åŠ¨æ€æ±¡ç‚¹åˆ†æçš„æ–¹æ³•å®ç°1.æ±¡ç‚¹æ•°æ®æ ‡è®°æ±¡ç‚¹æ•°æ®é€šå¸¸ä¸»è¦æ˜¯æŒ‡è½¯ä»¶ç³»ç»Ÿæ‰€æ¥å—çš„å¤–éƒ¨è¾“å…¥æ•°æ®ï¼Œåœ¨è®¡ç®—æœºä¸­ï¼Œè¿™äº›æ•°æ®å¯èƒ½ä»¥å†…å­˜ä¸´æ—¶æ•°æ®çš„å½¢å¼å­˜å‚¨ï¼Œä¹Ÿå¯èƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜å‚¨ã€‚å½“ç¨‹åºéœ€è¦ä½¿ç”¨è¿™äº›æ•°æ®æ—¶ï¼Œä¸€èˆ¬é€šè¿‡å‡½æ•°æˆ–ç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œæ•°æ®è®¿é—®å’Œå¤„ç†ï¼Œå› æ­¤åªéœ€è¦å¯¹è¿™äº›å…³é”®å‡½æ•°è¿›è¡Œç›‘æ§ï¼Œå³å¯å¾—åˆ°ç¨‹åºè¯»å–æˆ–è¾“å‡ºäº†ä»€ä¹ˆæ±¡ç‚¹ä¿¡æ¯ã€‚å¦å¤–å¯¹äºç½‘ç»œè¾“å…¥ï¼Œä¹Ÿéœ€è¦å¯¹ç½‘ç»œæ“ä½œå‡½æ•°è¿›è¡Œç›‘æ§ã€‚ è¯†åˆ«å‡ºæ±¡ç‚¹æ•°æ®åï¼Œéœ€è¦å¯¹æ±¡ç‚¹è¿›è¡Œæ ‡è®°ã€‚æ±¡ç‚¹ç”Ÿå‘½å‘¨æœŸæ˜¯æŒ‡åœ¨è¯¥ç”Ÿå‘½å‘¨æœŸçš„æ—¶é—´èŒƒå›´å†…ï¼Œæ±¡ç‚¹è¢«å®šä¹‰ä¸ºæœ‰æ•ˆã€‚æ±¡ç‚¹ç”Ÿå‘½å‘¨æœŸå¼€å§‹äºæ±¡ç‚¹åˆ›å»ºæ—¶åˆ»ï¼Œç”Ÿæˆæ±¡ç‚¹æ ‡è®°ï¼Œç»“æŸäºæ±¡ç‚¹åˆ é™¤æ—¶åˆ»ï¼Œæ¸…é™¤æ±¡ç‚¹æ ‡è®°ã€‚ æ±¡ç‚¹åˆ›å»º å°†æ¥è‡ªäºéå¯é æ¥æºçš„æ•°æ®åˆ†é…ç»™æŸå¯„å­˜å™¨æˆ–å†…å­˜æ“ä½œæ•°æ—¶ å°†å·²ç»æ ‡è®°ä¸ºæ±¡ç‚¹çš„æ•°æ®é€šè¿‡è¿ç®—åˆ†é…ç»™æŸå¯„å­˜å™¨æˆ–å†…å­˜æ“ä½œæ•°æ—¶ æ±¡ç‚¹åˆ é™¤ å°†éæ±¡ç‚¹æ•°æ®æŒ‡æ´¾ç»™å­˜æ”¾æ±¡ç‚¹çš„å¯„å­˜å™¨æˆ–å†…å­˜æ“ä½œæ•°æ—¶ å°†æ±¡ç‚¹æ•°æ®æŒ‡æ´¾ç»™å­˜æ”¾æ±¡ç‚¹çš„å¯„å­˜å™¨æˆ–å†…å­˜åœ°å€æ—¶ï¼Œæ­¤æ—¶ä¼šåˆ é™¤åŸæ±¡ç‚¹ï¼Œå¹¶åˆ›å»ºæ–°æ±¡ç‚¹ ä¸€äº›ä¼šæ¸…é™¤æ±¡ç‚¹ç—•è¿¹çš„ç®—æ•°è¿ç®—æˆ–é€»è¾‘è¿ç®—æ“ä½œæ—¶ 2.æ±¡ç‚¹åŠ¨æ€è·Ÿè¸ªå½“æ±¡ç‚¹æ•°æ®ä»ä¸€ä¸ªä½ç½®ä¼ é€’åˆ°å¦ä¸€ä¸ªä½ç½®æ—¶ï¼Œåˆ™è®¤ä¸ºäº§ç”Ÿäº†æ±¡ç‚¹ä¼ æ’­ã€‚æ±¡ç‚¹ä¼ æ’­è§„åˆ™ï¼š æŒ‡ä»¤ç±»å‹ ä¼ æ’­è§„åˆ™ ä¸¾ä¾‹è¯´æ˜ æ‹·è´æˆ–ç§»åŠ¨æŒ‡ä»¤ T(a)&lt;-T(b) mov aï¼Œ b ç®—æ•°è¿ç®—æŒ‡ä»¤ T(a)&lt;-T(b) add aï¼Œ b å †æ ˆæ“ä½œæŒ‡ä»¤ T(esp)&lt;-T(a) push a æ‹·è´æˆ–ç§»åŠ¨ç±»å‡½æ•°è°ƒç”¨æŒ‡ä»¤ T(dst)&lt;-T(src) call memcpy æ¸…é›¶æŒ‡ä»¤ T(a)&lt;-false xor aï¼Œ a æ³¨ï¼šT(x) çš„å–å€¼åˆ†ä¸º true å’Œ false ä¸¤ç§ï¼Œå–å€¼ä¸º true æ—¶è¡¨ç¤º x ä¸ºæ±¡ç‚¹ï¼Œå¦åˆ™ x ä¸æ˜¯æ±¡ç‚¹ã€‚ å¯¹äºæ±¡ç‚¹ä¿¡æ¯æµï¼Œé€šè¿‡æ±¡ç‚¹è·Ÿè¸ªå’Œå‡½æ•°ç›‘æ§ï¼Œå·²ç»èƒ½å¤Ÿè¿›è¡Œæ±¡ç‚¹ä¿¡æ¯æµæµåŠ¨æ–¹å‘çš„åˆ†æã€‚ä½†ç”±äºç¼ºå°‘å¯¹è±¡çº§çš„ä¿¡æ¯ï¼Œä»…é æŒ‡ä»¤çº§çš„ä¿¡æ¯æµåŠ¨å¹¶ä¸èƒ½å®Œå…¨ç»™å‡ºè¦åˆ†æçš„è½¯ä»¶çš„ç¡®åˆ‡è¡Œä¸ºã€‚å› æ­¤ï¼Œéœ€è¦åœ¨å‡½æ•°ç›‘æ§çš„åŸºç¡€ä¸Šè¿›è¡Œè§†å›¾é‡å»ºï¼Œå¦‚è·å–æ–‡ä»¶å¯¹è±¡å’Œå¥—æ¥å­—å¯¹è±¡çš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥æ–¹ä¾¿è¿›ä¸€æ­¥çš„åˆ†æå·¥ä½œã€‚ æ ¹æ®æ¼æ´åˆ†æçš„å®é™…éœ€æ±‚ï¼Œæ±¡ç‚¹åˆ†æåº”åŒ…æ‹¬ä¸¤æ–¹é¢çš„ä¿¡æ¯ï¼š æ±¡ç‚¹çš„ä¼ æ’­å…³ç³»ï¼Œå¯¹äºä»»ä¸€æ±¡ç‚¹èƒ½å¤Ÿè·çŸ¥å…¶ä¼ æ’­æƒ…å†µã€‚ å¯¹æ±¡ç‚¹æ•°æ®è¿›è¡Œå¤„ç†çš„æ‰€æœ‰æŒ‡ä»¤ä¿¡æ¯ï¼ŒåŒ…æ‹¬æŒ‡ä»¤åœ°å€ã€æ“ä½œç ã€æ“ä½œæ•°ä»¥åŠåœ¨æ±¡ç‚¹å¤„ç†è¿‡ç¨‹ä¸­è¿™äº›æŒ‡ä»¤æ‰§è¡Œçš„å…ˆåé¡ºåºç­‰ã€‚ æ±¡ç‚¹åŠ¨æ€è·Ÿè¸ªçš„å®ç°é€šå¸¸ä½¿ç”¨ï¼š å½±å­å†…å­˜ï¼šçœŸå®å†…å­˜ä¸­æ±¡ç‚¹æ•°æ®çš„é•œåƒï¼Œç”¨äºå­˜æ”¾ç¨‹åºæ‰§è¡Œçš„å½“å‰æ—¶åˆ»æ‰€æœ‰çš„æœ‰æ•ˆæ±¡ç‚¹ã€‚ æ±¡ç‚¹ä¼ æ’­æ ‘ï¼šç”¨äºè¡¨ç¤ºæ±¡ç‚¹çš„ä¼ æ’­å…³ç³»ã€‚ æ±¡ç‚¹å¤„ç†æŒ‡ä»¤é“¾ï¼šç”¨äºæŒ‰æ—¶é—´é¡ºåºå­˜å‚¨ä¸æ±¡ç‚¹æ•°æ®å¤„ç†ç›¸å…³çš„æ‰€æœ‰æŒ‡ä»¤ã€‚ å½“é‡åˆ°ä¼šå¼•èµ·æ±¡ç‚¹ä¼ æ’­çš„æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå¯¹æŒ‡ä»¤ä¸­çš„æ¯ä¸ªæ“ä½œæ•°éƒ½é€šè¿‡æ±¡ç‚¹å¿«é€Ÿæ˜ å°„æŸ¥æ‰¾å½±å­å†…å­˜ä¸­æ˜¯å¦å­˜åœ¨ä¸ä¹‹å¯¹åº”çš„å½±å­æ±¡ç‚¹ä»è€Œç¡®å®šå…¶æ˜¯å¦ä¸ºæ±¡ç‚¹æ•°æ®ï¼Œç„¶åæ ¹æ®æ±¡ç‚¹ä¼ æ’­è§„åˆ™å¾—åˆ°è¯¥æŒ‡ä»¤å¼•èµ·çš„æ±¡ç‚¹ä¼ æ’­ç»“æœï¼Œå¹¶å°†ä¼ æ’­äº§ç”Ÿçš„æ–°æ±¡ç‚¹æ·»åŠ åˆ°å½±å­å†…å­˜å’Œæ±¡ç‚¹ä¼ æ’­æ ‘ä¸­ï¼ŒåŒæ—¶å°†å¤±æ•ˆæ±¡ç‚¹å¯¹åº”çš„å½±å­æ±¡ç‚¹åˆ é™¤ã€‚åŒæ—¶ç”±äºä¸€æ¡æŒ‡ä»¤æ˜¯å¦æ¶‰åŠæ±¡ç‚¹æ•°æ®çš„å¤„ç†ï¼Œéœ€è¦åœ¨æ±¡ç‚¹åˆ†æè¿‡ç¨‹ä¸­åŠ¨æ€ç¡®å®šï¼Œå› æ­¤éœ€è¦åœ¨æ±¡ç‚¹å¤„ç†æŒ‡ä»¤é“¾ä¸­è®°å½•æ±¡ç‚¹æ•°æ®çš„æŒ‡ä»¤ä¿¡æ¯ã€‚ 3.æ±¡ç‚¹è¯¯ç”¨æ£€æŸ¥æ±¡ç‚¹æ•æ„Ÿç‚¹ï¼Œå³ Sink ç‚¹ï¼Œæ˜¯æ±¡ç‚¹æ•°æ®æœ‰å¯èƒ½è¢«è¯¯ç”¨çš„æŒ‡ä»¤æˆ–ç³»ç»Ÿè°ƒç”¨ç‚¹ï¼Œä¸»è¦åˆ†ä¸ºï¼š è·³è½¬åœ°å€ï¼šæ£€æŸ¥æ±¡ç‚¹æ•°æ®æ˜¯å¦ç”¨äºè·³è½¬å¯¹è±¡ï¼Œå¦‚è¿”å›åœ°å€ã€å‡½æ•°æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆåç§»ç­‰ã€‚å…·ä½“æ“ä½œæ˜¯åœ¨æ¯ä¸ªè·³è½¬ç±»æŒ‡ä»¤ï¼ˆå¦‚callã€retã€jmpç­‰ï¼‰æ‰§è¡Œå‰è¿›è¡Œç›‘æ§åˆ†æï¼Œä¿è¯è·³è½¬å¯¹è±¡ä¸æ˜¯æ±¡ç‚¹æ•°æ®æ‰€åœ¨çš„å†…å­˜åœ°å€ã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼šæ£€æŸ¥æ±¡ç‚¹æ•°æ®æ˜¯å¦ç”¨ä½œprintfç³»åˆ—å‡½æ•°çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²å‚æ•°ã€‚ ç³»ç»Ÿè°ƒç”¨å‚æ•°ï¼šæ£€æŸ¥ç‰¹æ®Šç³»ç»Ÿè°ƒç”¨çš„ç‰¹æ®Šå‚æ•°æ˜¯å¦ä¸ºæ±¡ç‚¹æ•°æ®ã€‚ æ ‡å¿—ä½ï¼šè·Ÿè¸ªæ ‡å¿—ä½æ˜¯å¦è¢«æ„ŸæŸ“ï¼ŒåŠè¢«æ„ŸæŸ“çš„æ ‡å¿—ä½æ˜¯å¦ç”¨äºæ”¹å˜ç¨‹åºæ§åˆ¶æµã€‚ åœ°å€ï¼šæ£€æŸ¥æ•°æ®ç§»åŠ¨ç±»æŒ‡ä»¤çš„åœ°å€æ˜¯å¦è¢«æ„ŸæŸ“ã€‚ åœ¨è¿›è¡Œæ±¡ç‚¹è¯¯ç”¨æ£€æŸ¥æ—¶ï¼Œé€šå¸¸éœ€è¦æ ¹æ®ä¸€äº›æ¼æ´æ¨¡å¼æ¥è¿›è¡Œæ£€æŸ¥ï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®å¸¸è§æ¼æ´åœ¨äºŒè¿›åˆ¶ä»£ç ä¸Šçš„è¡¨ç°å½¢å¼ï¼Œç„¶åå°†å…¶æç‚¼æˆæ¼æ´æ¨¡å¼ï¼Œä»¥æ›´æœ‰æ•ˆåœ°æŒ‡å¯¼è‡ªåŠ¨åŒ–çš„å®‰å…¨åˆ†æã€‚ åŠ¨æ€æ±¡ç‚¹åˆ†æçš„å®ä¾‹åˆ†æä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä½¿ç”¨åŠ¨æ€æ±¡ç‚¹åˆ†æçš„æ–¹æ³•æ£€æµ‹ç¼“å†²åŒºæº¢å‡ºæ¼æ´çš„ä¾‹å­ã€‚ 12345678910111213141516void fun(char *str)&#123; char temp[15]ï¼› printf(&quot;in strncpyï¼Œ sourceï¼š %s\\n&quot;ï¼Œ str)ï¼› strncpy(tempï¼Œ strï¼Œ strlen(str))ï¼› // Sink ç‚¹&#125;int main(int argcï¼Œ char *argv[])&#123; char source[30]ï¼› gets(source)ï¼› // Source ç‚¹ if (strlen(source) &lt; 30) fun(source)ï¼› else printf(&quot;too long stringï¼Œ %s\\n&quot;ï¼Œ source)ï¼› return 0ï¼›&#125; æ¼æ´å¾ˆæ˜æ˜¾ï¼Œ è°ƒç”¨ strncpy å‡½æ•°å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºã€‚ ç¨‹åºæ¥å—å¤–éƒ¨è¾“å…¥å­—ç¬¦ä¸²çš„äºŒè¿›åˆ¶ä»£ç å¦‚ä¸‹ï¼š 12345670x08048609 &lt;+51&gt;ï¼š lea eaxï¼Œ[ebp-0x2a]0x0804860c &lt;+54&gt;ï¼š push eax0x0804860d &lt;+55&gt;ï¼š call 0x8048400 &lt;gets@plt&gt;...0x0804862c &lt;+86&gt;ï¼š lea eaxï¼Œ[ebp-0x2a]0x0804862f &lt;+89&gt;ï¼š push eax0x08048630 &lt;+90&gt;ï¼š call 0x8048566 &lt;fun&gt; ç¨‹åºè°ƒç”¨ strncpy å‡½æ•°çš„äºŒè¿›åˆ¶ä»£ç å¦‚ä¸‹ï¼š 1234567890x080485a1 &lt;+59&gt;ï¼š push DWORD PTR [ebp-0x2c]0x080485a4 &lt;+62&gt;ï¼š call 0x8048420 &lt;strlen@plt&gt;0x080485a9 &lt;+67&gt;ï¼š add espï¼Œ0x100x080485ac &lt;+70&gt;ï¼š sub espï¼Œ0x40x080485af &lt;+73&gt;ï¼š push eax0x080485b0 &lt;+74&gt;ï¼š push DWORD PTR [ebp-0x2c]0x080485b3 &lt;+77&gt;ï¼š lea eaxï¼Œ[ebp-0x1b]0x080485b6 &lt;+80&gt;ï¼š push eax0x080485b7 &lt;+81&gt;ï¼š call 0x8048440 &lt;strncpy@plt&gt; é¦–å…ˆï¼Œåœ¨æ‰«æè¯¥ç¨‹åºçš„äºŒè¿›åˆ¶ä»£ç æ—¶ï¼Œèƒ½å¤Ÿæ‰«æåˆ° call &lt;gets@plt&gt;ï¼Œè¯¥å‡½æ•°ä¼šè¯»å…¥å¤–éƒ¨è¾“å…¥ï¼Œå³ç¨‹åºçš„æ”»å‡»é¢ã€‚ç¡®å®šäº†æ”»å‡»é¢åï¼Œæˆ‘ä»¬å°†åˆ†ææ±¡æŸ“æºæ•°æ®å¹¶è¿›è¡Œæ ‡è®°ï¼Œå³å°† [ebp-0x2a] æ•°ç»„ï¼ˆå³æºç¨‹åºä¸­çš„sourceï¼‰æ ‡è®°ä¸ºæ±¡ç‚¹æ•°æ®ã€‚ç¨‹åºç»§ç»­æ‰§è¡Œï¼Œè¯¥æ±¡æŸ“æ ‡è®°ä¼šéšç€è¯¥å€¼çš„ä¼ æ’­è€Œä¸€ç›´ä¼ é€’ã€‚åœ¨è¿›å…¥ fun() å‡½æ•°æ—¶ï¼Œè¯¥æ±¡æŸ“æ ‡è®°é€šè¿‡å½¢å‚å®å‚çš„æ˜ å°„ä¼ é€’åˆ°å‚æ•° str ä¸Šã€‚ç„¶åè¿è¡Œåˆ° Sink ç‚¹å‡½æ•° strncpy()ã€‚è¯¥å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å³ str å’Œ ç¬¬ä¸‰ä¸ªå‚æ•° strlen(str) éƒ½æ˜¯æ±¡ç‚¹æ•°æ®ã€‚æœ€ååœ¨æ‰§è¡Œ strncpy() å‡½æ•°æ—¶ï¼Œè‹¥è®¾å®šäº†ç›¸åº”çš„æ¼æ´è§„åˆ™ï¼ˆç›®æ ‡æ•°ç»„å°äºæºæ•°ç»„ï¼‰ï¼Œåˆ™æ¼æ´è§„åˆ™å°†è¢«è§¦å‘ï¼Œæ£€æµ‹å‡ºç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚ æ±¡ç‚¹åˆ†æåœ¨å®é™…åº”ç”¨ä¸­çš„å…³é”®æŠ€æœ¯æ±¡ç‚¹åˆ†æè¢«å¹¿æ³›åœ°åº”ç”¨åœ¨ç³»ç»Ÿéšç§æ•°æ®æ³„éœ²ã€å®‰å…¨æ¼æ´ç­‰é—®é¢˜çš„æ£€æµ‹ä¸­.åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­,ç”±äºç³»ç»Ÿæ¡†æ¶ã€è¯­è¨€ç‰¹æ€§ç­‰æ–¹é¢çš„å·®å¼‚,é€šç”¨çš„æ±¡ç‚¹åˆ†ææŠ€æœ¯å¾€å¾€éš¾ä»¥é€‚ç”¨.æ¯”å¦‚:ç³»ç»Ÿæ¡†æ¶çš„é«˜åº¦æ¨¡å—åŒ–ä»¥åŠå„æ¨¡å—ä¹‹é—´å¤æ‚çš„è°ƒç”¨å…³ç³»å¯¼è‡´æ±¡ç‚¹æºåˆ°æ±‡èšç‚¹çš„ä¼ æ’­è·¯å¾„å˜å¾—å¤æ‚ã€åºå¤§,é‡‡ç”¨é€šç”¨çš„æ±¡ç‚¹åˆ†ææŠ€æœ¯å¯èƒ½é¢ä¸´å¼€é”€éš¾ä»¥æ¥å—çš„é—®é¢˜;é€šç”¨çš„æ±¡ç‚¹åˆ†ææŠ€æœ¯å¯¹æ–°çš„è¯­è¨€ç‰¹æ€§æ”¯æŒæœ‰é™ç­‰.ä¸ºæ­¤,éœ€è¦é’ˆå¯¹ä¸åŒçš„åº”ç”¨åœºæ™¯,å¯¹é€šç”¨çš„æ±¡ç‚¹åˆ†ææŠ€æœ¯è¿›è¡Œæ‰©å±•æˆ–å®šåˆ¶ æœ¬èŠ‚ä»¥ä¸¤ä¸ªä»£è¡¨æ€§çš„åº”ç”¨åœºæ™¯â€”â€”æ™ºèƒ½æ‰‹æœºçš„éšç§æ³„æ¼æ£€æµ‹å’ŒWebåº”ç”¨å®‰å…¨æ¼æ´æ£€æµ‹ä¸ºåˆ‡å…¥ç‚¹,æ€»ç»“è¿‘10å¹´æ¥æ±¡ç‚¹åˆ†ææŠ€æœ¯åœ¨ä¸Šè¿°é¢†åŸŸçš„åº”ç”¨å®è·µè¿‡ç¨‹ä¸­æ‰€é¢ä¸´çš„é—®é¢˜å’Œå…³é”®è§£å†³æŠ€æœ¯ æ£€æµ‹æ™ºèƒ½æ‰‹æœºéšç§æ³„éœ²é’ˆå¯¹Androidçš„æ±¡ç‚¹ä¼ æ’­åˆ†æä¹Ÿå›´ç»•ç»„ä»¶å±•å¼€,æŒ‰ç…§ä¼ æ’­å¯èƒ½é€šè¿‡çš„æ¨¡å—çš„ä¸åŒ,åˆ†ä¸ºç»„ä»¶å†…æ±¡ç‚¹ä¼ æ’­ã€ç»„ä»¶é—´æ±¡ç‚¹ä¼ æ’­ã€ç»„ä»¶ä¸åº“å‡½æ•°ä¹‹é—´çš„æ±¡ç‚¹ä¼ æ’­è¿™3ç±»(å¦‚å›¾7æ‰€ç¤º).æ¥ä¸‹æ¥å°†åˆ†åˆ«ä»‹ç»é’ˆå¯¹è¿™3ç±»ä¼ æ’­é—®é¢˜çš„é™æ€å’ŒåŠ¨æ€æ±¡ç‚¹ä¼ æ’­åˆ†ææŠ€æœ¯ é™æ€æ±¡ç‚¹åˆ†æ1.ç»„ä»¶å†…æ±¡ç‚¹ä¼ æ’­åˆ†æç»„ä»¶å†…éƒ¨æ±¡ç‚¹åˆ†æé¢ä¸´çš„ä¸»è¦é—®é¢˜æ˜¯å¦‚ä½•æ„å»ºå®Œæ•´çš„åˆ†ææ¨¡å‹.ä¸åŒäºä¼ ç»Ÿçš„C/C++ç¨‹åº(æœ‰å”¯ä¸€çš„Mainå‡½æ•°å…¥å£),Androidåº”ç”¨ç¨‹åºå­˜åœ¨æœ‰å¤šä¸ªå…¥å£å‡½æ•°çš„æƒ…å†µ.è¿™ä¸ªæƒ…å†µæºäºAndroidåº”ç”¨ç¨‹åºå¤æ‚çš„è¿è¡Œç”Ÿå‘½å‘¨æœŸ(ä¾‹å¦‚onCreate,onStart,onResume,onPauseç­‰)ä»¥åŠç¨‹åºä¸­å¤§é‡å­˜åœ¨çš„å›è°ƒå‡½æ•°å’Œå¼‚æ­¥å‡½æ•°è°ƒç”¨.ç”±äºä»»ä½•çš„ç¨‹åºå…¥å£éƒ½æœ‰å¯èƒ½æ˜¯éšç§æ•°æ®çš„æ¥æº,åœ¨é™æ€çš„æ±¡ç‚¹åˆ†æå¼€å§‹ä¹‹å‰å¿…é¡»æ„å»ºå®Œæ•´çš„åº”ç”¨ç¨‹åºæ¨¡å‹,ä»¥ç¡®ä¿ç¨‹åºä¸­æ¯ä¸€ç§å¯èƒ½çš„æ‰§è¡Œè·¯å¾„éƒ½ä¼šè¢«é™æ€æ±¡ç‚¹ä¼ æ’­åˆ†æè¦†ç›–åˆ° LeakMiner[^4]å’ŒCHEX[^5]å°è¯•ä½¿ç”¨å¢é‡çš„æ–¹æ³•æ„å»ºç³»ç»Ÿè°ƒç”¨å›¾. Arztç­‰äººè®¾è®¡çš„FlowDroid[^6]æå‡ºäº†ä¸€ç§æ›´ç³»ç»Ÿçš„æ„å»ºAndroidç¨‹åºå®Œæ•´åˆ†ææ¨¡å‹çš„æ–¹æ³•:é¦–å…ˆ,é€šè¿‡XMLé…ç½®æ–‡ä»¶æå–ä¸Androidç”Ÿå‘½å‘¨æœŸç›¸å…³çš„å…¥å£å‡½æ•°,å°†è¿™äº›æ–¹æ³•ä½œä¸ºèŠ‚ç‚¹,å¹¶æ ¹æ®Androidç”Ÿå‘½å‘¨æœŸæ„å»ºè°ƒç”¨å›¾(å¦‚å›¾8æ‰€ç¤º);å…¶æ¬¡,å¯¹äºç”Ÿå‘½å‘¨æœŸå†…çš„å›è°ƒå‡½æ•°,åœ¨è¯¥è°ƒç”¨å›¾çš„åŸºç¡€ä¸Šå¢åŠ ä¸é€æ˜è°“è¯èŠ‚ç‚¹(å³å›¾8ä¸­è±å½¢çš„PèŠ‚ç‚¹);ç„¶å,å¢é‡å¼åœ°å°†å›è°ƒå‡½æ•°åŠ å…¥è¿™ä¸ªå‡½æ•°è°ƒç”¨å›¾;æœ€å,å°†è°ƒç”¨å›¾ä¸Šæ‰€æœ‰çš„æ‰§è¡Œå…¥å£è¿æ¥åˆ°ä¸€ä¸ªè™šå‡çš„Mainå‡½æ•°ä¸Š.FlowDroidä¸­çš„ä¸€æ¬¡åˆæ³•çš„æ‰§è¡Œ,å°±æ˜¯å¯¹è°ƒç”¨å›¾è¿›è¡Œçš„ä¸€æ¬¡éå† Gordonç­‰äºº[^7]æå‡ºçš„DroidSafeä½¿ç”¨Androidè®¾å¤‡å®ç°(Android device implementation)æ¥æ„å»ºAndroidçš„å®Œæ•´åˆ†ææ¨¡å‹.Androidè®¾å¤‡å®ç°æ˜¯å¯¹Androidè¿è¡Œç¯å¢ƒçš„ä¸€ä¸ªç®€å•æ¨¡æ‹Ÿ,å®ƒä½¿ç”¨Javaè¯­è¨€,ç»“åˆAndroid Open Source Porject(AOSP),å®ç°äº†ä¸åŸAndroidæ¥å£è¯­ä¹‰ç­‰ä»·çš„æ¨¡å‹,å¹¶ä½¿ç”¨ç²¾ç¡®åˆ†æå­˜æ ¹(accurate analysis stub)å°†AOSPä»£ç ä¹‹å¤–çš„å‡½æ•°åŠ å…¥åˆ°æ¨¡å‹ä¸­ 2.ç»„ä»¶é—´æ±¡ç‚¹ä¼ æ’­åˆ†æå³ä½¿æ­£ç¡®åˆ†æäº†ç»„ä»¶å†…çš„æ•°æ®æµå…³ç³»,æ±¡ç‚¹æ•°æ®ä»ç„¶å¯èƒ½é€šè¿‡ç»„ä»¶é—´çš„æ•°æ®æµæ¥ä¼ é€’,ä»è€Œé€ æˆä¿¡æ¯æ³„éœ².å¦‚ä¸Šå›¾7å·¦ä¾§æ‰€ç¤º,å³ä½¿ä¿è¯äº†å¯¹ç»„ä»¶Aå†…éƒ¨æ±¡ç‚¹ä¼ æ’­çš„ç²¾ç¡®åˆ†æ,ç»„ä»¶Aä»ç„¶å¯èƒ½é€šè¿‡è°ƒç”¨æ–¹æ³•startActivityforResult()å°†ä¿¡æ¯ä¼ é€’ç»™ç»„ä»¶B,å†é€šè¿‡ç»„ä»¶Bäº§ç”Ÿæ³„éœ².å› æ­¤,é’ˆå¯¹Androidåº”ç”¨çš„æ±¡ç‚¹åˆ†æè¿˜éœ€è¦åˆ†æå‡ºç»„ä»¶é—´æ‰€æœ‰å¯èƒ½çš„æ•°æ®æµä¿¡æ¯.ç»„ä»¶é—´é€šä¿¡æ˜¯é€šè¿‡ç»„ä»¶å‘é€Intentæ¶ˆæ¯å¯¹è±¡å®Œæˆçš„.IntentæŒ‰ç…§å‚æ•°å­—æ®µæ˜¯å¦åŒ…å«ç›®æ ‡ç»„ä»¶åç§°åˆ†ä¸ºæ˜¾å¼Intentå’Œéšå¼Intent.å¦‚å›¾9æ‰€ç¤º:æ˜¾å¼Intentå¯¹è±¡ä½¿ç”¨ä¸€ä¸ªåŒ…å«ç›®æ ‡ç»„ä»¶åç§°çš„å‚æ•°æ˜¾å¼åœ°æŒ‡å®šé€šä¿¡çš„ä¸‹ä¸€ä¸ªç»„ä»¶;éšå¼Intentä½¿ç”¨action,categoryç­‰åŸŸéšå¼åœ°è®©Androidç³»ç»Ÿé€šè¿‡Intent Filterè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªç»„ä»¶è°ƒç”¨.ç›®å‰,è§£å†³è¯¥é—®é¢˜çš„ä¸»è¦æ€æƒ³æ˜¯åˆ©ç”¨Intentå‚æ•°ä¿¡æ¯åˆ†æç»„ä»¶é—´çš„æ•°æ®æµ è§£å†³ç»„ä»¶é—´æ•°æ®æµçš„å‰ææ˜¯è§£æIntentçš„ç›®çš„åœ°,è§£æIntentç›®çš„åœ°åŒ…æ‹¬è§£ææ˜¾å¼Intentçš„ç›®çš„åœ°å’Œéšå¼Intentçš„ç›®çš„åœ°.ç”±äºæ˜¾å¼Intentçš„ç›®çš„åœ°å¯ä»¥ç›´æ¥é€šè¿‡åˆå§‹åŒ–Intentçš„åœ°å€å­—ç¬¦ä¸²å‚æ•°è·å¾—,ç›®å‰,è§£ææ˜¾å¼Intentç›®çš„åœ°çš„å¸¸ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²åˆ†æå·¥å…·æå–Intentä¸­å­—ç¬¦ä¸²å‚æ•°çš„ä¿¡æ¯. è§£æéšå¼Intentç›®çš„åœ°çš„ä¸»è¦æ–¹æ³•æ˜¯åˆ†æé…ç½®æ–‡ä»¶ä¿¡æ¯ä¸Intent Filteræ³¨å†Œå™¨ä¹‹é—´çš„æ˜ å°„å…³ç³»,å»ºç«‹å‘é€Intentç»„ä»¶å’Œæ¥å—Intentç»„ä»¶ä¹‹é—´çš„é…å¯¹å…³ç³».åœ¨è§£æå‡ºIntentç›®çš„åœ°ä¹‹å,é—®é¢˜çš„é‡ç‚¹è½¬ç§»åˆ°å¦‚ä½•æé«˜ç»„ä»¶é—´æ•°æ®æµåˆ†æçš„ç²¾åº¦ä¸Š. Klieberç­‰äººå°è¯•åœ¨å·²ç»å»ºç«‹å¥½çš„ç»„ä»¶å†…æ±¡ç‚¹åˆ†æçš„åŸºç¡€ä¸Š,ç»“åˆæ¨å¯¼è§„åˆ™æ¥åˆ†æç»„ä»¶é—´æ•°æ®æµ.åœ¨åˆ†æä¹‹å‰,éœ€è¦æ”¶é›†ç»„ä»¶å†…éƒ¨çš„æ±¡ç‚¹æºå’Œæ±‡èšç‚¹ä»¥åŠç»„ä»¶å†…Intentçš„å‘é€ç›®çš„åœ°æ ‡ç­¾ç­‰ä¿¡æ¯.è¡¨4å’Œè¡¨5ç»™å‡ºäº†æ¨å¯¼è§„åˆ™çš„å‰æå®šä¹‰å’Œå…·ä½“çš„æ¨å¯¼è§„åˆ™,å…¶ä¸­,ä¸€æ¬¡å®Œæ•´çš„åˆ†ææ˜¯æŒ‡æ ¹æ®å·²çŸ¥ç»„ä»¶å†…éƒ¨çš„ä¿¡æ¯srcâ†’sinksrcâ†’sin**kä»¥åŠæ¨å¯¼è§„åˆ™è¯†åˆ«æ‰€æœ‰srcâ€²â†’sinkâ€²srcâ€²â†’sin**kâ€²çš„æµé›†åˆ Octeauç­‰äººå°è¯•ä½¿ç”¨ç°æœ‰çš„ç¨‹åºåˆ†ææ–¹æ³•æé«˜ç»„ä»¶é—´æ•°æ®æµåˆ†æçš„ç²¾åº¦,ä»–ä»¬å°†ç»„ä»¶é—´æ•°æ®æµåˆ†æé—®é¢˜è½¬åŒ–æˆIDE(interprocedural distributive environment)é—®é¢˜[58]è¿›è¡Œæ±‚è§£.DroidSafeè®¾è®¡äº†ä¸€ç§å¯¹è±¡æ•æ„Ÿçš„åˆ«ååˆ†ææŠ€æœ¯,åœ¨æ­¤åŸºç¡€ä¸Šæä¾›çš„ç²¾åº¦ä¼˜åŒ–æ–¹æ³•åŒ…æ‹¬:æå–Intentçš„ç›®çš„åœ°çš„å­—ç¬¦ä¸²å‚æ•°ã€å°†Intentç›®çš„åœ°çš„åˆå§‹åŒ–å‡½æ•°åµŒå…¥åˆ°ç›®çš„ç»„ä»¶å½“ä¸­ä»¥æé«˜åˆ«ååˆ†æçš„ç²¾åº¦,åŒæ—¶,å¢åŠ å¤„ç†Android Serviceçš„æ”¯æŒ ç»„ä»¶ä¸åº“å‡½æ•°ä¹‹é—´çš„æ±¡ç‚¹ä¼ æ’­åˆ†æç»„ä»¶ä¸åº“å‡½æ•°ä¹‹é—´çš„æ±¡ç‚¹ä¼ æ’­åˆ†æé¢ä¸´çš„ä¸»è¦é—®é¢˜åŒ…æ‹¬å¯¹Androidåº“å‡½æ•°è‡ªèº«åºå¤§çš„ä»£ç é‡çš„åˆ†æä»¥åŠç»„ä»¶å’ŒæŸäº›åº“å‡½æ•°ä½¿ç”¨çš„å®ç°è¯­è¨€ä¸åŒ(Androidç»„ä»¶é€šå¸¸ç”¨Javaå®ç°,è€Œæœ¬åœ°åº“åˆ™é‡‡ç”¨C/C++ä»£ç ç¼–å†™)è¿™ä¸¤æ–¹é¢ åŠ¨æ€æ±¡ç‚¹åˆ†æAndroidç³»ç»Ÿä¸­çš„åŠ¨æ€æ±¡ç‚¹åŒæ ·éœ€è¦åˆ†æç»„ä»¶å†…æ±¡ç‚¹ä¼ æ’­ã€ç»„ä»¶é—´æ±¡ç‚¹ä¼ æ’­ä»¥åŠç»„ä»¶ä»£ç ä¸æœ¬åœ°åº“ä¹‹é—´çš„æ±¡ç‚¹ä¼ æ’­.åŠ¨æ€æ±¡ç‚¹åˆ†æé¢ä¸´çš„ä¸»è¦æŒ‘æˆ˜æ˜¯ç³»ç»Ÿä¿¡æ¯é™¤äº†åœ¨ç³»ç»Ÿå†…éƒ¨é€šè¿‡DEXæŒ‡ä»¤ä¼ æ’­ä»¥å¤–,è¿˜ä¼šç»è¿‡å…¶ä»–çš„é€šé“,å¦‚æœ¬åœ°åº“ã€ç½‘ç»œã€æ–‡ä»¶ç­‰. 1.ç»„ä»¶å†…çš„æ±¡ç‚¹ä¼ æ’­2.ç»„ä»¶é—´çš„æ±¡ç‚¹ä¼ æ’­3.ç»„ä»¶ä¸æœ¬åœ°åº“å‡½æ•°é—´çš„æ±¡ç‚¹ä¼ æ’­åŒ…æ‹¬æ±¡ç‚¹æ•°æ®é€šè¿‡æœ¬åœ°åº“ä»£ç æˆ–æ–‡ä»¶è¿›è¡Œä¼ æ’­.TaintDroidé€šè¿‡è®¾è®¡åç½®æ¡ä»¶å¯¹æœ¬åœ°ä»£ç çš„å‡½æ•°è¿›è¡Œæ±¡ç‚¹ä¼ æ’­.åç½®æ¡ä»¶ä¸º: (a) æ‰€æœ‰æœ¬åœ°ä»£ç è®¿é—®çš„å¤–éƒ¨å˜é‡éƒ½ä¼šè¢«æ ‡è®°ä¸Šæ±¡ç‚¹æ ‡ç­¾; (b) æ ¹æ®é¢„å®šä¹‰è§„åˆ™å°†è¢«èµ‹å€¼çš„å‡½æ•°è¿”å›å€¼ä¹Ÿæ ‡è®°ä¸Šæ±¡ç‚¹æ ‡ç­¾ æ€»ç»“æ±¡ç‚¹åˆ†æä½œä¸ºä¿¡æ¯æµåˆ†æçš„ä¸€ç§å®è·µæŠ€æœ¯,è¢«å¹¿æ³›åº”ç”¨äºäº’è”ç½‘åŠç§»åŠ¨ç»ˆç«¯å¹³å°ä¸Šåº”ç”¨ç¨‹åºçš„ä¿¡æ¯å®‰å…¨ä¿éšœä¸­.æœ¬æ–‡ä»‹ç»äº†æ±¡ç‚¹åˆ†æçš„åŸºæœ¬åŸç†å’Œé€šç”¨æŠ€æœ¯,å¹¶é’ˆå¯¹è¿‘å¹´æ¥æ±¡ç‚¹åˆ†æåœ¨è§£å†³å®é™…åº”ç”¨ç¨‹åºå®‰å…¨é—®é¢˜æ—¶é‡åˆ°çš„é—®é¢˜å’Œå…³é”®è§£å†³æŠ€æœ¯è¿›è¡Œäº†åˆ†æç»¼è¿°.ä¸åŒäºåŸºäºå®‰å…¨ç±»å‹ç³»ç»Ÿçš„ä¿¡æ¯æµåˆ†ææŠ€æœ¯,æ±¡ç‚¹åˆ†æå¯ä»¥ä¸æ”¹å˜ç¨‹åºç°æœ‰çš„ç¼–ç¨‹æ¨¡å‹æˆ–è¯­è¨€ç‰¹æ€§,å¹¶æä¾›ç²¾ç¡®ä¿¡æ¯æµä¼ æ’­è·Ÿè¸ª.åœ¨å®é™…åº”ç”¨è¿‡ç¨‹ä¸­,æ±¡ç‚¹åˆ†æè¿˜éœ€è¦å€ŸåŠ©ä¼ ç»Ÿçš„ç¨‹åºåˆ†ææŠ€æœ¯çš„æ”¯æŒ,ä¾‹å¦‚é™æ€åˆ†æä¸­çš„æ•°æ®æµåˆ†æã€åŠ¨æ€åˆ†æä¸­çš„ä»£ç é‡å†™ç­‰æŠ€æœ¯.å¦å¤–,ç»“åˆæµ‹è¯•ç”¨ä¾‹ç”ŸæˆæŠ€æœ¯ã€ç¬¦å·æ‰§è¡ŒæŠ€æœ¯ä»¥åŠè™šæ‹ŸæœºæŠ€æœ¯,ä¹Ÿä¼šç»™æ±¡ç‚¹åˆ†æå¸¦æ¥æ›´å¤šè¡Œä¹‹æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆ å‚è€ƒæ–‡çŒ®[^1]:Vogt P, Nentwich F, Jovanovic N, Kirda E, Kruegel C, Vigna G. Cross site scripting prevention with dynamic data tainting and static analysis. In: Proc. of the NDSS 2007. 2007. 12. http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.72.4505[^2]:Gordon MI, Kim D, Perkins JH, Gilham L, Nguyen N, Rinard MC. Information flow analysis of Android applications in DroidSafe. In: Proc. of the NDSS 2015. 2015. [doi: 10.14722/ndss.2015.23089][^3]:Rasthofer S, Arzt S, Bodden E. A machine-learning approach for classifying and categorizing android sources and sinks. In: Proc. of the Network and Distributed System Security Symp. (NDSS). 2014. [doi: 10.14722/ndss.2014.23039] [^4]:Yang Z, Yang M. Leakminer: Detect information leakage on Android with static taint analysis. In: Proc. of the Software Engineering. IEEE, 2012. 101âˆ’104. [doi: 10.1109/WCSE.2012.26][^5]:Lu L, Li Z, Wu Z, Lee W, Jiang G. Chex: Statically vetting Android apps for component hijacking vulnerabilities. In: Proc. of the 2012 ACM Conf. on Computer and Communications Security. ACM Press, 2012. 229âˆ’240. [doi: 10.1145/2382196.2382223][^6]:Arzt S, Rasthofer S, Fritz C, Bodden E, Bartel A, Klein J, Le Traon Y, Octeau D, McDaniel P. Flowdroid: Precise context, flow, field, object-sensitive and lifecycle-aware taint analysis for Android apps. ACM SIGPLAN Notices, 2014,49(6):259âˆ’269. [doi: 10.1145/2594291.2594299][^7]:Gordon MI, Kim D, Perkins JH, Gilham L, Nguyen N, Rinard MC. Information flow analysis of Android applications in DroidSafe. In: Proc. of the NDSS 2015. 2015. [doi: 10.14722/ndss.2015.23089] åŸæ–‡é“¾æ¥","categories":[{"name":"ç¨‹åºåˆ†æ","slug":"ç¨‹åºåˆ†æ","permalink":"https://lwy0518.github.io/categories/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/"}],"tags":[{"name":"æ•°æ®æµ","slug":"æ•°æ®æµ","permalink":"https://lwy0518.github.io/tags/%E6%95%B0%E6%8D%AE%E6%B5%81/"},{"name":"æ±¡ç‚¹åˆ†æ","slug":"æ±¡ç‚¹åˆ†æ","permalink":"https://lwy0518.github.io/tags/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/"},{"name":"ä¾èµ–å…³ç³»","slug":"ä¾èµ–å…³ç³»","permalink":"https://lwy0518.github.io/tags/%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB/"},{"name":"Source/Sink","slug":"Source-Sink","permalink":"https://lwy0518.github.io/tags/Source-Sink/"}],"author":"lwy"},{"title":"ç¨‹åºåˆ†æä¹‹ä¸­é—´è¡¨ç¤ºï¼ˆIntermediate Representationï¼‰","slug":"ç¨‹åºåˆ†æä¹‹ä¸­é—´è¡¨ç¤ºï¼ˆIntermediate-Representationï¼‰","date":"2021-12-10T07:43:30.000Z","updated":"2021-12-26T07:47:51.812Z","comments":true,"path":"2021/12/10/ç¨‹åºåˆ†æä¹‹ä¸­é—´è¡¨ç¤ºï¼ˆIntermediate-Representationï¼‰/","link":"","permalink":"https://lwy0518.github.io/2021/12/10/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90%E4%B9%8B%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BA%EF%BC%88Intermediate-Representation%EF%BC%89/","excerpt":"é™æ€åˆ†æç¨‹åºé™æ€åˆ†æï¼ˆProgram Static Analysisï¼‰æ˜¯æŒ‡åœ¨ä¸è¿è¡Œä»£ç çš„æ–¹å¼ä¸‹ï¼Œé€šè¿‡è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€æ§åˆ¶æµã€æ•°æ®æµåˆ†æç­‰æŠ€æœ¯å¯¹ç¨‹åºä»£ç è¿›è¡Œæ‰«æï¼ŒéªŒè¯ä»£ç æ˜¯å¦æ»¡è¶³è§„èŒƒæ€§ã€å®‰å…¨æ€§ã€å¯é æ€§ã€å¯ç»´æŠ¤æ€§ç­‰æŒ‡æ ‡çš„ä¸€ç§ä»£ç åˆ†ææŠ€æœ¯ã€‚é™æ€åˆ†ææŠ€æœ¯å‘æ¨¡æ‹Ÿæ‰§è¡Œçš„æŠ€æœ¯å‘å±•ä»¥èƒ½å¤Ÿå‘ç°æ›´å¤šä¼ ç»Ÿæ„ä¹‰ä¸ŠåŠ¨æ€æµ‹è¯•æ‰èƒ½å‘ç°çš„ç¼ºé™·ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡å’Œè½¯ä»¶è´¨é‡ã€‚æœ¬æ–‡ä»‹ç»éƒ¨åˆ†åœ¨é™æ€ä»£ç åˆ†æä¸­ä½¿ç”¨çš„ä¸­é—´è¡¨ç¤ºçš„æ¦‚å¿µï¼Œä¸»è¦åŒ…æ‹¬æŠ½è±¡è¯­æ³•æ ‘ã€ä¸‰åœ°å€ç ã€SSAå½¢å¼ï¼ŒåŠCFGå’ŒRTLç­‰æ¦‚å¿µ","text":"é™æ€åˆ†æç¨‹åºé™æ€åˆ†æï¼ˆProgram Static Analysisï¼‰æ˜¯æŒ‡åœ¨ä¸è¿è¡Œä»£ç çš„æ–¹å¼ä¸‹ï¼Œé€šè¿‡è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€æ§åˆ¶æµã€æ•°æ®æµåˆ†æç­‰æŠ€æœ¯å¯¹ç¨‹åºä»£ç è¿›è¡Œæ‰«æï¼ŒéªŒè¯ä»£ç æ˜¯å¦æ»¡è¶³è§„èŒƒæ€§ã€å®‰å…¨æ€§ã€å¯é æ€§ã€å¯ç»´æŠ¤æ€§ç­‰æŒ‡æ ‡çš„ä¸€ç§ä»£ç åˆ†ææŠ€æœ¯ã€‚é™æ€åˆ†ææŠ€æœ¯å‘æ¨¡æ‹Ÿæ‰§è¡Œçš„æŠ€æœ¯å‘å±•ä»¥èƒ½å¤Ÿå‘ç°æ›´å¤šä¼ ç»Ÿæ„ä¹‰ä¸ŠåŠ¨æ€æµ‹è¯•æ‰èƒ½å‘ç°çš„ç¼ºé™·ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡å’Œè½¯ä»¶è´¨é‡ã€‚æœ¬æ–‡ä»‹ç»éƒ¨åˆ†åœ¨é™æ€ä»£ç åˆ†æä¸­ä½¿ç”¨çš„ä¸­é—´è¡¨ç¤ºçš„æ¦‚å¿µï¼Œä¸»è¦åŒ…æ‹¬æŠ½è±¡è¯­æ³•æ ‘ã€ä¸‰åœ°å€ç ã€SSAå½¢å¼ï¼ŒåŠCFGå’ŒRTLç­‰æ¦‚å¿µ ä¸­é—´è¡¨ç¤ºï¼ˆIntermediate Representationï¼‰æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼ŒASTï¼‰åœ¨ä»‹ç»ASTæ—¶ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šx = 3 + 4 * y è¿™ä¸ªè¡¨è¾¾å¼ä½œä¸ºä¾‹å­æ¥è¿›è¡Œä»‹ç»ï¼š ASTï¼š æ˜¯æºä»£ç çš„æŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç¤ºï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ï¼Œä¹‹æ‰€ä»¥è¯´æ˜¯æŠ½è±¡çš„ï¼Œæ˜¯å› ä¸ºæŠ½è±¡è¯­æ³•æ ‘å¹¶ä¸ä¼šè¡¨ç¤ºå‡ºçœŸå®è¯­æ³•å‡ºç°çš„æ¯ä¸€ä¸ªç»†èŠ‚ æŠ½è±¡è¯­æ³•æ ‘ï¼Œå…¶å®å°±æ˜¯ç”¨æ ‘çŠ¶ç»“æ„è¡¨ç¤ºè¯­æ³•ç»“æ„ï¼Œä¹Ÿæ²¡æœ‰è¯´å¿…é¡»æ˜¯ä»€ä¹ˆå½¢å¼ï¼Œåªè¦èƒ½å¿ å®åœ°åæ˜ å‡ºæºç çš„æ ¼å¼å³å¯ å½“ç„¶ï¼Œä¸€èˆ¬èµ„æ–™ä¸­åœ¨è¿›è¡Œä»‹ç»æ—¶ï¼Œéƒ½æ˜¯ä»¥æ“ä½œç¬¦ä½œä¸ºæ ¹èŠ‚ç‚¹ï¼Œç”»ä¸ªæ ‘çŠ¶çš„ç»“æ„æ¥è¡¨ç¤ºï¼Œè¿™é‡Œå’±ä»¬ä¹Ÿç®€å•ç”»ä¸€ä¸ªæ„æ€ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‰åœ°å€ç ï¼ˆThree Address Codeï¼ŒTAC/3ACï¼‰ä¸‰åœ°å€ç æ˜¯ä¸€ç§æœ‰æ„æ€çš„ä¸­é—´è¡¨ç¤ºï¼Œå½“å‰ä¹Ÿæ˜¯ç¼–è¯‘åŸç†ä¸­ç”¨å¾—æœ€ç«çš„ã€‚è¿™é‡Œæˆ‘ç»™å¤§å®¶æ¢³ç†ä¸€ç§æˆ‘çš„ç†è§£ä¸Šçš„æ¦‚å¿µï¼Œé‚£å°±æ˜¯ï¼Œåˆ¨æ‰èµ‹å€¼æ“ä½œï¼Œæœ€å¤šåªæœ‰ä¸€ä¸ªæ“ä½œç¬¦ï¼Œå…ˆçœ‹ä¸‹é¢çš„å‡ ä¸ªä¾‹å­ x = y bop z x = uop y x = y goto L å¦‚ä¸Šï¼Œç¬¬ä¸€ä¸ªï¼Œé™¤äº†èµ‹å€¼ä¹‹å¤–ï¼Œåªæœ‰ bop ä¸€ä¸ªæ“ä½œç¬¦ï¼Œç¬¬äºŒä¸ªï¼Œåªæœ‰ uop ä¸€ä¸ªæ“ä½œç¬¦ï¼Œç¬¬ä¸‰ä¸ªæ²¡æœ‰æ“ä½œç¬¦ï¼ŒåŒæ—¶ï¼Œæ“ä½œç¬¦çš„æ¦‚å¿µå¯ä»¥è¿›ä¸€æ­¥æ‰©å±•åˆ°å‡½æ•°è°ƒç”¨ç­‰ï¼Œä¾‹å¦‚ call fun(a, b, c, d)ï¼Œè™½ç„¶æœ‰å››ä¸ªæ“ä½œæ•°ï¼Œä½†æ˜¯æˆ‘ä»¬è®¤ä¸º call funåªæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ã€‚ å¦‚ä¸Šé¢ x = 3 + 4 * y è½¬æ¢ä¸ºä¸‰åœ°å€ç å¦‚ä¸‹ï¼š 123456t1 = 4t2 = yt3 = t1 * t2t4 = 3t5 = t4 + t3x = t5 å½“ç„¶ï¼Œæœ‰äº›å½¢å¼ä¸‹ä¼šå‡å°‘ä¸´æ—¶å˜é‡çš„ä½¿ç”¨ï¼Œå°½é‡å¤ç”¨åŸæ¥çš„å˜é‡æˆ–è€…å¸¸é‡ï¼Œå½¢æˆçš„ä¸‰åœ°å€ç å¦‚ä¸‹ï¼š 12t1 = 4 * yx = 3 + t1 ä¸‰åœ°å€ç æœ€åˆåªæ˜¯å¤„ç†ç±»ä¼¼äº x = y bop z è¿™ç§å½¢å¼çš„è¯­å¥ï¼Œè€Œæå‡ºæ¥çš„â€œä¸‰ä¸ªæ“ä½œæ•°â€çš„æ„æ€ï¼Œéšç€è¯­æ³•çš„æ‰©å……ï¼Œä¹Ÿå¹¶ä¸æ˜¯å®Œå…¨å°±æ˜¯â€œä¸‰åœ°å€â€ã€‚ ASTå’Œä¸‰åœ°å€ç å¯¹æ¯”ä»¥ä¸‹ä»‹ç»å‡ ç‚¹ASTå’Œä¸‰åœ°å€ç çš„å¯¹æ¯”ç‰¹ç‚¹ï¼š æºç ç›¸å…³æ€§ ASTä¸­çš„èŠ‚ç‚¹ä¸è¾“å…¥æºä»£ç ä¸­çš„å„ä¸ªè¯­æ³•å…ƒç´ ä¸€ä¸€å¯¹åº”ï¼Œå¿ å®åœ°ä½“ç°äº†æºç çš„å†…å®¹å’Œè¯­æ³•ç‰¹æ€§ï¼Œå› æ­¤ASTä¸æºç å¼ºç›¸å…³ï¼›ä¸‰åœ°å€ç å°±æ˜¯ä»ASTè¿›ä¸€æ­¥æŠ½è±¡çš„ä¸€ç§ä¸­é—´è¡¨ç¤ºï¼Œæ›´æ¥è¿‘æœºå™¨è¯­è¨€ï¼Œå¯ä»¥è®¤ä¸ºå’Œè¯­è¨€æ— å…³ï¼Œæ˜¯è¿æ¥å‰åç«¯çš„ä¸€ç§ä¸­é—´è¡¨ç¤º å˜åŒ–é¢‘ç¹ç¨‹åº¦ å› ä¸ºASTéœ€è¦å¿ å®åœ°ä½“ç°å‡ºæºä»£ç çš„è¯­æ³•å…ƒç´ ï¼Œå› æ­¤åœ¨å¯¹åº”çš„ç¼–ç¨‹è¯­è¨€å‡çº§æ—¶ï¼Œå¯¹åº”çš„ASTå¿…ç„¶ä¼šè·Ÿç€å‘ç”Ÿå˜åŒ–ï¼Œæ¯”å¦‚Javaï¼Œä»Java7å˜æˆJava8ï¼Œå¢åŠ äº†å¤§é‡çš„Lambdaè¡¨è¾¾å¼ã€å‡½æ•°å¼•ç”¨ç­‰ç‰¹æ€§ï¼Œæ‰€ä»¥ASTèŠ‚ç‚¹ä¹Ÿéœ€è¦å¢åŠ è¿™äº›è¯­æ³•èŠ‚ç‚¹ï¼Œæ‰€ä»¥ASTçš„ç‰ˆæœ¬éœ€è¦éšç€è¯­è¨€å‘å¸ƒè€Œä¸æ–­å˜åŒ–ã€‚ ä½†æ˜¯ä¸‰åœ°å€ç æ˜¯ä¸€ç§ç»è¿‡å¤„ç†çš„è¯­è¨€æ— å…³çš„ä¸­é—´è¡¨ç¤ºï¼Œå³ä½¿æºä»£ç ç»“æ„å˜åŒ–ï¼ŒASTç»“æ„å˜åŒ–ï¼Œä½†æ˜¯è½¬æ¢åçš„ä¸‰åœ°å€ç æ˜¯ç¨³å®šçš„ï¼Œä¸ä¼šç»å¸¸å‘ç”Ÿå˜åŒ–ï¼Œæ„é€ åœ¨ä¸‰åœ°å€ç ä¸Šé¢çš„åˆ†æç®—æ³•å°±ç›¸å¯¹æ¯”è¾ƒç¨³å®š ç»“æ„ ASTä½“ç°æºç çš„ç»“æ„ï¼Œéœ€è¦åŒ¹é…æºç çš„è¯­æ³•ï¼Œå› æ­¤ä¸€èˆ¬ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œè€Œä¸‰åœ°å€ç»è¿‡å¤„ç†ï¼Œä¸€èˆ¬æ¯”è¾ƒç´§å‡‘ï¼Œç®€å•ã€‚ä¾‹å¦‚ï¼ŒJavaä¸­ï¼Œå¯¹ forï¼Œwhileï¼Œdo while æœ‰å¤šç§ä¸åŒçš„å¾ªç¯æ–¹å¼ï¼Œä½†æ˜¯ï¼Œå…¶å®å†…å®¹å¤§åŒå°å¼‚ï¼Œä½†æ˜¯åœ¨ASTå±‚é¢ï¼Œå°±æ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯è½¬æ¢ä¸ºä¸‰åœ°å€ç åï¼Œæ‰€è¡¨è¾¾çš„æ§åˆ¶è¯­ä¹‰æ˜¯å®Œå…¨ä¸€æ ·çš„ è¡¨è¾¾ä¿¡æ¯ ASTè¡¨è¾¾äº†æºç çš„ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥åœ¨ASTä¸Šåšç¨‹åºç»“æ„çš„æ£€æŸ¥ï¼Œä½†æ˜¯ä¸‰åœ°å€ç ä¸­ï¼Œå¯ä»¥æ›´å¥½åœ°åŒ…å«äº†ç¨‹åºæ§åˆ¶æµå’Œæ•°æ®æµä¿¡æ¯ï¼Œèƒ½è¿›è¡Œæ›´æ·±å±‚æ¬¡çš„æµæ•æ„Ÿåˆ†æï¼Œè¿‡ç¨‹é—´åˆ†æï¼Œä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æå’Œå¯¹è±¡æ•æ„Ÿåˆ†æç­‰ç­‰ï¼Œä»è€Œå®ç°å„ç§æ›´é«˜éš¾åº¦çš„ç¨‹åºæ¼æ´æ£€æŸ¥ã€‚ åŒæ—¶ï¼Œä¸‰åœ°å€ç å› ä¸ºæ˜¯è¯­è¨€æ— å…³çš„ï¼Œ æ‰€ä»¥åœ¨éƒ¨åˆ†é™æ€ä»£ç åˆ†æå·¥å…·å®ç°æ—¶ï¼Œä¼šå¯¹ä¸åŒçš„ä¸‰åœ°å€ç ï¼Œå®ç°ä¸€ä¸ªåˆ†æå¼•æ“ï¼Œåªæ˜¯é€šè¿‡å¼€å‘ä¸åŒè¯­è¨€çš„è§„åˆ™ï¼Œå®ç°å¯¹ä¸åŒè¯­è¨€çš„èƒ½åŠ›çš„è¦†ç›–ï¼Œè€ŒASTæ˜¯æ— æ³•åšåˆ°è¿™ä¸€ç‚¹çš„ã€‚å› æ­¤ï¼Œä¸‰åœ°å€ç ä¹Ÿè¢«è®¤ä¸ºæ˜¯é™æ€ä»£ç åˆ†æçš„åŸºç¡€ **é™æ€å•èµ‹å€¼å½¢å¼**ï¼ˆStatic Single Assignment Formï¼ŒSSAï¼‰æ–‡ä»¶åœ°å€ SSAæ¦‚å¿µåŠåˆ†ç±» SSAæ¦‚å¿µ åœ¨ç¼–è¯‘å™¨çš„è®¾è®¡ä¸­ï¼Œé™æ€å•èµ‹å€¼å½¢å¼é€šå¸¸ç®€å†™ä¸ºSSA formæˆ–æ˜¯SSAï¼Œæ˜¯ä¸­ä»‹ç çš„ç‰¹æ€§ï¼Œæ¯ä¸ªå˜æ•°ä»…è¢«èµ‹å€¼ä¸€æ¬¡ã€‚åœ¨åŸå§‹çš„IRä¸­ï¼Œå·²å­˜åœ¨çš„å˜æ•°å¯è¢«åˆ†å‰²æˆè®¸å¤šä¸åŒçš„ç‰ˆæœ¬ï¼Œåœ¨è®¸å¤šæ•™ç§‘ä¹¦å½“ä¸­é€šå¸¸ä¼šå°†æ—§çš„å˜æ•°åç§°åŠ ä¸Šä¸€ä¸ªä¸‹æ ‡è€Œæˆä¸ºæ–°çš„å˜æ•°åç§°ï¼Œä»¥è‡³äºæ ‡æ˜æ¯ä¸ªå˜æ•°åŠå…¶ä¸åŒç‰ˆæœ¬ã€‚åœ¨SSAä¸­ï¼ŒUDé“¾ï¼ˆuse-define chainï¼Œèµ‹å€¼ä»£è¡¨defineï¼Œä½¿ç”¨å˜æ•°ä»£è¡¨useï¼‰æ˜¯éå¸¸æ˜ç¡®ï¼Œè€Œä¸”æ¯ä¸ªä»…åŒ…å«å•ä¸€å…ƒç´  ä»¥ä¸‹é¢çš„ä»£ç ä¸ºä¾‹ï¼š 12345678910public void test(int x) &#123; int y = 0; if (x &gt; 3) &#123; y = x + 4; &#125; else &#123; y = 10; &#125; int z = y + 3; System.out.println(z);&#125; ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼Œå·¦å›¾æ˜¯åŸå§‹ä»£ç ï¼Œé‡Œé¢æœ‰åˆ†æ”¯ï¼Œ y å˜é‡åœ¨ä¸åŒè·¯å¾„ä¸­æœ‰ä¸åŒèµ‹å€¼ï¼Œæœ€åæ‰“å° zçš„å€¼ã€‚å³å›¾æ˜¯ç­‰ä»·çš„ SSA å½¢å¼ï¼Œy å˜é‡åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¸­è¢«æ”¹å†™ä¸º y2, y3ï¼Œåœ¨æ§åˆ¶æµäº¤æ±‡å¤„æ’å…¥Ï†å‡½æ•°ï¼Œåˆå¹¶äº†æ¥è‡ªä¸åŒè¾¹çš„ y2, y3å€¼, èµ‹ç»™ y4 æœ€åzç”±y4ç”Ÿæˆ å…¶å®è¦è®²SSAå½¢å¼ï¼Œå°±ä¸èƒ½ç¦»å¼€å¯¹DU Chainï¼ˆDefine-Use Chainï¼‰å’ŒUD Chainï¼ˆUse-Define Chainï¼‰çš„ä»‹ç»ï¼Œå› ä¸ºå¾ˆå¤šåœ°æ–¹å¯¹SSAçš„æ¦‚å¿µçš„ä»‹ç»ï¼Œéƒ½æ˜¯ä»DU Chainå’ŒUD Chainå¼•èµ·çš„ã€‚Use-Define Chain æ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ŒåŒ…å«ä¸€ä¸ªDefineå˜é‡ï¼Œä»¥åŠå®ƒçš„å…¨éƒ¨Useçš„é›†åˆã€‚ç›¸å¯¹çš„ï¼ŒDefine-Use Chain åŒ…å«ä¸€ä¸ªUseå˜é‡ï¼Œä»¥åŠå®ƒçš„å…¨éƒ¨ Defineçš„é›†åˆã€‚ å¦å¤–ä¸€ç§SSAçš„æè¿°ï¼Œå°±æ˜¯åœ¨ Define-Use Chainä¸­ï¼Œæ¯ä¸€ä¸ªUseå˜é‡ï¼Œåªä¼šæœ‰ä¸€ä¸ªDefineï¼Œä¾‹å¦‚ï¼Œåœ¨å‰é¢ä¾‹å­ä¸­ï¼Œz = y + 3 ä¸­ï¼Œå› ä¸ºæ­¤æ—¶ yå¯èƒ½åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¸­èµ‹å€¼ï¼Œå› æ­¤ï¼Œå¯¹äºå˜é‡ z = y + 3 ä¸­ï¼Œy çš„Useæ¥è¯´ï¼Œæœ‰ä¸¤ä¸ª Defineï¼Œä½†æ˜¯ï¼Œé€šè¿‡æ›´æ”¹ä¸º SSAå½¢å¼ï¼Œz = y + 3 ä¸­ï¼Œyåªæœ‰ä¸€ä¸ª Defineï¼Œé‚£å°±æ˜¯ y4ã€‚å› æ­¤ï¼Œé€šè¿‡å°†ä¸‰åœ°å€ç è½¬ä¸ºSSAå½¢å¼ï¼Œå¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šï¼Œç®€åŒ–Use-Define Chainå’ŒDefine-Use Chainã€‚ SSAåˆ†ç±» SSA æœ‰å‡ ç§ä¸åŒåˆ†ç±»ï¼ˆä¸»è¦æ˜¯æœ€å°SSAã€å‰ªæSSAã€åŠå‰ªæSSAï¼Œå¦å¤–ä¸¤ç§ä¸¥æ ¼SSAå’Œæœ€å¤§SSAï¼Œå¤§éƒ¨åˆ†èµ„æ–™ä¸Šéƒ½æ²¡æœ‰çœ‹åˆ°ï¼Œåªæ˜¯åœ¨å°‘éƒ¨åˆ†èµ„æ–™ä¸­æœ‰è§åˆ°ï¼Œæ‰€ä»¥ç®€å•æä¸€ä¸‹ï¼‰ æœ€å°SSA æœ€å°SSAæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šåŒä¸€åŸå§‹åå­—çš„ä¸¤ä¸ªä¸åŒå®šä¹‰çš„è·¯å¾„æ±‡åˆå¤„éƒ½æ’å…¥ä¸€ä¸ªÏ†å‡½æ•°ã€‚è¿™æ ·å¾—åˆ°ç¬¦åˆä¸¤å¤§ç‰¹å¾çš„ä¸”æ‹¥æœ‰æœ€å°‘Ï†å‡½æ•°æ•°é‡çš„ SSA å½¢å¼ã€‚ä½†æ˜¯è¿™é‡Œçš„æœ€å°ä¸åŒ…å«ä¼˜åŒ–æ•ˆæœï¼Œæ¯”å¦‚æ­»ä»£ç æ¶ˆé™¤ã€‚å¦‚ä¸Šé¢å›¾2.1èŠ‚ï¼Œå°±æ˜¯ä¸€ä¸ªæœ€å°SSAå½¢å¼ å‰ªæSSA å¦‚æœå˜é‡åœ¨åŸºæœ¬å—çš„å…¥å£å¤„ä¸æ˜¯æ´»è·ƒ (live) çš„ï¼Œå°±ä¸å¿…æ’å…¥Ï†å‡½æ•°ã€‚ä¸€ç§æ–¹æ³•æ˜¯åœ¨æ’å…¥ Ï†å‡½æ•°çš„æ—¶å€™è®¡ç®—æ´»è·ƒå˜é‡åˆ†æã€‚å¦ä¸€ç§å‰ªææ–¹å¼æ˜¯åœ¨æœ€å°SSAä¸Šåšæ­»ä»£ç æ¶ˆé™¤ï¼Œåˆ æ‰å¤šä½™çš„Ï†å‡½æ•°ã€‚å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œyåœ¨åˆ†æ”¯æ‰§è¡Œå®Œåï¼Œåœ¨æœ€åçš„BBå—ä¸­ä¸å†ä½¿ç”¨ï¼Œyå·²ç»ä¸å†æ´»è·ƒï¼Œæ­¤æ—¶æ²¡å¿…è¦åœ¨è¿™ä¸ªèŠ‚ç‚¹æ·»åŠ Ï†å‡½æ•°ï¼Œå¦‚ä¸‹é¢å³å›¾çº¢è‰²æ ‡å‡ºæ¥çš„ä½ç½®ï¼ˆè¯´æ˜ï¼šè™½ç„¶ä¸æ˜¯å‰ªæSSAï¼Œä½†æ˜¯ä»ç„¶æ˜¯æœ€å°SSAï¼‰ åŠå‰ªæSSA é‰´äºå‰ªæ SSA çš„æˆæœ¬ï¼Œå¯ä»¥ç¨å¾®æŠ˜è¡·ä¸€ç‚¹ã€‚æ’å…¥Ï†å‡½æ•°å‰å…ˆå»æ‰éè·¨è¶ŠåŸºæœ¬å—çš„å˜é‡åã€‚è¿™æ ·æ—¢å‡å°‘äº†åå­—ç©ºé—´ä¹Ÿæ²¡æœ‰è®¡ç®—æ´»è·ƒå˜é‡é›†çš„å¼€é”€ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œyå˜é‡é™¤äº†Defineï¼Œå¹¶æ²¡æœ‰Useï¼Œæ‰€ä»¥ï¼Œå˜é‡yå…¶å®å¯ä»¥å»æ‰ï¼Œå¦‚ä¸‹å³å›¾ ä¸¥æ ¼SSA å¦‚æœä¸€ä¸ª SSAä¸­ï¼Œæ¯ä¸ªUseè¢«å…¶Defineæ”¯é…ï¼ˆå¦‚æœä»ç¨‹åºå…¥å£åˆ°ä¸€ä¸ªç»“ç‚¹ A çš„æ‰€æœ‰è·¯å¾„ï¼Œéƒ½å…ˆç»è¿‡ç»“ç‚¹Bï¼Œåˆ™ç§°Aè¢«Bæ”¯é…ï¼‰ï¼Œé‚£ä¹ˆç§°ä¸ºä¸¥æ ¼ SSAï¼ˆå®é™…ä¸Šï¼Œåœ¨å¼ºç±»å‹è¯­è¨€ä¸­ï¼Œè¿™ç§æƒ…å†µæ¯”è¾ƒå°‘ï¼Œå› ä¸ºæ²¡æœ‰å®šä¹‰ï¼Œå°±ä¸å…è®¸ä½¿ç”¨ï¼Œåœ¨å°‘æ•°åŠ¨æ€ç±»å‹è¯­è¨€ä¸­ï¼Œå…è®¸æ²¡æœ‰å®šä¹‰å°±å¯ä»¥ä½¿ç”¨çš„æ‰æœ‰è¿™ç±»é—®é¢˜ï¼‰ æœ€å¤§SSA æœ€å¤§SSAæ˜¯ç›¸å¯¹æœ€å°SSAè€Œè¨€çš„ï¼Œå°±æ˜¯åœ¨æ¯ä¸ªæ±‡åˆç‚¹å¤„ä¸ºæ¯ä¸ªå˜é‡æ”¾ç½®ä¸€ä¸ªÏ†å‡½æ•°ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´SSAçš„ä½¿ç”¨æ•ˆç‡æœ€å·®ï¼Œç”¨æˆ·ä½“éªŒä¹Ÿå¾ˆå·®ï¼Œæˆ‘ä¼°è®¡è°ç”Ÿæˆçš„SSAæ˜¯è¿™æ ·çš„å½¢å¼ï¼Œä¼šè¢«ä½¿ç”¨çš„äººæ‰“æ­»çš„ SSAå½¢å¼å’Œæ™®é€šä¸‰åœ°å€ç å¯¹æ¯”å…¶å®å¯¹æ¯”SSAå½¢å¼å’Œæ™®é€šçš„ä¸‰åœ°å€ç å½¢å¼ï¼Œåªæœ‰ä¸€ä¸ªåŒºåˆ«ï¼Œé‚£å°±æ˜¯ï¼ŒSSAå½¢å¼ï¼Œå¯¹äºæ¯ä¸ªUseï¼Œåªä¼šæœ‰ä¸€ä¸ªDefineã€‚ä¸¤è€…åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼Œè¿˜æ˜¯éå¸¸ç±»ä¼¼çš„ã€‚é‚£ä¹ˆä¸»è¦å¯¹æ¯”åœ¨äºä¸¤ç§å½¢å¼çš„å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š SSAå½¢å¼ç›¸å¯¹äºä¸‰åœ°å€ç ï¼Œä¼šå¼•å…¥å¤§é‡çš„é¢å¤–çš„ä¸´æ—¶å˜é‡ï¼ŒåŒæ—¶éœ€è¦æ’å…¥Ï†å‡½æ•°ï¼Œè¿˜éœ€è¦ç»´æŠ¤è¿™äº›ä¸´æ—¶å˜é‡åˆ°åŸå§‹å˜é‡çš„æ˜ å°„å…³ç³»ï¼ˆå½“ç„¶ï¼Œä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºï¼Œä¹Ÿæœ‰èµ„æ–™è§‰å¾—è¿™äº›é¢å¤–çš„ä¸´æ—¶å˜é‡å¯ä»¥å¿½ç•¥ï¼Œé©³æ–¥è¿™ä¸ªè§‚ç‚¹ä¸ºè°¬è®ºï¼Œä¸è¿‡çš„ç¡®è¿˜æ˜¯æœ‰å…¶ä¸èˆ’æœçš„åœ°æ–¹çš„ï¼‰ SSAå½¢å¼çš„ä¼˜åŠ¿åœ¨äºï¼ŒSSAå½¢å¼ç®€åŒ–äº†DU Chainå’ŒUD chainï¼Œæ„å»ºäº†ä¸€ç§ç¨€ç–ç»“æ„ï¼Œå¯ä»¥ç®€åŒ–æ•°æ®æµåˆ†æï¼ˆä¸€èˆ¬åŸºäºä¸‰åœ°å€ç ï¼Œéœ€è¦åŸºäºä¼ ç»Ÿçš„æ•°æ®æµåˆ†ææ¥è¿›è¡Œåˆ†æï¼Œç§°ä¸ºdenseåˆ†æï¼ŒåŸºäºSSAå½¢å¼ï¼Œå¯ä»¥æ„é€ å€¼ä¾èµ–å…³ç³»ï¼ŒåŸºäºå€¼æµåˆ†æï¼Œä¹Ÿç§°ä¸ºsparseåˆ†æï¼ŒåŒæ—¶ï¼ŒSSAå½¢å¼ä¹Ÿéšå«äº†ä¸€å®šçš„ç¨‹åºæµä¿¡æ¯ï¼‰ SSAå½¢å¼ç›¸æ¯”äºæ™®é€šä¸‰åœ°å€ç ï¼Œå¯ä»¥ä¼˜åŒ–å¸¸é‡ä¼ æ’­ã€å€¼ä¾èµ–åˆ†æã€æ­»ä»£ç ã€é‡å¤ä»£ç åˆ é™¤ç­‰ æ§åˆ¶æµå›¾ï¼ˆControl Flow Graphï¼ŒCFGï¼‰ ä¹Ÿå«æ§åˆ¶æµç¨‹å›¾ï¼Œæ˜¯ä¸€ä¸ªè¿‡ç¨‹æˆ–ç¨‹åºçš„æŠ½è±¡è¡¨ç°ï¼Œæ˜¯ç”¨åœ¨ç¼–è¯‘å™¨ä¸­çš„ä¸€ä¸ªæŠ½è±¡æ•°æ®ç»“æ„ï¼Œç”±ç¼–è¯‘å™¨åœ¨å†…éƒ¨ç»´æŠ¤ï¼Œä»£è¡¨äº†ä¸€ä¸ªç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šéå†åˆ°çš„æ‰€æœ‰è·¯å¾„ã€‚å®ƒç”¨å›¾çš„å½¢å¼è¡¨ç¤ºä¸€ä¸ªè¿‡ç¨‹å†…æ‰€æœ‰åŸºæœ¬å—æ‰§è¡Œçš„å¯èƒ½æµå‘, ä¹Ÿèƒ½åæ˜ ä¸€ä¸ªè¿‡ç¨‹çš„å®æ—¶æ‰§è¡Œè¿‡ç¨‹ åŸºæœ¬å—ï¼ˆBasic Blockï¼‰ ç‰¹ç‚¹ï¼š å•å…¥å£ã€å•å‡ºå£ã€æ¯ä¸ªå—å†…çš„è¯­å¥éƒ½æ˜¯æŒ‰é¡ºåºæ‰§è¡Œçš„ï¼Œä¸èƒ½æœ‰åˆ†æ”¯å’Œè·³è½¬ åªèƒ½ä»ç¬¬ä¸€æ¡è¯­å¥è¿›å…¥è¯¥åŸºæœ¬å—ï¼Œä¸èƒ½å¤Ÿä»¥æŸç§æ–¹å¼è·³å…¥è¯¥åŸºæœ¬å—çš„ä¸­é—´ åŸºæœ¬å—å†…çš„è¯­å¥åœ¨æ‰§è¡Œæ—¶å¿…é¡»ä»æœ€åä¸€æ¡è¯­å¥ç¦»å¼€ï¼Œä¸èƒ½å¤Ÿæ‰§è¡Œåˆ°ä¸€åŠè·³è½¬åˆ°å…¶å®ƒçš„åŸºæœ¬å— CFG CFGæ˜¯ä¸€ä¸ªç”±åŸºæœ¬å—ç»„æˆçš„æœ‰å‘å›¾ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªåŸºæœ¬å—ã€‚å¦‚æœç¨‹åºçš„æ‰§è¡Œè·¯å¾„å¯èƒ½ä»ä¸€ä¸ªåŸºæœ¬å—$B_1$è¿›å…¥å¦ä¸€ä¸ªåŸºæœ¬å—**$B_2$ï¼Œ$B_1$æœ‰ä¸€æ¡æŒ‡å‘$ B_2 $**çš„è¾¹ å…¶ä¸­ï¼š $N:$è¡¨ç¤ºæ‰€æœ‰åŸºæœ¬å—èŠ‚ç‚¹çš„é›†åˆ $E:$è¡¨ç¤ºæ‰€æœ‰è¾¹çš„é›†åˆ $n_0:$è¡¨ç¤ºé¦–èŠ‚ç‚¹ CFGå…·æœ‰å¦‚ä¸‹çš„ä¸¤æ¡æ€§è´¨ï¼š CFG å¿…ç„¶æœ‰å”¯ä¸€çš„ä¸€ä¸ªå…¥å£ç‚¹ é¦–èŠ‚ç‚¹å¿…ç„¶æ”¯é…CFGä¸­å…¶ä»–çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå³ä»é¦–èŠ‚ç‚¹åˆ°CFGä¸Šå…¶ä»–ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€æ¡è·¯å¯ä»¥è¿é€šï¼‰ å¯„å­˜å™¨ä¼ è¾“è¯­è¨€ï¼ˆRegister Transfer Languageï¼ŒRFLï¼‰ åˆè¯‘ä¸ºæš‚å­˜å™¨è½¬æ¢è¯­è¨€ã€å¯„å­˜å™¨è½¬æ¢è¯­è¨€ï¼Œä¸€ç§ä¸­é—´è¯­è¨€ï¼Œä½¿ç”¨äºç¼–è¯‘å™¨ä¸­ã€‚ä¸æ±‡ç¼–è¯­è¨€å¾ˆæ¥è¿‘ã€‚å¯„å­˜å™¨ä¼ é€’è¯­è¨€è¢«ç”¨äºæè¿°ä¸€ä¸ªæ¶æ„ä¸­å¯„å­˜å™¨ä¼ è¾“çº§ä¸Šçš„æ•°æ®æµã€‚ åœ¨å­¦æœ¯è®ºæ–‡å’Œæ•™ç§‘ä¹¦ä¸­ï¼Œå¯„å­˜å™¨ä¼ é€’è¯­è¨€è¢«è®¤ä¸ºæ˜¯ä¸€ç§ä¸æ¶æ„æ— å…³çš„æ±‡ç¼–è¯­è¨€ã€‚GCCçš„ä¸­é—´è¯­è¨€ï¼Œä¹Ÿè¢«ç§°ä¸ºå¯„å­˜å™¨ä¼ é€’è¯­è¨€ï¼Œé£æ ¼ç±»ä¼¼äºLISPã€‚GCCçš„å‰ç«¯ï¼ˆfront-endï¼‰ä¼šå…ˆå°†ç¼–ç¨‹è¯­è¨€è½¬è¯‘æˆRTLï¼Œä¹‹åå†åˆ©ç”¨åç«¯ï¼ˆback-endï¼‰è½¬åŒ–æˆæœºå™¨ä»£ç  ä»¥ä¸‹ä¸€äº›æ–‡ç« ç”¨åˆ°ç›¸å…³æŠ€æœ¯ï¼š Vandal Securify2 MadMax Gigahorse Ethainter åŸæ–‡é“¾æ¥","categories":[{"name":"ç¨‹åºåˆ†æ","slug":"ç¨‹åºåˆ†æ","permalink":"https://lwy0518.github.io/categories/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/"}],"tags":[{"name":"ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰","slug":"ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰","permalink":"https://lwy0518.github.io/tags/%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BA%EF%BC%88IR%EF%BC%89/"},{"name":"CFG","slug":"CFG","permalink":"https://lwy0518.github.io/tags/CFG/"},{"name":"AST","slug":"AST","permalink":"https://lwy0518.github.io/tags/AST/"},{"name":"TAC","slug":"TAC","permalink":"https://lwy0518.github.io/tags/TAC/"},{"name":"SSA","slug":"SSA","permalink":"https://lwy0518.github.io/tags/SSA/"},{"name":"RTL","slug":"RTL","permalink":"https://lwy0518.github.io/tags/RTL/"}],"author":"lwy"},{"title":"hexoåšå®¢è¿ç§»åˆ°å¦å¤–ä¸€å°ç”µè„‘","slug":"hexoåšå®¢è¿ç§»åˆ°å¦å¤–ä¸€å°ç”µè„‘","date":"2021-12-10T07:10:46.000Z","updated":"2022-02-13T13:14:52.467Z","comments":true,"path":"2021/12/10/hexoåšå®¢è¿ç§»åˆ°å¦å¤–ä¸€å°ç”µè„‘/","link":"","permalink":"https://lwy0518.github.io/2021/12/10/hexo%E5%8D%9A%E5%AE%A2%E8%BF%81%E7%A7%BB%E5%88%B0%E5%8F%A6%E5%A4%96%E4%B8%80%E5%8F%B0%E7%94%B5%E8%84%91/","excerpt":"å¤åˆ¶åŸç”µè„‘ä¸Šçš„æ•°æ® æ³¨ï¼šä¸éœ€è¦å…¨éƒ¨å¤åˆ¶ _config.ymlï¼šç«™ç‚¹é…ç½®æ–‡ä»¶ package.jsonï¼šåº”ç”¨ç¨‹åºæ•°æ®ï¼ŒæŒ‡æ˜hexoçš„ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œç±»ä¼¼äºä¸€èˆ¬è½¯ä»¶ä¸­çš„å…³äºæŒ‰é’® scaffolds/ï¼šlayoutæ¨¡æ¿æ–‡ä»¶ç›®å½•ï¼Œå…¶ä¸­çš„mdæ–‡ä»¶å¯ä»¥æ·»åŠ ç¼–è¾‘ source/ï¼š æ–‡ç« æºç ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹çš„markdownå’Œhtmlæ–‡ä»¶å‡ä¼šè¢«hexoå¤„ç†ã€‚è¯¥é¡µé¢å¯¹åº”repoçš„æ ¹ç›®å½•ï¼Œ404æ–‡ä»¶ã€favicon.icoæ–‡ä»¶ï¼ŒCNAMEæ–‡ä»¶ç­‰éƒ½åº”è¯¥æ”¾è¿™é‡Œï¼Œè¯¥ç›®å½•ä¸‹å¯æ–°å»ºé¡µé¢ç›®å½•ã€‚ draftsï¼šè‰ç¨¿æ–‡ç«  postsï¼šå‘å¸ƒæ–‡ç«  themes/ï¼šä¸»é¢˜æ–‡ä»¶","text":"å¤åˆ¶åŸç”µè„‘ä¸Šçš„æ•°æ® æ³¨ï¼šä¸éœ€è¦å…¨éƒ¨å¤åˆ¶ _config.ymlï¼šç«™ç‚¹é…ç½®æ–‡ä»¶ package.jsonï¼šåº”ç”¨ç¨‹åºæ•°æ®ï¼ŒæŒ‡æ˜hexoçš„ç‰ˆæœ¬ç­‰ä¿¡æ¯ï¼Œç±»ä¼¼äºä¸€èˆ¬è½¯ä»¶ä¸­çš„å…³äºæŒ‰é’® scaffolds/ï¼šlayoutæ¨¡æ¿æ–‡ä»¶ç›®å½•ï¼Œå…¶ä¸­çš„mdæ–‡ä»¶å¯ä»¥æ·»åŠ ç¼–è¾‘ source/ï¼š æ–‡ç« æºç ç›®å½•ï¼Œè¯¥ç›®å½•ä¸‹çš„markdownå’Œhtmlæ–‡ä»¶å‡ä¼šè¢«hexoå¤„ç†ã€‚è¯¥é¡µé¢å¯¹åº”repoçš„æ ¹ç›®å½•ï¼Œ404æ–‡ä»¶ã€favicon.icoæ–‡ä»¶ï¼ŒCNAMEæ–‡ä»¶ç­‰éƒ½åº”è¯¥æ”¾è¿™é‡Œï¼Œè¯¥ç›®å½•ä¸‹å¯æ–°å»ºé¡µé¢ç›®å½•ã€‚ draftsï¼šè‰ç¨¿æ–‡ç«  postsï¼šå‘å¸ƒæ–‡ç«  themes/ï¼šä¸»é¢˜æ–‡ä»¶ å®‰è£…é…ç½®ç¯å¢ƒ å®‰è£…node å®‰è£…git å†å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç«  ä¸‹è½½ç›¸å…³æ’ä»¶123456# å°†æ–‡ç« éƒ¨ç½²åˆ°githubä¸Šçš„æ¨¡å—$ cnpm install hexo-deployer-git --save# å®‰è£…RSSæ’ä»¶$ cnpm install hexo-generator-feed --save# æ·»åŠ Sitemap,åŠ é€Ÿç½‘é¡µæ”¶å½•é€Ÿåº¦$ cnpm install hexo-generator-sitemap --save","categories":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://lwy0518.github.io/categories/%E5%8D%9A%E5%AE%A2/"}],"tags":[{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://lwy0518.github.io/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"hexo","slug":"hexo","permalink":"https://lwy0518.github.io/tags/hexo/"}],"author":"lwy"},{"title":"EOSIOç¯å¢ƒæ­å»ºåŠåˆ›å»ºè´¦æˆ·","slug":"EOSIOç¯å¢ƒæ­å»ºåŠåˆ›å»ºè´¦æˆ·","date":"2021-12-10T02:01:59.000Z","updated":"2021-12-22T02:58:52.714Z","comments":true,"path":"2021/12/10/EOSIOç¯å¢ƒæ­å»ºåŠåˆ›å»ºè´¦æˆ·/","link":"","permalink":"https://lwy0518.github.io/2021/12/10/EOSIO%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%8F%8A%E5%88%9B%E5%BB%BA%E8%B4%A6%E6%88%B7/","excerpt":"ç¯å¢ƒæ­å»ºå®˜æ–¹æ–‡æ¡£ é’±åŒ…å’Œè´¦æˆ·","text":"ç¯å¢ƒæ­å»ºå®˜æ–¹æ–‡æ¡£ é’±åŒ…å’Œè´¦æˆ· Nodeosï¼ˆnode + eos = nodeosï¼‰ï¼šè¿è¡ŒèŠ‚ç‚¹çš„æ ¸å¿ƒæœåŠ¡å®ˆæŠ¤è¿›ç¨‹ï¼Œç”¨äºåŒºå—ç”Ÿäº§ã€API ç«¯ç‚¹æˆ–æœ¬åœ°å¼€å‘ Cleos (cli + eos = cleos) ï¼š ä¸åŒºå—é“¾äº¤äº’çš„å‘½ä»¤è¡Œç•Œé¢ (via nodeos) å’Œç®¡ç†é’±åŒ… (via keosd) Keosd (key + eos = keosd) ï¼š ç®¡ç†é’±åŒ…ä¸­çš„ EOSIO å¯†é’¥å¹¶ä¸ºæ•°å­—ç­¾åæä¾›å®‰å…¨é£åœ°çš„ç»„ä»¶ å¯ä»¥å‚è€ƒä¸‹åˆ—è§£è¯»å›¾ï¼š åˆ›å»ºé’±åŒ…1$ cleos wallet create -n wallet_name --to-console å…¶ä¸­ï¼š**-næ˜¯æŒ‡å®šé’±åŒ…åç§°ï¼ˆå¦‚æœä¸æŒ‡å®šåˆ™ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªdefaulté’±åŒ…ï¼‰ï¼Œ wallet_nameæ˜¯ä½ éœ€è¦åˆ›å»ºçš„é’±åŒ…åï¼ˆä»¥ä¸‹ç”¨lwyä»£æ›¿ï¼‰ï¼Œâ€“to-console**æ˜¯å°†å¯†é’¥è¾“å‡ºåˆ°æ§åˆ¶å°ï¼ˆè®°å¾—ä¸€å®šè¦ä¿å­˜è¿™ä¸ªå¯†é’¥ï¼Œå› ä¸ºè¦ç”¨äºé’±åŒ…çš„è§£é”ï¼‰ æŸ¥çœ‹åˆ›å»ºçš„é’±åŒ…1$ cleos wallet list å…¶ä¸­å¸¦**â€*â€**å·æŒ‡å·²è§£é”çš„é’±åŒ… é’±åŒ…çš„è§£é”ä¸åŠ é” è§£é”ï¼ˆä¼šæç¤ºä½ è¾“å…¥é’±åŒ…å¯†é’¥ï¼‰ 1$ cleos wallet unlock -n lwy --password åŠ é”ï¼ˆä¸éœ€è¦è¾“å…¥å¯†é’¥ï¼‰ 1$ cleos wallet lock -n lwy ç”Ÿæˆå’Œå¯¼å…¥å…¬é’¥-ç§é’¥å¯¹ç”Ÿæˆå…¬é’¥-ç§é’¥å¯¹ ä¸ºäº†ç®€å•å¯ä»¥ç›´æ¥ç”¨ä¸€ä¸ªå…¬é’¥-ç§é’¥å¯¹ï¼ˆè®°å¾—ä¿å­˜ç§é’¥ï¼Œä¸€å®šï¼ä¸€å®š ï¼ï¼‰ 1$ cleos create key --to-console å¯¼å…¥å…¬é’¥-ç§é’¥å¯¹ å¦‚æœlwyé’±åŒ…è¿˜æ²¡è§£é”ï¼Œè®°å¾—å…ˆè§£é” å°†ç”Ÿæˆçš„å…¬é’¥-ç§é’¥å¯¹å¯¼å…¥lwyé’±åŒ…å†… 1$ cleos wallet import -n lwy --private-key 5J9rzfgPNLuCL9j4AEc4RYcchvJQPaPNUtWuToRSeFAEayitM8v åˆ›å»ºå’Œç®¡ç†è´¦æˆ·å‘½ä»¤è¡ŒåŠå‚æ•°è¯´æ˜1$ cleos create account authorizing_account NEW_ACCOUNT OWNER_KEY ACTIVE_KEY æ³¨ï¼šåœ¨è¿™OWNER_KEYä¸ACTIVE_KEYæ˜¯åŒä¸€ä¸ªï¼Œå› ä¸ºæˆ‘ä¸ºäº†ç®€å•åªç”Ÿæˆäº†ä¸€ä¸ªå…¬é’¥-ç§é’¥å¯¹ authorizing_account æ˜¯ä¸ºå¸æˆ·åˆ›å»ºæä¾›èµ„é‡‘çš„å¸æˆ·çš„åç§° new_account æ˜¯æ‚¨è¦åˆ›å»ºçš„å¸æˆ·çš„åç§° owner_keyæ˜¯åˆ†é…ç»™å¸æˆ·owneræƒé™çš„å…¬é’¥ active_keyæ˜¯åˆ†é…ç»™æ‚¨å¸æˆ·çš„activeæƒé™çš„å…¬é’¥ æ–°å¸æˆ·åç§°å¿…é¡»ç¬¦åˆä»¥ä¸‹å‡†åˆ™ï¼š å¿…é¡»åœ¨12ä¸ªå­—ç¬¦ä»¥å†…ï¼ŒåŒ…æ‹¬12å­—ç¬¦ã€‚ åªèƒ½åŒ…å«ä»¥ä¸‹ç¬¦å·ï¼š.12345abcdefghijklmnopqrstuvwxyz è¯·æ³¨æ„ï¼Œè´¦æˆ·åç§°ä¸å…è®¸ä½¿ç”¨6,7,8,9,0ã€‚ ä½¿ç”¨eosioåˆå§‹è´¦æˆ·åˆ›å»ºæ–°è´¦æˆ·eosioå¸æˆ·æ˜¯ç”¨äºå¼•å¯¼EOSIOèŠ‚ç‚¹çš„ç‰¹æ®Šå¸æˆ·ã€‚ç”±äºæˆ‘ä»¬æ²¡æœ‰å…¶ä»–è´¦æˆ·ï¼Œæ‰€ä»¥ç”¨åˆå§‹eosioè´¦æˆ·æ¥åˆ›å»ºæ–°å¸æˆ· eosioå¸æˆ·çš„å¯†é’¥å¯ä»¥åœ¨nodeosé…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°ï¼Œä½äº~/.local/share/eosio/nodeos/config/config.iniã€‚ åŒæ—¶ï¼Œè®°å¾—è§£é”lwyé’±åŒ… é¦–å…ˆï¼Œéœ€è¦å°†é»˜è®¤è´¦å·eosioçš„ç§é’¥å¯¼å…¥lwyé’±åŒ…å†…ï¼š 1$ cleos wallet import -n lwy --private-key 5J9rzfgPNLuCL9j4AEc4RYcchvJQPaPNUtWuToRSeFAEayitM8v ç„¶åï¼Œç”¨åˆå§‹eosioè´¦æˆ·æ¥åˆ›å»ºæ–°å¸æˆ·testaccountï¼š 1$ cleos create account eosio testaccount 5J9rzfgPNLuCL9j4AEc4RYcchvJQPaPNUtWuToRSeFAEayitM8v æŸ¥çœ‹è´¦æˆ·ä¿¡æ¯1$ cleos get account testaccount -j -j æŒ‡ä¿¡æ¯ä»¥jsonæ ¼å¼è¾“å‡º è‡³æ­¤ï¼ŒEOSIOç¯å¢ƒæ­å»ºä»¥åŠè´¦æˆ·åˆ›å»ºå·²å®Œæˆï¼ï¼","categories":[{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/categories/EOSIO/"}],"tags":[{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/tags/EOSIO/"},{"name":"æ™ºèƒ½åˆçº¦","slug":"æ™ºèƒ½åˆçº¦","permalink":"https://lwy0518.github.io/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"}],"author":"lwy"},{"title":"EOSIOéƒ¨ç½²å…¨è¿‡ç¨‹","slug":"EOSIOéƒ¨ç½²å…¨è¿‡ç¨‹","date":"2021-12-10T01:19:12.000Z","updated":"2021-12-22T02:58:49.459Z","comments":true,"path":"2021/12/10/EOSIOéƒ¨ç½²å…¨è¿‡ç¨‹/","link":"","permalink":"https://lwy0518.github.io/2021/12/10/EOSIO%E9%83%A8%E7%BD%B2%E5%85%A8%E8%BF%87%E7%A8%8B/","excerpt":"","text":"","categories":[{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/categories/EOSIO/"}],"tags":[{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/tags/EOSIO/"},{"name":"æ•°æ®æµ","slug":"æ•°æ®æµ","permalink":"https://lwy0518.github.io/tags/%E6%95%B0%E6%8D%AE%E6%B5%81/"},{"name":"ç¼–è¯‘å™¨","slug":"ç¼–è¯‘å™¨","permalink":"https://lwy0518.github.io/tags/%E7%BC%96%E8%AF%91%E5%99%A8/"},{"name":"æ¼æ´æ£€æµ‹","slug":"æ¼æ´æ£€æµ‹","permalink":"https://lwy0518.github.io/tags/%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B/"},{"name":"é™æ€åˆ†æ","slug":"é™æ€åˆ†æ","permalink":"https://lwy0518.github.io/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/"},{"name":"Datalog","slug":"Datalog","permalink":"https://lwy0518.github.io/tags/Datalog/"},{"name":"CFG","slug":"CFG","permalink":"https://lwy0518.github.io/tags/CFG/"},{"name":"IR","slug":"IR","permalink":"https://lwy0518.github.io/tags/IR/"}],"author":"lwy"},{"title":"æ•°æ®æµåˆ†æ","slug":"æ•°æ®æµåˆ†æ","date":"2021-12-07T07:31:36.000Z","updated":"2022-02-13T13:10:00.586Z","comments":true,"path":"2021/12/07/æ•°æ®æµåˆ†æ/","link":"","permalink":"https://lwy0518.github.io/2021/12/07/%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90/","excerpt":"åŸºæœ¬åŸç†æ•°æ®æµåˆ†ææ˜¯ä¸€ç§ç”¨æ¥è·å–ç›¸å…³æ•°æ®æ²¿ç€ç¨‹åºæ‰§è¡Œè·¯å¾„æµåŠ¨çš„ä¿¡æ¯åˆ†ææŠ€æœ¯ã€‚åˆ†æå¯¹è±¡æ˜¯ç¨‹åºæ‰§è¡Œè·¯å¾„ä¸Šçš„æ•°æ®æµåŠ¨æˆ–å¯èƒ½çš„å–å€¼ ä¼˜ç‚¹ï¼šå…·æœ‰æ›´å¼ºçš„åˆ†æèƒ½åŠ›ï¼Œé€‚åˆéœ€è¦è€ƒè™‘æ§åˆ¶æµä¿¡æ¯ä¸”å˜é‡å±æ€§ä¹‹æ“ä½œååˆ†ç®€å•çš„é™æ€åˆ†æé—®é¢˜ ç¼ºç‚¹ï¼šåˆ†ææ•ˆç‡ä½ï¼Œè¿‡ç¨‹é—´åˆ†æå’Œä¼˜åŒ–ç®—æ³•å¤æ‚ï¼Œç¼–ç¨‹å·¥ä½œé‡å¤§ï¼Œå®¹æ˜“å‡ºé”™ä¸”æ•ˆç‡ä½ ä¸€ä¸ªæ•°æ®æµåˆ†ææ¡†æ¶(D, L, F)åŒ…å«: Dï¼šæ•°æ®æµçš„æ–¹å‘ï¼Œå‰å‘æˆ–è€…åå‘ Lï¼šåŒ…å«æ•°å€¼ä½œç”¨åŸŸVå’Œæ“ä½œç¬¦meet âŠ“ æˆ– join âŠ” çš„lattice Fï¼šä¸€ç³»åˆ—V to Vçš„ä¼ é€’å‡½æ•° Tips: æ•°æ®æµåˆ†æå¯ä»¥çœ‹æˆåœ¨ä¸€ä¸ªlatticeçš„æ•°å€¼åŸŸä¸Šï¼Œè¿­ä»£åœ°ä½¿ç”¨ä¼ é€’å‡½æ•°å’Œæ“ä½œç¬¦","text":"åŸºæœ¬åŸç†æ•°æ®æµåˆ†ææ˜¯ä¸€ç§ç”¨æ¥è·å–ç›¸å…³æ•°æ®æ²¿ç€ç¨‹åºæ‰§è¡Œè·¯å¾„æµåŠ¨çš„ä¿¡æ¯åˆ†ææŠ€æœ¯ã€‚åˆ†æå¯¹è±¡æ˜¯ç¨‹åºæ‰§è¡Œè·¯å¾„ä¸Šçš„æ•°æ®æµåŠ¨æˆ–å¯èƒ½çš„å–å€¼ ä¼˜ç‚¹ï¼šå…·æœ‰æ›´å¼ºçš„åˆ†æèƒ½åŠ›ï¼Œé€‚åˆéœ€è¦è€ƒè™‘æ§åˆ¶æµä¿¡æ¯ä¸”å˜é‡å±æ€§ä¹‹æ“ä½œååˆ†ç®€å•çš„é™æ€åˆ†æé—®é¢˜ ç¼ºç‚¹ï¼šåˆ†ææ•ˆç‡ä½ï¼Œè¿‡ç¨‹é—´åˆ†æå’Œä¼˜åŒ–ç®—æ³•å¤æ‚ï¼Œç¼–ç¨‹å·¥ä½œé‡å¤§ï¼Œå®¹æ˜“å‡ºé”™ä¸”æ•ˆç‡ä½ ä¸€ä¸ªæ•°æ®æµåˆ†ææ¡†æ¶(D, L, F)åŒ…å«: Dï¼šæ•°æ®æµçš„æ–¹å‘ï¼Œå‰å‘æˆ–è€…åå‘ Lï¼šåŒ…å«æ•°å€¼ä½œç”¨åŸŸVå’Œæ“ä½œç¬¦meet âŠ“ æˆ– join âŠ” çš„lattice Fï¼šä¸€ç³»åˆ—V to Vçš„ä¼ é€’å‡½æ•° Tips: æ•°æ®æµåˆ†æå¯ä»¥çœ‹æˆåœ¨ä¸€ä¸ªlatticeçš„æ•°å€¼åŸŸä¸Šï¼Œè¿­ä»£åœ°ä½¿ç”¨ä¼ é€’å‡½æ•°å’Œæ“ä½œç¬¦ æ•°æ®æµåˆ†æçš„åˆ†ç±» å¯¹ç¨‹åºè·¯å¾„çš„åˆ†æç²¾åº¦åˆ†ç±» æµä¸æ•æ„Ÿåˆ†æï¼ˆflow insensitiveï¼‰ï¼šä¸è€ƒè™‘è¯­å¥çš„å…ˆåé¡ºåºï¼ŒæŒ‰ç…§ç¨‹åºè¯­å¥çš„ç‰©ç†ä½ç½®ä»ä¸Šå¾€ä¸‹é¡ºåºåˆ†ææ¯ä¸€è¯­å¥ï¼Œå¿½ç•¥ç¨‹åºä¸­å­˜åœ¨çš„åˆ†æ”¯ æµæ•æ„Ÿåˆ†æï¼ˆflow sensitiveï¼‰ï¼šè€ƒè™‘ç¨‹åºè¯­å¥å¯èƒ½çš„æ‰§è¡Œé¡ºåºï¼Œé€šå¸¸éœ€è¦åˆ©ç”¨ç¨‹åºçš„æ§åˆ¶æµå›¾ï¼ˆCFGï¼‰ è·¯å¾„æ•æ„Ÿåˆ†æï¼ˆpath sensitiveï¼‰ï¼šä¸ä»…è€ƒè™‘è¯­å¥çš„å…ˆåé¡ºåºï¼Œè¿˜å¯¹ç¨‹åºæ‰§è¡Œè·¯å¾„æ¡ä»¶åŠ ä»¥åˆ¤æ–­ï¼Œä»¥ç¡®å®šåˆ†æä½¿ç”¨çš„è¯­å¥åºåˆ—æ˜¯å¦å¯¹åº”ç€ä¸€æ¡å¯å®é™…è¿è¡Œçš„ç¨‹åºæ‰§è¡Œè·¯å¾„ åˆ†æç¨‹åºè·¯å¾„çš„æ·±åº¦åˆ†ç±» è¿‡ç¨‹å†…åˆ†æï¼ˆintra-procedure analysisï¼‰ï¼šåªé’ˆå¯¹ç¨‹åºä¸­å‡½æ•°å†…çš„ä»£ç  è¿‡ç¨‹é—´åˆ†æï¼ˆinter-procedure analysisï¼‰ï¼šè€ƒè™‘å‡½æ•°ä¹‹é—´çš„æ•°æ®æµï¼Œå³éœ€è¦è·Ÿè¸ªåˆ†æç›®æ ‡æ•°æ®åœ¨å‡½æ•°ä¹‹é—´çš„ä¼ é€’è¿‡ç¨‹ ä¸Šä¸‹æ–‡ä¸æ•æ„Ÿåˆ†æï¼ˆcontext-insensitiveï¼‰ï¼šå°†æ¯ä¸ªè°ƒç”¨æˆ–è¿”å›çœ‹åšä¸€ä¸ª â€œgotoâ€ æ“ä½œï¼Œå¿½ç•¥è°ƒç”¨ä½ç½®å’Œå‡½æ•°å‚æ•°å–å€¼ç­‰å‡½æ•°è°ƒç”¨çš„ç›¸å…³ä¿¡æ¯ ä¸Šä¸‹æ–‡æ•æ„Ÿåˆ†æï¼ˆcontext-sensitiveï¼‰ï¼šå¯¹ä¸åŒè°ƒç”¨ä½ç½®è°ƒç”¨çš„åŒä¸€å‡½æ•°åŠ ä»¥åŒºåˆ† æ£€æµ‹ç¨‹åºæ¼æ´åŸºäºæ•°æ®æµçš„æºä»£ç æ¼æ´åˆ†æçš„åŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»£ç å»ºæ¨¡ è¯¥è¿‡ç¨‹é€šè¿‡ä¸€ç³»åˆ—çš„ç¨‹åºåˆ†ææŠ€æœ¯è·å¾—ç¨‹åºä»£ç æ¨¡å‹ã€‚é¦–å…ˆé€šè¿‡è¯æ³•åˆ†æç”Ÿæˆè¯ç´ çš„åºåˆ—ï¼Œç„¶åé€šè¿‡è¯­æ³•åˆ†æå°†è¯ç´ ç»„åˆæˆæŠ½è±¡è¯­æ³•æ ‘ã€‚å¦‚æœéœ€è¦ä¸‰åœ°å€ç ï¼Œåˆ™åˆ©ç”¨ä¸­é—´ä»£ç ç”Ÿæˆè¿‡ç¨‹è§£ææŠ½è±¡è¯­æ³•æ ‘ç”Ÿæˆä¸‰åœ°å€ç ã€‚å¦‚æœé‡‡ç”¨æµæ•æ„Ÿæˆ–è·¯å¾„æ•æ„Ÿçš„æ–¹å¼ï¼Œåˆ™å¯ä»¥é€šè¿‡åˆ†ææŠ½è±¡è¯­æ³•æ ‘å¾—åˆ°ç¨‹åºçš„æ§åˆ¶æµå›¾ã€‚æ„é€ æ§åˆ¶æµå›¾çš„è¿‡ç¨‹æ˜¯è¿‡ç¨‹å†…çš„æ§åˆ¶æµåˆ†æè¿‡ç¨‹ã€‚æ§åˆ¶æµè¿˜åŒ…å«åˆ†æå„ä¸ªè¿‡ç¨‹ä¹‹é—´çš„è°ƒç”¨å…³ç³»çš„éƒ¨åˆ†ã€‚é€šè¿‡åˆ†æè¿‡ç¨‹ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œè¿˜å¯ä»¥æ„é€ ç¨‹åºçš„è°ƒç”¨å›¾ã€‚å¦å¤–ï¼Œè¯¥è¿‡ç¨‹è¿˜éœ€è¦ä¸€äº›è¾…åŠ©æ”¯æŒæŠ€æœ¯ï¼Œä¾‹å¦‚å˜é‡çš„åˆ«ååˆ†æï¼ŒJava åå°„æœºåˆ¶åˆ†æï¼ŒC/C++ çš„å‡½æ•°æŒ‡é’ˆæˆ–è™šå‡½æ•°è°ƒç”¨åˆ†æç­‰ ä»£ç è§£æï¼šæŒ‡è¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€ä¸­é—´ä»£ç ç”Ÿæˆä»¥åŠè¿‡ç¨‹å†…çš„æ§åˆ¶æµåˆ†æç­‰åŸºç¡€çš„åˆ†æè¿‡ç¨‹ è¾…åŠ©åˆ†æï¼šåŒ…æ‹¬æ§åˆ¶æµåˆ†æç­‰ä¸ºæ•°æ®æµåˆ†ææä¾›æ”¯æŒçš„åˆ†æè¿‡ç¨‹ ç¨‹åºä»£ç å»ºæ¨¡ æ¼æ´åˆ†æç³»ç»Ÿé€šå¸¸ä½¿ç”¨æ ‘å‹ç»“æ„çš„æŠ½è±¡è¯­æ³•æ ‘æˆ–è€…çº¿æ€§çš„ä¸‰åœ°å€ç æ¥æè¿°ç¨‹åºä»£ç çš„è¯­ä¹‰ã€‚æ§åˆ¶æµå›¾æè¿°äº†è¿‡ç¨‹å†…ç¨‹åºçš„æ§åˆ¶æµè·¯å¾„ï¼Œè¾ƒä¸ºç²¾ç¡®çš„æ•°æ®æµåˆ†æé€šå¸¸åˆ©ç”¨æ§åˆ¶æµå›¾åˆ†æç¨‹åºæ‰§è¡Œè·¯å¾„ä¸Šçš„æŸäº›è¡Œä¸ºã€‚è°ƒç”¨å›¾æè¿°äº†è¿‡ç¨‹ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œæ˜¯è¿‡ç¨‹é—´åˆ†æéœ€è¦ç”¨åˆ°çš„ç¨‹åºç»“æ„ æ¼æ´åˆ†æè§„åˆ™ æ¼æ´åˆ†æè§„åˆ™æ˜¯æ£€æµ‹ç¨‹åºæ¼æ´çš„ä¾æ®ã€‚å¯¹äºåˆ†æå˜é‡çŠ¶æ€çš„è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨çŠ¶æ€è‡ªåŠ¨æœºæ¥æè¿°ã€‚å¯¹äºéœ€è¦åˆ†æå˜é‡å–å€¼çš„æƒ…å†µï¼Œåˆ™éœ€è¦æŒ‡å‡ºåº”è¯¥æ€æ ·è®°å½•å˜é‡çš„å–å€¼ï¼Œä»¥åŠåœ¨æ€æ ·çš„æƒ…å†µä¸‹å¯¹å˜é‡çš„å–å€¼è¿›è¡Œä½•ç§çš„æ£€æµ‹ ç¨‹åºæ¼æ´é€šå¸¸å’Œç¨‹åºä¸­å˜é‡çš„çŠ¶æ€æˆ–è€…å˜é‡çš„å–å€¼ç›¸å…³ã€‚çŠ¶æ€è‡ªåŠ¨æœºå¯ä»¥æè¿°å’Œç¨‹åºå˜é‡çŠ¶æ€ç›¸å…³çš„æ¼æ´åˆ†æè§„åˆ™ï¼Œè‡ªåŠ¨æœºçš„çŠ¶æ€å’Œå˜é‡ç›¸åº”çš„çŠ¶æ€å¯¹åº” é™æ€æ¼æ´åˆ†æ æ•°æ®æµåˆ†æå¯ä»¥çœ‹åšä¸€ä¸ªæ ¹æ®æ£€æµ‹è§„åˆ™åœ¨ç¨‹åºçš„å¯æ‰§è¡Œè·¯å¾„ä¸Šè·Ÿè¸ªå˜é‡çš„çŠ¶æ€æˆ–è€…å˜é‡å–å€¼çš„è¿‡ç¨‹ã€‚åœ¨è¯¥è¿‡ç¨‹ä¸­ï¼Œå¦‚æœå¾…åˆ†æçš„ç¨‹åºè¯­å¥æ˜¯å‡½æ•°è°ƒç”¨è¯­å¥ï¼Œåˆ™éœ€è¦åˆ©ç”¨è°ƒç”¨å›¾è¿›è¡Œè¿‡ç¨‹é—´çš„åˆ†æï¼Œä»¥åˆ†æè¢«è°ƒç”¨å‡½æ•°çš„å†…éƒ¨ä»£ç ã€‚å¦å¤–ï¼Œæ•°æ®æµåˆ†æè¿˜å¯ä»¥ä½œä¸ºè¾…åŠ©æŠ€æœ¯ï¼Œç”¨äºå®Œå–„ç¨‹åºè°ƒç”¨å›¾å’Œåˆ†æå˜é‡åˆ«åç­‰ èµ‹å€¼è¯­å¥ã€æ§åˆ¶è½¬ç§»è¯­å¥å’Œè¿‡ç¨‹è°ƒç”¨è¯­å¥æ˜¯æ•°æ®æµåˆ†ææœ€å…³å¿ƒçš„ä¸‰ç±»è¯­å¥ è¿‡ç¨‹å†…åˆ†æ å¯¹äºæŠ½è±¡è¯­æ³•æ ‘çš„åˆ†æï¼Œå¯ä»¥æŒ‰ç…§ç¨‹åºæ‰§è¡Œè¯­å¥çš„è¿‡ç¨‹ä»å³å‘å·¦ã€è‡ªåº•å‘ä¸Šåœ°è¿›è¡Œåˆ†æ å¯¹äºä¸‰åœ°å€ç çš„åˆ†æï¼Œåˆ™å¯ä»¥ç›´æ¥è¯†åˆ«å…¶æ“ä½œä»¥åŠæ“ä½œç›¸å…³çš„å˜é‡ åœ¨æµä¸æ•æ„Ÿåˆ†æä¸­ï¼Œå¸¸å¸¸ä½¿ç”¨çº¿æ€§æ‰«æçš„æ–¹å¼ä¾æ¬¡åˆ†ææ¯ä¸€æ¡ä¸­é—´è¡¨ç¤ºå½¢å¼çš„è¯­å¥ æµæ•æ„Ÿçš„åˆ†ææˆ–è·¯å¾„æ•æ„Ÿçš„åˆ†æï¼Œåˆ™æ ¹æ®æ§åˆ¶æµå›¾è¿›è¡Œåˆ†æã€‚å¯¹æ§åˆ¶æµå›¾çš„éå†ä¸»è¦æ˜¯æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆä¸¤ç§æ–¹å¼ å¦‚æœåœ¨åˆ†ææŸæ®µç¨‹åºä¸­é‡åˆ°è¿‡ç¨‹è°ƒç”¨è¯­å¥ï¼Œå°±åˆ†æå…¶è°ƒç”¨è¿‡ç¨‹çš„å†…éƒ¨çš„ä»£ç ï¼Œå®Œæˆåˆ†æä¹‹åå†å›åˆ°åŸæ¥çš„ç¨‹åºæ®µç»§ç»­åˆ†æ å€Ÿé‰´åŸºæœ¬å—çš„åˆ†æï¼Œç»™è¿‡ç¨‹è®¾ç½®ä¸Šæ‘˜è¦ï¼Œä¹ŸåŒ…å«å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶ å‰ç½®æ¡ä»¶è®°å½•å¯¹åŸºæœ¬å—åˆ†æå‰å·²æœ‰çš„ç›¸å…³åˆ†æç»“æœ åç½®æ¡ä»¶æ˜¯åˆ†æåŸºæœ¬å—åå¾—åˆ°çš„ç»“æœ å¤„ç†åˆ†æç»“æœ å¯¹æ£€æµ‹å‡ºçš„æ¼æ´è¿›è¡Œå±å®³ç¨‹åº¦åˆ†ç±»ç­‰ æ–¹æ³•å®ç°æ•°æ®æµåˆ†æä½¿ç”¨çš„ç¨‹åºä»£ç æ¨¡å‹ä¸»è¦åŒ…æ‹¬ç¨‹åºä»£ç çš„ä¸­é—´è¡¨ç¤ºä»¥åŠä¸€äº›å…³é”®çš„æ•°æ®ç»“æ„ï¼Œåˆ©ç”¨ç¨‹åºä»£ç çš„ä¸­é—´è¡¨ç¤ºå¯ä»¥å¯¹ç¨‹åºè¯­å¥çš„æŒ‡ä»¤è¯­ä¹‰è¿›è¡Œåˆ†æ æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰æ˜¯ç¨‹åºæŠ½è±¡è¯­æ³•ç»“æ„çš„æ ‘çŠ¶è¡¨ç°å½¢å¼ï¼Œå…¶æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œè¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹ä»£è¡¨è¿™ä¸ªè¿ç®—ç¬¦çš„è¿ç®—åˆ†é‡ã€‚é€šè¿‡æè¿°æ§åˆ¶è½¬ç§»è¯­å¥çš„è¯­æ³•ç»“æ„ï¼ŒæŠ½è±¡è¯­æ³•æ ‘åœ¨ä¸€å®šç¨‹åº¦ä¸Šä¹Ÿæè¿°äº†ç¨‹åºçš„è¿‡ç¨‹å†…ä»£ç çš„æ§åˆ¶æµç»“æ„ ä¾‹å­ï¼š 123456while b â‰  0 if a &gt; b a := a âˆ’ b else b := b âˆ’ areturn a å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ä¸ºï¼š ç”±ä¸€ç»„ç±»ä¼¼äºæ±‡ç¼–è¯­è¨€çš„æŒ‡ä»¤ç»„æˆï¼Œæ¯ä¸ªæŒ‡ä»¤å…·æœ‰ä¸å¤šäºä¸‰ä¸ªçš„è¿ç®—åˆ†é‡ã€‚æ¯ä¸ªè¿ç®—åˆ†é‡éƒ½åƒæ˜¯ä¸€ä¸ªå¯„å­˜å™¨ é™æ€å•èµ‹å€¼å½¢å¼ï¼ˆSSAï¼‰æ˜¯ä¸€ç§ç¨‹åºè¯­å¥æˆ–è€…æŒ‡ä»¤çš„è¡¨ç¤ºå½¢å¼ï¼Œåœ¨è¿™ç§è¡¨ç¤ºå½¢å¼ä¸­ï¼Œæ‰€æœ‰çš„èµ‹å€¼éƒ½æ˜¯é’ˆå¯¹å…·æœ‰ä¸åŒåå­—çš„å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæŸä¸ªå˜é‡åœ¨ä¸åŒçš„ç¨‹åºç‚¹è¢«èµ‹å€¼ï¼Œé‚£ä¹ˆåœ¨è¿™äº›ç¨‹åºç‚¹ä¸Šï¼Œè¯¥å˜é‡åœ¨é™æ€å•èµ‹å€¼å½¢å¼çš„è¡¨ç¤ºä¸­åº”è¯¥ä½¿ç”¨ä¸åŒçš„åå­—ã€‚åœ¨ä½¿ç”¨ä¸‹æ ‡çš„èµ‹å€¼è¡¨ç¤ºä¸­ï¼Œå˜é‡çš„åå­—ç”¨äºåŒºåˆ†ç¨‹åºä¸­çš„ä¸åŒçš„å˜é‡ï¼Œä¸‹æ ‡ç”¨äºåŒºåˆ†ä¸åŒç¨‹åºç‚¹ä¸Šå˜é‡çš„èµ‹å€¼æƒ…å†µã€‚å¦å¤–ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç¨‹åºä¸­ï¼ŒåŒä¸€ä¸ªå˜é‡å¯èƒ½åœ¨ä¸¤ä¸ªä¸åŒçš„æ§åˆ¶æµè·¯å¾„ä¸­è¢«èµ‹å€¼ï¼Œå¹¶ä¸”åœ¨è·¯å¾„äº¤æ±‡åï¼Œè¯¥å˜é‡è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ç§è¢«ç§°ä¸º Î¦ å‡½æ•°çš„çš„è¡¨ç¤ºè§„åˆ™å°†å˜é‡çš„èµ‹å€¼åˆå¹¶èµ·æ¥ ä½œç”¨ï¼šé™æ€å•èµ‹å€¼å½¢å¼å¯¹äºæ•°æ®æµåˆ†æçš„æ„ä¹‰åœ¨äºï¼Œå¯ä»¥ç®€å•è€Œç›´æ¥åœ°å‘ç°å˜é‡çš„èµ‹å€¼å’Œä½¿ç”¨æƒ…å†µï¼Œä»¥æ­¤åˆ†ææ•°æ®çš„æµå‘å¹¶å‘ç°ç¨‹åºä¸å®‰å…¨çš„è¡Œä¸º æ§åˆ¶æµå›¾ï¼ˆCFGï¼‰æ˜¯æŒ‡ç”¨äºæè¿°ç¨‹åºè¿‡ç¨‹å†…çš„æ§åˆ¶æµçš„æœ‰å‘å›¾ã€‚æ§åˆ¶æµç”±èŠ‚ç‚¹å’Œæœ‰å‘è¾¹ç»„æˆã€‚å…¸å‹çš„èŠ‚ç‚¹æ˜¯åŸºæœ¬å—ï¼ˆBBï¼‰ï¼Œå³ç¨‹åºè¯­å¥çš„çº¿æ€§åºåˆ—ã€‚æœ‰å‘è¾¹è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´å­˜åœ¨æ½œåœ¨çš„æ§åˆ¶æµè·¯å¾„ï¼Œé€šå¸¸éƒ½å¸¦æœ‰å±æ€§ï¼ˆå¦‚ifè¯­å¥çš„trueåˆ†æ”¯å’Œfalseåˆ†æ”¯ï¼‰ è°ƒç”¨å›¾ï¼ˆCGï¼‰æ˜¯æè¿°ç¨‹åºä¸­è¿‡ç¨‹ä¹‹é—´çš„è°ƒç”¨å’Œè¢«è°ƒç”¨å…³ç³»çš„æœ‰å‘å›¾ã€‚æ§åˆ¶å›¾æ˜¯ä¸€ä¸ªèŠ‚ç‚¹å’Œè¾¹çš„é›†åˆï¼Œå¹¶æ»¡è¶³å¦‚ä¸‹åŸåˆ™ å¯¹ç¨‹åºä¸­çš„æ¯ä¸ªè¿‡ç¨‹éƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ å¯¹æ¯ä¸ªè°ƒç”¨ç‚¹éƒ½æœ‰ä¸€ä¸ªèŠ‚ç‚¹ å¦‚æœè°ƒç”¨ç‚¹ c è°ƒç”¨äº†è¿‡ç¨‹ pï¼Œå°±å­˜åœ¨ä¸€æ¡ä» c çš„èŠ‚ç‚¹åˆ° p çš„èŠ‚ç‚¹çš„è¾¹ é™æ€æ¼æ´åˆ†ææ•°æ®æµåˆ†ææ£€æµ‹æ¼æ´æ˜¯åˆ©ç”¨åˆ†æè§„åˆ™æŒ‰ç…§ä¸€å®šçš„é¡ºåºåˆ†æä»£ç ä¸­é—´è¡¨ç¤ºçš„è¿‡ç¨‹ è¿‡ç¨‹å†…åˆ†æï¼šå¯¹äºæŠ½è±¡è¯­æ³•æ ‘çš„åˆ†æï¼Œå¯ä»¥æŒ‰ç…§ç¨‹åºæ‰§è¡Œè¯­å¥çš„è¿‡ç¨‹ä»å³å‘å·¦ã€è‡ªåº•å‘ä¸Šåœ°è¿›è¡Œåˆ†æã€‚å¯¹äºä¸‰åœ°å€ç çš„åˆ†æï¼Œåˆ™å¯ä»¥ç›´æ¥è¯†åˆ«å…¶æ“ä½œä»¥åŠæ“ä½œç›¸å…³çš„å˜é‡ è¿‡ç¨‹é—´åˆ†æï¼šå¦‚æœåœ¨åˆ†ææŸæ®µç¨‹åºä¸­é‡åˆ°è¿‡ç¨‹è°ƒç”¨è¯­å¥ï¼Œå°±åˆ†æå…¶è°ƒç”¨è¿‡ç¨‹çš„å†…éƒ¨çš„ä»£ç ï¼Œå®Œæˆåˆ†æä¹‹åå†å›åˆ°åŸæ¥çš„ç¨‹åºæ®µç»§ç»­åˆ†æã€‚å¦ä¸€ç§æ€è·¯æ˜¯å€Ÿé‰´åŸºæœ¬å—çš„åˆ†æï¼Œç»™è¿‡ç¨‹è®¾ç½®ä¸Šæ‘˜è¦ï¼Œä¹ŸåŒ…å«å‰ç½®æ¡ä»¶å’Œåç½®æ¡ä»¶ åŸæ–‡é“¾æ¥","categories":[{"name":"ç¨‹åºåˆ†æ","slug":"ç¨‹åºåˆ†æ","permalink":"https://lwy0518.github.io/categories/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/"}],"tags":[{"name":"ç¨‹åºåˆ†æ","slug":"ç¨‹åºåˆ†æ","permalink":"https://lwy0518.github.io/tags/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/"},{"name":"æ•°æ®æµ","slug":"æ•°æ®æµ","permalink":"https://lwy0518.github.io/tags/%E6%95%B0%E6%8D%AE%E6%B5%81/"},{"name":"Def-Use","slug":"Def-Use","permalink":"https://lwy0518.github.io/tags/Def-Use/"},{"name":"ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰","slug":"ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰","permalink":"https://lwy0518.github.io/tags/%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BA%EF%BC%88IR%EF%BC%89/"}],"author":"lwy"},{"title":"EOSIO-Vulneribilities","slug":"EOSIO-Vulneribilities","date":"2021-12-07T07:29:37.000Z","updated":"2022-02-13T13:08:46.693Z","comments":true,"path":"2021/12/07/EOSIO-Vulneribilities/","link":"","permalink":"https://lwy0518.github.io/2021/12/07/EOSIO-Vulneribilities/","excerpt":"EOSIOæ¼æ´å¤ç°å®éªŒç¯å¢ƒ nodeos ï¼š2.0.12 EOSIO.CDTï¼ˆç¼–è¯‘å™¨ï¼‰ï¼š1.2.1 å®éªŒæ•°æ®","text":"EOSIOæ¼æ´å¤ç°å®éªŒç¯å¢ƒ nodeos ï¼š2.0.12 EOSIO.CDTï¼ˆç¼–è¯‘å™¨ï¼‰ï¼š1.2.1 å®éªŒæ•°æ® å‡†å¤‡ï¼ˆå‰ä¸€ç¯‡æ–‡ç« å·²ç»ä»‹ç»å¦‚ä½•åˆ›å»ºè´¦æˆ·ç­‰ç­‰æ“ä½œï¼‰ è§£é”è´¦æˆ·ï¼ˆé»˜è®¤é”å®šæ—¶é—´è¾ƒçŸ­ï¼Œå¯ä»¥è‡ªå·±ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿å¾—æ—¶é—´æ›´é•¿ï¼‰ yourcountï¼šæŒ‡ä½ è‡ªå·±åˆ›å»ºçš„é’±åŒ…å 1$ cleos wallet unlock -n yourcount --password EOS Fake Transferå¤ç°è¿‡ç¨‹ å­˜åœ¨æ¼æ´çš„åˆçº¦ç¤ºä¾‹ï¼ˆtest.cppï¼‰ï¼š 1234567891011if( code == self || action == ::eosio::string_to_name(&quot;onerror&quot;) || code == N(eosio.token)) &#123; print(&quot;receiver:&quot;, name&#123;receiver&#125;, &quot;, code:&quot;, name&#123;code&#125;, &quot;, action:&quot;, name&#123;action&#125;, &quot;\\n&quot;); notified thiscontract( self ); switch( action ) &#123; case ::eosio::string_to_name( &quot;transfer&quot; ): eosio::execute_action( &amp;thiscontract, &amp;notified::transfer ); break; &#125; &#125; // doSomething()&#125; æ¼æ´äº§ç”Ÿçš„åŸå›  ç”±äºeosio.tokenæºä»£ç å®Œå…¨å…¬å¼€çš„ï¼Œæ‰€ä»¥ä»»ä½•äººéƒ½èƒ½å¤åˆ¶å…¶æºä»£ç ï¼Œå¹¶å‘å¸ƒä¸€ä¸ªtokenï¼ˆç›¸åŒçš„åå­—ã€ç¬¦å·å’Œä»£ç ï¼‰ï¼Œè™šå‡çš„EOSå’Œå®˜æ–¹çš„å”¯ä¸€ä¸åŒå°±æ˜¯å…·æœ‰ä¸åŒçš„å‘å¸ƒäººï¼ˆissuerï¼‰ã€‚æˆ–è€…ç›´æ¥è°ƒç”¨æ¼æ´åˆçº¦çš„transferå‡½æ•°è¿›è¡Œè½¬è´¦ è¿‡ç¨‹ åˆ›å»ºå—å®³è€…è´¦æˆ· your keyï¼šæ˜¯ä½ è‡ªå·±åˆ›å»ºçš„å…¬é’¥ï¼Œéœ€è¦æŠŠå…¬é’¥å¯¼å…¥åˆ°ä½ çš„é’±åŒ…ä»¥åŠå®˜æ–¹é’±åŒ…eosio 1$ cleos create account eosio victim4 &quot;your key&quot; éƒ¨ç½²æµ‹è¯•åˆçº¦test.cpp cleos set contract + è´¦æˆ·å + æµ‹è¯•åˆçº¦çš„wasmå­—èŠ‚ç æ‰€åœ¨ç›®å½• + -p + è´¦æˆ·@activeï¼ˆé»˜è®¤æƒé™ä¸ºactiveï¼Œæ•…å¯åŠ å¯ä¸åŠ ï¼‰ 1$ cleos set contract victim4 test/ -p victim4 å¼€å§‹æ¨¡æ‹Ÿæ”»å‡» ç›´æ¥è°ƒç”¨test.cppåˆçº¦çš„transferï¼ˆä¸»è¦ç›®çš„çœ‹æ˜¯å¦trasnferä¸­çš„printæ˜¯å¦æœ‰è¾“å‡ºï¼‰ cleos push action + è´¦æˆ·å + éœ€è¦è°ƒç”¨çš„action + â€˜è°ƒç”¨actionçš„å‚æ•°â€™ + -p + è½¬è´¦è´¦æˆ· ï¼ˆ+ -jï¼‰ 1$ cleos push action victim4 transfer &#x27;[&quot;eosio&quot;,&quot;victim4&quot;,&quot;10.0000 EOS&quot;,&quot;inlined call&quot;]&#x27; -p eosio -j è¯´æ˜ï¼šåŠ äº†ä¸€ä¸ª -j ï¼Œè¯´æ˜ç»“æœä»¥jsonçš„æ ¼å¼è¿›è¡Œè¾“å‡ºçš„ ç»“æœæ˜¾ç¤ºï¼šæµ‹è¯•åˆçº¦çš„transferå‡½æ•°è¢«è°ƒç”¨äº† æŸ¥è¯¢è´¦æˆ·ä½™é¢ cleos get currency balance eosio.token + æŸ¥è¯¢è´¦æˆ· + tokenåï¼ˆEOS) 1$ cleos get currency balance eosio.token victim4 EOS Forged Transfer Notificationå¤ç°è¿‡ç¨‹ å­˜åœ¨æ¼æ´çš„åˆçº¦ç¤ºä¾‹ï¼ˆtest.cppï¼‰ï¼š 123456789void transfer(account_name from, account_name to, asset quantity, string memo) &#123; print(&quot;\\n Receiving transfer message: from &quot;, name&#123;from&#125;, &quot; to &quot;, name&#123;to&#125;, &quot;,&quot;, quantity, &quot;,&quot;, memo); if (from == _self) &#123; print(&quot;have a vulnerability!&quot;); return; &#125; print(&quot;in eosbet transfer,&quot;, name&#123; from &#125;, &quot;,&quot;, name&#123; to &#125;); // doSomething()&#125; æ¼æ´äº§ç”Ÿçš„åŸå›  æ”»å‡»è€…åœ¨ EOS ç½‘ç»œä¸­æ§åˆ¶ä¸¤ä¸ªè´¦æˆ· Aï¼ˆå‘èµ·æ”»å‡»çš„è´¦æˆ·ï¼‰ å’Œ Bï¼ˆå°†æ”¶åˆ°çš„é€šçŸ¥ç«‹å³è½¬å‘ç»™è´¦æˆ·Cï¼‰ã€‚é€šè¿‡è´¦æˆ· A å‘è´¦æˆ· B å‘é€çœŸæ­£çš„ EOSï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œeosio.token åˆçº¦åœ¨è½¬è´¦æˆåŠŸåä¼šå‘ è´¦æˆ·Aã€B å‘é€ notificationã€‚å½“è´¦æˆ· B æ”¶åˆ° notificationåï¼Œé€šè¿‡è°ƒç”¨require_recipient(C)éšå³å°†æ”¶åˆ°çš„é€šçŸ¥è½¬å‘ç»™éƒ¨ç½²å—å®³è€…æ™ºèƒ½åˆçº¦çš„è´¦æˆ·Cã€‚ è¿‡ç¨‹ åˆ›å»ºæ”»å‡»è€…è´¦æˆ·senderï¼Œç”¨äºå‘å¦ä¸€ä¸ªç”±æ”»å‡»è€…æ§åˆ¶çš„è´¦æˆ·notifier your keyï¼šæ˜¯ä½ è‡ªå·±åˆ›å»ºçš„å…¬é’¥ï¼Œéœ€è¦æŠŠå…¬é’¥å¯¼å…¥åˆ°ä½ çš„é’±åŒ…ä»¥åŠå®˜æ–¹é’±åŒ…eosio 1$ cleos create account eosio sender &quot;your key&quot; åˆ›å»ºè´¦æˆ·notifierï¼Œç”¨äºå°†æ”¶åˆ°çš„è½¬è´¦é€šçŸ¥è½¬å‘ç»™å—å®³è€… 1$ cleos create account eosio notifier &quot;your key&quot; åˆ›å»ºå—å®³è€…è´¦æˆ· 1$ cleos create account eosio victim5 &quot;your key&quot; è´¦æˆ·notifieréƒ¨ç½²æ”»å‡»åˆçº¦eosbethack.cpp cleos set contract + è´¦æˆ·å + æµ‹è¯•åˆçº¦çš„wasmå­—èŠ‚ç æ‰€åœ¨ç›®å½• + -p + è´¦æˆ·@activeï¼ˆé»˜è®¤æƒé™ä¸ºactiveï¼Œæ•…å¯åŠ å¯ä¸åŠ ï¼‰ 1$ cleos set contract notifier eosbethack/ -p notifier è´¦æˆ·victim5éƒ¨ç½²æ”»å‡»åˆçº¦eosbet.cpp 1$ cleos set contract victim5 eosbet/ -p victim5 å¼€å§‹æ¨¡æ‹Ÿæ”»å‡» è´¦æˆ·senderï¼ˆæ”»å‡»è€…ï¼‰å‘è´¦æˆ·notifierï¼ˆæ”»å‡»è€…ï¼‰å‘é€EOSï¼ˆä¸»è¦ç›®çš„çœ‹æ˜¯å¦trasnferä¸­çš„printæ˜¯å¦æœ‰è¾“å‡ºï¼‰ cleos push action + è´¦æˆ·å + éœ€è¦è°ƒç”¨çš„action + â€˜è°ƒç”¨actionçš„å‚æ•°â€™ + -p + è½¬è´¦è´¦æˆ· ï¼ˆ+ -jï¼‰ 1$ cleos push action eosio.token transfer &#x27;[&quot;sender&quot;,&quot;notifier&quot;,&quot;10.0000 EOS&quot;,&quot;transfer himself&quot;]&#x27; -p sender -j è¯´æ˜ï¼šåŠ äº†ä¸€ä¸ª -j ï¼Œè¯´æ˜ç»“æœä»¥jsonçš„æ ¼å¼è¿›è¡Œè¾“å‡ºçš„ ç»“æœæ˜¾ç¤ºï¼šæµ‹è¯•åˆçº¦çš„transferå‡½æ•°è¢«è°ƒç”¨äº† ç»“æœæ˜¾ç¤ºï¼š","categories":[{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/categories/EOSIO/"}],"tags":[{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/tags/EOSIO/"},{"name":"æ¼æ´","slug":"æ¼æ´","permalink":"https://lwy0518.github.io/tags/%E6%BC%8F%E6%B4%9E/"},{"name":"æ™ºèƒ½åˆçº¦","slug":"æ™ºèƒ½åˆçº¦","permalink":"https://lwy0518.github.io/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"},{"name":"é˜²æŠ¤","slug":"é˜²æŠ¤","permalink":"https://lwy0518.github.io/tags/%E9%98%B2%E6%8A%A4/"}],"author":"lwy"},{"title":"æ„å»ºhexoåšå®¢è¿‡ç¨‹","slug":"æ„å»ºhexoåšå®¢è¿‡ç¨‹","date":"2021-12-07T07:23:17.000Z","updated":"2021-12-22T02:58:34.388Z","comments":true,"path":"2021/12/07/æ„å»ºhexoåšå®¢è¿‡ç¨‹/","link":"","permalink":"https://lwy0518.github.io/2021/12/07/%E6%9E%84%E5%BB%BAhexo%E5%8D%9A%E5%AE%A2%E8%BF%87%E7%A8%8B/","excerpt":"ç¯å¢ƒï¼ˆWindowsï¼‰ gitï¼ˆgit version 2.29.2.windows.3ï¼‰ nodeï¼ˆv14.17.0ï¼‰","text":"ç¯å¢ƒï¼ˆWindowsï¼‰ gitï¼ˆgit version 2.29.2.windows.3ï¼‰ nodeï¼ˆv14.17.0ï¼‰ æœ¬åœ°éƒ¨ç½² å®‰è£…cnpmï¼ˆå›½å†…é•œåƒæºå¾ˆæ…¢ï¼‰ 1$ npm install -g cnpm --registry=https://registry.npm.taobao.org â€œ-gâ€ï¼šè¡¨ç¤ºå…¨å±€å®‰è£… éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š 1$ cnpm -v è®¾ç½®æºï¼š 1$ npm config set registry https://registry.npm.taobao.org å®‰è£…hexo 1$ cnpm install -g hexo-cli éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š 1$ hexo -v åˆ›å»ºä¸€ä¸ªç›®å½•ï¼ˆå‡ºé”™ç›´æ¥åˆ æ‰ç›®å½•å³å¯ï¼‰ 12$ mkdir myBlog$ cd myBlog åˆå§‹åŒ– 1$ hexo init å¯åŠ¨hexo 1$ hexo s è®¿é—®åœ°å€:localhost:4000 GitHubéƒ¨ç½² åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œä»“åº“åå¿…é¡»ä¸ºï¼š 1yourname.github.io å®‰è£…æ’ä»¶ 1$ cnpm install --save hexo-deployer-git ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼ˆåœ¨æ–‡ä»¶æœ€ä¸‹é¢ä¿®æ”¹ï¼‰ Windows ä¸‹ç›´æ¥å¯ä»¥ç”¨æ–‡æœ¬æ‰“å¼€ å…¶ä»–ç³»ç»Ÿå¯ä»¥ç”¨vim 1$ vim _config.yml æ·»åŠ ä»¥ä¸‹å†…å®¹ 1234deploy: type: git repo: https://github.com:yourname/yourname.github.io.git branch: master éƒ¨ç½²åˆ°è¿œç«¯ï¼ˆå¯ä»¥æå‰é…ç½®å¥½gitè´¦å·å’Œå¯†ç ï¼‰ 1$ hexo d è®¿é—®è¿œç¨‹åšå®¢ 1https://yourname.github.io.git æ¢ä¸»é¢˜ ä¸‹è½½ä¸»é¢˜ï¼ˆä¸‹è½½åˆ°themesç›®å½•ä¸‹ï¼‰ 1$ git clone https://github.com/litten/hexo-theme-yilia.git themes.yilia ä¿®æ”¹ Windows ä¸‹ç›´æ¥å¯ä»¥ç”¨æ–‡æœ¬æ‰“å¼€ å…¶ä»–ç³»ç»Ÿå¯ä»¥ç”¨vim 1$ vim _config.yml ä¿®æ”¹ä»¥ä¸‹å†…å®¹ 1theme: yilia é‡æ–°ç”Ÿæˆ 1$ hexo clean &amp; hexo g &amp; hexo s è¿œç¨‹éƒ¨ç½²åˆ°github 1$ hexo d é‡åˆ°çš„é—®é¢˜ å¦‚é‡åˆ°è¿™ä¸ªé—®é¢˜ï¼Œå…ˆæ£€æŸ¥æ˜¯å¦æ˜¯ç½‘ç»œçš„åŸå›  ï¼Œå¤šéƒ¨ç½²å‡ æ¬¡ï¼Œå¦‚æœè¿˜æ˜¯ä¸è¡Œï¼Œåˆ™é‡‡ç”¨ä»¥ä¸‹æ–¹å¼ï¼š æ–¹æ³•ä¸€ï¼šåœ¨å½“å‰ç›®å½•ä¸‹æ“ä½œ 12345678## åˆ é™¤gitæäº¤å†…å®¹æ–‡ä»¶å¤¹$ rm -rf .deploy_git/##æ‰§è¡Œ$ git config --global core.autocrlf false##æœ€åhexo clean &amp;&amp; hexo g &amp;&amp; hexo d æ–¹æ³•äºŒï¼šæœ‰å¯èƒ½æ˜¯ä½ çš„git repoé…ç½®åœ°å€ä¸æ­£ç¡®,å¯ä»¥å°†httpæ–¹å¼å˜æ›´ä¸ºsshæ–¹å¼ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æ“ä½œ 123456789101112##åˆ é™¤gitæäº¤å†…å®¹æ–‡ä»¶å¤¹$ vim _config.yml##ä¿®æ”¹deploy: type: git repo:https://github.com/yourname/yourname.github.io.git -&gt; git@github.com:a956551943/weixiaohui.github.io.git branch: master##æœ€å$ hexo clean &amp;&amp; hexo g &amp;&amp; hexo d æ–¹æ³•ä¸‰ï¼šå¤‡é€‰ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æ“ä½œ 12345##è¿›å…¥depolyæ–‡ä»¶å¤¹$ cd .deploy_git/##å¼ºåˆ¶æ¨é€$ git push -f é‡åˆ°æ–°å»ºåšå®¢æ–‡ç« éƒ¨ç½²ä¹‹åå›¾ç‰‡ä¸æ˜¾ç¤ºçš„é—®é¢˜ åœ¨Typoraä¸­çš„å·¥å…·æ ä¸­çš„â€œæ ¼å¼â€ â€“&gt; â€œå›¾åƒâ€ â€“&gt; â€œå…¨å±€å›¾åƒè®¾ç½®â€ä¸­è®¾ç½®å¦‚ä¸‹ï¼Œæ­¤åä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”ŸæˆåŒ…å«å›¾ç‰‡åŒåçš„æ–‡ä»¶ å¦å¤–ï¼Œåœ¨æ–‡ç« å¼€å§‹éƒ¨åˆ†åŠ ä¸Šä»¥ä¸Šå‘½ä»¤å³å¯è§£å†³å›¾ç‰‡ä¸æ˜¾ç¤ºçš„é—®é¢˜ 1&lt;meta name=&quot;referrer&quot; content=&quot;no-referrer&quot;","categories":[{"name":"Blog","slug":"Blog","permalink":"https://lwy0518.github.io/categories/Blog/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"https://lwy0518.github.io/tags/hexo/"},{"name":"Blog","slug":"Blog","permalink":"https://lwy0518.github.io/tags/Blog/"}],"author":"lwy"}],"categories":[{"name":"Docker","slug":"Docker","permalink":"https://lwy0518.github.io/categories/Docker/"},{"name":"Redis","slug":"Redis","permalink":"https://lwy0518.github.io/categories/Redis/"},{"name":"ååº","slug":"ååº","permalink":"https://lwy0518.github.io/categories/%E5%81%8F%E5%BA%8F/"},{"name":"SSA","slug":"SSA","permalink":"https://lwy0518.github.io/categories/SSA/"},{"name":"hexo","slug":"hexo","permalink":"https://lwy0518.github.io/categories/hexo/"},{"name":"Markdown","slug":"Markdown","permalink":"https://lwy0518.github.io/categories/Markdown/"},{"name":"ç¨‹åºåˆ†æ","slug":"ç¨‹åºåˆ†æ","permalink":"https://lwy0518.github.io/categories/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://lwy0518.github.io/categories/%E5%8D%9A%E5%AE%A2/"},{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/categories/EOSIO/"},{"name":"Blog","slug":"Blog","permalink":"https://lwy0518.github.io/categories/Blog/"}],"tags":[{"name":"Docker","slug":"Docker","permalink":"https://lwy0518.github.io/tags/Docker/"},{"name":"Redis","slug":"Redis","permalink":"https://lwy0518.github.io/tags/Redis/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://lwy0518.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"åˆ†å¸ƒå¼","slug":"åˆ†å¸ƒå¼","permalink":"https://lwy0518.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"},{"name":"ååº","slug":"ååº","permalink":"https://lwy0518.github.io/tags/%E5%81%8F%E5%BA%8F/"},{"name":"Lattice","slug":"Lattice","permalink":"https://lwy0518.github.io/tags/Lattice/"},{"name":"SSA","slug":"SSA","permalink":"https://lwy0518.github.io/tags/SSA/"},{"name":"gcc","slug":"gcc","permalink":"https://lwy0518.github.io/tags/gcc/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://lwy0518.github.io/tags/%E7%AE%97%E6%B3%95/"},{"name":"ç¼–è¯‘åŸç†","slug":"ç¼–è¯‘åŸç†","permalink":"https://lwy0518.github.io/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"},{"name":"hexo","slug":"hexo","permalink":"https://lwy0518.github.io/tags/hexo/"},{"name":"Blog","slug":"Blog","permalink":"https://lwy0518.github.io/tags/Blog/"},{"name":"Typora","slug":"Typora","permalink":"https://lwy0518.github.io/tags/Typora/"},{"name":"Markdown","slug":"Markdown","permalink":"https://lwy0518.github.io/tags/Markdown/"},{"name":"æ•°æ®æµ","slug":"æ•°æ®æµ","permalink":"https://lwy0518.github.io/tags/%E6%95%B0%E6%8D%AE%E6%B5%81/"},{"name":"æ±¡ç‚¹åˆ†æ","slug":"æ±¡ç‚¹åˆ†æ","permalink":"https://lwy0518.github.io/tags/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/"},{"name":"ä¾èµ–å…³ç³»","slug":"ä¾èµ–å…³ç³»","permalink":"https://lwy0518.github.io/tags/%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB/"},{"name":"Source/Sink","slug":"Source-Sink","permalink":"https://lwy0518.github.io/tags/Source-Sink/"},{"name":"ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰","slug":"ä¸­é—´è¡¨ç¤ºï¼ˆIRï¼‰","permalink":"https://lwy0518.github.io/tags/%E4%B8%AD%E9%97%B4%E8%A1%A8%E7%A4%BA%EF%BC%88IR%EF%BC%89/"},{"name":"CFG","slug":"CFG","permalink":"https://lwy0518.github.io/tags/CFG/"},{"name":"AST","slug":"AST","permalink":"https://lwy0518.github.io/tags/AST/"},{"name":"TAC","slug":"TAC","permalink":"https://lwy0518.github.io/tags/TAC/"},{"name":"RTL","slug":"RTL","permalink":"https://lwy0518.github.io/tags/RTL/"},{"name":"åšå®¢","slug":"åšå®¢","permalink":"https://lwy0518.github.io/tags/%E5%8D%9A%E5%AE%A2/"},{"name":"EOSIO","slug":"EOSIO","permalink":"https://lwy0518.github.io/tags/EOSIO/"},{"name":"æ™ºèƒ½åˆçº¦","slug":"æ™ºèƒ½åˆçº¦","permalink":"https://lwy0518.github.io/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/"},{"name":"ç¼–è¯‘å™¨","slug":"ç¼–è¯‘å™¨","permalink":"https://lwy0518.github.io/tags/%E7%BC%96%E8%AF%91%E5%99%A8/"},{"name":"æ¼æ´æ£€æµ‹","slug":"æ¼æ´æ£€æµ‹","permalink":"https://lwy0518.github.io/tags/%E6%BC%8F%E6%B4%9E%E6%A3%80%E6%B5%8B/"},{"name":"é™æ€åˆ†æ","slug":"é™æ€åˆ†æ","permalink":"https://lwy0518.github.io/tags/%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90/"},{"name":"Datalog","slug":"Datalog","permalink":"https://lwy0518.github.io/tags/Datalog/"},{"name":"IR","slug":"IR","permalink":"https://lwy0518.github.io/tags/IR/"},{"name":"ç¨‹åºåˆ†æ","slug":"ç¨‹åºåˆ†æ","permalink":"https://lwy0518.github.io/tags/%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90/"},{"name":"Def-Use","slug":"Def-Use","permalink":"https://lwy0518.github.io/tags/Def-Use/"},{"name":"æ¼æ´","slug":"æ¼æ´","permalink":"https://lwy0518.github.io/tags/%E6%BC%8F%E6%B4%9E/"},{"name":"é˜²æŠ¤","slug":"é˜²æŠ¤","permalink":"https://lwy0518.github.io/tags/%E9%98%B2%E6%8A%A4/"}]}