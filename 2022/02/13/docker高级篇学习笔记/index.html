<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"lwy0518.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":300,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

<meta name="baidu-site-verification" content="code-tlV260igRr" />

<meta name="google-site-verification" content="3TzY94yf8m8aMSOKllM3oE4kDtCoMSJouSOn2A3knxk" />

  <meta name="description" content="目录">
<meta property="og:type" content="article">
<meta property="og:title" content="docker高级篇学习笔记">
<meta property="og:url" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="lwy的博客">
<meta property="og:description" content="目录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/1.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/2.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/3.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/4.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/5.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/6.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/7.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/8.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/9.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/10.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/11.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/12.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/13.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/14.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/15.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/16.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/17.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/18.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/20.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/19.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/21.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/22.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/23.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/24.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/25.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/26.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/27.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/28.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/29.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/30.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/31.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/32.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/33.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/34.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/35.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/36.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/37.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/38.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/39.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/40.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/41.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/42.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/43.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/44.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/45.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/46.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/47.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/48.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/49.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/50.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/51.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/52.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/53.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/54.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/71.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/72.png">
<meta property="og:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/73.png">
<meta property="article:published_time" content="2022-02-13T13:06:53.000Z">
<meta property="article:modified_time" content="2022-02-13T13:50:15.506Z">
<meta property="article:author" content="lwy">
<meta property="article:tag" content="Docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/images/1.png">

<link rel="canonical" href="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
<link rel="stylesheet" type="text/css" href="/css/injector/main.css" /><link rel="preload" as="style" href="/css/injector/light.css" /><link rel="preload" as="style" href="/css/injector/dark.css" />
  <title>

  docker高级篇学习笔记 | lwy的博客

</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="lwy的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">lwy的博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">欢迎大家与我交流</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-top">

    <a href="/top/" rel="section"><i class="fa fa-signal fa-fw"></i>热榜</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">35</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">10</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">18</span></a>

  </li>
        <li class="menu-item menu-item-tools">

    <a href="/tools/" rel="section"><i class="fa fa-toolbox fa-fw"></i>tools</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
        <li class="menu-item menu-item-guestbook">

    <a href="/guestbook" rel="section"><i class="fa fa-book fa-fw"></i>留言</a>

  </li>
        <li class="menu-item menu-item-navigate">

    <a href="/navigate" rel="section"><i class="fa fa-location-arrow fa-fw"></i>导航</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/lwy0518" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener external nofollow noreferrer" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="lwy">
      <meta itemprop="description" content="茫茫人海，总会与你相遇">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lwy的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          docker高级篇学习笔记
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-02-13 21:06:53 / 修改时间：21:50:15" itemprop="dateCreated datePublished" datetime="2022-02-13T21:06:53+08:00">2022-02-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Docker/" itemprop="url" rel="index"><span itemprop="name">Docker</span></a>
                </span>
            </span>

          
            <span id="/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-meta-item leancloud_visitors" data-flag-title="docker高级篇学习笔记" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="commentCount"></span>
    </a>
  </span>
  
  <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>50k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>45 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <meta name="referrer" content="no-referrer" />

<h3 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h3><hr>
<span id="more"></span>

<h3 id="Docker-高级篇"><a href="#Docker-高级篇" class="headerlink" title="Docker 高级篇"></a>Docker 高级篇</h3><h3 id="一、Docker复杂安装"><a href="#一、Docker复杂安装" class="headerlink" title="一、Docker复杂安装"></a>一、Docker复杂安装</h3><h4 id="1-1-安装mysql主从复制"><a href="#1-1-安装mysql主从复制" class="headerlink" title="1.1 安装mysql主从复制"></a>1.1 安装mysql主从复制</h4><h5 id="1-1-1-主从复制原理"><a href="#1-1-1-主从复制原理" class="headerlink" title="1.1.1 主从复制原理"></a>1.1.1 主从复制原理</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">默认你已经了解</span></span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-主从搭建步骤"><a href="#1-1-2-主从搭建步骤" class="headerlink" title="1.1.2 主从搭建步骤"></a>1.1.2 主从搭建步骤</h5><blockquote>
<p>1、新建主服务器容器实例3307</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -p 3307:3306 --name mysql-master \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-v /mydata/mysql-master/<span class="built_in">log</span>:/var/<span class="built_in">log</span>/mysql \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-v /mydata/mysql-master/data:/var/lib/mysql \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-v /mydata/mysql-master/conf:/etc/mysql \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-e MYSQL_ROOT_PASSWORD=root  \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-d mysql:5.7</span> </span><br></pre></td></tr></table></figure>

<p>2、进入/mydata/mysql-master/conf目录下新建my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">[mysqld]</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">server_id=101</span>  </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 指定不需要同步的数据库名称</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">binlog-ignore-db=mysql</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 开启二进制日志功能</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">log-bin=mall-mysql-bin</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">binlog_cache_size=1M</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">binlog_format=mixed</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">expire_logs_days=7</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">slave_skip_errors=1062</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置utf8</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">collation_server = utf8_general_ci</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置server字符集</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">character_set_server = utf8</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">[client]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">default_character_set=utf8</span> </span><br></pre></td></tr></table></figure>

<p>3、修改完配置后重启master实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker restart mysql-master</span></span><br></pre></td></tr></table></figure>

<p>4、进入mysql-master容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker <span class="built_in">exec</span> -it mysql-master /bin/bash</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">mysql -uroot -proot</span></span><br></pre></td></tr></table></figure>

<p>5、maser容器实例内创建数据同步用户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 创建同步用户</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">CREATE USER <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span> IDENTIFIED BY <span class="string">&#x27;123456&#x27;</span>;</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 同步用户授权</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">GRANT REPLICATION SLAVE, REPLICATION CLIENT ON *.* TO <span class="string">&#x27;slave&#x27;</span>@<span class="string">&#x27;%&#x27;</span>;</span></span><br></pre></td></tr></table></figure>

<p>6、新建从服务容器实例3308</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -p 3308:3306 --name mysql-slave \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-v /mydata/mysql-slave/<span class="built_in">log</span>:/var/<span class="built_in">log</span>/mysql \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-v /mydata/mysql-slave/data:/var/lib/mysql \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-v /mydata/mysql-slave/conf:/etc/mysql \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-e MYSQL_ROOT_PASSWORD=root  \ </span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-d mysql:5.7</span> </span><br></pre></td></tr></table></figure>

<p>7、进入/mydata/mysql-slave/conf目录下新建my.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 添加配置文件</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">[mysqld]</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置server_id，同一局域网中需要唯一</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">server_id=102</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 指定不需要同步的数据库名称</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">binlog-ignore-db=mysql</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 开启二进制日志功能，以备Slave作为其它数据库实例的Master时使用</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">log-bin=mall-mysql-slave1-bin</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置二进制日志使用内存大小（事务）</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">binlog_cache_size=1M</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置使用的二进制日志格式（mixed,statement,row）</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">binlog_format=mixed</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 二进制日志过期清理时间。默认值为0，表示不自动清理。</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">expire_logs_days=7</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">slave_skip_errors=1062</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## relay_log配置中继日志</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">relay_log=mall-mysql-relay-bin</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## log_slave_updates表示slave将复制事件写进自己的二进制日志</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">log_slave_updates=1</span>   </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## slave设置为只读（具有super权限的用户除外）</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">read_only=1</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置utf8</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">collation_server = utf8_general_ci</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment">## 设置server字符集</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">character_set_server = utf8</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">[client]</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">default_character_set=utf8</span> </span><br></pre></td></tr></table></figure>

<p>8、修改完配置后重启slave实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker restart mysql-slave</span></span><br></pre></td></tr></table></figure>

<p>9、在主数据库中查看主从同步状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">show master status;</span></span><br></pre></td></tr></table></figure>

<p>10、进入mysql-slave容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker <span class="built_in">exec</span> -it mysql-slave /bin/bash</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">mysql -uroot -proot</span></span><br></pre></td></tr></table></figure>

<p>11、在从数据库中配置主从复制</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">change master to master_host=<span class="string">&#x27;宿主机ip&#x27;</span>, master_user=<span class="string">&#x27;slave&#x27;</span>, master_password=<span class="string">&#x27;123456&#x27;</span>, master_port=3307, master_log_file=<span class="string">&#x27;mall-mysql-bin.000001&#x27;</span>, master_log_pos=617, master_connect_retry=30;</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/1.png" alt="1"></p>
<p>12、在从数据库中查看主从同步状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">show slave status\G;</span></span><br></pre></td></tr></table></figure>

<p>13、在从数据库中开启主从同步</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">start slave;</span></span><br></pre></td></tr></table></figure>

<p>14、查看从数据库状态发现已经同步</p>
<p><img src="images/2.png" alt="2"></p>
<p>15、主从复制测试</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;1.主机新建数据库</span> <span class="string">---&gt;  使用数据库 ---&gt; 新建表 ---&gt;插入数据 ， ok</span></span><br><span class="line"><span class="meta">&gt;2.从机使用库</span> <span class="string">---&gt; 查看记录 ok</span></span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="1-2-安装redis集群-大厂面试题第4季-分布式存储案例真题"><a href="#1-2-安装redis集群-大厂面试题第4季-分布式存储案例真题" class="headerlink" title="1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)"></a>1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)</h4><h5 id="1-2-1-cluster-集群-模式-docker版哈希槽分区进行亿级数据存储"><a href="#1-2-1-cluster-集群-模式-docker版哈希槽分区进行亿级数据存储" class="headerlink" title="1.2.1 cluster(集群)模式-docker版哈希槽分区进行亿级数据存储"></a>1.2.1 cluster(集群)模式-docker版哈希槽分区进行亿级数据存储</h5><blockquote>
<p>一、面试题</p>
<p>问题：1~2亿条数据需要缓存，请问如何设计这个存储案例</p>
<p>回答：单机单台100%不可能，肯定是分布式存储，用redis如何落地？</p>
<p>上述问题阿里P6~P7工程案例和场景设计类必考题目，<br>一般业界有3种解决方案</p>
<ol>
<li>哈希取余分区</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">2亿条记录就是2亿个k,v，我们单机不行必须要分布式多机，假设有3台机器构成一个集群，用户每次读写操作都是根据公式：</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="built_in">hash</span>(key) % N个机器台数，计算出哈希值，用来决定数据映射到哪一个节点上。</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">优点：</span></span><br><span class="line">简单粗暴，直接有效，只需要预估好数据规划好节点，例如3台、8台、10台，就能保证一段时间的数据支撑。使用Hash算法让固定的一部分请求落到同一台服务器上，这样每台服务器固定处理一部分请求（并维护这些请求的信息），起到负载均衡+分而治之的作用。 </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">缺点：</span></span><br><span class="line"> 原来规划好的节点，进行扩容或者缩容就比较麻烦了额，不管扩缩，每次数据变动导致节点有变动，映射关系需要重新进行计算，在服务器个数固定不变时没有问题，如果需要弹性扩容或故障停机的情况下，原来的取模公式就会发生变化：Hash(key)/3会变成Hash(key) /?。此时地址经过取余运算的结果将发生很大变化，根据公式获取的服务器也会变得不可控。 </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">某个redis机器宕机了，由于台数数量变化，会导致<span class="built_in">hash</span>取余全部数据重新洗牌。</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>一致性哈希算法分区</li>
</ol>
<p> 1、是什么<br> 一致性Hash算法背景<br> 　一致性哈希算法在1997年由麻省理工学院中提出的，设计目标是为了解决<br> 分布式缓存数据 变动和映射问题 ，某个机器宕机了，分母数量改变了，自然取余数不OK了。<br> 2、能干什么<br> 提出一致性Hash解决方案。目的是当服务器个数发生变动时，尽量减少影响客户端到服务器的映射关系。<br> 3、3大步骤<br> 【算法构建一致性哈希环】<br>     一致性哈希算法必然有个hash函数并按照算法产生hash值，这个算法的所有可能哈希值会构成一个全量集，这个集合可以成为一个hash空间[0,2^32-1]，这个是一个线性空间，但是在算法中，我们通过适当的逻辑控制将它首尾相连(0 = 2^32),这样让它逻辑上形成了一个环形空间。 </p>
<p> 它也是按照使用取模的方法，前面笔记介绍的节点取模法是对节点（服务器）的数量进行取模。而一致性Hash算法是对2^32取模，简单来说， 一致性Hash算法将整个哈希值空间组织成一个虚拟的圆环 ，如假设某哈希函数H的值空间为0-2^32-1（即哈希值是一个32位无符号整形），整个哈希环如下图：整个空间 按顺时针方向组织 ，圆环的正上方的点代表0，0点右侧的第一个点代表1，以此类推，2、3、4、……直到2^32-1，也就是说0点左侧的第一个点代表2^32-1， 0和2^32-1在零点中方向重合，我们把这个由2^32个点组成的圆环称为Hash环。</p>
<p><img src="images/3.png" alt="3"></p>
<p>【服务器IP节点映射】<br> 将集群中各个IP节点映射到环上的某一个位置。<br> 将各个服务器使用Hash进行一个哈希，具体可以选择服务器的IP或主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假如4个节点NodeA、B、C、D，经过IP地址的 哈希函数 计算(hash(ip))，使用IP地址哈希后在环空间的位置如下：</p>
<p><img src="images/4.png" alt="4"></p>
<p>【key落到服务器的落键规则】<br>   当我们需要存储一个kv键值对时，首先计算key的hash值，hash(key)，将这个key使用相同的函数Hash计算出哈希值并确定此数据在环上的位置， 从此位置沿环顺时针“行走” ，第一台遇到的服务器就是其应该定位到的服务器，并将该键值对存储在该节点上。<br>如我们有Object A、Object B、Object C、Object D四个数据对象，经过哈希计算后，在环空间上的位置如下：根据一致性Hash算法，数据A会被定为到Node A上，B被定为到Node B上，C被定为到Node C上，D被定为到Node D上。</p>
<p><img src="images/5.png" alt="5"></p>
<p>4、优点</p>
<p>一致性哈希算法的容错性</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;假设Node</span> <span class="string">C宕机，可以看到此时对象A、B、D不会受到影响，只有C对象被重定位到Node D。一般的，在一致性Hash算法中，如果一台服务器不可用，则 受影响的数据仅仅是此服务器到其环空间中前一台服务器（即沿着逆时针方向行走遇到的第一台服务器）之间数据 ，其它不会受到影响。简单说，就是C挂了，受到影响的只是B、C之间的数据，并且这些数据会转移到D进行存储。 </span></span><br></pre></td></tr></table></figure>

<p><img src="images/6.png" alt="6"></p>
<p>一致性哈希算法的扩展性</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;数据量增加了，需要增加一台节点NodeX，X的位置在A和B之间，那收到影响的也就是A到X之间的数据，重新把A到X的数据录入到X上即可，</span> <span class="string"></span></span><br><span class="line"><span class="meta">&gt;不会导致hash取余全部数据重新洗牌。</span> <span class="string"></span></span><br></pre></td></tr></table></figure>

<p><img src="images/7.png" alt="7"></p>
<p>5、缺点</p>
<p>一致性哈希算法的数据倾斜问题</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;一致性Hash算法在服务</span> <span class="string">节点太少时 ，容易因为节点分布不均匀而造成 数据倾斜 （被缓存的对象大部分集中缓存在某一台服务器上）问题， </span></span><br><span class="line"><span class="attr">&gt;例如系统中只有两台服务器：</span></span><br></pre></td></tr></table></figure>

<p><img src="images/8.png" alt="8"></p>
<p>6、小总结</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;为了在节点数目发生改变时尽可能少的迁移数据</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;将所有的存储节点排列在收尾相接的Hash环上，每个key在计算Hash后会</span> <span class="string">顺时针 找到临近的存储节点存放。 </span></span><br><span class="line"><span class="meta">&gt;而当有节点加入或退出时仅影响该节点在Hash环上</span> <span class="string">顺时针相邻的后续节点 。   </span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;优点</span> <span class="string"></span></span><br><span class="line"><span class="meta">&gt;加入和删除节点只影响哈希环中顺时针方向的相邻的节点，对其他节点无影响。</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;缺点</span>  <span class="string"></span></span><br><span class="line"><span class="meta">&gt;数据的分布和节点的位置有关，因为这些节点不是均匀的分布在哈希环上的，所以数据在进行存储时达不到均匀分布的效果。</span> <span class="string"></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<ol start="3">
<li>哈希槽分区</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1.</span> <span class="string">为什么出现</span></span><br><span class="line"><span class="attr">一致性哈希算法的数据倾斜问题</span></span><br><span class="line"><span class="meta">哈希槽是指就是一个数组，数组[0,2^14-1]形成的hash</span> <span class="string">slot空间。</span></span><br><span class="line"><span class="meta">2.</span> <span class="string">能干什么</span></span><br><span class="line"><span class="attr">解决均匀分配的问题，在数据和节点之间有加入了一层，把这层称为哈希槽(slot)，用于管理数据和节点之间的关系，现在就相当于节点上放的是槽，槽里放的是数据。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="images/9.png" alt="9"></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">槽解决的是粒度问题，相当于把粒度变大了，这样便于数据移动。</span> <span class="string"></span></span><br><span class="line"><span class="attr">哈希解决的是映射问题，使用key的哈希值来计算所在的槽，便于数据分配。</span></span><br><span class="line"><span class="meta">3.</span> <span class="string">多少个hash槽 </span></span><br><span class="line"><span class="meta">一个集群只能有16384个槽，编号0-16383（0-2^14-1）。这些槽会分配给集群中的所有主节点，分配策略没有要求。可以指定哪些编号的槽分配给哪个主节点。集群会记录节点和槽的对应关系。解决了节点和槽的关系后，接下来就需要对key求哈希值，然后对16384取余，余数是几key就落入对应的槽里。slot</span> = <span class="string">CRC16(key) % 16384。以槽为单位移动数据，因为槽的数目是固定的，处理起来比较容易，这样数据移动问题就解决了。 </span></span><br></pre></td></tr></table></figure>


</blockquote>
<h5 id="1-2-2-redis集群3主3从扩缩容配置案例"><a href="#1-2-2-redis集群3主3从扩缩容配置案例" class="headerlink" title="1.2.2 redis集群3主3从扩缩容配置案例"></a>1.2.2 redis集群3主3从扩缩容配置案例</h5><blockquote>
<p>一、关闭防火墙+启动docker后台服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">systemctl start docker</span></span><br></pre></td></tr></table></figure>

<p>二、新建6个docker容器redis实例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 创建并运行docker容器实例</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 容器名字</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">--name redis-node-6</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 使用宿主机的IP和端口，默认</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">--net host</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 获取宿主机root用户权限</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">--privileged=<span class="literal">true</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 容器卷，宿主机地址:docker内部地址</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">-v /data/redis/share/redis-node-6:/data</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># redis镜像和版本号</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis:6.0.8</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 开启redis集群</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">--cluster-enabled yes</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 开启持久化</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">--applendonly yes</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-1 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-1:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6381</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-2 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-2:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6382</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-3 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-3:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6383</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-4 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-4:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6384</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-5 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-5:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6385</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-6 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-6:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6386</span> </span><br></pre></td></tr></table></figure>

<p>三、进入容器redis-node-1并为6台机器构建集群关系</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 进入容器</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker <span class="built_in">exec</span> -it redis-node-1 /bin/bash</span></span><br></pre></td></tr></table></figure>

<p>//注意，进入docker容器后才能执行一下命令，且注意自己的真实IP地址 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster create 192.168.111.147:6381 192.168.111.147:6382 192.168.111.147:6383 192.168.111.147:6384 192.168.111.147:6385 192.168.111.147:6386 --cluster-replicas 1</span> </span><br></pre></td></tr></table></figure>

<p>–cluster-replicas 1 表示为每个master创建一个slave节点 </p>
<p><img src="images/10.png" alt="10"></p>
<p><img src="images/11.png" alt="11"></p>
<p>四、连接进入6318作为切入点，查看集群状态</p>
<p><img src="images/12.png" alt="12"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;cluster info</span><br><span class="line"></span><br><span class="line">&gt;cluster nodes</span><br></pre></td></tr></table></figure>


</blockquote>
<h5 id="1-2-3-主从容错切换迁移案例"><a href="#1-2-3-主从容错切换迁移案例" class="headerlink" title="1.2.3 主从容错切换迁移案例"></a>1.2.3 主从容错切换迁移案例</h5><blockquote>
<p>一、数据读写存储</p>
<p>启动6机构成的集群并通过exec进入</p>
<p>对6381新增两个key</p>
<p>防止路由时效加参数-c并新增连个key</p>
<p><img src="images/13.png" alt="13"></p>
<p>查看集群信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 192.168.111.147:6381</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/14.png" alt="14"></p>
<p>二、容错切换迁移</p>
<ol>
<li>主6381和从机切换，先停止主机6381</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&gt;6381主机停了，对应的真实从机上位</span></span><br><span class="line"><span class="attr">&gt;6381作为1号主机分配的从机以实际情况为准，具体是几号机器就是几号</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>再次查看集群信息</li>
</ol>
<p> <img src="images/15.png" alt="15"></p>
<p> 6381宕机了，6385上位成为了新的master。 </p>
<p> 备注：本次脑图笔记6381为主下面挂从6385 。 </p>
<p> 每次案例下面挂的从机以实际情况为准，具体是几号机器就是几号 </p>
<ol start="3">
<li>先还原之前的3主3从</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 先启6381</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker start redis-node-1</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 再停6385</span></span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker stop redis-node-5</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 再起6385</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker start redis-node-5</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">主从机器分配情况一实际情况为准</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>查看集群状态</li>
</ol>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli --cluster check 自己IP:6381</span><br></pre></td></tr></table></figure>

<p> <img src="images/16.png" alt="16"></p>
</blockquote>
<h5 id="1-2-4-主从扩容案例"><a href="#1-2-4-主从扩容案例" class="headerlink" title="1.2.4 主从扩容案例"></a>1.2.4 主从扩容案例</h5><blockquote>
<p>一、新建6387、6388两个节点+新建后启动+查看是否8节点</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-7 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-7:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6387</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d --name redis-node-8 --net host --privileged=<span class="literal">true</span> -v /data/redis/share/redis-node-8:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6388</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker ps</span> </span><br></pre></td></tr></table></figure>

<p>二、进入6387容器实例内部</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker <span class="built_in">exec</span> -it redis-node-7 /bin/bash</span></span><br></pre></td></tr></table></figure>

<p>三、将新增的6387节点(空槽号)作为master节点加入原集群</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">将新增的6387作为master节点加入集群</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster  add-node  自己实际IP地址: 6387  自己实际IP地址: 6381</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">6387 就是将要作为master新增节点</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">6381 就是原来集群节点里面的领路人，相当于6387拜拜6381的码头从而找到组织加入集群</span> </span><br></pre></td></tr></table></figure>

<p>四、检查集群情况第1次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 真实ip地址:6381</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 例如</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 192.168.111.147:6381</span> </span><br></pre></td></tr></table></figure>

<p>五、重新分派槽号</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">重新分派槽号</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">命令:redis-cli --cluster  reshard  IP地址:端口号</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster reshard 192.168.111.147:6381</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/17.png" alt="17"></p>
<p>六、检查集群情况第2次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 真实ip地址:6381</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">为什么6387是3个新的区间，以前的还是连续？</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">重新分配成本太高，所以前3家各自匀出来一部分，从6381/6382/6383三个旧节点分别匀出1364个坑位给新节点6387</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/18.png" alt="18"></p>
<p>七、为主节点6387分配从节点6388</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">命令：redis-cli  --cluster add-node  ip:新slave端口 ip:新master端口 --cluster-slave --cluster-master-id 新主机节点ID</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster add-node 192.168.111.147:6388 192.168.111.147:6387 --cluster-slave --cluster-master-id e4781f644d4a4e4d4b4d107157b9ba8144631451-------这个是6387的编号，按照自己实际情况</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/20.png" alt="20"></p>
<p>八、检查集群情况第3次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 192.168.111.147:6382</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/19.png" alt="19"></p>
</blockquote>
<h5 id="1-2-5-主从缩容案例"><a href="#1-2-5-主从缩容案例" class="headerlink" title="1.2.5 主从缩容案例"></a>1.2.5 主从缩容案例</h5><blockquote>
<p>一、目的：6387和6388下线</p>
<p>二、检查集群情况1获得6388的节点ID</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 192.168.111.147:6382</span> </span><br></pre></td></tr></table></figure>

<p>三、将6388删除  从集群中将4号从节点6388删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">命令：redis-cli --cluster  del-node  ip:从机端口 从机6388节点ID</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster  del-node  192.168.111.147:6388 5d149074b7e57b802287d1797a874ed7a1a284a8</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 192.168.111.147:6382</span> </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">检查一下发现，6388被删除了，只剩下7台机器了。</span></span><br></pre></td></tr></table></figure>

<p>四、将6387的槽号清空，重新分配，本例将清出来的槽号都给6381</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster reshard 192.168.111.147:6381</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/21.png" alt="21"></p>
<p>五、检查集群情况第二次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 192.168.111.147:6381</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">4096个槽位都指给6381，它变成了8192个槽位，相当于全部都给6381了，不然要输入3次，一锅端</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/22.png" alt="22"></p>
<p>六、将6387删除</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 命令：redis-cli --cluster del-node ip:端口 6387节点ID</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster del-node 192.168.111.147:6387 e4781f644d4a4e4d4b4d107157b9ba8144631451</span> </span><br></pre></td></tr></table></figure>

<p>七、检查集群情况第三次</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">redis-cli --cluster check 192.168.111.147:6381</span> </span><br></pre></td></tr></table></figure>

<p><img src="images/23.png" alt="23"></p>
</blockquote>
<h3 id="二、DockerFile解析"><a href="#二、DockerFile解析" class="headerlink" title="二、DockerFile解析"></a>二、DockerFile解析</h3><h4 id="2-1-DockerFile是什么"><a href="#2-1-DockerFile是什么" class="headerlink" title="2.1 DockerFile是什么"></a>2.1 DockerFile是什么</h4><p>DockerFile是用来构建Docker镜像的文本文件，是有一条条构建镜像所需的指令和参数构成的脚本。</p>
<p><img src="images/24.png" alt="24"></p>
<p>官网：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></p>
<p>构建三步骤</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1、编写DockerFile文件</span><br><span class="line">2、docker build命令构建镜像</span><br><span class="line">3、docker run 依镜像运行容器实例</span><br></pre></td></tr></table></figure>

<h4 id="2-2-DockerFile构建过程解析"><a href="#2-2-DockerFile构建过程解析" class="headerlink" title="2.2 DockerFile构建过程解析"></a>2.2 DockerFile构建过程解析</h4><p><strong>DockerFile内容基础知识</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 每条保留字指令都必须为大写字母且后面跟随至少一个参数</span><br><span class="line">2. 指令按照从上到下，顺序执行</span><br><span class="line">3. #表示注释</span><br><span class="line">4. 每条指令都会创建一个新的镜像层并对镜像进行提交。</span><br></pre></td></tr></table></figure>

<p><strong>Docker执行DockerFile的大致流程</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. docker从技术镜像运行一个容器</span><br><span class="line">2. 执行一条指令比鞥对容器做出修改</span><br><span class="line">3. 执行类似docker commit 的操作提交一个新的镜像层</span><br><span class="line">4. docker 在基于刚提交的镜像运行一个新容器</span><br><span class="line">5. 执行dockerfile中的下一条指令直到所有执行执行完成。</span><br></pre></td></tr></table></figure>

<h4 id="2-3-小总结"><a href="#2-3-小总结" class="headerlink" title="2.3 小总结"></a>2.3 小总结</h4><blockquote>
<p>从应用软件的角度来看，Dockerfile、Docker镜像与Docker容器分别代表软件的三个不同阶段， </p>
<p>Dockerfile是软件的原材料 </p>
<p>Docker镜像是软件的交付品 </p>
<p>Docker容器则可以认为是软件镜像的运行态，也即依照镜像运行的容器实例 </p>
<p>Dockerfile面向开发，Docker镜像成为交付标准，Docker容器则涉及部署与运维，三者缺一不可，合力充当Docker体系的基石。 </p>
<p><img src="images/25.png" alt="25"></p>
<ol>
<li><p>Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等; </p>
</li>
<li><p>Docker镜像，在用Dockerfile定义一个文件之后，docker build时会产生一个Docker镜像，当运行 Docker镜像时会真正开始提供服务; </p>
</li>
<li><p>Docker容器，容器是直接提供服务的。 </p>
</li>
</ol>
</blockquote>
<h4 id="2-4-DockerFile常用保留字指令"><a href="#2-4-DockerFile常用保留字指令" class="headerlink" title="2.4 DockerFile常用保留字指令"></a>2.4 DockerFile常用保留字指令</h4><blockquote>
<ol>
<li>参考tomcat8的dockerfile入门</li>
</ol>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/docker-library/tomcat">https://github.com/docker-library/tomcat</a></p>
<ol start="2">
<li>From</li>
</ol>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>MANINTAINER</li>
</ol>
<p> 镜像维护者的姓名和邮箱地址</p>
<ol start="4">
<li>Run</li>
</ol>
<p> 容器构建时需要运行的命令</p>
<p> 两种格式：</p>
<p> shell格式</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;命令行命令&gt;等同于，在终端操作的shell命令</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br></pre></td></tr></table></figure>

<p> exec格式</p>
<p> <img src="images/26.png" alt="26"></p>
<p> RUN是在docker build时运行</p>
<ol start="5">
<li>EXPOSE</li>
</ol>
<p> 当前容器对外暴露出的端口</p>
<ol start="6">
<li>WORKDIR</li>
</ol>
<p> 指定在创建容器后。终端默认登录的进来工作目录，一个落脚点。</p>
<ol start="7">
<li>USER</li>
</ol>
<p> 指定该镜像以什么样的用户去执行，如果都不指定，默认是root</p>
<ol start="8">
<li>ENV</li>
</ol>
<p> 用来在构建镜像过程中设置环境变量</p>
 <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">ENV</span> <span class="string">MY_PATH /usr/mytest </span></span><br><span class="line"><span class="meta">这个环境变量可以在后续的任何RUN指令中使用，这就如同在命令前面指定了环境变量前缀一样；</span> <span class="string"></span></span><br><span class="line"><span class="meta">也可以在其它指令中直接使用这些环境变量，</span> <span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="meta">比如：WORKDIR</span> <span class="string">$MY_PATH </span></span><br></pre></td></tr></table></figure>



<ol start="9">
<li>ADD</li>
</ol>
<p> 将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</p>
<ol start="10">
<li>COPY</li>
</ol>
<p>  类似ADD，拷贝文件和目录到镜像中。将从构建上下文目录中&lt;源路径&gt;的文件/目录复制到新的一层镜像内的&lt;目标路径&gt;位置</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">COPY src dest</span><br><span class="line"></span><br><span class="line">COPY[&quot;src&quot;,&quot;dest&quot;]</span><br><span class="line"></span><br><span class="line">&lt;src源路径&gt;：源文件或源目录</span><br><span class="line"></span><br><span class="line">&lt;dest目标路径&gt;: 容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</span><br></pre></td></tr></table></figure>



<ol start="11">
<li>VOLUME</li>
</ol>
<p>  容器数据卷，用于数据保存和持久化的工作</p>
<ol start="12">
<li>CMD</li>
</ol>
<p>  指定容器启动后的要干的事情。</p>
<p>  【注意】</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Dockerfile 中可以由多个CMD指令，但是只有最后一个生效，CMD会被docker run 之后的参数替换。</span><br></pre></td></tr></table></figure>

<p>  参考官网Tomcat的dockerfile演示讲解</p>
<p>  官网最后一行命令</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EXPOSE 8080</span><br><span class="line">CMD [&quot;catalina.sh&quot;,&quot;run&quot;]</span><br></pre></td></tr></table></figure>

<p>  我们演示自己的覆盖操作</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -p 8080:8080  容器ID /bin/bash</span><br></pre></td></tr></table></figure>

<p>  他和前面RUN命令的区别</p>
  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CMD 是在 docker run 时运行。</span><br><span class="line"></span><br><span class="line">RUN 是在docker build 时运行</span><br></pre></td></tr></table></figure>



<ol start="13">
<li><p>ENTRYPOINT </p>
</li>
<li><p>也是用来指定一个容器启动时要运行的命令</p>
</li>
<li><p>类似于CMD指令，但是ENTRYPOINT不会被docker run 后面的命令覆盖，而且这些命令行参数会被当作参数送给ENTRYPOINT指令指定的程序。</p>
</li>
<li><p>命令格式和案例说明</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">命令格式：ENTRYPOINT[&quot;&lt;executeable&gt;&quot;,&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...]</span><br><span class="line">                              </span><br><span class="line">ENTRYPOINT 可以和CMD一起用，一般是 变参 才会使用 CMD ，这里的CMD等于是在给 ENTRYPOINT 传参。当制定了 ENTRYPOINT 后，CMD的含义就发生了变化，不再是直接运行其命令而是将 CMD 的内容作为参数传递给 ENTRYPOINT 指定，他两个组合会变成&lt;ENTRYPOINT&gt; &quot;&lt;CMD&gt;&quot;</span><br><span class="line">案例如下：假设已通过 Dockerfile 构建了 nginx:test 镜像</span><br></pre></td></tr></table></figure>

<p> <img src="images/27.png" alt="27"></p>
<table>
<thead>
<tr>
<th>是否传参</th>
<th>按照dockerfile编写执行</th>
<th>传参运行</th>
</tr>
</thead>
<tbody><tr>
<td>Docker命令</td>
<td>docker run nginx:test</td>
<td>docker run nginx:test -c /etc/nginx/ new.conf</td>
</tr>
<tr>
<td>衍生出的实际命令</td>
<td>nginx -c /etc/nginx/nginx.conf</td>
<td>nginx -c /etc/nginx/ new.conf</td>
</tr>
</tbody></table>
</li>
</ol>
<p>  优点：在执行docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</p>
<p>  注意：如果Dockerfile 中如果存在多个 ENTRYPOINT 指令，进最后一个生效。</p>
<ol start="14">
<li><p>小总结</p>
<p><img src="images/28.png" alt="28"></p>
</li>
</ol>
</blockquote>
<h4 id="2-5-案例"><a href="#2-5-案例" class="headerlink" title="2.5 案例"></a>2.5 案例</h4><h5 id="2-5-1-自定义镜像mycentosjava8"><a href="#2-5-1-自定义镜像mycentosjava8" class="headerlink" title="2.5.1 自定义镜像mycentosjava8"></a>2.5.1 自定义镜像mycentosjava8</h5><p><strong>要求</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Centos7镜像具备 vim + ifconfig + jdk8</span><br><span class="line"></span><br><span class="line">JDK下载镜像地址</span><br><span class="line">官网：https://www.oracle.com/java/technologies/downloads/#java8 </span><br><span class="line">https://mirrors.yangxingzhen.com/jdk/</span><br></pre></td></tr></table></figure>

<p><strong>编写</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">准备编写Dockerfile文件 </span><br><span class="line">【注意】大写字母D</span><br><span class="line"> </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER zzyy&lt;zzyybs@126.com&gt; </span><br><span class="line">  </span><br><span class="line">ENV MYPATH /usr/local </span><br><span class="line">WORKDIR $MYPATH </span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash">安装vim编辑器</span> </span><br><span class="line">RUN yum -y install vim </span><br><span class="line"><span class="meta">#</span><span class="bash">安装ifconfig命令查看网络IP</span> </span><br><span class="line">RUN yum -y install net-tools </span><br><span class="line"><span class="meta">#</span><span class="bash">安装java8及lib库</span> </span><br><span class="line">RUN yum -y install glibc.i686 </span><br><span class="line">RUN mkdir /usr/local/java </span><br><span class="line"><span class="meta">#</span><span class="bash">ADD 是相对路径jar,把jdk-8u171-linux-x64.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置</span> </span><br><span class="line">ADD jdk-8u171-linux-x64.tar.gz /usr/local/java/ </span><br><span class="line"><span class="meta">#</span><span class="bash">配置java环境变量</span> </span><br><span class="line">ENV JAVA_HOME /usr/local/java/jdk1.8.0_171 </span><br><span class="line">ENV JRE_HOME $JAVA_HOME/jre </span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH </span><br><span class="line">ENV PATH $JAVA_HOME/bin:$PATH </span><br><span class="line">  </span><br><span class="line">EXPOSE 80 </span><br><span class="line"> </span><br><span class="line">CMD echo $MYPATH </span><br><span class="line">CMD echo &quot;success--------------ok&quot; </span><br><span class="line">CMD /bin/bash </span><br></pre></td></tr></table></figure>

<p><strong>构建</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker build -t 新镜像名字: TAG</span><br><span class="line"></span><br><span class="line">例如：docker build -t centosjava8:1.5 .</span><br><span class="line"></span><br><span class="line">【注意】</span><br><span class="line">上面TAG 后面有个空格，有个点</span><br></pre></td></tr></table></figure>

<p><strong>运行</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -it 新镜像名字:TAG</span><br><span class="line"></span><br><span class="line">docker run -it centosjava8:1.5 /bin/bash </span><br></pre></td></tr></table></figure>

<p><img src="images/29.png" alt="29"></p>
<p><strong>再体会下UnionFS（联合文件系统）</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">UnionFS（联合文件系统）：Union文件系统（UnionFS）是一种分层、轻量级并且高性能的文件系统，它支持</span> <span class="string">对文件系统的修改作为一次提交来一层层的叠加， 同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。 镜像可以通过分层来进行继承 ，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</span> <span class="string"></span></span><br></pre></td></tr></table></figure>

<h5 id="2-5-2-虚悬镜像"><a href="#2-5-2-虚悬镜像" class="headerlink" title="2.5.2 虚悬镜像"></a>2.5.2 虚悬镜像</h5><p><strong>是什么</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">仓库名，标签都是 &lt;none&gt; 的镜像，俗称dangling image</span><br><span class="line"></span><br><span class="line">Dockerfile 写一个</span><br></pre></td></tr></table></figure>

<p><img src="images/30.png" alt="30"></p>
<p><strong>查看</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker image ls -f dangling=true</span><br><span class="line">命令结果如下图：</span><br></pre></td></tr></table></figure>

<p><img src="images/31.png" alt="31"></p>
<p><strong>删除</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker image prune </span><br><span class="line"></span><br><span class="line">虚悬镜像已经市区存在价值，可以删除</span><br></pre></td></tr></table></figure>

<p><img src="images/32.png" alt="32"></p>
<h5 id="2-5-3-家庭作业自定义myubuntu"><a href="#2-5-3-家庭作业自定义myubuntu" class="headerlink" title="2.5.3 家庭作业自定义myubuntu"></a>2.5.3 家庭作业自定义myubuntu</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 编写</span></span><br><span class="line">准备编写DockerFile文件</span><br><span class="line">vim Dockerfile</span><br><span class="line">----------------------</span><br><span class="line">FROM ubuntu</span><br><span class="line">MAINTAINER zzyy&lt;zzyybs@126.com&gt; </span><br><span class="line">  </span><br><span class="line">ENV MYPATH /usr/local </span><br><span class="line">WORKDIR $MYPATH </span><br><span class="line">  </span><br><span class="line">RUN apt-get update </span><br><span class="line">RUN apt-get install net-tools </span><br><span class="line"><span class="meta">#</span><span class="bash">RUN apt-get install -y iproute2</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">RUN apt-get install -y inetutils-ping</span> </span><br><span class="line">  </span><br><span class="line">EXPOSE 80 </span><br><span class="line">  </span><br><span class="line">CMD echo $MYPATH </span><br><span class="line">CMD echo &quot;install inconfig cmd into ubuntu success--------------ok&quot; </span><br><span class="line">CMD /bin/bash </span><br><span class="line">------------------------</span><br><span class="line"><span class="meta">#</span><span class="bash"> 构建</span></span><br><span class="line">docker build -t 新镜像名字:TAG</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">运行</span></span><br><span class="line">docker run -it 新镜像名字:TAG</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="三、Docker微服务实战"><a href="#三、Docker微服务实战" class="headerlink" title="三、Docker微服务实战"></a>三、Docker微服务实战</h3><h4 id="3-1-通过IDEA新建一个普通微服务模块"><a href="#3-1-通过IDEA新建一个普通微服务模块" class="headerlink" title="3.1 通过IDEA新建一个普通微服务模块"></a>3.1 通过IDEA新建一个普通微服务模块</h4><p><strong>建Module</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker_boot</span><br></pre></td></tr></table></figure>

<p><strong>修改POM</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version =&quot;1.0&quot; encoding =&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span> =<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:</span> <span class="attr">xsi</span> =<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi</span> <span class="attr">:schemaLocation</span> =<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span> </span><br><span class="line">   <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span> 4.0.0 &lt;/ modelVersion&gt; </span><br><span class="line">   <span class="tag">&lt;<span class="name">parent</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.springframework.boot &lt;/ groupId&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> spring-boot-starter-parent &lt;/ artifactId&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span> 2.5.6 &lt;/ version&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">relativePath</span> /&gt;</span> </span><br><span class="line">   &lt;/ parent&gt; </span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> com.atguigu.docker &lt;/ groupId&gt; </span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> docker_boot &lt;/ artifactId&gt; </span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span> 0.0.1-SNAPSHOT &lt;/ version&gt; </span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">properties</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span> UTF-8 &lt;/ project.build.sourceEncoding&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span> 1.8 &lt;/ maven.compiler.source&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span> 1.8 &lt;/ maven.compiler.target&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">junit.version</span>&gt;</span> 4.12 &lt;/ junit.version&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">log4j.version</span>&gt;</span> 1.2.17 &lt;/ log4j.version&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">lombok.version</span>&gt;</span> 1.16.18 &lt;/ lombok.version&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span> 5.1.47 &lt;/ mysql.version&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">druid.version</span>&gt;</span> 1.1.16 &lt;/ druid.version&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">mapper.version</span>&gt;</span> 4.1.5 &lt;/ mapper.version&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">mybatis.spring.boot.version</span>&gt;</span> 1.3.0 &lt;/ mybatis.spring.boot.version&gt; </span><br><span class="line">   &lt;/ properties&gt; </span><br><span class="line"> </span><br><span class="line">   <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span> </span><br><span class="line">     <span class="comment">&lt;!--SpringBoot 通用依赖模块 --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.springframework.boot &lt;/ groupId&gt; </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> spring-boot-starter-web &lt;/ artifactId&gt; </span><br><span class="line">     &lt;/ dependency&gt; </span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.springframework.boot &lt;/ groupId&gt; </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> spring-boot-starter-actuator &lt;/ artifactId&gt; </span><br><span class="line">     &lt;/ dependency&gt; </span><br><span class="line">     <span class="comment">&lt;!--test--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.springframework.boot &lt;/ groupId&gt; </span><br><span class="line">       <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> spring-boot-starter-test &lt;/ artifactId&gt; </span><br><span class="line">       <span class="tag">&lt;<span class="name">scope</span>&gt;</span> test &lt;/ scope&gt; </span><br><span class="line">     &lt;/ dependency&gt; </span><br><span class="line">   &lt;/ dependencies&gt; </span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> </span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.springframework.boot &lt;/ groupId&gt; </span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> spring-boot-maven-plugin &lt;/ artifactId&gt; </span><br><span class="line">       &lt;/ plugin&gt; </span><br><span class="line">       <span class="tag">&lt;<span class="name">plugin</span>&gt;</span> </span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span> org.apache.maven.plugins &lt;/ groupId&gt; </span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> maven-resources-plugin &lt;/ artifactId&gt; </span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span> 3.1.0 &lt;/ version&gt; </span><br><span class="line">       &lt;/ plugin&gt; </span><br><span class="line">     &lt;/ plugins&gt; </span><br><span class="line">   &lt;/ build&gt; </span><br><span class="line"> &lt;/ project&gt; </span><br></pre></td></tr></table></figure>

<p><strong>写YML</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server.port=6001</span></span><br></pre></td></tr></table></figure>

<p><strong>主启动</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span>  com.atguigu.docker;</span><br><span class="line"><span class="keyword">import</span>  org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span>  org.springframework.boot.autoconfigure. SpringBootApplication ;</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">DockerBootApplication</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span>  <span class="title">main</span><span class="params">(String[] args)</span>    </span>&#123;</span><br><span class="line">  	SpringApplication. run (DockerBootApplication. <span class="class"><span class="keyword">class</span> , <span class="title">args</span>)</span>;</span><br><span class="line"> 		 &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p><strong>业务类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.docker.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation. Value ;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation. RequestMapping ;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation. RestController ;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.UUID;</span><br><span class="line"></span><br><span class="line">/</span><br><span class="line"> *<span class="meta">@auther</span>  zzyy</span><br><span class="line"> *<span class="meta">@create</span>  <span class="number">2021</span>-<span class="number">10</span>-<span class="number">25</span> <span class="number">17</span>:<span class="number">43</span></span><br><span class="line">*/</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">  <span class="meta">@Value</span> ( <span class="string">&quot;$&#123;server.port&#125;&quot;</span> )</span><br><span class="line">  <span class="keyword">private</span> String port ;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span> ( <span class="string">&quot;/order/docker&quot;</span> )</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">helloDocker</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello docker&quot;</span> + <span class="string">&quot; \t &quot;</span> + port + <span class="string">&quot; \t &quot;</span> + UUID. *randomUUID* ().toString();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping</span> (value = <span class="string">&quot;/order/index&quot;</span> ,method = RequestMethod. *GET\* )</span><br><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span></span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; 服务端口号 : &quot;</span> + <span class="string">&quot; \t &quot;</span> + port + <span class="string">&quot; \t &quot;</span> +UUID. *randomUUID* ().toString();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h4 id="3-2-通过dockerfile-发布微服务部署到docker容器"><a href="#3-2-通过dockerfile-发布微服务部署到docker容器" class="headerlink" title="3.2 通过dockerfile 发布微服务部署到docker容器"></a>3.2 通过dockerfile 发布微服务部署到docker容器</h4><h5 id="3-2-1-IDEA工具里面搞定微服务jar包"><a href="#3-2-1-IDEA工具里面搞定微服务jar包" class="headerlink" title="3.2.1 IDEA工具里面搞定微服务jar包"></a>3.2.1 <strong>IDEA工具里面搞定微服务jar包</strong></h5><p><img src="images/33.png" alt="33"></p>
<h5 id="3-2-2-编写Dockerfile"><a href="#3-2-2-编写Dockerfile" class="headerlink" title="3.2.2 编写Dockerfile"></a>3.2.2 <strong>编写Dockerfile</strong></h5><p> <strong>Dockerfile内容</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 基础镜像使用java</span> </span><br><span class="line">FROM java:8 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 作者</span> </span><br><span class="line">MAINTAINER zzyy </span><br><span class="line"><span class="meta">#</span><span class="bash"> VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span> </span><br><span class="line">VOLUME /tmp </span><br><span class="line"><span class="meta">#</span><span class="bash"> 将jar包添加到容器中并更名为zzyy_docker.jar</span> </span><br><span class="line">ADD docker_boot-0.0.1-SNAPSHOT.jar /zzyy_docker.jar </span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行jar包</span> </span><br><span class="line">RUN bash -c &#x27;touch /zzyy_docker.jar&#x27; </span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/zzyy_docker.jar&quot;] </span><br><span class="line"><span class="meta">#</span><span class="bash">暴露6001端口作为微服务</span> </span><br><span class="line">EXPOSE 6001 </span><br></pre></td></tr></table></figure>

<p><strong>将微服务jar包和Dockerfile文件上传到同一个目录下/mydocker</strong></p>
<p> <img src="images/34.png" alt="34"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker build -t zzyy_docker:1.6 . </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>构建镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build -t zzyy_docker:1.6 .</span><br><span class="line"></span><br><span class="line">打包成镜像文件</span><br><span class="line"><span class="meta">#</span><span class="bash"> 命令</span></span><br><span class="line">docker build -t zzyy_docker:1.6 .</span><br></pre></td></tr></table></figure>

<p><strong>运行容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 运行命令</span></span><br><span class="line">docker run -d -p 6001:6001 zzyy_docker:1.6</span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像运行命令</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><strong>访问测试</strong></p>
<p><img src="images/35.png" alt="35"></p>
<h3 id="四、Docker网络"><a href="#四、Docker网络" class="headerlink" title="四、Docker网络"></a>四、Docker网络</h3><h4 id="4-1-Docker-网络是什么"><a href="#4-1-Docker-网络是什么" class="headerlink" title="4.1 Docker 网络是什么"></a>4.1 Docker 网络是什么</h4><h5 id="4-1-1-docker不启动，默认网络情况"><a href="#4-1-1-docker不启动，默认网络情况" class="headerlink" title="4.1.1 docker不启动，默认网络情况"></a>4.1.1 docker不启动，默认网络情况</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ens 33</span><br><span class="line">lo</span><br><span class="line">virbr0</span><br></pre></td></tr></table></figure>

<p><img src="images/36.png" alt="36"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在CentOS7的安装过程中如果有 选择相关虚拟化的的服务安装系统后 ，启动网卡时会发现有一个以网桥连接的私网地址的virbr0网卡(virbr0网卡：它还有一个固定的默认IP地址192.168.122.1)，是做虚拟机网桥的使用的，其作用是为连接其上的虚机网卡提供 NAT访问外网的功能。 </span><br><span class="line">  </span><br><span class="line">我们之前学习Linux安装，勾选安装系统的时候附带了libvirt服务才会生成的一个东西，如果不需要可以直接将libvirtd服务卸载， </span><br><span class="line">yum remove libvirt-libs.x86_64 </span><br></pre></td></tr></table></figure>

<h5 id="4-1-2-docker启动后，网络情况"><a href="#4-1-2-docker启动后，网络情况" class="headerlink" title="4.1.2 docker启动后，网络情况"></a>4.1.2 docker启动后，网络情况</h5><p>查看docker网络模式命令</p>
<p><img src="images/37.png" alt="37"></p>
<h4 id="4-2-常用基本命令"><a href="#4-2-常用基本命令" class="headerlink" title="4.2 常用基本命令"></a>4.2 常用基本命令</h4><h5 id="4-2-1-All-命令"><a href="#4-2-1-All-命令" class="headerlink" title="4.2.1 All 命令"></a>4.2.1 <strong>All 命令</strong></h5><p><img src="images/38.png" alt="38"></p>
<h5 id="4-2-2-查看网络"><a href="#4-2-2-查看网络" class="headerlink" title="4.2.2 查看网络"></a>4.2.2 <strong>查看网络</strong></h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls</span><br></pre></td></tr></table></figure>

<h5 id="4-2-3-查看网络源数据"><a href="#4-2-3-查看网络源数据" class="headerlink" title="4.2.3 查看网络源数据"></a>4.2.3 查看网络源数据</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect  XXX网络名字</span><br></pre></td></tr></table></figure>

<h5 id="4-2-4-删除网络"><a href="#4-2-4-删除网络" class="headerlink" title="4.2.4 删除网络"></a>4.2.4 删除网络</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network rm XXX网络名字</span><br></pre></td></tr></table></figure>

<h5 id="4-2-5-案例"><a href="#4-2-5-案例" class="headerlink" title="4.2.5 案例"></a>4.2.5 案例</h5><p><img src="images/39.png" alt="39"></p>
<h4 id="4-3-能干嘛"><a href="#4-3-能干嘛" class="headerlink" title="4.3 能干嘛"></a>4.3 能干嘛</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">容器间的互联和通信以及端口映射</span><br><span class="line">容器IP变动时候可以通过服务名直接网络通信而不受到影响</span><br></pre></td></tr></table></figure>

<h4 id="4-4-网络模式"><a href="#4-4-网络模式" class="headerlink" title="4.4 网络模式"></a>4.4 网络模式</h4><h5 id="4-4-1-总体介绍"><a href="#4-4-1-总体介绍" class="headerlink" title="4.4.1 总体介绍"></a>4.4.1 总体介绍</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bridge模式：使用--network bridge指定，默认使用docker()</span><br><span class="line"></span><br><span class="line">host模式：使用 --network host指定</span><br><span class="line"></span><br><span class="line">none模式：使用 --network none指定</span><br><span class="line"></span><br><span class="line">container模式：使用 --network container:Name或者容器ID指定</span><br></pre></td></tr></table></figure>

<h5 id="4-4-2-容器实例内默认网络IP生产规则"><a href="#4-4-2-容器实例内默认网络IP生产规则" class="headerlink" title="4.4.2 容器实例内默认网络IP生产规则"></a>4.4.2 容器实例内默认网络IP生产规则</h5><blockquote>
<p>1 先启动两个ubuntu容器实例 </p>
<p><img src="images/40.png" alt="40"></p>
<p>2 docker inspect 容器ID or 容器名字 </p>
<p><img src="images/41.png" alt="41"></p>
<p>3 关闭u2实例，新建u3，查看ip变化 </p>
<p><img src="images/42.png" alt="42"></p>
</blockquote>
<h5 id="4-4-3-案例说明"><a href="#4-4-3-案例说明" class="headerlink" title="4.4.3 案例说明"></a>4.4.3 案例说明</h5><p><strong>bridge</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Docker 服务默认会创建一个 docker0 网桥（其上有一个 docker0 内部接口），该桥接网络的名称为docker0，它在 内核层 连通了其他的物理或虚拟网卡，这就将所有容器和本地主机都放到 同一个物理网络 。Docker 默认指定了 docker0 接口 的 IP 地址和子网掩码， 让主机和容器之间可以通过网桥相互通信。 </span><br><span class="line"><span class="meta">  </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 bridge 网络的详细信息，并通过 grep 获取名称项</span> </span><br><span class="line">docker network inspect bridge | grep name </span><br><span class="line"></span><br><span class="line">ifconfig </span><br></pre></td></tr></table></figure>

<p><strong>案例</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 Docker使用Linux桥接，在宿主机虚拟一个Docker容器网桥(docker0)，Docker启动一个容器时会根据Docker网桥的网段分配给容器一个IP地址，称为Container-IP，同时Docker网桥是每个容器的默认网关。因为在同一宿主机内的容器都接入同一个网桥，这样容器之间就能够通过容器的Container-IP直接通信。 </span><br><span class="line"> </span><br><span class="line">2 docker run 的时候，没有指定network的话默认使用的网桥模式就是bridge，使用的就是docker0 。在宿主机ifconfig,就可以看到docker0和自己create的network(后面讲)eth0，eth1，eth2……代表网卡一，网卡二，网卡三…… ，lo代表127.0.0.1，即localhost ，inet addr用来表示网卡的IP地址 </span><br><span class="line"> </span><br><span class="line">3 网桥docker0创建一对对等虚拟设备接口一个叫veth，另一个叫eth0，成对匹配。 </span><br><span class="line">   3.1 整个宿主机的网桥模式都是docker0，类似一个交换机有一堆接口，每个接口叫veth，在本地主机和容器内分别创建一个虚拟接口，并让他们彼此联通（这样一对接口叫veth pair）； </span><br><span class="line">   3.2 每个容器实例内部也有一块网卡，每个接口叫eth0； </span><br><span class="line">   3.3 docker0上面的每个veth匹配某个容器实例内部的eth0，两两配对，一一匹配。 </span><br><span class="line"> 通过上述，将宿主机上的所有容器都连接到这个内部网络上，两个容器在同一个网络下,会从这个网关下各自拿到分配的ip，此时两个容器的网络是互通的。 </span><br></pre></td></tr></table></figure>

<p><img src="images/43.png" alt="43"></p>
<p>【代码】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8081:8080   --name tomcat81 billygoo/tomcat8-jdk8</span><br><span class="line"></span><br><span class="line">docker run -d -p 8082:8080   --name tomcat82 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>

<p><strong>两两匹配验证</strong></p>
<p><img src="images/44.png" alt="44"></p>
<p><strong>Host</strong></p>
<blockquote>
<p>一、是什么</p>
<p>直接使用宿主机的IP地址与外界进行通信，不再需要额外进行NAT转换。</p>
<p>二、案例</p>
<ol>
<li>说明</li>
</ol>
<p> 容器将 不会获得 一个独立的Network Namespace， 而是和宿主机共用一个Network Namespace。 容器将不会虚拟出自己的网卡而是使用宿主机的IP和端口。</p>
<ol start="2">
<li>代码</li>
</ol>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">警告：</span><br><span class="line"> docker run -d -p 8083:8080 --network host --name tomcat83 billygoo/tomcat8-jdk8</span><br><span class="line"></span><br><span class="line">正确：</span><br><span class="line"> docker run -d    --network host --name tomcat83 billygoo/tomcat8-jdk8</span><br></pre></td></tr></table></figure>



<ol start="3">
<li>无之前的配对显示了，看容器实例内部</li>
</ol>
<p> <img src="images/45.png" alt="45"></p>
<ol start="4">
<li>没有设置-p的端口映射了，如何访问启动的tomcat83？</li>
</ol>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://宿主机IP:8080/ </span><br><span class="line"></span><br><span class="line">在CentOS里面用默认的火狐浏览器访问容器内的tomcat83看到访问成功，因为此时容器的IP借用主机的， </span><br><span class="line">所以容器共享宿主机网络IP，这样的好处是外部主机与容器可以直接通信。</span><br></pre></td></tr></table></figure>


</blockquote>
<p><strong>none</strong></p>
<blockquote>
<p>一、是什么</p>
<p>禁用网络功能，只有lo标识（就是127.0.0.1表示本地回环）</p>
<p>二、案例</p>
<p>docker run -d -p8084:8080 –network none –name tomcat84 billygoo/tomcat8-jdk8</p>
</blockquote>
<p><strong>container</strong></p>
<blockquote>
<p>一、是什么</p>
<p>container⽹络模式 </p>
<p>新建的容器和已经存在的一个容器共享一个网络ip配置而不是和宿主机共享。新创建的容器不会创建自己的网卡，配置自己的IP，而是和一个指定的容器共享IP、端口范围等。同样，两个容器除了网络方面，其他的如文件系统、进程列表等还是隔离的。 </p>
<p>二、❎案例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d -p 8085:8080                                     --name tomcat85 billygoo/tomcat8-jdk8</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d -p 8086:8080 --network container:tomcat85 --name tomcat86 billygoo/tomcat8-jdk8</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">运行结果</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker：Error response from daemon: conflicting optisons: port ...........</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"><span class="comment"># 相当于tomcat86和tomcat85公用同一个ip同一个端口，导致端口冲突</span></span> </span><br></pre></td></tr></table></figure>

<p>三、✅案例2</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">Alpine操作系统是一个面向安全的轻型 Linux发行版</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -it                  --name alpine1  alpine /bin/sh</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -it --network container:alpine1 --name alpine2  alpine /bin/sh</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果，验证共用搭桥</p>
<p><img src="images/46.png" alt="46"></p>
<p>假如此时关闭alpine1，再看看alpine2</p>
<p><img src="images/47.png" alt="47"></p>
</blockquote>
<p><strong>自定义网络</strong></p>
<blockquote>
<p>一、过时的link</p>
<p><img src="images/48.png" alt="48"></p>
<p>二、是什么</p>
<p>三、案例</p>
<p>【before】</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">案例：</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d -p 8081:8080   --name tomcat81 billygoo/tomcat8-jdk8</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d -p 8082:8080   --name tomcat82 billygoo/tomcat8-jdk8</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">上述成功启动并用docker <span class="built_in">exec</span>进入各自容器实例内部</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">问题：</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">1. 按照IP地址ping是OK的</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">2. 按照服务名ping结果???</span></span><br><span class="line">ping： tocmat82：Name or service not known</span><br></pre></td></tr></table></figure>

<p>【after】</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;案例</span><br><span class="line">&gt;自定义桥接网络,自定义网络默认使用的是桥接网络bridge</span><br><span class="line"></span><br><span class="line">&gt;新建自定义网络</span><br></pre></td></tr></table></figure>

<p><img src="images/49.png" alt="49"></p>
<p>新建容器加入上一步新建的自定义网络</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d -p 8081:8080 --network zzyy_network  --name tomcat81 billygoo/tomcat8-jdk8</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d -p 8082:8080 --network zzyy_network  --name tomcat82 billygoo/tomcat8-jdk8</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>互相ping测试</p>
<p><img src="images/50.png" alt="50"></p>
<p>问题结论</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;1、自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</span><br><span class="line">&gt;2、自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</span><br><span class="line">&gt;3、自定义网络本身就维护好了主机名和ip的对应关系（ip和域名都能通）</span><br></pre></td></tr></table></figure>


</blockquote>
<h4 id="4-5-Docker平台架构图解"><a href="#4-5-Docker平台架构图解" class="headerlink" title="4.5 Docker平台架构图解"></a>4.5 Docker平台架构图解</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">从其架构和运行流程来看，Docker 是一个 C/S 模式的架构，后端是一个松耦合架构，众多模块各司其职。  </span><br><span class="line">  </span><br><span class="line">Docker 运行的基本流程为： </span><br><span class="line">  </span><br><span class="line">1 用户是使用 Docker Client 与 Docker Daemon 建立通信，并发送请求给后者。 </span><br><span class="line">2 Docker Daemon 作为 Docker 架构中的主体部分，首先提供 Docker Server 的功能使其可以接受 Docker Client 的请求。 </span><br><span class="line">3 Docker Engine 执行 Docker 内部的一系列工作，每一项工作都是以一个 Job 的形式的存在。 </span><br><span class="line">4 Job 的运行过程中，当需要容器镜像时，则从 Docker Registry 中下载镜像，并通过镜像管理驱动 Graph driver将下载镜像以Graph的形式存储。 </span><br><span class="line">5 当需要为 Docker 创建网络环境时，通过网络管理驱动 Network driver 创建并配置 Docker 容器网络环境。 </span><br><span class="line">6 当需要限制 Docker 容器运行资源或执行用户指令等操作时，则通过 Execdriver 来完成。 </span><br><span class="line">7 Libcontainer是一项独立的容器管理包，Network driver以及Exec driver都是通过Libcontainer来实现具体对容器进行的操作。</span><br></pre></td></tr></table></figure>

<p><img src="images/51.png" alt="51"></p>
<h3 id="五、Docker-compose容器编排"><a href="#五、Docker-compose容器编排" class="headerlink" title="五、Docker-compose容器编排"></a>五、Docker-compose容器编排</h3><h4 id="5-1-Docker-compose是什么"><a href="#5-1-Docker-compose是什么" class="headerlink" title="5.1 Docker-compose是什么"></a>5.1 Docker-compose是什么</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Docker-Compose是Docker官方的开源项目，负责实现对Docker容器集群的快速编排。</span><br></pre></td></tr></table></figure>

<h4 id="5-2-能干什么"><a href="#5-2-能干什么" class="headerlink" title="5.2 能干什么"></a>5.2 能干什么</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">docker建议我们每一个容器中只运行一个服务,因为docker容器本身占用资源极少,所以最好是将每个服务单独的分割开来但是这样我们又面临了一个问题？</span> <span class="string"></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">如果我需要同时部署好多个服务,难道要每个服务单独写Dockerfile然后在构建镜像,构建容器,这样累都累死了,所以docker官方给我们提供了docker-compose多服务部署的工具</span> <span class="string"></span></span><br><span class="line">  </span><br><span class="line"><span class="meta">例如要实现一个Web微服务项目，除了Web服务容器本身，往往还需要再加上后端的数据库mysql服务容器，redis服务器，注册中心eureka，甚至还包括负载均衡容器等等。。。。。。</span> <span class="string"></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">Compose允许用户通过一个单独的</span> <span class="string">docker-compose.yml模板文件 （YAML 格式）来定义 一组相关联的应用容器为一个项目（project）。 </span></span><br><span class="line">  </span><br><span class="line"><span class="meta">可以很容易地用一个配置文件定义一个多容器的应用，然后使用一条指令安装这个应用的所有依赖，完成构建。Docker-Compose</span> <span class="string">解决了容器与容器之间如何管理编排的问题。</span></span><br></pre></td></tr></table></figure>

<h4 id="5-3-去哪里"><a href="#5-3-去哪里" class="headerlink" title="5.3 去哪里"></a>5.3 去哪里</h4><h5 id="5-3-1-官网："><a href="#5-3-1-官网：" class="headerlink" title="5.3.1 官网："></a>5.3.1 官网：</h5><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/compose/compose-file/compose-file-v3/">https://docs.docker.com/compose/compose-file/compose-file-v3/</a></p>
<h5 id="5-3-2-官网下载"><a href="#5-3-2-官网下载" class="headerlink" title="5.3.2 官网下载"></a>5.3.2 官网下载</h5><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.docker.com/compose/install/">https://docs.docker.com/compose/install/</a></p>
<h5 id="5-3-3-安装步骤"><a href="#5-3-3-安装步骤" class="headerlink" title="5.3.3 安装步骤"></a>5.3.3 安装步骤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose </span><br><span class="line">chmod +x /usr/local/bin/docker-compose </span><br><span class="line">docker-compose --version </span><br></pre></td></tr></table></figure>

<p><img src="images/52.png" alt="52"></p>
<h5 id="5-3-4-卸载步骤"><a href="#5-3-4-卸载步骤" class="headerlink" title="5.3.4 卸载步骤"></a>5.3.4 卸载步骤</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rm /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure>

<h4 id="5-4-Compose-核心概念"><a href="#5-4-Compose-核心概念" class="headerlink" title="5.4 Compose 核心概念"></a>5.4 Compose 核心概念</h4><h5 id="5-4-1-一文件"><a href="#5-4-1-一文件" class="headerlink" title="5.4.1 一文件"></a>5.4.1 一文件</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose.yml</span><br></pre></td></tr></table></figure>

<h5 id="5-4-2-两要素"><a href="#5-4-2-两要素" class="headerlink" title="5.4.2 两要素"></a>5.4.2 两要素</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">服务(service):</span><br><span class="line">一个个应用容器实例，比如订单微服务、库存微服务、mysql容器、nginx容器或者redis容器。</span><br><span class="line"></span><br><span class="line">工程(project):</span><br><span class="line">由一组关联的应用容器组成的一个完整业务单元，在 docker-compose.yml 文件中定义。</span><br></pre></td></tr></table></figure>

<h4 id="5-5-Compose-使用的三个步骤"><a href="#5-5-Compose-使用的三个步骤" class="headerlink" title="5.5 Compose 使用的三个步骤"></a>5.5 Compose 使用的三个步骤</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. 编写Dockerfile定义各个微服务应用并构建出对应的镜像文件</span><br><span class="line">2. 使用 docker-compose.yml 定义一个完整业务单元，安排好整体应用中的各个容器服务。</span><br><span class="line">3. 最后，执行docker-compose up命令 来启动并运行整个应用程序，完成一键部署上线</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="5-6-Compose常用命令"><a href="#5-6-Compose常用命令" class="headerlink" title="5.6 Compose常用命令"></a>5.6 Compose常用命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Compose 常用命令 </span><br><span class="line">docker-compose -h                           #  查看帮助 </span><br><span class="line">docker-compose up                           #  启动所有 docker-compose服务 </span><br><span class="line">docker-compose up -d                        #  启动所有 docker-compose服务 并后台运行 </span><br><span class="line">docker-compose down                         #  停止并删除容器、网络、卷、镜像。 </span><br><span class="line">docker-compose exec  yml里面的服务id                 # 进入容器实例内部  docker-compose exec  docker-compose.yml文件中写的服务id  /bin/bash </span><br><span class="line">docker-compose ps                      # 展示当前docker-compose编排过的运行的所有容器 </span><br><span class="line">docker-compose top                     # 展示当前docker-compose编排过的容器进程 </span><br><span class="line"> </span><br><span class="line">docker-compose logs  yml里面的服务id     #  查看容器输出日志 </span><br><span class="line">docker-compose config     #  检查配置 </span><br><span class="line">docker-compose config -q  #  检查配置，有问题才有输出 </span><br><span class="line">docker-compose restart   #  重启服务 </span><br><span class="line">docker-compose start     #  启动服务 </span><br><span class="line">docker-compose stop      #  停止服务 </span><br></pre></td></tr></table></figure>

<h4 id="5-5-Componse-编排微服务"><a href="#5-5-Componse-编排微服务" class="headerlink" title="5.5 Componse 编排微服务"></a>5.5 Componse 编排微服务</h4><h5 id="5-5-1-改造升级微服务工程docker-boot"><a href="#5-5-1-改造升级微服务工程docker-boot" class="headerlink" title="5.5.1 改造升级微服务工程docker_boot"></a>5.5.1 改造升级微服务工程docker_boot</h5><p><strong>以前的基础版</strong></p>
<p><img src="images/53.png" alt="53"></p>
<p><strong>SQL建表建库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `t_user` ( </span><br><span class="line">  `id` int(10) unsigned NOT NULL AUTO_INCREMENT, </span><br><span class="line">  `username` varchar(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;用户名&#x27;, </span><br><span class="line">  `password` varchar(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;密码&#x27;, </span><br><span class="line">  `sex` tinyint(4) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;性别 0=女 1=男 &#x27;, </span><br><span class="line">  `deleted` tinyint(4) unsigned NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;删除标志，默认0不删除，1删除&#x27;, </span><br><span class="line">  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;更新时间&#x27;, </span><br><span class="line">  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;, </span><br><span class="line">  PRIMARY KEY (`id`) </span><br><span class="line">) ENGINE=InnoDB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8 COMMENT=&#x27;用户表&#x27; </span><br></pre></td></tr></table></figure>

<p><strong>改POM</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line">&lt;? xml version =&quot;1.0&quot; encoding =&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt; project xmlns =&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns: xsi =&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">      xsi :schemaLocation =&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot; &gt; </span><br><span class="line">   &lt; modelVersion &gt; 4.0.0 &lt;/ modelVersion &gt; </span><br><span class="line">   &lt; parent &gt; </span><br><span class="line">     &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">     &lt; artifactId &gt; spring-boot-starter-parent &lt;/ artifactId &gt; </span><br><span class="line">     &lt; version &gt; 2.5.6 &lt;/ version &gt; </span><br><span class="line">     <span class="comment">&lt;!--&lt;version&gt;2.3.10.RELEASE&lt;/version&gt;--&gt;</span></span><br><span class="line">     &lt; relativePath /&gt;  <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">   &lt;/ parent &gt; </span><br><span class="line"></span><br><span class="line">   &lt; groupId &gt; com.atguigu.docker &lt;/ groupId &gt; </span><br><span class="line">   &lt; artifactId &gt; docker_boot &lt;/ artifactId &gt; </span><br><span class="line">   &lt; version &gt; 0.0.1-SNAPSHOT &lt;/ version &gt; </span><br><span class="line"></span><br><span class="line">   &lt; properties &gt; </span><br><span class="line">     &lt; project.build.sourceEncoding &gt; UTF-8 &lt;/ project.build.sourceEncoding &gt; </span><br><span class="line">     &lt; maven.compiler.source &gt; 1.8 &lt;/ maven.compiler.source &gt; </span><br><span class="line">     &lt; maven.compiler.target &gt; 1.8 &lt;/ maven.compiler.target &gt; </span><br><span class="line">     &lt; junit.version &gt; 4.12 &lt;/ junit.version &gt; </span><br><span class="line">     &lt; log4j.version &gt; 1.2.17 &lt;/ log4j.version &gt; </span><br><span class="line">     &lt; lombok.version &gt; 1.16.18 &lt;/ lombok.version &gt; </span><br><span class="line">     &lt; mysql.version &gt; 5.1.47 &lt;/ mysql.version &gt; </span><br><span class="line">     &lt; druid.version &gt; 1.1.16 &lt;/ druid.version &gt; </span><br><span class="line">     &lt; mapper.version &gt; 4.1.5 &lt;/ mapper.version &gt; </span><br><span class="line">     &lt; mybatis.spring.boot.version &gt; 1.3.0 &lt;/ mybatis.spring.boot.version &gt; </span><br><span class="line">   &lt;/ properties &gt; </span><br><span class="line"></span><br><span class="line">   &lt; dependencies &gt; </span><br><span class="line">     <span class="comment">&lt;!--guava Google 开源的  Guava 中自带的布隆过滤器 --&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; com.google.guava &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; guava &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 23.0 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!-- redisson --&gt;</span></span><br><span class="line">    &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.redisson &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; redisson &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 3.13.4 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--SpringBoot 通用依赖模块 --&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; spring-boot-starter-web &lt;/ artifactId &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; spring-boot-starter-actuator &lt;/ artifactId &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--swagger2--&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; io.springfox &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; springfox-swagger2 &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 2.9.2 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; io.springfox &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; springfox-swagger-ui &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 2.9.2 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--SpringBoot 与 Redis 整合依赖 --&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; spring-boot-starter-data-redis &lt;/ artifactId &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--springCache--&gt;</span></span><br><span class="line">    &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; spring-boot-starter-cache &lt;/ artifactId &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--springCache 连接池依赖包 --&gt;</span></span><br><span class="line">    &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.apache.commons &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; commons-pool2 &lt;/ artifactId &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!-- jedis --&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; redis.clients &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; jedis &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 3.1.0 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--Mysql 数据库驱动 --&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; mysql &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; mysql-connector-java &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 5.1.47 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--SpringBoot 集成 druid 连接池 --&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; com.alibaba &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; druid-spring-boot-starter &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 1.1.10 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; com.alibaba &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; druid &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; $&#123;druid.version&#125; &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--mybatis 和 springboot 整合 --&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.mybatis.spring.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; mybatis-spring-boot-starter &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; $&#123;mybatis.spring.boot.version&#125; &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!-- 添加 springboot 对 amqp 的支持 --&gt;</span></span><br><span class="line">    &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; spring-boot-starter-amqp &lt;/ artifactId &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; commons-codec &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; commons-codec &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 1.10 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!-- 通用基础配置 junit/devtools/test/log4j/lombok/hutool--&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--hutool--&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; cn.hutool &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; hutool-all &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 5.2.3 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; junit &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; junit &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; $&#123;junit.version&#125; &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; spring-boot-devtools &lt;/ artifactId &gt; </span><br><span class="line">       &lt; scope &gt; runtime &lt;/ scope &gt; </span><br><span class="line">       &lt; optional &gt; true &lt;/ optional &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; spring-boot-starter-test &lt;/ artifactId &gt; </span><br><span class="line">       &lt; scope &gt; test &lt;/ scope &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; log4j &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; log4j &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; $&#123;log4j.version&#125; &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; org.projectlombok &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; lombok &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; $&#123;lombok.version&#125; &lt;/ version &gt; </span><br><span class="line">       &lt; optional &gt; true &lt;/ optional &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!--persistence--&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; javax.persistence &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; persistence-api &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; 1.0.2 &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">     <span class="comment">&lt;!-- 通用 Mapper--&gt;</span></span><br><span class="line">     &lt; dependency &gt; </span><br><span class="line">       &lt; groupId &gt; tk.mybatis &lt;/ groupId &gt; </span><br><span class="line">       &lt; artifactId &gt; mapper &lt;/ artifactId &gt; </span><br><span class="line">       &lt; version &gt; $&#123;mapper.version&#125; &lt;/ version &gt; </span><br><span class="line">     &lt;/ dependency &gt; </span><br><span class="line">   &lt;/ dependencies &gt; </span><br><span class="line"></span><br><span class="line">   &lt; build &gt; </span><br><span class="line">     &lt; plugins &gt; </span><br><span class="line">       &lt; plugin &gt; </span><br><span class="line">         &lt; groupId &gt; org.springframework.boot &lt;/ groupId &gt; </span><br><span class="line">         &lt; artifactId &gt; spring-boot-maven-plugin &lt;/ artifactId &gt; </span><br><span class="line">       &lt;/ plugin &gt; </span><br><span class="line">       &lt; plugin &gt; </span><br><span class="line">         &lt; groupId &gt; org.apache.maven.plugins &lt;/ groupId &gt; </span><br><span class="line">         &lt; artifactId &gt; maven-resources-plugin &lt;/ artifactId &gt; </span><br><span class="line">         &lt; version &gt; 3.1.0 &lt;/ version &gt; </span><br><span class="line">       &lt;/ plugin &gt; </span><br><span class="line">     &lt;/ plugins &gt; </span><br><span class="line">   &lt;/ build &gt; </span><br><span class="line"></span><br><span class="line"> &lt;/ project &gt; </span><br></pre></td></tr></table></figure>

<p><strong>写YML</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">server.port</span> <span class="string">=</span> <span class="number">6001</span></span><br><span class="line"><span class="string">========================alibaba.druid*</span> <span class="string">相关配置</span> <span class="string">*=====================</span></span><br><span class="line"><span class="string">spring.datasource.type</span> <span class="string">=</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="string">spring.datasource.driver-class-name</span> <span class="string">=</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="string">spring.datasource.url=</span> <span class="string">jdbc:mysql://192.168.111.169</span> <span class="string">:3306/db2021?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="string">spring.datasource.username</span> <span class="string">=</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="string">spring.datasource.password</span> <span class="string">=</span> <span class="number">123456</span></span><br><span class="line"><span class="string">spring.datasource.druid.test-while-idle</span> <span class="string">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="string">========================redis*</span> <span class="string">相关配置</span> <span class="string">*=====================</span></span><br><span class="line"></span><br><span class="line"><span class="string">spring.redis.database</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"><span class="string">spring.redis.host</span> <span class="string">=</span> <span class="number">192.168</span><span class="number">.111</span><span class="number">.169</span></span><br><span class="line"><span class="string">spring.redis.port</span> <span class="string">=</span> <span class="number">6379</span></span><br><span class="line"><span class="string">spring.redis.password</span> <span class="string">=</span></span><br><span class="line"><span class="string">spring.redis.lettuce.pool.max-active</span> <span class="string">=</span> <span class="number">8</span></span><br><span class="line"><span class="string">spring.redis.lettuce.pool.max-wait</span> <span class="string">=</span> <span class="string">-1ms</span></span><br><span class="line"><span class="string">spring.redis.lettuce.pool.max-idle</span> <span class="string">=</span> <span class="number">8</span></span><br><span class="line"><span class="string">spring.redis.lettuce.pool.min-idle</span> <span class="string">=</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="string">========================mybatis</span> <span class="string">相关配置</span> <span class="string">*===================*=</span></span><br><span class="line"></span><br><span class="line"><span class="string">mybatis.mapper-locations</span> <span class="string">=</span> <span class="string">classpath:mapper/\*.xml</span></span><br><span class="line"><span class="string">mybatis.type-aliases-package</span> <span class="string">=</span> <span class="string">com.atguigu.docker.entities</span></span><br><span class="line"></span><br><span class="line"><span class="string">========================swagger=====================</span></span><br><span class="line"></span><br><span class="line"><span class="string">spring.swagger2.enabled</span> <span class="string">=</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p><strong>主启动</strong></p>
<p><img src="images/54.png" alt="54"></p>
<p><strong>业务类</strong></p>
<blockquote>
<p>一、config配置类</p>
<p>RedisConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="keyword">package</span>  com.atguigu.docker.config;</span><br><span class="line">&gt;<span class="keyword">import</span>  lombok.extern.slf4j. Slf4j ;</span><br><span class="line">&gt;<span class="keyword">import</span>  org.springframework.context.annotation.Bean ;</span><br><span class="line">&gt;<span class="keyword">import</span>  org.springframework.context.annotation.Configuration ;</span><br><span class="line">&gt;<span class="keyword">import</span>  org.springframework.data.redis.connection.lettuce.LettuceConnectionFactory;</span><br><span class="line">&gt;<span class="keyword">import</span>  org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">&gt;<span class="keyword">import</span>  org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line">&gt;<span class="keyword">import</span>  org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line">&gt;<span class="keyword">import</span>  java.io.Serializable;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*  <span class="doctag">@auther</span>  zzyy</span></span><br><span class="line"><span class="comment">*  <span class="doctag">@create</span>  2021-10-27 17:19</span></span><br><span class="line"><span class="comment">*/</span> </span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">RedisConfig</span></span>&#123;    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span>  lettuceConnectionFactory     </span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span>    </span></span><br><span class="line"><span class="comment">* redis 序列化的工具配置类，下面这个请一定开启配置     </span></span><br><span class="line"><span class="comment">* 127.0.0.1:6379&gt; keys *    </span></span><br><span class="line"><span class="comment">* 1) &quot;ord:102&quot;   序列化过     </span></span><br><span class="line"><span class="comment">* 2) &quot;\xac\xed\x00\x05t\x00\aord:102&quot;    野生，没有序列化过     </span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line">&gt;<span class="meta">@Bean</span>    </span><br><span class="line">&gt;<span class="function"><span class="keyword">public</span>  RedisTemplate&lt;String,Serializable&gt; <span class="title">redisTemplate</span><span class="params">(LettuceConnectionFactory lettuceConnectionFactory)</span>   </span>&#123;       </span><br><span class="line">RedisTemplate&lt;String,Serializable&gt; redisTemplate =  <span class="keyword">new</span>  RedisTemplate&lt;&gt;();</span><br><span class="line">redisTemplate.setConnectionFactory(lettuceConnectionFactory);        </span><br><span class="line"><span class="comment">// 设置 key 序列化方式 string        </span></span><br><span class="line">redisTemplate.setKeySerializer( <span class="keyword">new</span>  StringRedisSerializer());        </span><br><span class="line"><span class="comment">// 设置 value 的序列化方式 json        </span></span><br><span class="line">redisTemplate.setValueSerializer(<span class="keyword">new</span> GenericJackson2JsonRedisSerializer());</span><br><span class="line">redisTemplate.setHashKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">redisTemplate.setHashValueSerializer( <span class="keyword">new</span> GenericJackson2JsonRedisSerializer());</span><br><span class="line">redisTemplate.afterPropertiesSet();</span><br><span class="line"><span class="keyword">return</span>  redisTemplate;   </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>SwaggerConfig</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.docker.config;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> org.springframework.beans.factory.annotation. Value ;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.context.annotation. Bean ;</span><br><span class="line"> <span class="keyword">import</span> org.springframework.context.annotation. Configuration ;</span><br><span class="line"> <span class="keyword">import</span> springfox.documentation.builders.ApiInfoBuilder;</span><br><span class="line"> <span class="keyword">import</span> springfox.documentation.builders.PathSelectors;</span><br><span class="line"> <span class="keyword">import</span> springfox.documentation.builders.RequestHandlerSelectors;</span><br><span class="line"> <span class="keyword">import</span> springfox.documentation.service.ApiInfo;</span><br><span class="line"> <span class="keyword">import</span> springfox.documentation.spi.DocumentationType;</span><br><span class="line"> <span class="keyword">import</span> springfox.documentation.spring.web.plugins.Docket;</span><br><span class="line"> <span class="keyword">import</span> springfox.documentation.swagger2.annotations. EnableSwagger2 ;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"> <span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment">  *<span class="doctag">@auther</span> zzyy</span></span><br><span class="line"><span class="comment">  *<span class="doctag">@create</span> 2021-05-01 16:18</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@Configuration</span></span><br><span class="line"> <span class="meta">@EnableSwagger2</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">   <span class="meta">@Value</span> ( <span class="string">&quot;$&#123;spring.swagger2.enabled&#125;&quot;</span> )</span><br><span class="line">   <span class="keyword">private</span> Boolean enabled ;</span><br><span class="line"> </span><br><span class="line">   <span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType. *SWAGGER_2\* )</span><br><span class="line">         .apiInfo(apiInfo())</span><br><span class="line">         .enable( enabled )</span><br><span class="line">         .select()</span><br><span class="line">         .apis(RequestHandlerSelectors. *basePackage* ( <span class="string">&quot;com.atguigu.docker&quot;</span> )) *<span class="comment">//* 你自己的 *package</span></span><br><span class="line">         .paths(PathSelectors. *any* ())</span><br><span class="line">         .build();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="function"><span class="keyword">public</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">         .title( <span class="string">&quot; 尚硅谷 Java 大厂技术 &quot;</span> + <span class="string">&quot; \t &quot;</span> + <span class="keyword">new</span> SimpleDateFormat( <span class="string">&quot;yyyy-MM-dd&quot;</span> ).format( <span class="keyword">new</span> Date()))</span><br><span class="line">         .description( <span class="string">&quot;docker-compose&quot;</span> )</span><br><span class="line">         .version( <span class="string">&quot;1.0&quot;</span> )</span><br><span class="line">         .termsOfServiceUrl( <span class="string">&quot;https://www.atguigu.com/&quot;</span> )</span><br><span class="line">         .build();</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>新建entity</strong> <strong>User</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.docker.entities;</span><br><span class="line"> </span><br><span class="line"> <span class="keyword">import</span> javax.persistence. Column ;</span><br><span class="line"> <span class="keyword">import</span> javax.persistence. GeneratedValue ;</span><br><span class="line"> <span class="keyword">import</span> javax.persistence. Id ;</span><br><span class="line"> <span class="keyword">import</span> javax.persistence. Table ;</span><br><span class="line"> <span class="keyword">import</span> java.util.Date;</span><br><span class="line"> </span><br><span class="line"> <span class="meta">@Table</span> (name = <span class="string">&quot;t_user&quot;</span> )</span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line">   <span class="meta">@Id</span></span><br><span class="line">   <span class="meta">@GeneratedValue</span> (generator = <span class="string">&quot;JDBC&quot;</span> )</span><br><span class="line">   <span class="keyword">private</span> Integer id ;</span><br><span class="line"></span><br><span class="line">	 <span class="keyword">private</span> String username ;</span><br><span class="line">   <span class="keyword">private</span> String password ;</span><br><span class="line"> 	 <span class="keyword">private</span> Byte sex ;</span><br><span class="line">   <span class="keyword">private</span> Byte deleted ;</span><br><span class="line">   <span class="meta">@Column</span> (name = <span class="string">&quot;update_time&quot;</span> )</span><br><span class="line">   <span class="keyword">private</span> Date updateTime ;</span><br><span class="line">   <span class="meta">@Column</span> (name = <span class="string">&quot;create_time&quot;</span> )</span><br><span class="line">   <span class="keyword">private</span> Date createTime ;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> id ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span> . id = id;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> username ;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span> . username = username;</span><br><span class="line">   &#125;</span><br><span class="line">	 <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> password ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span> . password = password;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Byte <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> sex ;</span><br><span class="line">   &#125;</span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSex</span><span class="params">(Byte sex)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span> . sex = sex;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Byte <span class="title">getDeleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> deleted ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDeleted</span><span class="params">(Byte deleted)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span> . deleted = deleted;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Date <span class="title">getUpdateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> updateTime ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUpdateTime</span><span class="params">(Date updateTime)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span> . updateTime = updateTime;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> createTime ;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(Date createTime)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">this</span> . createTime = createTime;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125; </span><br></pre></td></tr></table></figure>

<p><strong>UserDTO</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span>  com.atguigu.docker.entities;</span><br><span class="line"><span class="keyword">import</span>  io.swagger.annotations. ApiModel ;</span><br><span class="line"><span class="keyword">import</span>  io.swagger.annotations. ApiModelProperty ;</span><br><span class="line"><span class="keyword">import</span>  lombok. AllArgsConstructor ;</span><br><span class="line"><span class="keyword">import</span>  lombok. Data ;</span><br><span class="line"><span class="keyword">import</span>  lombok. NoArgsConstructor ;</span><br><span class="line"><span class="keyword">import</span>  java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span>  java.util.Date;</span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel</span> (value =  <span class="string">&quot; 用户信息 &quot;</span> )</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span>  <span class="title">UserDTO</span>  <span class="keyword">implements</span>  <span class="title">Serializable</span></span>&#123;     </span><br><span class="line"></span><br><span class="line">	<span class="meta">@ApiModelProperty</span> (value =  <span class="string">&quot; 用户 ID&quot;</span> )     </span><br><span class="line">	<span class="keyword">private</span>  Integer  id ;     </span><br><span class="line">	<span class="meta">@ApiModelProperty</span> (value =  <span class="string">&quot; 用户名 &quot;</span> )     </span><br><span class="line">	<span class="keyword">private</span>  String  username ;     </span><br><span class="line">	<span class="meta">@ApiModelProperty</span> (value =  <span class="string">&quot; 密码 &quot;</span> )     </span><br><span class="line">	<span class="keyword">private</span>  String  password ;     </span><br><span class="line">	<span class="meta">@ApiModelProperty</span> (value =  <span class="string">&quot; 性别  0= 女  1= 男  &quot;</span> )     </span><br><span class="line">	<span class="keyword">private</span>  Byte  sex ;     </span><br><span class="line">	<span class="meta">@ApiModelProperty</span> (value =  <span class="string">&quot; 删除标志，默认 0 不删除， 1 删除 &quot;</span> )     </span><br><span class="line">	<span class="keyword">private</span>  Byte  deleted ;     </span><br><span class="line">	<span class="meta">@ApiModelProperty</span> (value =  <span class="string">&quot; 更新时间 &quot;</span> )     </span><br><span class="line">	<span class="keyword">private</span>  Date  updateTime ;     </span><br><span class="line">	<span class="meta">@ApiModelProperty</span> (value =  <span class="string">&quot; 创建时间 &quot;</span> )     </span><br><span class="line">	<span class="keyword">private</span>  Date  createTime ;     </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	*  <span class="doctag">@return</span>  id</span></span><br><span class="line"><span class="comment">	*/</span>     </span><br><span class="line">	<span class="function"><span class="keyword">public</span>  Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;         </span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span>  id ;    </span><br><span class="line">	&#125;     </span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	*  <span class="doctag">@param</span>  id </span></span><br><span class="line"><span class="comment">	*/</span>     </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">this</span> . id  = id;   </span><br><span class="line">		 &#125;     </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	*  获取用户名</span></span><br><span class="line"><span class="comment">	* </span></span><br><span class="line"><span class="comment">	*  <span class="doctag">@return</span>  username -  用户名</span></span><br><span class="line"><span class="comment">	*/</span>     </span><br><span class="line">	<span class="function"><span class="keyword">public</span>  String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span>  username ;    </span><br><span class="line">		&#125;    </span><br><span class="line"></span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  设置用户名</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *  <span class="doctag">@param</span>  username  用户名</span></span><br><span class="line"><span class="comment">	 */</span>     </span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">	 	<span class="keyword">this</span>.username = username;</span><br><span class="line">	 &#125;     </span><br><span class="line"></span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  获取密码</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *  <span class="doctag">@return</span>  password -  密码</span></span><br><span class="line"><span class="comment">	 */</span>     </span><br><span class="line">	 <span class="function"><span class="keyword">public</span>  String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	 	<span class="keyword">return</span>  password ;</span><br><span class="line">	 &#125;     </span><br><span class="line"></span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  设置密码</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *  <span class="doctag">@param</span>  password  密码</span></span><br><span class="line"><span class="comment">	 */</span>     </span><br><span class="line">	 <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">	 	<span class="keyword">this</span>.password=password;</span><br><span class="line">	 &#125;     </span><br><span class="line"></span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *获取性别  0= 女  1= 男</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *  <span class="doctag">@return</span>  sex -  性别  0= 女  1= 男</span></span><br><span class="line"><span class="comment">	 */</span>     </span><br><span class="line">	 <span class="function"><span class="keyword">public</span>  Byte <span class="title">getSex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	 	<span class="keyword">return</span>  sex ;    </span><br><span class="line">	 	&#125;     </span><br><span class="line"></span><br><span class="line">	 <span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  设置性别  0= 女  1= 男       </span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 *  <span class="doctag">@param</span>  sex  性别  0= 女  1= 男       </span></span><br><span class="line"><span class="comment">	 */</span>    </span><br><span class="line">	  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setSex</span><span class="params">(Byte sex)</span> </span>&#123;</span><br><span class="line">	  <span class="keyword">this</span>.sex = sex;</span><br><span class="line">	  &#125;     </span><br><span class="line"></span><br><span class="line">	  <span class="comment">/**</span></span><br><span class="line"><span class="comment">	  *  获取删除标志，默认 0 不删除， 1 删除      </span></span><br><span class="line"><span class="comment">	  *     </span></span><br><span class="line"><span class="comment">	  *  <span class="doctag">@return</span>  deleted -  删除标志，默认 0 不删除， 1 删除      </span></span><br><span class="line"><span class="comment">	  */</span>    </span><br><span class="line">	   <span class="function"><span class="keyword">public</span>  Byte <span class="title">getDeleted</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	   	<span class="keyword">return</span>  deleted ;</span><br><span class="line">	   &#125;     </span><br><span class="line"></span><br><span class="line">	   <span class="comment">/**</span></span><br><span class="line"><span class="comment">	   *  设置删除标志，默认 0 不删除， 1 删除      </span></span><br><span class="line"><span class="comment">	   *</span></span><br><span class="line"><span class="comment">	   *  <span class="doctag">@param</span>  deleted  删除标志，默认 0 不删除， 1 删除      </span></span><br><span class="line"><span class="comment">	   */</span>    </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setDeleted</span><span class="params">(Byte deleted)</span> </span>&#123;</span><br><span class="line">	    	<span class="keyword">this</span>.deleted = deleted;    </span><br><span class="line">	    	&#125;     </span><br><span class="line"></span><br><span class="line">	    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	    *  获取更新时间</span></span><br><span class="line"><span class="comment">	    *</span></span><br><span class="line"><span class="comment">	    *  <span class="doctag">@return</span>  update_time -  更新时间</span></span><br><span class="line"><span class="comment">	    */</span>     </span><br><span class="line">	    <span class="function"><span class="keyword">public</span>  Date <span class="title">getUpdateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	    	<span class="keyword">return</span>  updateTime ; </span><br><span class="line">	    	&#125;     </span><br><span class="line"></span><br><span class="line">	    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	    *  设置更新时间 </span></span><br><span class="line"><span class="comment">      *</span></span><br><span class="line"><span class="comment">      *  <span class="doctag">@param</span>  updateTime  更新时间     </span></span><br><span class="line"><span class="comment">      */</span>     </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setUpdateTime</span><span class="params">(Date updateTime)</span> </span>&#123;</span><br><span class="line">	    	<span class="keyword">this</span> . updateTime  = updateTime;</span><br><span class="line">	    	&#125;     </span><br><span class="line"></span><br><span class="line">	    <span class="comment">/** </span></span><br><span class="line"><span class="comment">      *  获取创建时间     </span></span><br><span class="line"><span class="comment">      *   </span></span><br><span class="line"><span class="comment">      *  <span class="doctag">@return</span>  create_time -  创建时间   </span></span><br><span class="line"><span class="comment">      */</span>     </span><br><span class="line">	    <span class="function"><span class="keyword">public</span>  Date <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;         </span><br><span class="line">	    	<span class="keyword">return</span>  createTime ;  </span><br><span class="line">        &#125;     </span><br><span class="line"></span><br><span class="line">	    <span class="comment">/**</span></span><br><span class="line"><span class="comment">	    *  设置创建时间 </span></span><br><span class="line"><span class="comment">	    *</span></span><br><span class="line"><span class="comment">	    *  <span class="doctag">@param</span>  createTime  创建时间 </span></span><br><span class="line"><span class="comment">	    */</span>     </span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">setCreateTime</span><span class="params">(Date createTime)</span> </span>&#123;         </span><br><span class="line">	    	<span class="keyword">this</span> . createTime  = createTime;    </span><br><span class="line">	    	&#125;     </span><br><span class="line"></span><br><span class="line">	    <span class="meta">@Override</span> </span><br><span class="line">	    <span class="function"><span class="keyword">public</span>  String <span class="title">toString</span><span class="params">()</span> </span>&#123;         \</span><br><span class="line">	    	<span class="keyword">return</span>  <span class="string">&quot;User&#123;&quot;</span>  +                 <span class="string">&quot;id=&quot;</span>  +  id  +                 <span class="string">&quot;, </span></span><br><span class="line"><span class="string">	    	username=&#x27;&quot;</span>  +  username  +  <span class="string">&#x27; \&#x27; &#x27;</span>  +                 <span class="string">&quot;, </span></span><br><span class="line"><span class="string">	    	password=&#x27;&quot;</span>  +  password  +  <span class="string">&#x27; \&#x27; &#x27;</span>  +                 <span class="string">&quot;, </span></span><br><span class="line"><span class="string">	    	sex=&quot;</span>  +  sex  + <span class="string">&#x27;&#125;&#x27;</span> ;    </span><br><span class="line">	    &#125;&#125; </span><br></pre></td></tr></table></figure>

<p><strong>新建mapper</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">新建接口UserMapper</span><br><span class="line">src\main\resource路径下新建mapper文件夹并新增UserMapper.xml</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span>  com.atguigu.docker.mapper;</span><br><span class="line"><span class="keyword">import</span>  com.atguigu.docker.entities.User;</span><br><span class="line"><span class="keyword">import</span>  tk.mybatis.mapper.common.Mapper;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span>  <span class="title">UserMapper</span>  <span class="keyword">extends</span>  <span class="title">Mapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><strong>UserMapper.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> &lt;? xml version =&quot;1.0&quot;  encoding =&quot;UTF-8&quot; ?&gt;  </span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE   <span class="meta-keyword">mapper</span>   <span class="meta-keyword">PUBLIC</span>   <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>   <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span> </span><br><span class="line">&lt; mapper  namespace =&quot;com.atguigu.docker.mapper.UserMapper&quot; &gt;     </span><br><span class="line">  &lt; resultMap  id =&quot;BaseResultMap&quot;  type =&quot;com.atguigu.docker.entities.User&quot; &gt;        </span><br><span class="line">    <span class="comment">&lt;!--        WARNING - @mbg.generated      --&gt;</span>       </span><br><span class="line">    &lt; id  column =&quot;id&quot;  jdbcType =&quot;INTEGER&quot;  property =&quot;id&quot;  /&gt;        </span><br><span class="line">    &lt; result  column =&quot;username&quot;  jdbcType =&quot;VARCHAR&quot;  property =&quot;username&quot;  /&gt;       </span><br><span class="line">    &lt; result  column =&quot;password&quot;  jdbcType =&quot;VARCHAR&quot;  property =&quot;password&quot;  /&gt;       </span><br><span class="line">    &lt; result  column =&quot;sex&quot;  jdbcType =&quot;TINYINT&quot;  property =&quot;sex&quot;  /&gt;       </span><br><span class="line">    &lt; result  column =&quot;deleted&quot;  jdbcType =&quot;TINYINT&quot;  property =&quot;deleted&quot;  /&gt;       </span><br><span class="line">    &lt; result  column =&quot;update_time&quot;  jdbcType =&quot;TIMESTAMP&quot;  property =&quot;updateTime&quot;  /&gt;       </span><br><span class="line">    &lt; result  column =&quot;create_time&quot;  jdbcType =&quot;TIMESTAMP&quot;  property =&quot;createTime&quot;  /&gt;     </span><br><span class="line">  &lt;/ resultMap &gt;  </span><br><span class="line">&lt;/ mapper &gt; </span><br></pre></td></tr></table></figure>

<p><strong>新建Service</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">**新建Controller**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mvn package命令将微服务形成新的jar包</span><br><span class="line"></span><br><span class="line">并上传到Linux服务器/mydocker目录下</span><br><span class="line"></span><br><span class="line">**编写Dockerfile**</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line"># 基础镜像使用java </span><br><span class="line">FROM java:8 </span><br><span class="line"># 作者 </span><br><span class="line">MAINTAINER zzyy </span><br><span class="line"># VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp </span><br><span class="line">VOLUME /tmp </span><br><span class="line"># 将jar包添加到容器中并更名为zzyy_docker.jar </span><br><span class="line">ADD docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar </span><br><span class="line"># 运行jar包 </span><br><span class="line">RUN bash -c &#x27;touch /zzyy_docker.jar&#x27; </span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/zzyy_docker.jar&quot;] </span><br><span class="line">#暴露6001端口作为微服务 </span><br><span class="line">EXPOSE 6001 </span><br></pre></td></tr></table></figure>

<p><strong>构建镜像</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t zzyy_docker:1.6 .</span><br></pre></td></tr></table></figure>

<p><strong>5.5.2 不用Compose</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">一、单独的mysql容器实例</span><br><span class="line">1. 新建mysql容器实例</span><br><span class="line">docker run -p 3306:3306 --name mysql57 --privileged=true -v /zzyyuse/mysql/conf:/etc/mysql/conf.d -v /zzyyuse/mysql/logs:/logs -v /zzyyuse/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7</span><br><span class="line"></span><br><span class="line">2. 进入mysql容器实例并新建库db2021+新建表t_user</span><br><span class="line">docker exec -it mysql57 /bin/bash </span><br><span class="line">mysql -uroot -p </span><br><span class="line">create database db2021; </span><br><span class="line">use db2021; </span><br><span class="line">CREATE TABLE `t_user` (</span><br><span class="line">  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT, </span><br><span class="line">  `username` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;用户名&#x27;, </span><br><span class="line">  `password` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;密码&#x27;, </span><br><span class="line">  `sex` TINYINT(4) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;性别 0=女 1=男 &#x27;, </span><br><span class="line">  `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;删除标志，默认0不删除，1删除&#x27;, </span><br><span class="line">  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;更新时间&#x27;, </span><br><span class="line">  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;, </span><br><span class="line">  PRIMARY KEY (`id`) </span><br><span class="line">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;用户表&#x27;; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>单独的redis容器实例</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run  -p 6379:6379 --name redis608 --privileged=true -v /app/redis/redis.conf:/etc/redis/redis.conf -v /app/redis/data:/data -d redis:6.0.8 redis-server /etc/redis/redis.conf </span><br></pre></td></tr></table></figure>

<p><strong>微服务工程</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 6001:6001 zzyy_docker:1.6 </span><br></pre></td></tr></table></figure>

<p><strong>上面三个容器实例依次顺序启动成功</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p><strong>5.5.3 swagger 测试</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:你的微服务端口号/swagger-ui.html#/</span><br></pre></td></tr></table></figure>

<h5 id="5-5-4-上面存在什么问题？"><a href="#5-5-4-上面存在什么问题？" class="headerlink" title="5.5.4 上面存在什么问题？"></a>5.5.4 上面存在什么问题？</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">先后顺序要求固定，先mysql+redis才能微服务访问成功</span><br><span class="line"></span><br><span class="line">多个run命令......</span><br><span class="line"></span><br><span class="line">容器间的启停或宕机，有可能导致IP地址对应的容器实例变化，映射出错，</span><br><span class="line"></span><br><span class="line">要么生产IP写死(可以但是不推荐)，要么通过服务调用</span><br></pre></td></tr></table></figure>

<h5 id="5-5-5-使用Compose"><a href="#5-5-5-使用Compose" class="headerlink" title="5.5.5 使用Compose"></a>5.5.5 使用Compose</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 服务编排，一套带走，安排</span><br><span class="line"></span><br><span class="line">2. 编写docker-componse.yml文件</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span> </span><br><span class="line">  </span><br><span class="line"><span class="attr">services:</span> </span><br><span class="line">  <span class="attr">microService:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">zzyy_docker:1.6</span> </span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">ms01</span> </span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6001:6001&quot;</span> </span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/microService:/data</span> </span><br><span class="line">    <span class="attr">networks:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span>  </span><br><span class="line">    <span class="attr">depends_on:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">mysql</span> </span><br><span class="line">  </span><br><span class="line">  <span class="attr">redis:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.0.8</span> </span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span> </span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/redis/redis.conf:/etc/redis/redis.conf</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/app/redis/data:/data</span> </span><br><span class="line">    <span class="attr">networks:</span>  </span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span> </span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span> <span class="string">/etc/redis/redis.conf</span> </span><br><span class="line">  </span><br><span class="line">  <span class="attr">mysql:</span> </span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span> </span><br><span class="line">    <span class="attr">environment:</span> </span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&#x27;123456&#x27;</span> </span><br><span class="line">      <span class="attr">MYSQL_ALLOW_EMPTY_PASSWORD:</span> <span class="string">&#x27;no&#x27;</span> </span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&#x27;db2021&#x27;</span> </span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">&#x27;zzyy&#x27;</span> </span><br><span class="line">      <span class="attr">MYSQL_PASSWORD:</span> <span class="string">&#x27;zzyy123&#x27;</span> </span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">       <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span> </span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">       <span class="bullet">-</span> <span class="string">/app/mysql/db:/var/lib/mysql</span> </span><br><span class="line">       <span class="bullet">-</span> <span class="string">/app/mysql/conf/my.cnf:/etc/my.cnf</span> </span><br><span class="line">       <span class="bullet">-</span> <span class="string">/app/mysql/init:/docker-entrypoint-initdb.d</span> </span><br><span class="line">    <span class="attr">networks:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">atguigu_net</span> </span><br><span class="line">    <span class="attr">command:</span> <span class="string">--default-authentication-plugin=mysql_native_password</span> <span class="comment">#解决外部无法访问 </span></span><br><span class="line">  </span><br><span class="line"><span class="attr">networks:</span>  </span><br><span class="line">   <span class="attr">atguigu_net:</span>  </span><br><span class="line"> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3. 第二次修改微服务工程docker_boot</span><br><span class="line">写YML 通过服务名访问，IP无关</span><br></pre></td></tr></table></figure>

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">server.port</span> = <span class="string">6001</span></span><br><span class="line"><span class="comment"># ========================alibaba.druid 相关配置 =====================</span></span><br><span class="line"><span class="meta">spring.datasource.type</span> = <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">#spring.datasource.url=jdbc:mysql://192.168.111.169:3306/db2021?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="meta">spring.datasource.url</span> = <span class="string">jdbc:mysql://mysql:3306/db2021?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false spring.datasource.username = rootspring.datasource.password = 123456spring.datasource.druid.test-while-idle = false</span></span><br><span class="line"><span class="comment"># ========================redis 相关配置 =====================</span></span><br><span class="line"><span class="meta">spring.redis.database</span> = <span class="string">0</span></span><br><span class="line"><span class="comment">#spring.redis.host=192.168.111.169</span></span><br><span class="line"><span class="meta">spring.redis.host</span> = <span class="string">redis </span></span><br><span class="line"><span class="meta">spring.redis.port</span> = <span class="string">6379</span></span><br><span class="line"><span class="meta">spring.redis.password</span> =<span class="string"></span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-active</span> = <span class="string">8</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-wait</span> = <span class="string">-1ms</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-idle</span> = <span class="string">8</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.min-idle</span> = <span class="string">0</span></span><br><span class="line"><span class="comment"># ========================mybatis 相关配置 ===================</span></span><br><span class="line"><span class="meta">mybatis.mapper-locations</span> = <span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="meta">mybatis.type-aliases-package</span> = <span class="string">com.atguigu.docker.entities</span></span><br><span class="line"><span class="comment"># ========================swagger=====================</span></span><br><span class="line"><span class="meta">spring.swagger2.enabled</span> = <span class="string">true </span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mvn package命令将微服务形成新的jar包</span><br><span class="line">并上传到Linux服务器/mydocker目录下</span><br><span class="line"></span><br><span class="line">编写Dockerfile</span><br><span class="line"><span class="meta">#</span><span class="bash"> 基础镜像使用java</span> </span><br><span class="line">FROM java:8 </span><br><span class="line"><span class="meta">#</span><span class="bash"> 作者</span> </span><br><span class="line">MAINTAINER zzyy </span><br><span class="line"><span class="meta">#</span><span class="bash"> VOLUME 指定临时文件目录为/tmp，在主机/var/lib/docker目录下创建了一个临时文件并链接到容器的/tmp</span> </span><br><span class="line">VOLUME /tmp </span><br><span class="line"><span class="meta">#</span><span class="bash"> 将jar包添加到容器中并更名为zzyy_docker.jar</span> </span><br><span class="line">ADD docker_boot-0.0.1-SNAPSHOT.jar zzyy_docker.jar </span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行jar包</span> </span><br><span class="line">RUN bash -c &#x27;touch /zzyy_docker.jar&#x27; </span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/zzyy_docker.jar&quot;] </span><br><span class="line"><span class="meta">#</span><span class="bash">暴露6001端口作为微服务</span> </span><br><span class="line">EXPOSE 6001 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">构建镜像</span><br><span class="line">docker build -t zzyy_docker:1.6 .</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4. 执行 docker-compose up 或者 执行 docker-compose up -d</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">5. 进入mysql容器实例并新建库db2021+新建表t_user</span><br><span class="line">docker exec -it 容器实例id /bin/bash </span><br><span class="line">mysql -uroot -p </span><br><span class="line">create database db2021; </span><br><span class="line">use db2021; </span><br><span class="line">CREATE TABLE `t_user` (</span><br><span class="line">  `id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT, </span><br><span class="line">  `username` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;用户名&#x27;, </span><br><span class="line">  `password` VARCHAR(50) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;密码&#x27;, </span><br><span class="line">  `sex` TINYINT(4) NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;性别 0=女 1=男 &#x27;, </span><br><span class="line">  `deleted` TINYINT(4) UNSIGNED NOT NULL DEFAULT &#x27;0&#x27; COMMENT &#x27;删除标志，默认0不删除，1删除&#x27;, </span><br><span class="line">  `update_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;更新时间&#x27;, </span><br><span class="line">  `create_time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;, </span><br><span class="line">  PRIMARY KEY (`id`) </span><br><span class="line">) ENGINE=INNODB AUTO_INCREMENT=1 DEFAULT CHARSET=utf8mb4 COMMENT=&#x27;用户表&#x27;; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">6. 测试通过</span><br><span class="line">7. Compose常用命令</span><br><span class="line">Compose 常用命令 </span><br><span class="line">docker-compose -h                           #  查看帮助 </span><br><span class="line">docker-compose up                           #  启动所有 docker-compose服务 </span><br><span class="line">docker-compose up -d                        #  启动所有 docker-compose服务 并后台运行 </span><br><span class="line">docker-compose down                         #  停止并删除容器、网络、卷、镜像。 </span><br><span class="line">docker-compose exec  yml里面的服务id                 # 进入容器实例内部  docker-compose exec  docker-compose.yml文件中写的服务id  /bin/bash </span><br><span class="line">docker-compose ps                      # 展示当前docker-compose编排过的运行的所有容器 </span><br><span class="line">docker-compose top                     # 展示当前docker-compose编排过的容器进程 </span><br><span class="line"> </span><br><span class="line">docker-compose logs  yml里面的服务id     #  查看容器输出日志 </span><br><span class="line">dokcer-compose config     #  检查配置 </span><br><span class="line">dokcer-compose config -q  #  检查配置，有问题才有输出 </span><br><span class="line">docker-compose restart   #  重启服务 </span><br><span class="line">docker-compose start     #  启动服务 </span><br><span class="line">docker-compose stop      #  停止服务 </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8. 关停</span><br><span class="line">docker -compose stop</span><br></pre></td></tr></table></figure>

<h3 id="六、Docker轻量级可视化工具Portainer"><a href="#六、Docker轻量级可视化工具Portainer" class="headerlink" title="六、Docker轻量级可视化工具Portainer"></a>六、Docker轻量级可视化工具Portainer</h3><h4 id="6-1-是什么"><a href="#6-1-是什么" class="headerlink" title="6.1 是什么"></a>6.1 是什么</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Portainer 是一款轻量级的应用，它提供了图形化界面，用于方便地管理Docker环境，包括单机环境和集群环境。 </span><br></pre></td></tr></table></figure>

<h4 id="6-2-安装"><a href="#6-2-安装" class="headerlink" title="6.2 安装"></a>6.2 安装</h4><blockquote>
<p>一、官网</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.portainer.io/">https://www.portainer.io/</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux">https://docs.portainer.io/v/ce-2.9/start/install/server/docker/linux</a></p>
<p>二、步骤</p>
<ol>
<li>docker命令安装</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker run -d -p 8000:8000 -p 9000:9000 --name portainer     --restart=always     -v /var/run/docker.sock:/var/run/docker.sock     -v portainer_data:/data     portainer/portainer</span> </span><br></pre></td></tr></table></figure>

<ol start="2">
<li>第一次登录需创建admin，访问地址：xxx.xxx.xxx.xxx:9000</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">用户名，直接用默认admin</span> </span><br><span class="line"><span class="meta">&gt;</span><span class="bash">密码记得8位，随便你写</span> </span><br></pre></td></tr></table></figure>

<ol start="3">
<li>设置admin用户和密码后首次登陆</li>
<li>选择local选项卡后本地docker详细信息展示</li>
<li>上一步的图形展示，能想得起对应命令吗？</li>
<li>登陆并演示介绍常用操作case</li>
</ol>
</blockquote>
<h3 id="七、Docker容器监控之CAdvisor-InfluxDB-Granfana"><a href="#七、Docker容器监控之CAdvisor-InfluxDB-Granfana" class="headerlink" title="七、Docker容器监控之CAdvisor+InfluxDB+Granfana"></a>七、Docker容器监控之CAdvisor+InfluxDB+Granfana</h3><h4 id="7-1-原生命令"><a href="#7-1-原生命令" class="headerlink" title="7.1 原生命令"></a>7.1 原生命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker stats命令的结果 </span><br><span class="line"></span><br><span class="line">问题</span><br><span class="line">通过docker stats命令可以很方便的看到当前宿主机上所有容器的CPU,内存以及网络流量等数据， 一般小公司够用了。。。。 </span><br><span class="line">但是</span><br><span class="line">docker stats统计结果只能是当前宿主机的全部容器，数据资料是实时的，没有地方存储、没有健康指标过线预警等功能 </span><br></pre></td></tr></table></figure>

<h4 id="7-2-是什么"><a href="#7-2-是什么" class="headerlink" title="7.2 是什么"></a>7.2 是什么</h4><blockquote>
<p>容器监控3剑客</p>
<p>一句话</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">CAdvisor监控收集+InfluxDB存储数据+Granfana展示图表</span></span><br></pre></td></tr></table></figure>

<p><strong>CAdvisor</strong></p>
<p><img src="images/71.png" alt="71"></p>
<p><strong>InfluxDB</strong></p>
<p><img src="images/72.png" alt="72"></p>
<p>Granfana</p>
<p><img src="images/73.png" alt="73"></p>
</blockquote>
<h4 id="7-3-compose容器编排，一套带走"><a href="#7-3-compose容器编排，一套带走" class="headerlink" title="7.3 compose容器编排，一套带走"></a>7.3 compose容器编排，一套带走</h4><blockquote>
<p>一、新建目录</p>
<p>二、新建3件套组合的 docker-compose.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&gt;version:</span> <span class="string">&#x27;3.1&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="string">&gt;volumes:</span> </span><br><span class="line"><span class="string">&gt;grafana_data:</span> &#123;&#125; </span><br><span class="line"></span><br><span class="line"><span class="string">&gt;services:</span> </span><br><span class="line"><span class="string">&gt;influxdb:</span> </span><br><span class="line"><span class="string">&gt;image:</span> <span class="string">tutum/influxdb:0.9</span> </span><br><span class="line"><span class="string">&gt;restart:</span> <span class="string">always</span> </span><br><span class="line"><span class="string">&gt;environment:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">PRE_CREATE_DB=cadvisor</span> </span><br><span class="line"><span class="attr">ports:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;8083:8083&quot;</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;8086:8086&quot;</span> </span><br><span class="line"><span class="attr">volumes:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">./data/influxdb:/data</span> </span><br><span class="line"></span><br><span class="line"><span class="string">&gt;cadvisor:</span> </span><br><span class="line"><span class="attr">image:</span> <span class="string">google/cadvisor</span> </span><br><span class="line"><span class="attr">links:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span> </span><br><span class="line"><span class="attr">command:</span> <span class="string">-storage_driver=influxdb</span> <span class="string">-storage_driver_db=cadvisor</span> <span class="string">-storage_driver_host=influxsrv:8086</span> </span><br><span class="line"><span class="attr">restart:</span> <span class="string">always</span> </span><br><span class="line"><span class="attr">ports:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span> </span><br><span class="line"><span class="attr">volumes:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">/:/rootfs:ro</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">/var/run:/var/run:rw</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">/sys:/sys:ro</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">/var/lib/docker/:/var/lib/docker:ro</span> </span><br><span class="line"></span><br><span class="line"><span class="string">&gt;grafana:</span> </span><br><span class="line"><span class="attr">user:</span> <span class="string">&quot;104&quot;</span> </span><br><span class="line"><span class="attr">image:</span> <span class="string">grafana/grafana</span> </span><br><span class="line"><span class="attr">user:</span> <span class="string">&quot;104&quot;</span> </span><br><span class="line"><span class="attr">restart:</span> <span class="string">always</span> </span><br><span class="line"><span class="attr">links:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">influxdb:influxsrv</span> </span><br><span class="line"><span class="attr">ports:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;3000:3000&quot;</span> </span><br><span class="line"><span class="attr">volumes:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">grafana_data:/var/lib/grafana</span> </span><br><span class="line"><span class="attr">environment:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">HTTP_USER=admin</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">HTTP_PASS=admin</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">INFLUXDB_HOST=influxsrv</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">INFLUXDB_PORT=8086</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">INFLUXDB_NAME=cadvisor</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">INFLUXDB_USER=root</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">INFLUXDB_PASS=root</span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>三、启动docker-compose文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker-compose up</span></span><br></pre></td></tr></table></figure>

<p>四、查看三个服务容器是否启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">docker ps</span></span><br></pre></td></tr></table></figure>

<p>五、测试</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;1.</span> <span class="string">浏览cAdvisor收集服务，http://ip:8080/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&gt;第一次访问慢，请稍等</span></span><br><span class="line"></span><br><span class="line"><span class="attr">&gt;cadvisor也有基础的图形展现功能，这里主要用它来作数据采集</span></span><br><span class="line"><span class="meta">&gt;2.</span> <span class="string">浏览influxdb存储服务，http://ip:8083/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;3. 浏览grafana展现服务，http://ip:3000</span><br><span class="line">ip+3000端口的方式访问,默认帐户密码（admin/admin）</span><br><span class="line">https://gitee.com/yooome/golang/tree/main/Docker详细教程</span><br><span class="line">配置步骤</span><br><span class="line">[1] 配置数据源</span><br><span class="line">[2] 选择influxdb数据源</span><br><span class="line">[3] 配置细节</span><br><span class="line">[4] 配置面板panel</span><br><span class="line">[5] 到这里cAdvisor+InfluxDB+Grafana容器监控系统就部署完成了</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bilibili.com/video/BV1gr4y1U7CY?p=88">原视频地址</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://gitee.com/yooome/golang">原文章地址</a></p>
</blockquote>
<script type="text&#x2F;javascript" src="https://cdn.jsdelivr.net/npm/kity@2.0.4/dist/kity.min.js"></script><script type="text&#x2F;javascript" src="https://cdn.jsdelivr.net/npm/kityminder-core@1.4.50/dist/kityminder.core.min.js"></script><script defer="true" type="text&#x2F;javascript" src="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.7.0/dist/mindmap.min.js"></script><link rel="stylesheet" type="text&#x2F;css" href="https://cdn.jsdelivr.net/npm/hexo-simple-mindmap@0.7.0/dist/mindmap.min.css">
    </div>

    
    
    
    
      <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束 <i class="fa fa-heart"></i> 感谢阅读-------------</div>
    
      

        <div class="reward-container">
  <div>献上你的银子！</div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="lwy 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="lwy 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>lwy
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://lwy0518.github.io/2022/02/13/docker%E9%AB%98%E7%BA%A7%E7%AF%87%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="docker高级篇学习笔记">https://lwy0518.github.io/2022/02/13/docker高级篇学习笔记/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>欢迎关注我的其它发布渠道</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/qq_channel.jpg">
            <span class="icon">
              <i class="fab fa-qq"></i>
            </span>

            <span class="label">QQ</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/Docker/" rel="tag"> <i class="fa fa-tag"></i>Docker</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/02/13/docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="docker学习笔记">
      <i class="fa fa-chevron-left"></i> docker学习笔记
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          

  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Docker-%E9%AB%98%E7%BA%A7%E7%AF%87"><span class="nav-number">2.</span> <span class="nav-text">Docker 高级篇</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81Docker%E5%A4%8D%E6%9D%82%E5%AE%89%E8%A3%85"><span class="nav-number">3.</span> <span class="nav-text">一、Docker复杂安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-1-%E5%AE%89%E8%A3%85mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="nav-number">3.1.</span> <span class="nav-text">1.1 安装mysql主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-1-%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.1.</span> <span class="nav-text">1.1.1 主从复制原理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-2-%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA%E6%AD%A5%E9%AA%A4"><span class="nav-number">3.1.2.</span> <span class="nav-text">1.1.2 主从搭建步骤</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#1-2-%E5%AE%89%E8%A3%85redis%E9%9B%86%E7%BE%A4-%E5%A4%A7%E5%8E%82%E9%9D%A2%E8%AF%95%E9%A2%98%E7%AC%AC4%E5%AD%A3-%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8%E6%A1%88%E4%BE%8B%E7%9C%9F%E9%A2%98"><span class="nav-number">3.2.</span> <span class="nav-text">1.2 安装redis集群(大厂面试题第4季-分布式存储案例真题)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-1-cluster-%E9%9B%86%E7%BE%A4-%E6%A8%A1%E5%BC%8F-docker%E7%89%88%E5%93%88%E5%B8%8C%E6%A7%BD%E5%88%86%E5%8C%BA%E8%BF%9B%E8%A1%8C%E4%BA%BF%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="nav-number">3.2.1.</span> <span class="nav-text">1.2.1 cluster(集群)模式-docker版哈希槽分区进行亿级数据存储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-2-redis%E9%9B%86%E7%BE%A43%E4%B8%BB3%E4%BB%8E%E6%89%A9%E7%BC%A9%E5%AE%B9%E9%85%8D%E7%BD%AE%E6%A1%88%E4%BE%8B"><span class="nav-number">3.2.2.</span> <span class="nav-text">1.2.2 redis集群3主3从扩缩容配置案例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-3-%E4%B8%BB%E4%BB%8E%E5%AE%B9%E9%94%99%E5%88%87%E6%8D%A2%E8%BF%81%E7%A7%BB%E6%A1%88%E4%BE%8B"><span class="nav-number">3.2.3.</span> <span class="nav-text">1.2.3 主从容错切换迁移案例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-4-%E4%B8%BB%E4%BB%8E%E6%89%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="nav-number">3.2.4.</span> <span class="nav-text">1.2.4 主从扩容案例</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-5-%E4%B8%BB%E4%BB%8E%E7%BC%A9%E5%AE%B9%E6%A1%88%E4%BE%8B"><span class="nav-number">3.2.5.</span> <span class="nav-text">1.2.5 主从缩容案例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81DockerFile%E8%A7%A3%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">二、DockerFile解析</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-DockerFile%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">4.1.</span> <span class="nav-text">2.1 DockerFile是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B%E8%A7%A3%E6%9E%90"><span class="nav-number">4.2.</span> <span class="nav-text">2.2 DockerFile构建过程解析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-%E5%B0%8F%E6%80%BB%E7%BB%93"><span class="nav-number">4.3.</span> <span class="nav-text">2.3 小总结</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-DockerFile%E5%B8%B8%E7%94%A8%E4%BF%9D%E7%95%99%E5%AD%97%E6%8C%87%E4%BB%A4"><span class="nav-number">4.4.</span> <span class="nav-text">2.4 DockerFile常用保留字指令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-%E6%A1%88%E4%BE%8B"><span class="nav-number">4.5.</span> <span class="nav-text">2.5 案例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-1-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%95%9C%E5%83%8Fmycentosjava8"><span class="nav-number">4.5.1.</span> <span class="nav-text">2.5.1 自定义镜像mycentosjava8</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-2-%E8%99%9A%E6%82%AC%E9%95%9C%E5%83%8F"><span class="nav-number">4.5.2.</span> <span class="nav-text">2.5.2 虚悬镜像</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#2-5-3-%E5%AE%B6%E5%BA%AD%E4%BD%9C%E4%B8%9A%E8%87%AA%E5%AE%9A%E4%B9%89myubuntu"><span class="nav-number">4.5.3.</span> <span class="nav-text">2.5.3 家庭作业自定义myubuntu</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81Docker%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98"><span class="nav-number">5.</span> <span class="nav-text">三、Docker微服务实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-%E9%80%9A%E8%BF%87IDEA%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AA%E6%99%AE%E9%80%9A%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9D%97"><span class="nav-number">5.1.</span> <span class="nav-text">3.1 通过IDEA新建一个普通微服务模块</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-%E9%80%9A%E8%BF%87dockerfile-%E5%8F%91%E5%B8%83%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%83%A8%E7%BD%B2%E5%88%B0docker%E5%AE%B9%E5%99%A8"><span class="nav-number">5.2.</span> <span class="nav-text">3.2 通过dockerfile 发布微服务部署到docker容器</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-1-IDEA%E5%B7%A5%E5%85%B7%E9%87%8C%E9%9D%A2%E6%90%9E%E5%AE%9A%E5%BE%AE%E6%9C%8D%E5%8A%A1jar%E5%8C%85"><span class="nav-number">5.2.1.</span> <span class="nav-text">3.2.1 IDEA工具里面搞定微服务jar包</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-2-%E7%BC%96%E5%86%99Dockerfile"><span class="nav-number">5.2.2.</span> <span class="nav-text">3.2.2 编写Dockerfile</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81Docker%E7%BD%91%E7%BB%9C"><span class="nav-number">6.</span> <span class="nav-text">四、Docker网络</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-Docker-%E7%BD%91%E7%BB%9C%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">6.1.</span> <span class="nav-text">4.1 Docker 网络是什么</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-1-docker%E4%B8%8D%E5%90%AF%E5%8A%A8%EF%BC%8C%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9C%E6%83%85%E5%86%B5"><span class="nav-number">6.1.1.</span> <span class="nav-text">4.1.1 docker不启动，默认网络情况</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-1-2-docker%E5%90%AF%E5%8A%A8%E5%90%8E%EF%BC%8C%E7%BD%91%E7%BB%9C%E6%83%85%E5%86%B5"><span class="nav-number">6.1.2.</span> <span class="nav-text">4.1.2 docker启动后，网络情况</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-%E5%B8%B8%E7%94%A8%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="nav-number">6.2.</span> <span class="nav-text">4.2 常用基本命令</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-1-All-%E5%91%BD%E4%BB%A4"><span class="nav-number">6.2.1.</span> <span class="nav-text">4.2.1 All 命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-2-%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C"><span class="nav-number">6.2.2.</span> <span class="nav-text">4.2.2 查看网络</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-3-%E6%9F%A5%E7%9C%8B%E7%BD%91%E7%BB%9C%E6%BA%90%E6%95%B0%E6%8D%AE"><span class="nav-number">6.2.3.</span> <span class="nav-text">4.2.3 查看网络源数据</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-4-%E5%88%A0%E9%99%A4%E7%BD%91%E7%BB%9C"><span class="nav-number">6.2.4.</span> <span class="nav-text">4.2.4 删除网络</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-2-5-%E6%A1%88%E4%BE%8B"><span class="nav-number">6.2.5.</span> <span class="nav-text">4.2.5 案例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="nav-number">6.3.</span> <span class="nav-text">4.3 能干嘛</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-%E7%BD%91%E7%BB%9C%E6%A8%A1%E5%BC%8F"><span class="nav-number">6.4.</span> <span class="nav-text">4.4 网络模式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-1-%E6%80%BB%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.4.1.</span> <span class="nav-text">4.4.1 总体介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-2-%E5%AE%B9%E5%99%A8%E5%AE%9E%E4%BE%8B%E5%86%85%E9%BB%98%E8%AE%A4%E7%BD%91%E7%BB%9CIP%E7%94%9F%E4%BA%A7%E8%A7%84%E5%88%99"><span class="nav-number">6.4.2.</span> <span class="nav-text">4.4.2 容器实例内默认网络IP生产规则</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#4-4-3-%E6%A1%88%E4%BE%8B%E8%AF%B4%E6%98%8E"><span class="nav-number">6.4.3.</span> <span class="nav-text">4.4.3 案例说明</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-5-Docker%E5%B9%B3%E5%8F%B0%E6%9E%B6%E6%9E%84%E5%9B%BE%E8%A7%A3"><span class="nav-number">6.5.</span> <span class="nav-text">4.5 Docker平台架构图解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81Docker-compose%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92"><span class="nav-number">7.</span> <span class="nav-text">五、Docker-compose容器编排</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-Docker-compose%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">7.1.</span> <span class="nav-text">5.1 Docker-compose是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-%E8%83%BD%E5%B9%B2%E4%BB%80%E4%B9%88"><span class="nav-number">7.2.</span> <span class="nav-text">5.2 能干什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-%E5%8E%BB%E5%93%AA%E9%87%8C"><span class="nav-number">7.3.</span> <span class="nav-text">5.3 去哪里</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-1-%E5%AE%98%E7%BD%91%EF%BC%9A"><span class="nav-number">7.3.1.</span> <span class="nav-text">5.3.1 官网：</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-2-%E5%AE%98%E7%BD%91%E4%B8%8B%E8%BD%BD"><span class="nav-number">7.3.2.</span> <span class="nav-text">5.3.2 官网下载</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-3-%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="nav-number">7.3.3.</span> <span class="nav-text">5.3.3 安装步骤</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-3-4-%E5%8D%B8%E8%BD%BD%E6%AD%A5%E9%AA%A4"><span class="nav-number">7.3.4.</span> <span class="nav-text">5.3.4 卸载步骤</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-Compose-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">7.4.</span> <span class="nav-text">5.4 Compose 核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-1-%E4%B8%80%E6%96%87%E4%BB%B6"><span class="nav-number">7.4.1.</span> <span class="nav-text">5.4.1 一文件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-4-2-%E4%B8%A4%E8%A6%81%E7%B4%A0"><span class="nav-number">7.4.2.</span> <span class="nav-text">5.4.2 两要素</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-Compose-%E4%BD%BF%E7%94%A8%E7%9A%84%E4%B8%89%E4%B8%AA%E6%AD%A5%E9%AA%A4"><span class="nav-number">7.5.</span> <span class="nav-text">5.5 Compose 使用的三个步骤</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-6-Compose%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">7.6.</span> <span class="nav-text">5.6 Compose常用命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-5-Componse-%E7%BC%96%E6%8E%92%E5%BE%AE%E6%9C%8D%E5%8A%A1"><span class="nav-number">7.7.</span> <span class="nav-text">5.5 Componse 编排微服务</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-5-1-%E6%94%B9%E9%80%A0%E5%8D%87%E7%BA%A7%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%B7%A5%E7%A8%8Bdocker-boot"><span class="nav-number">7.7.1.</span> <span class="nav-text">5.5.1 改造升级微服务工程docker_boot</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-5-4-%E4%B8%8A%E9%9D%A2%E5%AD%98%E5%9C%A8%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="nav-number">7.7.2.</span> <span class="nav-text">5.5.4 上面存在什么问题？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-5-5-%E4%BD%BF%E7%94%A8Compose"><span class="nav-number">7.7.3.</span> <span class="nav-text">5.5.5 使用Compose</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81Docker%E8%BD%BB%E9%87%8F%E7%BA%A7%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7Portainer"><span class="nav-number">8.</span> <span class="nav-text">六、Docker轻量级可视化工具Portainer</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">8.1.</span> <span class="nav-text">6.1 是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-%E5%AE%89%E8%A3%85"><span class="nav-number">8.2.</span> <span class="nav-text">6.2 安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%83%E3%80%81Docker%E5%AE%B9%E5%99%A8%E7%9B%91%E6%8E%A7%E4%B9%8BCAdvisor-InfluxDB-Granfana"><span class="nav-number">9.</span> <span class="nav-text">七、Docker容器监控之CAdvisor+InfluxDB+Granfana</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-%E5%8E%9F%E7%94%9F%E5%91%BD%E4%BB%A4"><span class="nav-number">9.1.</span> <span class="nav-text">7.1 原生命令</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="nav-number">9.2.</span> <span class="nav-text">7.2 是什么</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-compose%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%EF%BC%8C%E4%B8%80%E5%A5%97%E5%B8%A6%E8%B5%B0"><span class="nav-number">9.3.</span> <span class="nav-text">7.3 compose容器编排，一套带走</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lwy"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">lwy</p>
  <div class="site-description" itemprop="description">茫茫人海，总会与你相遇</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/lwy0518" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;lwy0518" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/qq_channel.jpg" title="QQ → &#x2F;images&#x2F;qq_channel.jpg"><i class="fab fa-qq fa-fw"></i>QQ</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/wechat_channel.jpg" title="WeChat → &#x2F;images&#x2F;wechat_channel.jpg"><i class="fab fa-weixin fa-fw"></i>WeChat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/yourname" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;yourname" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://myaccount.google.com/" title="Google → https:&#x2F;&#x2F;myaccount.google.com&#x2F;" rel="noopener external nofollow noreferrer" target="_blank"><i class="fab fa-google fa-fw"></i>Google</a>
      </span>
      <span class="links-of-author-item">
        <a href="/images/zhihu_channel.jpg" title="Zhihu → &#x2F;images&#x2F;zhihu_channel.jpg"><i class="fab fa-zhihu fa-fw"></i>Zhihu</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

      
      
        <div class="links-of-blogroll motion-element links-of-blogroll-block">
          <div class="links-of-blogroll-title">
            <!-- modify icon to fire by szw -->
            <i class="fa fa-history fa-" aria-hidden="true"></i>
            近期文章
          </div>
          <ul class="links-of-blogroll-list">
            
            
              <li class="recent_posts_li">
                <a href="/" title="" target="_blank"></a>
              </li>
            
              <li class="recent_posts_li">
                <a href="/" title="" target="_blank"></a>
              </li>
            
              <li class="recent_posts_li">
                <a href="/" title="" target="_blank"></a>
              </li>
            
              <li class="recent_posts_li">
                <a href="/" title="" target="_blank"></a>
              </li>
            
              <li class="recent_posts_li">
                <a href="/" title="" target="_blank"></a>
              </li>
            
          </ul>
        </div>
      
      
      

      
          
      
      <div id="music163player">
    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=320 height=320 src="//music.163.com/outchain/player?type=0&id=5419518169&auto=0&height=430"></iframe>
</div>

<div style="">
  <canvas id="canvas" style="width:60%;">当前浏览器不支持canvas，请更换浏览器后再试</canvas>
</div>
<script>
(function(){

   var digit=
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,0,0,0]
        ]//:
    ];

var canvas = document.getElementById('canvas');

if(canvas.getContext){
    var cxt = canvas.getContext('2d');
    //声明canvas的宽高
    var H = 100,W = 700;
    canvas.height = H;
    canvas.width = W;
    cxt.fillStyle = '#f00';
    cxt.fillRect(10,10,50,50);

    //存储时间数据
    var data = [];
    //存储运动的小球
    var balls = [];
    //设置粒子半径
    var R = canvas.height/20-1;
    (function(){
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        //存储时间数字，由十位小时、个位小时、冒号、十位分钟、个位分钟、冒号、十位秒钟、个位秒钟这7个数字组成
        data.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
    })();

    /*生成点阵数字*/
    function renderDigit(index,num){
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    cxt.beginPath();
                    cxt.arc(14*(R+2)*index + j*2*(R+1)+(R+1),i*2*(R+1)+(R+1),R,0,2*Math.PI);
                    cxt.closePath();
                    cxt.fill();
                }
            }
        }
    }

    /*更新时钟*/
    function updateDigitTime(){
        var changeNumArray = [];
        var temp = /(\d)(\d):(\d)(\d):(\d)(\d)/.exec(new Date());
        var NewData = [];
        NewData.push(temp[1],temp[2],10,temp[3],temp[4],10,temp[5],temp[6]);
        for(var i = data.length-1; i >=0 ; i--){
            //时间发生变化
            if(NewData[i] !== data[i]){
                //将变化的数字值和在data数组中的索引存储在changeNumArray数组中
                changeNumArray.push(i+'_'+(Number(data[i])+1)%10);
            }
        }
        //增加小球
        for(var i = 0; i< changeNumArray.length; i++){
            addBalls.apply(this,changeNumArray[i].split('_'));
        }
        data = NewData.concat();
    }

    /*更新小球状态*/
    function updateBalls(){
        for(var i = 0; i < balls.length; i++){
            balls[i].stepY += balls[i].disY;
            balls[i].x += balls[i].stepX;
            balls[i].y += balls[i].stepY;
            if(balls[i].x > W + R || balls[i].y > H + R){
                balls.splice(i,1);
                i--;
            }
        }
    }

    /*增加要运动的小球*/
    function addBalls(index,num){
        var numArray = [1,2,3];
        var colorArray =  ["#3BE","#09C","#A6C","#93C","#9C0","#690","#FB3","#F80","#F44","#C00"];
        for(var i = 0; i < digit[num].length; i++){
            for(var j = 0; j < digit[num][i].length; j++){
                if(digit[num][i][j] == 1){
                    var ball = {
                        x:14*(R+2)*index + j*2*(R+1)+(R+1),
                        y:i*2*(R+1)+(R+1),
                        stepX:Math.floor(Math.random() * 4 -2),
                        stepY:-2*numArray[Math.floor(Math.random()*numArray.length)],
                        color:colorArray[Math.floor(Math.random()*colorArray.length)],
                        disY:1
                    };
                    balls.push(ball);
                }
            }
        }
    }

    /*渲染*/
    function render(){
        //重置画布宽度，达到清空画布的效果
        canvas.height = 100;
        //渲染时钟
        for(var i = 0; i < data.length; i++){
            renderDigit(i,data[i]);
        }
        //渲染小球
        for(var i = 0; i < balls.length; i++){
            cxt.beginPath();
            cxt.arc(balls[i].x,balls[i].y,R,0,2*Math.PI);
            cxt.fillStyle = balls[i].color;
            cxt.closePath();
            cxt.fill();
        }
    }

    clearInterval(oTimer);
    var oTimer = setInterval(function(){
        //更新时钟
        updateDigitTime();
        //更新小球状态
        updateBalls();
        //渲染
        render();
    },50);
}

})();
</script>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>



      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lwy</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">384k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">5:49</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener external nofollow noreferrer" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<!-- 
  
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

 -->

<div class="translate-style">
繁/简：<a id="translateLink" href="javascript:translatePage();" rel="external nofollow noreferrer">繁体
</a>
</div>
<script type="text/javascript" src="/js/tw_cn.js"></script>
<script type="text/javascript">
var defaultEncoding = 2; //网站编写字体是否繁体，1-繁体，2-简体
var translateDelay = 0; //延迟时间,若不在前, 要设定延迟翻译时间, 如100表示100ms,默认为0
var cookieDomain = "https://tding.top/"; //Cookie地址, 一定要设定, 通常为你的网址
var msgToTraditionalChinese = "繁体"; //此处可以更改为你想要显示的文字
var msgToSimplifiedChinese = "简体"; //同上，但两处均不建议更改
var translateButtonId = "translateLink"; //默认互换id
translateInitilization();
</script>

<!-- 网站运行时间的设置 -->
<span id="timeDate">载入天数...</span>
<span id="times">载入时分秒...</span>
<script>
    var now = new Date();
    function createtime() {
        var grt= new Date("12/6/2021 00:00:00");//此处修改你的建站时间或者网站上线时间
        now.setTime(now.getTime()+250);
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 ";
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒";
    }
setInterval("createtime()",250);
</script>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/canvas_lines.min.js"></script>


  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'MFQhQyWNB2j6szwYkM7xnoPx-gzGzoHsz',
      appKey     : 'Ef8odmx3eh3G2SQX8kki5PVV',
      placeholder: "｡◕‿◕｡ 请献上你的口水！",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>
<div class="moon-menu">
  <div class="moon-menu-items">
    
    <div id="moon-menu-item-back2bottom" class="moon-menu-item" onclick="back2bottom()">
      <i class='fa fa-chevron-down'></i>    </div>
    
    <div id="moon-menu-item-back2top" class="moon-menu-item" onclick="back2top()">
      <i class='fa fa-chevron-up'></i>    </div>
    
  </div>
  <div class="moon-menu-button">
    <svg class="moon-menu-bg">
      <circle class="moon-menu-cricle" cx="50%" cy="50%" r="44%"></circle>
      <circle class="moon-menu-border" cx="50%" cy="50%" r="48%"></circle>
    </svg>
    <div class="moon-menu-content">
      <div class="moon-menu-icon"><i class='fas fa-ellipsis-v'></i></div>
      <div class="moon-menu-text"></div>
    </div>
  </div>
</div><script src="/js/injector.js"></script>

  

  <script async src="/js/cursor/fireworks.js"></script>




  <script src="/js/activate-power-mode.min.js"></script>
  <script>
    POWERMODE.colorful = true;
    POWERMODE.shake = false;
    document.body.addEventListener('input', POWERMODE);
  </script>


  <script type="text/javascript" src="/js/click-loveword.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"live2d-widget-model-wanko"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-10},"mobile":{"show":true,"scale":0.05},"react":{"opacityDefault":0.7,"opacityOnHover":0.2}});</script></body>
</html>
